{
  "permissions": {
    "allow": [
      "Bash(powershell -Command \"[System.IO.File]::WriteAllBytes(''c:/Users/28218/WeChatProjects/miniprogram-1/miniprogram/images/tab-home.png'', [System.Convert]::FromBase64String(''iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAsQAAALEBxi1JjQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAADlSURBVEiJ7ZSxDcIwEEVfIhawAAuwAQuwARtADxuwARuwQTYgG0AHHaIDCl5hOfElsS3UcNKT7fv/7tx5DmQyGS75Aw7qNB8F3oEb4AScqNP8rL7QLHAL3AJP6jQf+xWHWuABuAMeg8JRA18ngD3gOSi84OP4CRaE1gH2KpqBZ+CdY+Ag4PwMjfnxvEuNYJ8DtgM4Bp6CwqvAzd8CYwJjAmMCYwJjAmMCYwJD4CIoZALY/S0w5m/v4F4ddIDtAA6AZ+Cd14CD8DOhHsABcBcU3qvT/NQz4A14BF6A54D9M8GRzGT+Cj9A5lLZyLUFywAAAABJRU5ErkJggg==''))\")",
      "Bash(powershell -Command \"[System.IO.File]::WriteAllBytes(''c:/Users/28218/WeChatProjects/miniprogram-1/miniprogram/images/tab-home-active.png'', [System.Convert]::FromBase64String(''iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAsQAAALEBxi1JjQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAEGSURBVEiJ7ZSxDcIwEEW/KShYgA3YgAWgZwM2YAM2YAPYgA3IBmQD6KCDDhS8wmLsSWxL0HDSJ9t3/9+5cwJkMpks+QMO6jQfBd6BG+AEnKjT/Ky+0CxwC9wCT+o0H/sVh1rgAbgDHoPCUQNfJ4A94DkovODj+AkWhNYB9iqagWfgnWPgIOD8DI358bxLjWCfA7YDOAaegkL/APvW9pTf4m+B4TEmMCYwJjAmMCYwJjAG7oNCJoBd3wJj/vYOHtRBB9gO4AB4Bt55DTgIP9PqARwAd0HhvTrNTz0D3oBH4AV4Dtg/ExzJTOav8ANkLpWNXFuwDGwHcAA8A++8BhyEn6n1AA6Au6DwXp3mp54Bb8Aj8AI8B+xPAUcyk/kr/AAF+FDZyLUFywAAAABJRU5ErkJggg==''))\")",
      "Bash(powershell -Command \"[System.IO.File]::WriteAllBytes(''c:/Users/28218/WeChatProjects/miniprogram-1/miniprogram/images/tab-mine.png'', [System.Convert]::FromBase64String(''iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAsQAAALEBxi1JjQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAADSSURBVEiJ7ZSxDcIwEEW/UbAAG7ABG0DPBmzABmzABrABG5ANyAbQQQcdKHiFxdhO7EjQcNKX7bv/71yIA4FAIH/gENip0nwQeAOugCNwokrzs/pCs8A1cA08q9J87FccaoEH4BZ4DAovGvg6AWwDj0HhGR/HT7AgtA6wU9EEvAGvHAMHAednaMyP501qBPscsB3AIfAUFFoJ6P8tMOZv76CjDjrAdgAHwBPwyitgFH6m1gM4AG6Dwlt1mp96BrwAj8AL8BSw3wcciQTyV/gGAmNU2ci1BasAAAAASUVORK5CYII=''))\")",
      "Bash(powershell -Command \"[System.IO.File]::WriteAllBytes(''c:/Users/28218/WeChatProjects/miniprogram-1/miniprogram/images/tab-mine-active.png'', [System.Convert]::FromBase64String(''iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAsQAAALEBxi1JjQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAADmSURBVEiJ7ZSxDcIwEEW/UbAAG7ABG0DPBmzABmzABrABG5ANyAbQQQcdKHiFxdhO7EjQcNKX7bv/71zIA4FAIP/gCNip0nwQeAOugCNwokrzs/pCs8A1cA08q9J87FccaoEH4BZ4DAovGvg6AWwDj0HhGR/HT7AgtA6wU9EEvAGvHAMHAednaMyP501qBPscsB3AIfAUFFoJ6P8tMOZv76CjDjrAdgAHwBPwyitgFH6m1gM4AG6Dwlt1mp96BrwAj8AL8BSw3wcciQTyV/gGEu1P2ci1BasAAAAASUVORK5CYII=''))\")",
      "Bash(powershell -Command \"[System.IO.File]::WriteAllBytes(''c:/Users/28218/WeChatProjects/miniprogram-1/miniprogram/images/tab-history.png'', [System.Convert]::FromBase64String(''iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAsQAAALEBxi1JjQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAADfSURBVEiJ7ZSxDcIwEEVfIhawAAuwAQuwARtADxuwARuwQTYgG0AHHaIDCl5hMfYlsS3UcNKX7bv/71yIA4FAIP/gCNip03wQeAOugCNwok7zs/pCs8A1cA08q9N87FccaoEH4BZ4DAovGvg6AWwDj0HhGR/HT7AgtA6wU9EEvAGvHAMHAednaMyP501qBPscsB3AIfAUFFoJ6P8tMOZv76CjDjrAdgAHwBPwyitgFH6m1gM4AG6Dwlt1mp96BrwAj8AL8BSw3wcciQTyV/gGsqNU2ci1BasAAAAASUVORK5CYII=''))\")",
      "Bash(powershell -Command \"[System.IO.File]::WriteAllBytes(''c:/Users/28218/WeChatProjects/miniprogram-1/miniprogram/images/tab-history-active.png'', [System.Convert]::FromBase64String(''iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAsQAAALEBxi1JjQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAADzSURBVEiJ7ZSxDcIwEEVfIhawAAuwAQuwARtADxuwARuwQTYgG0AHHaIDCl5hMfYlsS3UcNKX7bv/71yIA4FAIP/gCNip03wQeAOugCNwok7zs/pCs8A1cA08q9N87FccaoEH4BZ4DAovGvg6AWwDj0HhGR/HT7AgtA6wU9EEvAGvHAMHAednaMyP501qBPscsB3AIfAUFFoJ6P8tMOZv76CjDjrAdgAHwBPwyitgFH6m1gM4AG6Dwlt1mp96BrwAj8AL8BSw3wcc+QfyV/gGLKpP2ci1BasAAAAASUVORK5CYII=''))\")",
      "Bash(powershell -Command:*)",
      "Bash(dir:*)",
      "Bash(cmd /c \"for %f in (c:\\Users\\28218\\WeChatProjects\\miniprogram-1\\miniprogram\\images\\tab-*.png) do @echo %~nxf: %~zf bytes\")",
      "Bash(cmd /c \"forfiles /P c:\\Users\\28218\\WeChatProjects\\miniprogram-1\\miniprogram /S /C \"\"cmd /c if @fsize GEQ 50000 echo @fsize @path\"\"\")",
      "Bash(cmd /c \"forfiles /P c:\\Users\\28218\\WeChatProjects\\miniprogram-1\\miniprogram /S /C \"cmd /c if @fsize GEQ 50000 echo @fsize @path\"\")",
      "Bash(cmd /c \"for %f in (c:\\Users\\28218\\WeChatProjects\\miniprogram-1\\miniprogram\\pages\\index\\*.png) do @echo %~nxf: %~zf bytes\")",
      "Bash(findstr:*)",
      "Bash(cmd /c \"cd /d c:\\Users\\28218\\WeChatProjects\\miniprogram-1\\miniprogram && forfiles /S /C \"\"cmd /c if @fsize GEQ 30000 echo @fsize @path\"\"\")",
      "Bash(cmd /c \"cd /d c:\\Users\\28218\\WeChatProjects\\miniprogram-1\\miniprogram && forfiles /S /C \"cmd /c if @fsize GEQ 30000 echo @fsize @path\"\")",
      "Bash(cmd /c \"for %f in (c:\\Users\\28218\\WeChatProjects\\miniprogram-1\\miniprogram\\images\\*.png) do @echo %~nxf: %~zf bytes\")",
      "Bash(powershell \"Get-ChildItem ''c:\\Users\\28218\\WeChatProjects\\miniprogram-1\\miniprogram\\images\\*.png'' | ForEach-Object { Write-Host $_Name'': ''$_Length'' bytes'' }\")",
      "Bash(sort:*)",
      "Bash(ls:*)",
      "Bash(git -C \"c:/Users/28218/WeChatProjects/miniprogram-1\" status)",
      "Bash(find:*)",
      "Bash(ssh -o StrictHostKeyChecking=no root@49.235.76.142 \"mkdir -p /var/www/html/flashphoto && ls -la /var/www/html/\")",
      "Bash(scp:*)",
      "Bash(ssh root@49.235.76.142 \"cd /var/www/html/flashphoto && cp family.png pet.png && cp family.png wedding.png && ls -la\")",
      "Bash(ssh root@49.235.76.142 \"cat > /etc/nginx/conf.d/flashphoto.conf << ''EOF''\nserver {\n    listen 80;\n    server_name 49.235.76.142;\n    \n    location /flashphoto/ {\n        alias /var/www/html/flashphoto/;\n        expires 30d;\n        add_header Cache-Control \"\"public, immutable\"\";\n        add_header Access-Control-Allow-Origin \"\"*\"\";\n    }\n}\nEOF\nnginx -t && nginx -s reload\")",
      "Bash(ssh -o StrictHostKeyChecking=no root@49.235.76.142 \"which certbot || which nginx || cat /etc/nginx/nginx.conf 2>/dev/null | head -20\")",
      "Bash(ssh root@49.235.76.142 \"apt update && apt install -y certbot python3-certbot-nginx\")",
      "Bash(ssh root@49.235.76.142 \"cat /etc/os-release | head -3 && yum install -y epel-release && yum install -y certbot python3-certbot-nginx\")",
      "Bash(ssh root@49.235.76.142 \"yum install -y certbot python3-certbot-nginx || dnf install -y certbot python3-certbot-nginx\")",
      "Bash(ssh root@49.235.76.142 \"ping -c 1 cdn.pop-pub.com 2>/dev/null || nslookup cdn.pop-pub.com 2>/dev/null || echo ''DNS lookup failed''\")",
      "Bash(ssh root@49.235.76.142 \"cat > /etc/nginx/conf.d/cdn.conf << ''EOF''\nserver {\n    listen 80;\n    server_name cdn.pop-pub.com;\n    \n    location /flashphoto/ {\n        alias /var/www/html/flashphoto/;\n        expires 30d;\n        add_header Cache-Control \"\"public, immutable\"\";\n        add_header Access-Control-Allow-Origin \"\"*\"\";\n    }\n    \n    location / {\n        return 404;\n    }\n}\nEOF\nnginx -t && nginx -s reload\")",
      "Bash(ssh root@49.235.76.142 \"certbot --nginx -d cdn.pop-pub.com --non-interactive --agree-tos --email admin@pop-pub.com\")",
      "Bash(nslookup:*)",
      "Bash(ssh root@49.235.76.142 \"firewall-cmd --list-all 2>/dev/null || iptables -L INPUT -n 2>/dev/null | head -20\")",
      "Bash(ssh root@49.235.76.142 \"curl -I http://cdn.pop-pub.com/flashphoto/camera.png 2>/dev/null | head -5\")",
      "Bash(curl:*)",
      "Bash(ssh root@49.235.76.142 \"ls -la /var/www/html/flashphoto/ | head -20\")",
      "Bash(ssh root@49.235.76.142 \"openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/nginx/ssl/selfsigned.key -out /etc/nginx/ssl/selfsigned.crt -subj ''/CN=49.235.76.142'' 2>&1 || (mkdir -p /etc/nginx/ssl && openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/nginx/ssl/selfsigned.key -out /etc/nginx/ssl/selfsigned.crt -subj ''/CN=49.235.76.142'')\")",
      "Bash(ssh root@49.235.76.142 \"cat > /etc/nginx/conf.d/flashphoto.conf << ''EOF''\nserver {\n    listen 80;\n    listen 443 ssl;\n    server_name 49.235.76.142;\n    \n    ssl_certificate /etc/nginx/ssl/selfsigned.crt;\n    ssl_certificate_key /etc/nginx/ssl/selfsigned.key;\n    \n    location /flashphoto/ {\n        alias /var/www/html/flashphoto/;\n        expires 30d;\n        add_header Cache-Control \"\"public, immutable\"\";\n        add_header Access-Control-Allow-Origin \"\"*\"\";\n    }\n}\nEOF\nnginx -t && nginx -s reload\")",
      "Bash(ssh root@49.235.76.142 \"ls -la /var/www/html/flashphoto/tab-*.png\")",
      "Bash(ssh root@49.235.76.142:*)",
      "Bash(powershell \"Get-ChildItem ''c:\\Users\\28218\\WeChatProjects\\miniprogram-1\\miniprogram\\images\\*.png'' -Recurse | ForEach-Object { Write-Host $_Name'': ''$_Length'' bytes'' }\")",
      "Bash(powershell \"Get-ChildItem ''c:\\Users\\28218\\WeChatProjects\\miniprogram-1\\miniprogram\\images\\*.png'' | Select-Object Name, Length | Format-Table -AutoSize\")",
      "Bash(powershell \"(Get-ChildItem ''c:\\Users\\28218\\WeChatProjects\\miniprogram-1\\miniprogram'' -Recurse -File | Measure-Object -Property Length -Sum).Sum / 1KB\")",
      "Bash(powershell \"Get-ChildItem ''c:\\Users\\28218\\WeChatProjects\\miniprogram-1\\miniprogram'' -Recurse -Include *.png,*.jpg,*.jpeg | Where-Object { $_Length -gt 200KB } | Select-Object FullName, @{N=''SizeKB'';E={[math]::Round($_Length/1KB,1)}} | Format-Table -AutoSize\")",
      "Bash(powershell \"Get-ChildItem ''c:\\Users\\28218\\WeChatProjects\\miniprogram-1\\miniprogram\\images\\*.png'' | Where-Object { $_Length -gt 200000 } | Select-Object Name, Length\")",
      "Bash(cmd /c \"dir c:\\Users\\28218\\WeChatProjects\\miniprogram-1\\miniprogram\\images\\*.png\")",
      "Bash(ls -la \"c:\\Users\\28218\\WeChatProjects\\miniprogram-1\\miniprogram\\images\"\" 2>/dev/null || dir \"c:Users28218WeChatProjectsminiprogram-1miniprogramimages \")",
      "Bash(ssh:*)",
      "Bash(sshpass -p 'pXw@023.c0m' ssh -o StrictHostKeyChecking=no root@49.235.76.142 \"mkdir -p /www/wwwroot/cdn.pop-pub.com/flashphoto/images && ls -la /www/wwwroot/cdn.pop-pub.com/\")",
      "Bash(node:*)",
      "Bash(npm install)",
      "Bash(node app.js:*)",
      "Bash(npm run build:*)",
      "Bash(curl -s http://localhost:3000/api/auth/info)",
      "Bash(cat:*)",
      "Bash(netstat:*)",
      "Bash(taskkill:*)",
      "Bash(cmd.exe /c \"taskkill /F /PID 30372\")",
      "Bash(cmd.exe /c \"taskkill /F /PID 30372 && cd /d c:\\Users\\28218\\WeChatProjects\\miniprogram-1\\admin-server\\server && node app.js\")",
      "Bash(powershell -Command \"Get-Process -Id (Get-NetTCPConnection -LocalPort 3000).OwningProcess | Stop-Process -Force\")",
      "Bash(del \"c:\\Users\\28218\\WeChatProjects\\miniprogram-1\\admin-server\\admin-web\\src\\views\\Coupons.vue\")",
      "Bash(cmd.exe /c \"taskkill /F /PID 75820\")",
      "Bash(timeout:*)",
      "Bash(powershell:*)",
      "Bash(curl -s -w \"\\n\\nHTTP_STATUS: %{http_code}\\nTIME_TOTAL: %{time_total}s\" -X POST \"https://api.vectorengine.ai/v1beta/models/gemini-3-pro-image-preview:generateContent\" -H \"Content-Type: application/json\" -H \"Authorization: Bearer sk-GtmTU7PTpPmWTVurx2SPBdaRsJoDPaJDpkSgRIK8Xu6huLt8\" -d '{\"\"contents\"\":[{\"\"role\"\":\"\"user\"\",\"\"parts\"\":[{\"\"text\"\":\"\"Hello, just testing the API connection\"\"}]}]}' --connect-timeout 30 --max-time 60)",
      "Bash(curl -s -w \"\\n\\nHTTP_STATUS: %{http_code}\\nTIME_TOTAL: %{time_total}s\" -X POST \"https://api.vectorengine.ai/v1beta/models/gemini-3-pro-image-preview:generateContent\" -H \"Content-Type: application/json\" -H \"Authorization: Bearer sk-GtmTU7PTpPmWTVurx2SPBdaRsJoDPaJDpkSgRIK8Xu6huLt8\" -d '{\"\"contents\"\":[{\"\"role\"\":\"\"user\"\",\"\"parts\"\":[{\"\"text\"\":\"\"生成专业证件照，标准蓝色背景\"\"}]}],\"\"generationConfig\"\":{\"\"responseModalities\"\":[\"\"text\"\",\"\"image\"\"]}}' --connect-timeout 60 --max-time 120)",
      "Bash(curl -s -w \"\\n\\nHTTP_STATUS: %{http_code}\\nTIME_TOTAL: %{time_total}s\" -X POST \"https://api.vectorengine.ai/v1beta/models/gemini-3-pro-image-preview:generateContent\" -H \"Content-Type: application/json\" -H \"Authorization: Bearer sk-GtmTU7PTpPmWTVurx2SPBdaRsJoDPaJDpkSgRIK8Xu6huLt8\" -d '{\"\"\"\"contents\"\"\"\":[{\"\"\"\"role\"\"\"\":\"\"\"\"user\"\"\"\",\"\"\"\"parts\"\"\"\":[{\"\"\"\"text\"\"\"\":\"\"\"\"Hello\"\"\"\"}]}]}' --connect-timeout 10 --max-time 30)",
      "Bash(ssh root@49.235.76.142 \"ls -la /var/www/ 2>/dev/null || ls -la /usr/share/nginx/ 2>/dev/null || ls -la /home/\")",
      "Bash(ssh root@49.235.76.142 \"ls -la /var/www/flashphoto-api/\")",
      "Bash(ssh root@49.235.76.142 \"ls -la /var/www/flashphoto-api/public/\")",
      "Bash(ssh root@49.235.76.142 \"cat /etc/nginx/nginx.conf 2>/dev/null | head -100\")",
      "Bash(ssh root@49.235.76.142 \"cat /etc/nginx/conf.d/*.conf\")",
      "Bash(ssh root@49.235.76.142 \"cat /var/www/flashphoto-api/public/index.html\")",
      "Bash(ssh root@49.235.76.142 \"pm2 list 2>/dev/null || systemctl status flashphoto 2>/dev/null || ps aux | grep node\")",
      "Bash(ssh root@49.235.76.142 \"curl -s http://127.0.0.1:3000/api/auth/login -X POST -H ''Content-Type: application/json'' -d ''{\"\"username\"\":\"\"admin\"\",\"\"password\"\":\"\"pXw1995\"\"}''\")",
      "Bash(ssh root@49.235.76.142 \"cd /var/www/flashphoto-api && pm2 restart flashphoto-api\")",
      "Bash(ssh root@49.235.76.142 \"cd /var/www/flashphoto-api && ls -la && head -50 index.js\")",
      "Bash(ssh root@49.235.76.142 \"cd /var/www/flashphoto-api && pm2 delete flashphoto-api && pm2 start app.js --name flashphoto-api && pm2 save\")",
      "Bash(plink -ssh root@49.235.76.142 -pw \"pXw@023.c0m\" \"cd /root/flashphoto-server && cat index.js | head -20\")",
      "Bash(ssh -o StrictHostKeyChecking=no -o ConnectTimeout=10 root@49.235.76.142 \"ls -la /root/\")",
      "Bash(ssh -o StrictHostKeyChecking=no root@49.235.76.142 \"cd /root/flashphoto-server && npm install dotenv && pm2 restart all && pm2 logs --lines 10\")",
      "Bash(ssh -o StrictHostKeyChecking=no root@49.235.76.142 \"ls -la /var/www/flashphoto-api/\")",
      "Bash(ssh -o StrictHostKeyChecking=no root@49.235.76.142 \"cat /var/www/flashphoto-api/.env\")",
      "Bash(ssh -o StrictHostKeyChecking=no root@49.235.76.142 \"grep -n ''wx-login'' /var/www/flashphoto-api/app.js /var/www/flashphoto-api/routes/*.js 2>/dev/null || echo ''未找到wx-login接口''\")",
      "Bash(ssh -o StrictHostKeyChecking=no root@49.235.76.142 \"echo ''检查服务器位置和域名信息:'' && curl -s ''http://ip-api.com/json/?lang=zh-CN'' | head -5\")",
      "Bash(ssh root@49.235.76.142 \"curl -s http://localhost:3000/api/health\")",
      "Bash(scp \"c:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\temp_photos.js\" root@49.235.76.142:/var/www/flashphoto-api/routes/photos.js)",
      "Bash(del:*)",
      "Bash(sshpass:*)",
      "Bash(where:*)",
      "Bash(where scp:*)",
      "Bash(powershell -Command \"Get-Command sftp -ErrorAction SilentlyContinue | Select-Object -ExpandProperty Source\")",
      "Bash(ssh -o StrictHostKeyChecking=no -o ConnectTimeout=10 root@49.235.76.142 \"echo ''SSH连接成功'' && uname -a\")",
      "Bash(ssh root@49.235.76.142 \"node -v && npm -v && ls -la /www/wwwroot/ 2>/dev/null || echo ''宝塔目录不存在''\")",
      "Bash(ssh root@49.235.76.142 \"mkdir -p /www/wwwroot/pop-pub.com/admin-server /www/wwwroot/pop-pub.com/miniprogram-server && ls -la /www/wwwroot/pop-pub.com/\")",
      "Bash(ssh root@49.235.76.142 \"ls -la /www/wwwroot/pop-pub.com/admin-server/\")",
      "Bash(ssh root@49.235.76.142 \"ls -la /www/wwwroot/pop-pub.com/admin-server/ && du -sh /www/wwwroot/pop-pub.com/admin-server/\")",
      "Bash(ssh root@49.235.76.142 \"ls -la /www/wwwroot/pop-pub.com/admin-server/public/ && ls -la /www/wwwroot/pop-pub.com/miniprogram-server/\")",
      "Bash(ssh root@49.235.76.142 \"cd /www/wwwroot/pop-pub.com/miniprogram-server && npm install --production\")",
      "Bash(ssh root@49.235.76.142 \"which pm2 || npm install -g pm2\")",
      "Bash(ssh root@49.235.76.142 \"pm2 list\")",
      "Bash(ssh root@49.235.76.142 \"pm2 show flashphoto-api | head -20\")",
      "Bash(ssh root@49.235.76.142 \"rm -rf /var/www/flashphoto-api/* && cp -r /www/wwwroot/pop-pub.com/admin-server/* /var/www/flashphoto-api/ && ls -la /var/www/flashphoto-api/\")",
      "Bash(ssh root@49.235.76.142 \"pm2 restart flashphoto-api && pm2 logs flashphoto-api --lines 10 --nostream\")",
      "Bash(ssh root@49.235.76.142 \"cat /var/www/flashphoto-api/routes/upload.js | head -20\")",
      "Bash(ssh root@49.235.76.142 \"ls -la /var/www/flashphoto-api/routes/ && cat /var/www/flashphoto-api/app.js | head -50\")",
      "Bash(Remove-Item -Recurse -Force \"c:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\admin-server\\\\server\\\\public\\\\admin\" -ErrorAction SilentlyContinue)",
      "Bash(New-Item -ItemType Directory -Force -Path \"c:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\admin-server\\\\server\\\\public\\\\admin\")",
      "Bash(Copy-Item -Recurse -Force \"c:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\admin-server\\\\admin-web\\\\dist\\\\*\" \"c:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\admin-server\\\\server\\\\public\\\\admin\"\")",
      "Bash(Copy-Item -Recurse -Force \"c:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\admin-server\\\\admin-web\\\\dist\\\\*\" \"c:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\admin-server\\\\server\\\\public\\\\admin\")",
      "Bash(grep:*)",
      "Bash(xcopy:*)",
      "Bash(ssh root@49.235.76.142 \"ls -la /var/www/ && find /var -name ''admin'' -type d 2>/dev/null | head -10\")",
      "Bash(ssh root@49.235.76.142 \"cat /var/www/flashphoto-api/routes/auth.js 2>/dev/null || cat /var/www/flashphoto-api/src/routes/auth.js 2>/dev/null || find /var/www/flashphoto-api -name ''auth*.js'' -type f 2>/dev/null | head -5\")",
      "Bash(ssh root@49.235.76.142 \"cat /var/www/flashphoto-api/app.js 2>/dev/null | head -100\")",
      "Bash(ssh root@49.235.76.142 \"cd /var/www/flashphoto-api && sqlite3 data/app.db \"\"SELECT id, username, password FROM admins;\"\" 2>/dev/null || sqlite3 database.db \"\"SELECT id, username, password FROM admins;\"\" 2>/dev/null || find . -name ''*.db'' -exec echo {} \\\\; -exec sqlite3 {} \"\"SELECT * FROM admins LIMIT 1;\"\" \\\\; 2>/dev/null\")",
      "Bash(ssh root@49.235.76.142 \"cd /var/www/flashphoto-api && node -e \"\"const bcrypt = require\\(''bcryptjs''\\); const hash = bcrypt.hashSync\\(''pXw1995'', 10\\); console.log\\(hash\\);\"\" 2>/dev/null\")",
      "Bash(ssh root@49.235.76.142 \"cd /var/www/flashphoto-api && sqlite3 database/xingmei.db \"\"UPDATE admins SET password=''$2a$10$JdgAszm7G5SVsLotnAKAx.I2krOwoYpF.OxIJH55tGeM2PqG87qcq'' WHERE username=''admin'';\"\" && sqlite3 database/xingmei.db \"\"SELECT id, username, password FROM admins;\"\"\")",
      "Bash(ssh root@49.235.76.142 \"cd /var/www/flashphoto-api && node -e \"\"\nconst bcrypt = require\\(''bcryptjs''\\);\nconst Database = require\\(''better-sqlite3''\\);\nconst db = new Database\\(''./database/xingmei.db''\\);\nconst hash = bcrypt.hashSync\\(''pXw1995'', 10\\);\ndb.prepare\\(''UPDATE admins SET password = ? WHERE username = ?''\\).run\\(hash, ''admin''\\);\nconst row = db.prepare\\(''SELECT * FROM admins WHERE username = ?''\\).get\\(''admin''\\);\nconsole.log\\(''Updated:'', row\\);\ndb.close\\(\\);\n\"\"\")",
      "Bash(ssh root@49.235.76.142 \"cd /var/www/flashphoto-api && cat config/database.js | head -20\")",
      "Bash(ssh root@49.235.76.142 \"cd /var/www/flashphoto-api && cat > reset_pwd.js << ''SCRIPT''\nconst bcrypt = require\\(''bcryptjs''\\);\nconst initSqlJs = require\\(''sql.js''\\);\nconst fs = require\\(''fs''\\);\n\nasync function resetPassword\\(\\) {\n  const SQL = await initSqlJs\\(\\);\n  const dbPath = ''./database/xingmei.db'';\n  const fileBuffer = fs.readFileSync\\(dbPath\\);\n  const db = new SQL.Database\\(fileBuffer\\);\n  \n  const hash = bcrypt.hashSync\\(''pXw1995'', 10\\);\n  db.run\\(''UPDATE admins SET password = ? WHERE username = ?'', [hash, ''admin'']\\);\n  \n  const result = db.exec\\(''SELECT * FROM admins WHERE username = \"\"admin\"\"''\\);\n  console.log\\(''Updated admin:'', result\\);\n  \n  const data = db.export\\(\\);\n  const buffer = Buffer.from\\(data\\);\n  fs.writeFileSync\\(dbPath, buffer\\);\n  console.log\\(''Password reset to: pXw1995''\\);\n}\n\nresetPassword\\(\\).catch\\(console.error\\);\nSCRIPT\nnode reset_pwd.js && rm reset_pwd.js\")",
      "Bash(ssh root@49.235.76.142 \"pm2 restart flashphoto-api && sleep 2 && pm2 status\")",
      "Bash(ssh root@49.235.76.142 'cat > /var/www/flashphoto-api/routes/ai-proxy.js << ''''ENDFILE''''\n/**\n * AI 代理路由\n * 将 AI API 调用移到后端，避免前端暴露密钥\n */\nconst express = require\\(''''express''''\\);\nconst router = express.Router\\(\\);\nconst axios = require\\(''''axios''''\\);\n\n// AI 服务配置（从环境变量读取）\nconst AI_API_KEY = process.env.AI_API_KEY || ''''sk-GtmTU7PTpPmWTVurx2SPBdaRsJoDPaJDpkSgRIK8Xu6huLt8'''';\nconst AI_API_BASE = process.env.AI_API_BASE || ''''https://api.vectorengine.ai'''';\n\n/**\n * AI 图片生成代理接口\n * POST /api/ai/generate-image\n */\nrouter.post\\(''''/generate-image'''', async \\(req, res\\) => {\n  if \\(!AI_API_KEY\\) {\n    console.error\\(''''[AI代理] AI_API_KEY 未配置''''\\);\n    return res.status\\(500\\).json\\({ code: 500, message: ''''AI服务未配置'''' }\\);\n  }\n\n  const { prompt, imageBase64, mimeType } = req.body;\n\n  if \\(!prompt\\) {\n    return res.status\\(400\\).json\\({ code: 400, message: ''''缺少 prompt 参数'''' }\\);\n  }\n\n  console.log\\(''''[AI代理] 收到请求, prompt长度:'''', prompt.length\\);\n\n  try {\n    const requestData = {\n      contents: [{\n        parts: []\n      }],\n      generationConfig: { responseModalities: [''''image''''] }\n    };\n\n    if \\(imageBase64\\) {\n      requestData.contents[0].parts.push\\({\n        inlineData: {\n          mimeType: mimeType || ''''image/jpeg'''',\n          data: imageBase64\n        }\n      }\\);\n    }\n\n    requestData.contents[0].parts.push\\({ text: prompt }\\);\n\n    const response = await axios.post\\(\n      AI_API_BASE + ''''/v1beta/models/gemini-3-pro-image-preview:generateContent'''',\n      requestData,\n      {\n        headers: {\n          ''''Content-Type'''': ''''application/json'''',\n          ''''Authorization'''': ''''Bearer '''' + AI_API_KEY\n        },\n        timeout: 120000\n      }\n    \\);\n\n    const data = response.data;\n    let imageData = null;\n    let responseMimeType = ''''image/png'''';\n\n    if \\(data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts\\) {\n      for \\(const part of data.candidates[0].content.parts\\) {\n        if \\(part.inlineData\\) {\n          imageData = part.inlineData.data;\n          responseMimeType = part.inlineData.mimeType || ''''image/png'''';\n          break;\n        }\n        if \\(part.inline_data\\) {\n          imageData = part.inline_data.data;\n          responseMimeType = part.inline_data.mime_type || ''''image/png'''';\n          break;\n        }\n      }\n    }\n\n    if \\(imageData\\) {\n      console.log\\(''''[AI代理] 成功生成图片''''\\);\n      return res.json\\({\n        code: 200,\n        data: { imageData, mimeType: responseMimeType }\n      }\\);\n    } else {\n      const textPart = data.candidates && data.candidates[0] && data.candidates[0].content && \n                       data.candidates[0].content.parts && data.candidates[0].content.parts.find\\(p => p.text\\);\n      if \\(textPart\\) {\n        console.warn\\(''''[AI代理] 模型返回文本而非图片''''\\);\n        return res.status\\(400\\).json\\({\n          code: 400,\n          message: ''''模型返回文本而非图片: '''' + textPart.text.substring\\(0, 100\\)\n        }\\);\n      }\n      return res.status\\(500\\).json\\({ code: 500, message: ''''未获取到图片'''' }\\);\n    }\n\n  } catch \\(error\\) {\n    console.error\\(''''[AI代理] 请求失败:'''', error.message\\);\n    \n    if \\(error.response\\) {\n      const errData = error.response.data;\n      let errMsg = ''''服务器错误'''';\n      if \\(errData && errData.error && errData.error.message\\) {\n        errMsg = errData.error.message;\n      } else if \\(typeof errData === ''''string''''\\) {\n        errMsg = errData;\n      }\n      return res.status\\(error.response.status\\).json\\({\n        code: error.response.status,\n        message: errMsg\n      }\\);\n    }\n    \n    return res.status\\(500\\).json\\({\n      code: 500,\n      message: ''''网络请求失败: '''' + error.message\n    }\\);\n  }\n}\\);\n\nmodule.exports = router;\nENDFILE\necho \"\"AI代理路由已创建\"\"')",
      "Bash(scp \"c:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\temp-security.js\" root@49.235.76.142:/var/www/flashphoto-api/routes/security.js)",
      "Bash(del \"c:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\temp-security.js\")",
      "Bash(scp \"c:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\temp-users.js\" root@49.235.76.142:/var/www/flashphoto-api/routes/users.js)",
      "Bash(ssh root@49.235.76.142 \"cd /var/www/flashphoto-api && node scripts/init-midplatform.js\")",
      "Bash(ssh root@49.235.76.142 \"grep -n ''configRoutes'' /var/www/flashphoto-api/app.js\")",
      "Bash(python3:*)",
      "Bash(npm install:*)",
      "Bash(del \"c:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\admin-server\\\\server\\\\database\\\\xingmei.db\")",
      "Bash(timeout 10 node:*)",
      "Bash(ssh root@49.235.76.142 \"cd /www/wwwroot/pop-pub.com/admin-server && node -e \"\"\nconst initSqlJs = require\\(''sql.js''\\);\nconst fs = require\\(''fs''\\);\nconst dbPath = ''/www/wwwroot/pop-pub.com/miniprogram-server/data/flashphoto_prod.db'';\nasync function check\\(\\) {\n  const SQL = await initSqlJs\\(\\);\n  const buffer = fs.readFileSync\\(dbPath\\);\n  const db = new SQL.Database\\(buffer\\);\n  const tables = db.exec\\(\\\\\"\"SELECT name FROM sqlite_master WHERE type=''table''\\\\\"\"\\);\n  console.log\\(''表:'', tables.length > 0 ? tables[0].values.map\\(v => v[0]\\).join\\('', ''\\) : ''无''\\);\n  try {\n    const scenes = db.exec\\(''SELECT COUNT\\(*\\) FROM scenes''\\);\n    console.log\\(''scenes表存在, 记录数:'', scenes[0].values[0][0]\\);\n  } catch\\(e\\) {\n    console.log\\(''scenes表不存在''\\);\n  }\n}\ncheck\\(\\);\n\"\"\")",
      "Bash(ssh root@49.235.76.142 \"cat /www/wwwroot/pop-pub.com/admin-server/routes/config.js 2>/dev/null | head -20 || echo ''文件不存在''\")",
      "Bash(ssh root@49.235.76.142 \"ls -la /www/wwwroot/pop-pub.com/admin-server/routes/\")",
      "Bash(ssh root@49.235.76.142 \"rm -rf /www/wwwroot/pop-pub.com/admin-server/public/admin/* 2>/dev/null; mkdir -p /www/wwwroot/pop-pub.com/admin-server/public/admin\")",
      "Bash(ssh root@49.235.76.142 \"cd /www/wwwroot/pop-pub.com/admin-server && npm install multer --save 2>&1\")",
      "Bash(ssh root@49.235.76.142 \"grep -n ''config'' /www/wwwroot/pop-pub.com/admin-server/app.js | head -10\")",
      "Bash(ssh root@49.235.76.142 \"pm2 show flashphoto-api | grep -E ''\\(script|cwd\\)''\")",
      "Bash(ssh root@49.235.76.142 \"head -100 /var/www/flashphoto-api/routes/config.js\")",
      "Bash(ssh root@49.235.76.142 \"cd /var/www/flashphoto-api && node -e \"\"\nconst initSqlJs = require\\(''sql.js''\\);\nconst fs = require\\(''fs''\\);\nconst dbPath = ''/www/wwwroot/pop-pub.com/miniprogram-server/data/flashphoto_prod.db'';\nasync function check\\(\\) {\n  const SQL = await initSqlJs\\(\\);\n  const buffer = fs.readFileSync\\(dbPath\\);\n  const db = new SQL.Database\\(buffer\\);\n  \n  // 检查scenes表结构\n  const scenesCols = db.exec\\(''PRAGMA table_info\\(scenes\\)''\\);\n  console.log\\(''scenes表结构:''\\);\n  scenesCols[0].values.forEach\\(col => console.log\\(''  -'', col[1], col[2]\\)\\);\n  \n  // 检查system_config表结构\n  console.log\\(''\\\\nsystem_config表结构:''\\);\n  const configCols = db.exec\\(''PRAGMA table_info\\(system_config\\)''\\);\n  configCols[0].values.forEach\\(col => console.log\\(''  -'', col[1], col[2]\\)\\);\n}\ncheck\\(\\);\n\"\"\")",
      "Bash(ssh root@49.235.76.142 \"cd /var/www/flashphoto-api && node -e \"\"\nconst initSqlJs = require\\(''sql.js''\\);\nconst fs = require\\(''fs''\\);\nconst dbPath = ''/www/wwwroot/pop-pub.com/miniprogram-server/data/flashphoto_prod.db'';\nasync function check\\(\\) {\n  const SQL = await initSqlJs\\(\\);\n  const buffer = fs.readFileSync\\(dbPath\\);\n  const db = new SQL.Database\\(buffer\\);\n  const scenes = db.exec\\(''SELECT id, name, status, icon FROM scenes''\\);\n  console.log\\(''场景数据:''\\);\n  scenes[0].values.forEach\\(s => console.log\\(''  -'', s[0], s[1], s[2], s[3] ? s[3].substring\\(0,50\\)+''...'' : ''无icon''\\)\\);\n}\ncheck\\(\\);\n\"\"\")",
      "Bash(ssh root@49.235.76.142 \"grep -n ''CDN_BASE\\\\|icon\\\\|cos.ap'' /var/www/flashphoto-api/routes/config.js | head -20\")",
      "Bash(ssh root@49.235.76.142 \"cd /var/www/flashphoto-api && node -e \"\"\nconst initSqlJs = require\\(''sql.js''\\);\nconst fs = require\\(''fs''\\);\nconst dbPath = ''/www/wwwroot/pop-pub.com/miniprogram-server/data/flashphoto_prod.db'';\n\nconst CDN_BASE = ''https://xingmeishantu-1310044729.cos.ap-shanghai.myqcloud.com'';\nconst IMG_VERSION = ''v7'';\n\nconst iconMap = {\n  ''idphoto'': ''id-photo.png'',\n  ''professional'': ''professional.png'',\n  ''portrait'': ''portrait.png'',\n  ''family'': ''family.png'',\n  ''pet'': ''pet.png'',\n  ''wedding'': ''wedding.png''\n};\n\nasync function updateIcons\\(\\) {\n  const SQL = await initSqlJs\\(\\);\n  const buffer = fs.readFileSync\\(dbPath\\);\n  const db = new SQL.Database\\(buffer\\);\n  \n  Object.entries\\(iconMap\\).forEach\\(\\([id, iconFile]\\) => {\n    const iconUrl = CDN_BASE + ''/'' + iconFile + ''?'' + IMG_VERSION;\n    db.run\\(''UPDATE scenes SET icon = ? WHERE id = ?'', [iconUrl, id]\\);\n    console.log\\(''更新'', id, ''=>'', iconUrl\\);\n  }\\);\n  \n  // 保存\n  const data = db.export\\(\\);\n  fs.writeFileSync\\(dbPath, Buffer.from\\(data\\)\\);\n  console.log\\(''\\\\n数据库已保存''\\);\n  \n  // 验证\n  const scenes = db.exec\\(''SELECT id, icon FROM scenes''\\);\n  console.log\\(''\\\\n验证结果:''\\);\n  scenes[0].values.forEach\\(s => console.log\\(''  -'', s[0], s[1]\\)\\);\n}\nupdateIcons\\(\\);\n\"\"\")",
      "Bash(ssh root@49.235.76.142 \"rm -rf /var/www/flashphoto-api/public/admin/*\")",
      "Bash(ssh root@49.235.76.142 \"ls -la /var/www/flashphoto-api/public/admin/\")",
      "Bash(ssh root@49.235.76.142 \"pm2 restart flashphoto-api && sleep 3 && pm2 logs flashphoto-api --lines 15 --nostream\")",
      "Bash(ssh root@49.235.76.142 \"pm2 restart flashphoto-api && sleep 3 && pm2 logs flashphoto-api --lines 10 --nostream\")",
      "Bash(del \"c:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\admin-server\\\\temp_config.js\")",
      "Bash(cmd /c \"cd /d c:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\admin-server\\\\admin-web && npm run build\")",
      "Bash(powershell -Command \"cd ''c:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\admin-server\\\\admin-web''; npm run build\")",
      "Bash(powershell -Command \"Select-String -Path ''c:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\admin-server\\\\server\\\\routes\\\\config.js'' -Pattern ''system_config.*value|\\\\.value'' | Select-Object -First 30\")",
      "Bash(del \"c:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\admin-server\\\\temp_update_gender.js\")",
      "Bash(exit 0)",
      "Bash(node -e:*)",
      "Bash(ssh -o ConnectTimeout=10 root@49.235.76.142 \"pm2 restart all && pm2 list\")",
      "Bash(timeout 60 npm run build)",
      "Bash(ssh -o StrictHostKeyChecking=no -o ConnectTimeout=10 root@49.235.76.142 \"echo ''连接成功'' && pm2 list\")",
      "Bash(ssh root@49.235.76.142 \"grep -n ''cos-images'' /www/wwwroot/flashphoto/admin-server/server/routes/photos.js 2>/dev/null || echo ''未找到cos-images接口''\")",
      "Bash(ssh root@49.235.76.142 \"tail -50 /www/wwwroot/flashphoto/admin-server/server/routes/photos.js\")",
      "Bash(ssh root@49.235.76.142 \"pm2 show flashphoto-api | grep -E ''exec cwd|script path''\")",
      "Bash(ssh root@49.235.76.142 \"grep -n ''cos-images'' /var/www/flashphoto-api/routes/photos.js 2>/dev/null || echo ''未找到cos-images接口''\")",
      "Bash(node upload-icons.js:*)",
      "Bash(timeout /t 5)",
      "Bash(ssh root@49.235.76.142 \"ls -la /www/wwwroot/pop-pub.com/ 2>/dev/null || ls -la /var/www/ 2>/dev/null || echo ''需要确认服务器目录''\")",
      "Bash(ssh root@49.235.76.142 \"ls -la /www/wwwroot/pop-pub.com/admin-server/server/config/\")",
      "Bash(ssh root@49.235.76.142 \"ls -la /www/wwwroot/pop-pub.com/admin-server/admin-web/\")",
      "Bash(ssh root@49.235.76.142 \"cd /www/wwwroot/pop-pub.com/admin-server && pm2 restart all 2>/dev/null || \\(pkill -f ''node app.js'' 2>/dev/null; nohup node app.js > /var/log/admin-server.log 2>&1 &\\)\")",
      "Bash(ssh root@49.235.76.142 \"pm2 logs flashphoto-api --lines 30 --nostream 2>/dev/null | tail -30\")",
      "Bash(ssh root@49.235.76.142 \"ls -la /www/wwwroot/pop-pub.com/admin-server/config/\")",
      "Bash(ssh root@49.235.76.142 \"head -50 /www/wwwroot/pop-pub.com/admin-server/config/database.js\")",
      "Bash(ssh root@49.235.76.142 \"pm2 logs flashphoto-api --lines 50 --nostream 2>/dev/null | grep -E ''Database|已为|迁移''\")",
      "Bash(ssh root@49.235.76.142 \"grep -E ''require.*database'' /www/wwwroot/pop-pub.com/admin-server/app.js\")",
      "Bash(ssh root@49.235.76.142 \"grep -E ''better-sqlite3|sql.js'' /www/wwwroot/pop-pub.com/admin-server/config/database.js | head -5\")",
      "Bash(ssh root@49.235.76.142 \"ls -la /var/www/flashphoto-api/config/\")",
      "Bash(ssh root@49.235.76.142 \"grep -E ''better-sqlite3|sql.js'' /var/www/flashphoto-api/config/database.js | head -3\")",
      "Bash(ssh root@49.235.76.142 \"ls -la /var/www/flashphoto-api/admin-web/ 2>/dev/null || echo ''目录不存在''\")",
      "Bash(ssh root@49.235.76.142 \"pm2 restart flashphoto-api && sleep 3 && pm2 logs flashphoto-api --lines 30 --nostream\")",
      "Bash(ssh root@49.235.76.142 \"curl -s ''http://localhost:3000/config/init'' | head -c 1500\")",
      "Bash(ssh root@49.235.76.142 \"curl -s ''http://localhost:3000/api/config/init'' | head -c 1500\")",
      "Bash(ssh root@49.235.76.142 \"curl -s ''http://localhost:3000/api/config/init'' | python3 -c \"\"import json,sys; d=json.load\\(sys.stdin\\); steps=d[''data''][''scenes''][0][''steps'']; print\\(''\\\\n''.join\\([f\\\\\"\"步骤: {s.get\\(''title'',''?''\\)} | icon: {s.get\\(''icon'',''无''\\)}\\\\\"\" for s in steps[:6]]\\)\\)\"\"\")",
      "Bash(ssh root@49.235.76.142 \"grep -n ''icon'' /var/www/flashphoto-api/routes/config.js | head -40\")",
      "Bash(ssh root@49.235.76.142 \"grep -n -A5 ''batch-save'' /var/www/flashphoto-api/routes/config.js | head -30\")",
      "Bash(ssh root@49.235.76.142 \"sqlite3 /www/wwwroot/pop-pub.com/miniprogram-server/data/flashphoto_prod.db ''PRAGMA table_info\\(scene_steps\\);''\")",
      "Bash(ssh root@49.235.76.142 \"sqlite3 /www/wwwroot/pop-pub.com/miniprogram-server/data/flashphoto_prod.db \"\"SELECT id, scene_id, title, icon, gender_based FROM scene_steps ORDER BY scene_id, step_order;\"\"\")",
      "Bash(dir \"c:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\admin-server\\\\admin-web\\\\dist\\\\assets\")",
      "Bash(ssh root@49.235.76.142 \"find /root -name ''admin-web'' -type d 2>/dev/null || find / -name ''admin-web'' -type d 2>/dev/null | head -5\")",
      "Bash(xargs:*)",
      "Bash(ssh root@49.235.76.142 \"ls -la /root/ && ls -la /var/www/ 2>/dev/null || echo ''no /var/www''\")",
      "Bash(ssh root@49.235.76.142 \"ls -la /var/www/flashphoto-api/ && ls -la /var/www/flashphoto-api/config/ 2>/dev/null && ls -la /var/www/flashphoto-api/services/ 2>/dev/null\")",
      "Bash(ssh root@49.235.76.142 \"cat > /var/www/flashphoto-api/config/virtualPay.js << ''EOF''\n/**\n * 微信虚拟支付配置 \\(admin-server\\)\n */\n\nconst ENV = process.env.VIRTUAL_PAY_ENV || ''sandbox'';\n\nconst config = {\n  appId: ''wxf67c9b6c7b94a9bb'',\n  offerId: ''1450466646'',\n  env: ENV === ''production'' ? 0 : 1,\n  appKey: ENV === ''production''\n    ? ''X5Gaym9LhezY0vPlqqyfbRfUXVrvz6Pr''\n    : ''bF30M6FjS99phWrk80UZCwzbFlNgaZNq'',\n  coinToFen: 10,\n  yuanToPoints: 10,\n  envName: ENV\n};\n\nconsole.log\\(''[VirtualPay] 环境: '' + config.envName + '', env='' + config.env\\);\n\nmodule.exports = config;\nEOF\")",
      "Bash(ssh root@49.235.76.142 \"mkdir -p /var/www/flashphoto-api/services && cat > /var/www/flashphoto-api/services/signService.js << ''EOF''\n/**\n * 微信虚拟支付签名服务 \\(admin-server\\)\n */\n\nconst crypto = require\\(''crypto''\\);\nconst virtualPayConfig = require\\(''../config/virtualPay''\\);\n\nfunction hmacSha256\\(data, key\\) {\n  return crypto.createHmac\\(''sha256'', key\\).update\\(data, ''utf8''\\).digest\\(''hex''\\);\n}\n\nfunction calculatePaySig\\(uri, postBody, appKey = virtualPayConfig.appKey\\) {\n  const signData = typeof postBody === ''string'' ? postBody : JSON.stringify\\(postBody\\);\n  return hmacSha256\\(uri + ''&'' + signData, appKey\\);\n}\n\nfunction calculateSignature\\(postBody, sessionKey\\) {\n  const signData = typeof postBody === ''string'' ? postBody : JSON.stringify\\(postBody\\);\n  return hmacSha256\\(signData, sessionKey\\);\n}\n\nfunction generateOrderId\\(\\) {\n  const timestamp = Date.now\\(\\).toString\\(36\\).toUpperCase\\(\\);\n  const random = Math.random\\(\\).toString\\(36\\).substr\\(2, 6\\).toUpperCase\\(\\);\n  return ''VP'' + timestamp + random;\n}\n\nfunction buildSignData\\(params\\) {\n  const {\n    outTradeNo,\n    buyQuantity,\n    goodsPrice,\n    productId = ''points_recharge'',\n    attach = '''',\n    platform = ''ios''\n  } = params;\n\n  return {\n    offerId: virtualPayConfig.offerId,\n    buyQuantity: buyQuantity,\n    env: virtualPayConfig.env,\n    currencyType: ''CNY'',\n    platform: platform,\n    productId: productId,\n    goodsPrice: goodsPrice,\n    outTradeNo: outTradeNo,\n    attach: attach\n  };\n}\n\nfunction generatePaymentParams\\(options\\) {\n  const {\n    orderId,\n    amount,\n    points,\n    userId,\n    sessionKey,\n    platform = ''ios''\n  } = options;\n\n  const buyQuantity = amount * 10;\n  const goodsPrice = amount * 100;\n\n  const attach = JSON.stringify\\({\n    userId: userId,\n    points: points,\n    orderId: orderId\n  }\\);\n\n  const signData = buildSignData\\({\n    outTradeNo: orderId,\n    buyQuantity: buyQuantity,\n    goodsPrice: goodsPrice,\n    productId: ''points_'' + amount,\n    attach: attach,\n    platform: platform\n  }\\);\n\n  const signDataStr = JSON.stringify\\(signData\\);\n  const paySig = calculatePaySig\\(''requestVirtualPayment'', signDataStr\\);\n  const signature = calculateSignature\\(signDataStr, sessionKey\\);\n\n  return {\n    signData: signData,\n    paySig: paySig,\n    signature: signature,\n    sigMethod: ''hmac_sha256'',\n    mode: ''coin''\n  };\n}\n\nmodule.exports = {\n  hmacSha256,\n  calculatePaySig,\n  calculateSignature,\n  buildSignData,\n  generateOrderId,\n  generatePaymentParams\n};\nEOF\")",
      "Bash(ssh root@49.235.76.142 \"head -20 /var/www/flashphoto-api/routes/users.js\")",
      "Bash(ssh root@49.235.76.142 \"cat /var/www/flashphoto-api/app.js\")",
      "Bash(ssh root@49.235.76.142 \"sed -i \"\"/const assetsRoutes = require/a const virtualPayRoutes = require\\(''./routes/virtual-pay''\\);\"\" /var/www/flashphoto-api/app.js && sed -i \"\"/app.use\\(''\\\\/api\\\\/assets'', assetsRoutes\\);/a app.use\\(''/api/virtual-pay'', virtualPayRoutes\\);\"\" /var/www/flashphoto-api/app.js\")",
      "Bash(sqlite3:*)",
      "Bash(ssh root@49.235.76.142 \"sqlite3 /root/xingmei-app/admin-server/server/database/xingmei.db \"\"SELECT order_id, user_id, amount, points, status, delivered_at FROM virtual_pay_orders WHERE order_id=''VPMK571HMT5NQ2LE'';\"\"\")",
      "Bash(ssh root@49.235.76.142 \"grep -n ''session_key\\\\|sessionKey'' /www/wwwroot/pop-pub.com/miniprogram-server/index.js | head -30\")",
      "Bash(ssh root@49.235.76.142 \"sed -n ''360,380p'' /www/wwwroot/pop-pub.com/miniprogram-server/index.js\")",
      "Bash(ssh root@49.235.76.142 \"sqlite3 /www/wwwroot/pop-pub.com/miniprogram-server/data/flashphoto_prod.db \"\"SELECT id, nickname, session_key FROM users WHERE id=''u_1766996558717_pxk6rzs'';\"\"\")",
      "Bash(ssh root@49.235.76.142 \"ls -la /var/www/flashphoto-api/routes/ | grep -i ai\")",
      "Bash(ssh root@49.235.76.142 \"cat /var/www/flashphoto-api/routes/ai-proxy.js\")",
      "Bash(ssh root@49.235.76.142 \"grep -n ''ai'' /var/www/flashphoto-api/index.js\")",
      "Bash(ssh root@49.235.76.142 \"ls -la /var/www/flashphoto-api/*.js\")",
      "Bash(tasklist:*)",
      "Bash(ssh root@49.235.76.142 \"ls -la /var/www/ 2>/dev/null || ls -la /opt/ 2>/dev/null | head -20\")",
      "Bash(ssh root@49.235.76.142 \"ls -la /opt/flashphoto-admin/\")",
      "Bash(ssh root@49.235.76.142 \"ls -la /var/www/flashphoto-admin/ 2>/dev/null; find /var/www -name ''admin'' -type d 2>/dev/null; find /opt -name ''admin'' -type d 2>/dev/null\")",
      "Bash(ssh root@49.235.76.142 \"ls -la /var/www/flashphoto-admin/\")",
      "Bash(node --check:*)",
      "Bash(node update_i18n_translations.js:*)",
      "Bash(node check_db_structure.js:*)",
      "Bash(node init_scene_steps.js:*)",
      "Bash(node test_config_api.js:*)",
      "Bash(node fix_all_translations.js:*)",
      "Bash(node fix_all_translations_v2.js:*)",
      "Bash(ssh root@49.235.76.142 \"ls -la /var/www/flashphoto-api/routes/ && echo ''=== app.js 路由注册 ==='' && grep -n ''app.use'' /var/www/flashphoto-api/app.js\")",
      "Bash(ssh root@49.235.76.142 \"cat /var/www/flashphoto-api/routes/config.js\")",
      "Bash(ssh root@49.235.76.142 \"sqlite3 /var/www/flashphoto-api/data/flashphoto.db \"\"SELECT config_key, config_value FROM system_config;\"\"\")",
      "Bash(ssh root@49.235.76.142 \"ls -la /var/www/flashphoto-api/data/ && find /var/www/flashphoto-api -name ''*.db'' -o -name ''*.sqlite''\")",
      "Bash(ssh root@49.235.76.142 \"cat /var/www/flashphoto-api/config/database.js | head -50\")",
      "Bash(ssh root@49.235.76.142 \"echo $SHARED_DB_PATH && cat /var/www/flashphoto-api/.env | grep -i db\")",
      "Bash(ssh root@49.235.76.142 \"sqlite3 /www/wwwroot/pop-pub.com/miniprogram-server/data/flashphoto_prod.db \"\"SELECT config_key, config_value, config_type FROM system_config;\"\"\")",
      "Bash(ssh root@49.235.76.142 \"sqlite3 /www/wwwroot/pop-pub.com/miniprogram-server/data/flashphoto_prod.db \"\"INSERT INTO system_config \\(config_key, config_value, config_type\\) VALUES \\(''support_email'', ''support@xingmei.com'', ''string''\\); INSERT INTO system_config \\(config_key, config_value, config_type\\) VALUES \\(''copyright_text'', ''© 2026 上海醒美元子网络科技工作室（个人独资）所有'', ''string''\\);\"\"\")",
      "Bash(ssh root@49.235.76.142 \"sqlite3 /www/wwwroot/pop-pub.com/miniprogram-server/data/flashphoto_prod.db \"\"SELECT config_key, config_value FROM system_config WHERE config_key IN \\(''support_email'', ''copyright_text''\\);\"\"\")",
      "Bash(ssh root@49.235.76.142 \"curl -s http://localhost:3000/api/config/system\")",
      "Bash(ssh root@49.235.76.142 \"sqlite3 /www/wwwroot/pop-pub.com/miniprogram-server/data/flashphoto_prod.db \"\"SELECT config_key, config_value, config_type FROM system_config WHERE config_key IN \\(''support_email'', ''copyright_text''\\);\"\"\")",
      "Bash(ssh root@49.235.76.142 \"grep -A 20 ''router.get.*system'' /var/www/flashphoto-api/routes/config.js | head -25\")",
      "Bash(ssh root@49.235.76.142 \"cd /var/www/flashphoto-api && pm2 restart flashphoto-api && sleep 2 && curl -s http://localhost:3000/api/config/system\")",
      "Bash(ssh root@49.235.76.142 \"ls -la /var/www/flashphoto-api/public/ 2>/dev/null || ls -la /www/wwwroot/pop-pub.com/miniprogram-server/admin/ 2>/dev/null || echo ''checking admin location...''\")",
      "Bash(ssh root@49.235.76.142 \"cd /var/www/flashphoto-api && ls -la public/admin/\")",
      "Bash(powershell.exe -Command \"cd ''C:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\admin-server\\\\admin-web''; npm run build\")",
      "Bash(powershell.exe -Command \"scp -r ''C:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\admin-server\\\\admin-web\\\\dist\\\\*'' root@49.235.76.142:/var/www/flashphoto-api/public/admin/\")",
      "Bash(powershell.exe -Command \"Get-ChildItem ''C:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\admin-server\\\\admin-web\\\\dist'' | ForEach-Object { scp -r $_.FullName root@49.235.76.142:/var/www/flashphoto-api/public/admin/ }\")",
      "Bash(ssh root@49.235.76.142 \"rm -rf /var/www/flashphoto-api/public/admin/* && ls /var/www/flashphoto-api/public/admin/\")",
      "Bash(ssh root@49.235.76.142 \"mkdir -p /var/www/flashphoto-api/public/admin/assets\")",
      "Bash(ssh root@49.235.76.142 \"cat > /var/www/flashphoto-api/public/admin/index.html\")",
      "Bash(ssh root@49.235.76.142 \"cat > /var/www/flashphoto-api/public/admin/favicon.svg\")",
      "Bash(powershell.exe -Command \"Get-ChildItem -Path ''C:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\admin-server\\\\admin-web\\\\dist\\\\assets\\\\'' | ForEach-Object { Write-Output $_.Name }\")",
      "Bash(cmd.exe /c \"dir /b C:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\admin-server\\\\admin-web\\\\dist\\\\assets\\\\\")",
      "Bash(ssh root@49.235.76.142 \"cd /tmp && rm -rf admin_dist && mkdir admin_dist\")",
      "Bash(tar:*)",
      "Bash(ssh root@49.235.76.142 \"cd /tmp/admin_dist && tar -xvf -\")",
      "Bash(ssh root@49.235.76.142 \"rm -rf /var/www/flashphoto-api/public/admin/* && cp -r /tmp/admin_dist/* /var/www/flashphoto-api/public/admin/ && ls -la /var/www/flashphoto-api/public/admin/\")",
      "Bash(ssh root@49.235.76.142 \"curl -s http://localhost:3000/api/config/system | head -200\")",
      "Bash(ssh root@49.235.76.142 \"rm -rf /var/www/flashphoto-api/public/admin/* && cd /var/www/flashphoto-api/public/admin && tar -xvf -\")",
      "Bash(powershell.exe -Command \"Remove-Item -Recurse -Force ''C:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\admin-server\\\\admin-web\\\\node_modules\\\\.vite'' -ErrorAction SilentlyContinue; Remove-Item -Recurse -Force ''C:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\admin-server\\\\admin-web\\\\dist'' -ErrorAction SilentlyContinue; cd ''C:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\admin-server\\\\admin-web''; npm run build\")",
      "Bash(powershell.exe -Command \"\\(Get-Item ''C:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\admin-server\\\\admin-web\\\\src\\\\views\\\\Operations.vue''\\).LastWriteTime = Get-Date; Remove-Item -Recurse -Force ''C:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\admin-server\\\\admin-web\\\\dist'' -ErrorAction SilentlyContinue; cd ''C:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\admin-server\\\\admin-web''; npm run build 2>&1\")",
      "Bash(ssh root@49.235.76.142 \"rm -rf /var/www/flashphoto-api/public/admin/* && cd /var/www/flashphoto-api/public/admin && tar -xvf - && ls -la\")",
      "Bash(ssh root@49.235.76.142 \"grep -o ''小程序信息配置'' /var/www/flashphoto-api/public/admin/assets/Operations*.js || echo ''NOT FOUND''\")",
      "Bash(ssh root@49.235.76.142 \"cat /var/www/flashphoto-api/public/admin/index.html\")",
      "Bash(ssh root@49.235.76.142 \"cat /var/www/flashphoto-api/public/admin/assets/Operations-CX59jp4d.js | grep -o ''support_email\\\\|copyright_text\\\\|小程序信息'' | head -10\")",
      "Bash(ssh root@49.235.76.142 \"find /www -name ''Operations*.js'' 2>/dev/null | head -10\")",
      "Bash(ls -la \"c:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\miniprogram\\\\pages\\\\flashphoto\\\\icons\"\" 2>&1 || echo \"Directory not found \")",
      "Bash(ssh root@49.235.76.142 \"grep -rn ''testMode\\\\|TEST_MODE'' /www/wwwroot/pop-pub.com/miniprogram-server/ --include=''*.js'' 2>/dev/null | head -30\")",
      "Bash(ls -la \"c:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\miniprogram\\\\images\"\" 2>/dev/null || dir \"c:Users28218WeChatProjectsminiprogram-1miniprogramimages\"\")",
      "Bash(ssh root@49.235.76.142 \"cat /www/wwwroot/admin-server/server/services/signService.js\")",
      "Bash(ssh root@49.235.76.142 \"find /www -name ''signService.js'' 2>/dev/null\")",
      "Bash(ssh root@49.235.76.142 \"find /www -name ''virtual-pay.js'' 2>/dev/null && ls -la /www/wwwroot/\")",
      "Bash(ssh root@49.235.76.142 \"ls -la /www/wwwroot/admin.xingmei.ink/ && cat /www/wwwroot/admin.xingmei.ink/services/signService.js 2>/dev/null || find /www/wwwroot/admin.xingmei.ink -name ''*.js'' | head -20\")",
      "Bash(ssh root@49.235.76.142 \"pm2 list && pm2 show 0 2>/dev/null | head -20\")",
      "Bash(ssh root@49.235.76.142 \"pm2 show flashphoto-api 2>/dev/null | grep -E ''script path|exec cwd''\")",
      "Bash(dir \"c:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\"\" /b | findstr -i \"cert|key|pem \")",
      "Bash(powershell -Command \"Expand-Archive -Path ''1737984033_20260111_cert.zip'' -DestinationPath ''./cert_temp'' -Force\")",
      "Bash(unzip:*)",
      "Bash(openssl x509:*)",
      "Bash(curl -X POST \"https://pop-pub.com/api/pay/confirm\" -H \"Content-Type: application/json\" -d '{\"\"orderId\"\":\"\"WX17681309811575PGFV7\"\",\"\"transactionId\"\":\"\"wx1119294152315447261bf41da21d410000\"\"}')",
      "Bash(ssh -o StrictHostKeyChecking=no root@49.235.76.142 \"cat /var/www/flashphoto-api/services/signService.js | head -30\")",
      "Bash(ssh -o StrictHostKeyChecking=no root@49.235.76.142 \"cd /www/wwwroot/flashphoto-server && pm2 restart admin-server\")",
      "Bash(python:*)",
      "Bash(tree:*)",
      "Bash(Remove-Item \"c:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\nul\", \"c:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\admin-server\\\\nul\", \"c:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\admin-server\\\\admin-web\\\\nul\", \"c:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\admin-server\\\\server\\\\nul\", \"c:\\\\Users\\\\28218\\\\WeChatProjects\\\\miniprogram-1\\\\miniprogram\\\\nul\" -Force -ErrorAction SilentlyContinue)",
      "Bash(npx vite build)",
      "Bash(npm --version)",
      "Bash(./deploy.bat:*)",
      "Bash(tee:*)",
      "Bash(cmd //c \"npm run build\")",
      "Bash(bash:*)",
      "Bash(npx vite build:*)",
      "Bash(node_modules/.bin/vite build:*)",
      "Bash(if:*)",
      "Bash(then echo \"dist exists\")",
      "Bash(else echo \"dist does not exist\")",
      "Bash(fi)",
      "Bash(./node_modules/.bin/vite build:*)",
      "Bash(echo:*)",
      "Bash(npm run dev)",
      "Bash(pip install:*)",
      "Bash(docker info:*)",
      "Bash(docker compose:*)",
      "Read(//c/Users/28218/Pictures/醒美闪图/商户微信支付相关/1105214064_20260122_cert/**)",
      "Bash(git update-index:*)",
      "Bash(npm cache clean:*)",
      "Bash(npx vite:*)"
    ]
  }
}
