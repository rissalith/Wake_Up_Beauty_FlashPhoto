<!-- 我的场景列表页面 -->
<view class="page-container">
  <!-- 自定义导航栏 -->
  <view class="custom-nav" style="padding-top: {{statusBarHeight}}px;">
    <view class="nav-content">
      <view class="nav-back" bindtap="goBack">
        <image class="back-icon" src="/images/icon-back.svg" mode="aspectFit"></image>
      </view>
      <text class="nav-title">我的场景</text>
      <view class="nav-action" bindtap="createScene">
        <image class="add-icon" src="/images/icon-add.svg" mode="aspectFit"></image>
      </view>
    </view>
  </view>

  <!-- 标签栏 -->
  <view class="tabs-bar" style="top: {{navBarHeight}}px;">
    <scroll-view class="tabs-scroll" scroll-x="{{true}}" enhanced="{{true}}" show-scrollbar="{{false}}">
      <view class="tabs-content">
        <view
          class="tab-item {{currentTab === item.key ? 'active' : ''}}"
          wx:for="{{tabs}}"
          wx:key="key"
          data-tab="{{item.key}}"
          bindtap="switchTab"
        >
          <text class="tab-text">{{item.name}}</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- 场景列表 -->
  <scroll-view
    class="scene-list"
    style="top: {{navBarHeight + 50}}px;"
    scroll-y="{{true}}"
    enhanced="{{true}}"
    show-scrollbar="{{false}}"
    refresher-enabled="{{true}}"
    refresher-triggered="{{refreshing}}"
    bindrefresherrefresh="onRefresh"
    bindscrolltolower="loadMore"
  >
    <!-- 场景卡片 -->
    <view class="scene-card" wx:for="{{scenes}}" wx:key="id">
      <view class="scene-main" bindtap="viewScene" data-id="{{item.id}}">
        <image class="scene-icon" src="{{item.icon || '/images/default-scene.svg'}}" mode="aspectFill"></image>
        <view class="scene-info">
          <view class="scene-name-row">
            <text class="scene-name">{{item.name}}</text>
            <view class="scene-status {{item.review_status}}">
              <text class="status-text">{{statusMap[item.review_status]}}</text>
            </view>
          </view>
          <text class="scene-desc">{{item.description || '暂无描述'}}</text>
          <view class="scene-stats">
            <text class="stat-item">{{item.points_cost || 0}}醒币</text>
            <text class="stat-item">{{item.use_count || 0}}次使用</text>
            <text class="stat-item">{{item.like_count || 0}}赞</text>
          </view>
        </view>
      </view>

      <!-- 拒绝原因 -->
      <view class="reject-reason" wx:if="{{item.review_status === 'rejected' && item.reject_reason}}">
        <text class="reject-label">拒绝原因：</text>
        <text class="reject-text">{{item.reject_reason}}</text>
      </view>

      <!-- 操作按钮 -->
      <view class="scene-actions">
        <view class="action-btn edit" wx:if="{{item.review_status === 'draft' || item.review_status === 'rejected'}}" bindtap="editScene" data-id="{{item.id}}">
          <text class="action-text">编辑</text>
        </view>
        <view class="action-btn submit" wx:if="{{item.review_status === 'draft' || item.review_status === 'rejected'}}" bindtap="submitReview" data-id="{{item.id}}">
          <text class="action-text">提交审核</text>
        </view>
        <view class="action-btn delete" wx:if="{{item.review_status === 'draft' || item.review_status === 'rejected'}}" bindtap="deleteScene" data-id="{{item.id}}">
          <text class="action-text">删除</text>
        </view>
        <view class="action-btn preview" wx:if="{{item.review_status === 'approved'}}" bindtap="viewScene" data-id="{{item.id}}">
          <text class="action-text">预览</text>
        </view>
      </view>
    </view>

    <!-- 空状态 -->
    <view class="empty-state" wx:if="{{scenes.length === 0 && !loading}}">
      <image class="empty-icon" src="/images/icon-empty.svg" mode="aspectFit"></image>
      <text class="empty-text">还没有创建场景</text>
      <view class="empty-btn" bindtap="createScene">
        <text class="empty-btn-text">立即创建</text>
      </view>
    </view>

    <!-- 加载状态 -->
    <view class="loading-more" wx:if="{{loading && scenes.length > 0}}">
      <text class="loading-text">加载中...</text>
    </view>

    <!-- 没有更多 -->
    <view class="no-more" wx:if="{{!hasMore && scenes.length > 0}}">
      <text class="no-more-text">没有更多了</text>
    </view>

    <!-- 底部安全区 -->
    <view class="safe-bottom"></view>
  </scroll-view>

  <!-- 加载中 -->
  <view class="loading-mask" wx:if="{{loading && scenes.length === 0}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">加载中...</text>
  </view>
</view>
