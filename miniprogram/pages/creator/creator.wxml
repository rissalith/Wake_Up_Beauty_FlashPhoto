<!-- 创作者中心页面 -->
<view class="page-container">
  <!-- 自定义导航栏 -->
  <view class="custom-nav" style="padding-top: {{statusBarHeight}}px;">
    <view class="nav-content">
      <text class="nav-title">创作者中心</text>
    </view>
  </view>

  <!-- 页面内容 -->
  <scroll-view class="page-scroll" style="top: {{navBarHeight}}px;" scroll-y="{{true}}" enhanced="{{true}}" show-scrollbar="{{false}}">
    <!-- 创作者信息卡片 -->
    <view class="creator-card">
      <view class="creator-header">
        <image class="creator-avatar" src="{{creator.creator_avatar || '/images/default-avatar.svg'}}" mode="aspectFill"></image>
        <view class="creator-info">
          <view class="creator-name-row">
            <text class="creator-name">{{creator.creator_name || '创作者'}}</text>
            <view class="level-badge">
              <text class="level-text">Lv.{{creator.level || 1}}</text>
            </view>
          </view>
          <text class="creator-bio">{{creator.bio || '这个创作者很懒，还没有简介~'}}</text>
        </view>
      </view>

      <!-- 数据统计 -->
      <view class="stats-row">
        <view class="stat-item">
          <text class="stat-value">{{creator.total_templates || 0}}</text>
          <text class="stat-label">模板</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{creator.total_uses || 0}}</text>
          <text class="stat-label">被使用</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{creator.total_likes || 0}}</text>
          <text class="stat-label">获赞</text>
        </view>
        <view class="stat-item" bindtap="goToEarnings">
          <text class="stat-value highlight">{{creator.total_earnings || 0}}</text>
          <text class="stat-label">收益</text>
        </view>
      </view>
    </view>

    <!-- 收益明细入口 -->
    <view class="earnings-entry" bindtap="goToEarnings">
      <view class="earnings-icon-wrap">
        <image class="earnings-icon" src="/images/icon-coin.svg" mode="aspectFit"></image>
      </view>
      <text class="earnings-text">收益明细</text>
      <image class="earnings-arrow" src="/images/icon-arrow-right.svg" mode="aspectFit"></image>
    </view>

    <!-- 我的模板（横向滚动） -->
    <view class="templates-section">
      <view class="section-header">
        <text class="section-title">我的模板</text>
        <view class="view-all" bindtap="goToMyTemplates" wx:if="{{templates.length > 0 || backgroundTasks.length > 0}}">
          <text class="view-all-text">查看全部</text>
          <image class="view-all-arrow" src="/images/icon-arrow-right.svg" mode="aspectFit"></image>
        </view>
      </view>

      <!-- 横向滚动模板列表 -->
      <scroll-view class="template-scroll" scroll-x="{{true}}" enhanced="{{true}}" show-scrollbar="{{false}}">
        <view class="template-list-horizontal">
          <!-- 创建模板入口卡片 -->
          <view class="template-card create-card" bindtap="createTemplate">
            <view class="create-placeholder">
              <view class="create-icon-circle">
                <text class="create-icon">+</text>
              </view>
              <text class="create-text">创建模板</text>
            </view>
          </view>

          <!-- 后台任务卡片 -->
          <view class="template-card task-card {{item.status}}" wx:for="{{backgroundTasks}}" wx:key="taskId" bindtap="onTaskCardTap" data-task="{{item}}">
            <view class="task-card-content">
              <view class="task-status-icon">
                <image wx:if="{{item.status === 'processing' || item.status === 'loading'}}" class="task-icon spinning" src="/images/icon-loading.svg" mode="aspectFit"></image>
                <image wx:elif="{{item.status === 'completed'}}" class="task-icon" src="/images/icon-task-done.svg" mode="aspectFit"></image>
                <image wx:elif="{{item.status === 'failed'}}" class="task-icon" src="/images/icon-task-error.svg" mode="aspectFit"></image>
                <image wx:else class="task-icon" src="/images/icon-task-pending.svg" mode="aspectFit"></image>
              </view>
              <text class="task-title">{{item.description || 'AI生成中'}}</text>
              <view class="task-progress-wrap" wx:if="{{item.status === 'processing' || item.status === 'loading'}}">
                <view class="task-progress-bar">
                  <view class="task-progress-fill" style="width: {{item.progress || 0}}%;"></view>
                </view>
                <text class="task-progress-text">{{item.progress || 0}}%</text>
              </view>
              <text class="task-status-text completed" wx:elif="{{item.status === 'completed'}}">点击应用</text>
              <text class="task-status-text failed" wx:elif="{{item.status === 'failed'}}">生成失败</text>
            </view>
          </view>

          <!-- 模板卡片列表 -->
          <view class="template-card" wx:for="{{templates}}" wx:key="id" bindtap="goToTemplateDetail" data-id="{{item.id}}">
            <image class="template-cover" src="{{item.cover_image}}" mode="aspectFill"></image>
            <view class="template-card-info">
              <text class="template-name">{{item.name}}</text>
              <view class="template-status {{item.status}}">
                <text class="status-text">{{statusMap[item.status] || item.status}}</text>
              </view>
            </view>
          </view>
        </view>
      </scroll-view>
    </view>

    <!-- 底部安全区 -->
    <view class="safe-bottom"></view>
  </scroll-view>
</view>

<!-- 登录弹窗 -->
<login-modal
  show="{{showLoginModal}}"
  bind:close="onLoginModalClose"
  bind:loginsuccess="onLoginSuccess"
/>
