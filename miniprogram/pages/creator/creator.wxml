<!-- åˆ›ä½œè€…ä¸­å¿ƒé¡µé¢ -->
<view class="page-container">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <view class="custom-nav" style="padding-top: {{statusBarHeight}}px;">
    <view class="nav-content">
      <text class="nav-title">åˆ›ä½œè€…ä¸­å¿ƒ</text>
    </view>
  </view>

  <!-- é¡µé¢å†…å®¹ -->
  <scroll-view class="page-scroll" style="top: {{navBarHeight}}px;" scroll-y="{{true}}" enhanced="{{true}}" show-scrollbar="{{false}}">
    <!-- åˆ›ä½œè€…ä¿¡æ¯å¡ç‰‡ -->
    <view class="creator-card">
      <view class="creator-header">
        <image class="creator-avatar" src="{{creator.creator_avatar || '/images/default-avatar.svg'}}" mode="aspectFill"></image>
        <view class="creator-info">
          <view class="creator-name-row">
            <text class="creator-name">{{creator.creator_name || 'åˆ›ä½œè€…'}}</text>
            <view class="level-badge">
              <text class="level-text">Lv.{{creator.level || 1}}</text>
            </view>
          </view>
          <text class="creator-bio">{{creator.bio || 'è¿™ä¸ªåˆ›ä½œè€…å¾ˆæ‡’ï¼Œè¿˜æ²¡æœ‰ç®€ä»‹~'}}</text>
        </view>
      </view>

      <!-- æ•°æ®ç»Ÿè®¡ -->
      <view class="stats-row">
        <view class="stat-item">
          <text class="stat-value">{{creator.total_templates || 0}}</text>
          <text class="stat-label">æ¨¡æ¿</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{creator.total_uses || 0}}</text>
          <text class="stat-label">è¢«ä½¿ç”¨</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{creator.total_likes || 0}}</text>
          <text class="stat-label">è·èµ</text>
        </view>
        <view class="stat-item" bindtap="goToEarnings">
          <text class="stat-value highlight">{{creator.total_earnings || 0}}</text>
          <text class="stat-label">æ”¶ç›Š</text>
        </view>
      </view>
    </view>

    <!-- æ”¶ç›Šæ˜ç»†å…¥å£ -->
    <view class="earnings-entry" bindtap="goToEarnings">
      <view class="earnings-icon-wrap">
        <image class="earnings-icon" src="/images/icon-coin.svg" mode="aspectFit"></image>
      </view>
      <text class="earnings-text">æ”¶ç›Šæ˜ç»†</text>
      <image class="earnings-arrow" src="/images/icon-arrow-right.svg" mode="aspectFit"></image>
    </view>

    <!-- æˆ‘çš„æ¨¡æ¿ï¼ˆèåˆåˆ›å»ºå…¥å£ï¼‰ -->
    <view class="templates-section">
      <view class="section-header">
        <text class="section-title">æˆ‘çš„æ¨¡æ¿</text>
        <view class="view-all" bindtap="goToMyTemplates" wx:if="{{templates.length > 0 || backgroundTasks.length > 0}}">
          <text class="view-all-text">æŸ¥çœ‹å…¨éƒ¨</text>
          <image class="view-all-arrow" src="/images/icon-arrow-right.svg" mode="aspectFit"></image>
        </view>
      </view>

      <!-- æ¨ªå‘æ»šåŠ¨æ¨¡æ¿åˆ—è¡¨ -->
      <scroll-view class="template-scroll" scroll-x="{{true}}" enhanced="{{true}}" show-scrollbar="{{false}}">
        <view class="template-list-horizontal">
          <!-- åˆ›å»ºæ¨¡æ¿å…¥å£å¡ç‰‡ -->
          <view class="template-card create-card" bindtap="createTemplate">
            <view class="create-placeholder">
              <view class="create-icon-circle">
                <text class="create-icon">+</text>
              </view>
              <text class="create-text">åˆ›å»ºæ¨¡æ¿</text>
            </view>
          </view>

          <!-- åå°ä»»åŠ¡å¡ç‰‡ -->
          <view class="template-card task-card {{item.status}}" wx:for="{{backgroundTasks}}" wx:key="taskId" bindtap="onTaskCardTap" data-task="{{item}}">
            <view class="task-card-content">
              <view class="task-status-icon">
                <text wx:if="{{item.status === 'processing' || item.status === 'loading'}}">ğŸ”„</text>
                <text wx:elif="{{item.status === 'completed'}}">âœ…</text>
                <text wx:elif="{{item.status === 'failed'}}">âŒ</text>
                <text wx:else>â³</text>
              </view>
              <text class="task-title">{{item.description || 'AIç”Ÿæˆä¸­'}}</text>
              <view class="task-progress-wrap" wx:if="{{item.status === 'processing' || item.status === 'loading'}}">
                <view class="task-progress-bar">
                  <view class="task-progress-fill" style="width: {{item.progress || 0}}%;"></view>
                </view>
                <text class="task-progress-text">{{item.progress || 0}}%</text>
              </view>
              <text class="task-status-text completed" wx:elif="{{item.status === 'completed'}}">ç‚¹å‡»åº”ç”¨</text>
              <text class="task-status-text failed" wx:elif="{{item.status === 'failed'}}">ç”Ÿæˆå¤±è´¥</text>
            </view>
          </view>

          <!-- æ¨¡æ¿å¡ç‰‡åˆ—è¡¨ -->
          <view class="template-card" wx:for="{{templates}}" wx:key="id" bindtap="goToTemplateDetail" data-id="{{item.id}}">
            <image class="template-cover" src="{{item.cover_image}}" mode="aspectFill"></image>
            <view class="template-card-info">
              <text class="template-name">{{item.name}}</text>
              <view class="template-status {{item.status}}">
                <text class="status-text">{{statusMap[item.status] || item.status}}</text>
              </view>
            </view>
          </view>
        </view>
      </scroll-view>
    </view>

    <!-- åº•éƒ¨å®‰å…¨åŒº -->
    <view class="safe-bottom"></view>
  </scroll-view>
</view>

<!-- ç™»å½•å¼¹çª— -->
<login-modal
  show="{{showLoginModal}}"
  bind:close="onLoginModalClose"
  bind:loginsuccess="onLoginSuccess"
/>
