<!-- æ‘‡éª°å­å®¹å™¨ç»„ä»¶ - æ¨ªå‘å¸ƒå±€ç‰ˆ -->
<view class="dice-roller">
  <!-- ä¸»å†…å®¹åŒºï¼šç»“æœå¡ç‰‡ + éª°å­ -->
  <view class="dice-main">
    <!-- å·¦ä¾§ï¼šç»“æœå¡ç‰‡ -->
    <view class="result-area">
      <block wx:if="{{result && !isRolling}}">
        <!-- æˆè¯­ç»“æœ -->
        <view class="phrase-card" wx:if="{{drawType === 'phrase'}}">
          <text class="phrase-text">{{result.phrase}}</text>
          <text class="phrase-en" wx:if="{{result.phrase_en}}">{{result.phrase_en}}</text>
        </view>
        <!-- é©¬å“çº§ç»“æœ - å·¦å›¾å³å­—å¸ƒå±€ -->
        <view class="horse-card {{result.grade_key}}" wx:else>
          <image
            class="horse-img"
            src="{{result.image}}"
            mode="aspectFit"
            wx:if="{{result.image}}"
            bindtap="onPreviewImage"
            data-url="{{result.image}}"
          />
          <!-- æ²¡æœ‰å›¾ç‰‡æ—¶æ˜¾ç¤ºé©¬åŒ¹å›¾æ ‡ -->
          <view class="horse-icon-wrapper {{result.grade_key}}" wx:else>
            <text class="horse-icon">ğŸ´</text>
          </view>
          <view class="horse-info">
            <text class="horse-name">{{result.name}}</text>
            <text class="horse-name-en" wx:if="{{result.name_en}}">{{result.name_en}}</text>
          </view>
        </view>
      </block>
      <!-- æœªæŠ½å–æ—¶çš„å ä½ -->
      <view class="empty-placeholder" wx:else>
        <text class="empty-text">{{i18n.clickToRoll || 'ç‚¹å‡»éª°å­æŠ½å–'}}</text>
      </view>
    </view>

    <!-- å³ä¾§ï¼šéª°å­/å“çº§æ˜¾ç¤º -->
    <view class="dice-area">
      <view class="dice-wrapper {{result && !isRolling ? 'show-rarity rarity-' + (drawType === 'horse' ? (result.grade_key || 'common') : (result.rarity || 'common')) : ''}}" bindtap="onDiceTap">
        <!-- æŠ½å–åæ˜¾ç¤ºå“çº§ -->
        <block wx:if="{{result && !isRolling}}">
          <text class="rarity-text">{{drawType === 'horse' ? result.name : (result.rarity_name || 'æ™®é€š')}}</text>
        </block>
        <!-- æœªæŠ½å–æˆ–æŠ½å–ä¸­æ˜¾ç¤ºéª°å­ -->
        <block wx:else>
          <dice-cube
            is-rolling="{{isRolling}}"
            current-face="{{currentDiceFace}}"
            size="{{80}}"
          />
        </block>
      </view>
      <!-- çŠ¶æ€æç¤º -->
      <view class="dice-status">
        <text class="status-text rolling" wx:if="{{isRolling}}">{{i18n.rolling || 'æŠ½å–ä¸­...'}}</text>
        <text class="status-text" wx:elif="{{result}}">{{i18n.rollAgain || 'å†æ‘‡ä¸€æ¬¡'}}</text>
        <text class="status-text" wx:else>{{i18n.clickRoll || 'ç‚¹å‡»æŠ½å–'}}</text>
      </view>
      <!-- è´¹ç”¨æç¤º -->
      <view class="cost-hint">
        <text wx:if="{{freeCount > 0}}" class="free-tag">{{i18n.free || 'å…è´¹'}}</text>
        <text wx:else class="cost-tag">{{costPerRoll}}{{i18n.points || 'é†’å¸'}}</text>
      </view>
    </view>
  </view>

  <!-- ä»˜è´¹ç¡®è®¤å¼¹çª— -->
  <view class="confirm-modal" wx:if="{{showPayConfirm}}">
    <view class="confirm-mask" bindtap="onCancelPay"></view>
    <view class="confirm-content">
      <view class="confirm-title">{{i18n.confirmTitle || 'ç¡®è®¤æ¶ˆè€—é†’å¸'}}</view>
      <view class="confirm-desc">{{i18n.confirmDesc || 'æœ¬æ¬¡æ‘‡éª°å­å°†æ¶ˆè€—'}} {{costPerRoll}} {{i18n.points || 'é†’å¸'}}</view>
      <view class="confirm-balance">{{i18n.currentBalance || 'å½“å‰ä½™é¢'}}: {{userPoints}} {{i18n.points || 'é†’å¸'}}</view>
      <view class="confirm-btns">
        <view class="confirm-btn cancel" bindtap="onCancelPay">{{i18n.cancel || 'å–æ¶ˆ'}}</view>
        <view class="confirm-btn ok" bindtap="onConfirmPay">{{i18n.confirm || 'ç¡®è®¤'}}</view>
      </view>
    </view>
  </view>
</view>
