<!-- æ‘‡éª°å­ç»„ä»¶ -->
<view class="dice-roller">
  <!-- æ ‡é¢˜åŒºåŸŸ -->
  <view class="dice-header" wx:if="{{title}}">
    <text class="dice-title">{{title}}</text>
    <text class="dice-subtitle" wx:if="{{subtitle}}">{{subtitle}}</text>
  </view>

  <!-- éª°å­åŒºåŸŸ -->
  <view class="dice-container">
    <!-- æœªæŠ½å–çŠ¶æ€ - æ˜¾ç¤ºéª°å­ -->
    <view class="dice-box {{isRolling ? 'rolling' : ''}}" wx:if="{{!result}}" bindtap="onRollTap">
      <view class="dice">
        <view class="dice-face dice-face-{{currentDice}}">
          <block wx:if="{{currentDice === 1}}">
            <view class="dot center"></view>
          </block>
          <block wx:elif="{{currentDice === 2}}">
            <view class="dot top-right"></view>
            <view class="dot bottom-left"></view>
          </block>
          <block wx:elif="{{currentDice === 3}}">
            <view class="dot top-right"></view>
            <view class="dot center"></view>
            <view class="dot bottom-left"></view>
          </block>
          <block wx:elif="{{currentDice === 4}}">
            <view class="dot top-left"></view>
            <view class="dot top-right"></view>
            <view class="dot bottom-left"></view>
            <view class="dot bottom-right"></view>
          </block>
          <block wx:elif="{{currentDice === 5}}">
            <view class="dot top-left"></view>
            <view class="dot top-right"></view>
            <view class="dot center"></view>
            <view class="dot bottom-left"></view>
            <view class="dot bottom-right"></view>
          </block>
          <block wx:else>
            <view class="dot top-left"></view>
            <view class="dot top-right"></view>
            <view class="dot middle-left"></view>
            <view class="dot middle-right"></view>
            <view class="dot bottom-left"></view>
            <view class="dot bottom-right"></view>
          </block>
        </view>
      </view>
      <view class="dice-hint" wx:if="{{!isRolling}}">
        <text>ç‚¹å‡»æ‘‡ä¸€æ‘‡</text>
      </view>
      <view class="dice-hint rolling-hint" wx:else>
        <text>æ‘‡éª°å­ä¸­...</text>
      </view>
    </view>

    <!-- å·²æŠ½å–çŠ¶æ€ - æ˜¾ç¤ºç»“æœ -->
    <view class="result-box" wx:else animation="{{animationData}}">
      <!-- æˆè¯­ç»“æœ -->
      <block wx:if="{{drawType === 'phrase'}}">
        <view class="result-phrase">
          <text class="phrase-text">{{result.phrase}}</text>
          <text class="phrase-en" wx:if="{{result.phrase_en}}">{{result.phrase_en}}</text>
        </view>
      </block>

      <!-- é©¬å“çº§ç»“æœ -->
      <block wx:else>
        <view class="result-horse {{getRarityClass(result.grade_key)}}">
          <image class="horse-image" src="{{result.image}}" mode="aspectFit" wx:if="{{result.image}}"></image>
          <view class="horse-placeholder" wx:else>
            <text class="horse-icon">ğŸ´</text>
          </view>
          <text class="horse-name">{{result.name}}</text>
          <view class="horse-rarity {{getRarityClass(result.grade_key)}}" wx:if="{{showRarity}}">
            <text>{{getRarityText(result.grade_key)}}</text>
          </view>
          <text class="horse-desc" wx:if="{{result.description}}">{{result.description}}</text>
        </view>
      </block>

      <!-- é‡æ–°æ‘‡éª°å­æŒ‰é’® -->
      <view class="reroll-btn" bindtap="onReroll">
        <text>å†æ‘‡ä¸€æ¬¡</text>
        <text class="reroll-cost" wx:if="{{remainingFree <= 0}}">ï¼ˆ{{costPerRoll}}é†’å¸ï¼‰</text>
        <text class="reroll-free" wx:else>ï¼ˆå…è´¹ï¼‰</text>
      </view>
    </view>
  </view>

  <!-- å…è´¹æ¬¡æ•°æç¤º -->
  <view class="free-hint">
    <text wx:if="{{remainingFree > 0}}">ä»Šæ—¥å…è´¹æ¬¡æ•°: {{remainingFree}}æ¬¡</text>
    <text wx:else>æ¯æ¬¡æ¶ˆè€— {{costPerRoll}} é†’å¸</text>
  </view>

  <!-- ä»˜è´¹ç¡®è®¤å¼¹çª— -->
  <view class="confirm-modal" wx:if="{{showConfirm}}">
    <view class="confirm-mask" bindtap="onCancelPay"></view>
    <view class="confirm-content">
      <view class="confirm-title">ç¡®è®¤æ¶ˆè€—é†’å¸</view>
      <view class="confirm-desc">æœ¬æ¬¡æ‘‡éª°å­å°†æ¶ˆè€— {{costPerRoll}} é†’å¸</view>
      <view class="confirm-btns">
        <view class="confirm-btn cancel" bindtap="onCancelPay">å–æ¶ˆ</view>
        <view class="confirm-btn ok" bindtap="onConfirmPay">ç¡®è®¤</view>
      </view>
    </view>
  </view>
</view>
