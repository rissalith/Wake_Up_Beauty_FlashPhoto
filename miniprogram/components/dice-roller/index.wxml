<!-- æ‘‡éª°å­å®¹å™¨ç»„ä»¶ - æ¨ªå‘å¸ƒå±€ç‰ˆ -->
<view class="dice-roller">
  <!-- ä¸»å†…å®¹åŒºï¼šç»“æœå¡ç‰‡ + éª°å­ -->
  <view class="dice-main">
    <!-- å·¦ä¾§ï¼šç»“æœå¡ç‰‡ -->
    <view class="result-area">
      <block wx:if="{{result && !isRolling}}">
        <!-- æˆè¯­ç»“æœ -->
        <view class="phrase-card" wx:if="{{drawType === 'phrase'}}">
          <text class="phrase-text">{{result.phrase}}</text>
          <text class="phrase-en" wx:if="{{result.phrase_en}}">{{result.phrase_en}}</text>
        </view>
        <!-- é©¬å“çº§ç»“æœ - å·¦å›¾å³å­—å¸ƒå±€ -->
        <view class="horse-card {{result.grade_key}}" wx:else>
          <image
            class="horse-img"
            src="{{result.image}}"
            mode="aspectFit"
            wx:if="{{result.image}}"
            bindtap="onPreviewImage"
            data-url="{{result.image}}"
          />
          <!-- æ²¡æœ‰å›¾ç‰‡æ—¶æ˜¾ç¤ºé©¬åŒ¹å›¾æ ‡ -->
          <view class="horse-icon-wrapper {{result.grade_key}}" wx:else>
            <text class="horse-icon">ğŸ´</text>
          </view>
          <view class="horse-info">
            <text class="horse-name">{{result.name}}</text>
            <text class="horse-name-en" wx:if="{{result.name_en}}">{{result.name_en}}</text>
          </view>
        </view>
      </block>
      <!-- æœªæŠ½å–æ—¶çš„å ä½ -->
      <view class="empty-placeholder" wx:else>
        <text class="empty-text">{{i18n.clickToRoll || 'ç‚¹å‡»éª°å­æŠ½å–'}}</text>
      </view>
    </view>

    <!-- å³ä¾§ï¼šéª°å­/å“çº§æ˜¾ç¤º -->
    <view class="dice-area">
      <view class="dice-wrapper {{result && !isRolling ? 'show-rarity rarity-' + (drawType === 'horse' ? (result.grade_key || 'common') : (result.rarity || 'common')) : ''}}" bindtap="onDiceTap">
        <!-- æŠ½å–åæ˜¾ç¤ºå“çº§ -->
        <block wx:if="{{result && !isRolling}}">
          <text class="rarity-text">{{drawType === 'horse' ? result.name : (result.rarity_name || 'æ™®é€š')}}</text>
        </block>
        <!-- æœªæŠ½å–æˆ–æŠ½å–ä¸­æ˜¾ç¤ºéª°å­ -->
        <block wx:else>
          <dice-cube
            is-rolling="{{isRolling}}"
            current-face="{{currentDiceFace}}"
            size="{{80}}"
          />
        </block>
      </view>
      <!-- çŠ¶æ€æç¤º -->
      <view class="dice-status">
        <text class="status-text rolling" wx:if="{{isRolling}}">{{i18n.rolling || 'æŠ½å–ä¸­...'}}</text>
        <text class="status-text" wx:elif="{{result}}">{{i18n.rollAgain || 'å†æ‘‡ä¸€æ¬¡'}}</text>
        <text class="status-text" wx:else>{{i18n.clickRoll || 'ç‚¹å‡»æŠ½å–'}}</text>
      </view>
      <!-- è´¹ç”¨æç¤º + é—®å·å›¾æ ‡ -->
      <view class="cost-hint">
        <text wx:if="{{freeCount > 0}}" class="free-tag">{{i18n.free || 'å…è´¹'}}</text>
        <text wx:else class="cost-tag">{{costPerRoll}}{{i18n.points || 'é†’å¸'}}</text>
        <view class="help-icon" bindtap="onShowRules">?</view>
      </view>
    </view>
  </view>

  <!-- ä»˜è´¹ç¡®è®¤å¼¹çª— -->
  <view class="confirm-modal" wx:if="{{showPayConfirm}}">
    <view class="confirm-mask" bindtap="onCancelPay"></view>
    <view class="confirm-content">
      <view class="confirm-title">{{i18n.confirmTitle || 'ç¡®è®¤æ¶ˆè€—é†’å¸'}}</view>
      <view class="confirm-desc">{{i18n.confirmDesc || 'æœ¬æ¬¡æ‘‡éª°å­å°†æ¶ˆè€—'}} {{costPerRoll}} {{i18n.points || 'é†’å¸'}}</view>
      <view class="confirm-balance">{{i18n.currentBalance || 'å½“å‰ä½™é¢'}}: {{userPoints}} {{i18n.points || 'é†’å¸'}}</view>
      <view class="confirm-btns">
        <view class="confirm-btn cancel" bindtap="onCancelPay">{{i18n.cancel || 'å–æ¶ˆ'}}</view>
        <view class="confirm-btn ok" bindtap="onConfirmPay">{{i18n.confirm || 'ç¡®è®¤'}}</view>
      </view>
    </view>
  </view>

  <!-- è§„åˆ™è¯´æ˜å¼¹çª— -->
  <view class="rules-modal" wx:if="{{showRulesModal}}">
    <view class="rules-mask" bindtap="onCloseRules"></view>
    <view class="rules-content">
      <view class="rules-header">
        <text class="rules-title">{{i18n.rulesTitle || 'æŠ½å–è§„åˆ™'}}</text>
        <view class="rules-close" bindtap="onCloseRules">Ã—</view>
      </view>

      <!-- è§„åˆ™è¯´æ˜ -->
      <view class="rules-section">
        <view class="rules-item">
          <text class="rules-label">{{i18n.freeRule || 'å…è´¹æ¬¡æ•°'}}</text>
          <text class="rules-value">{{i18n.freeRuleDesc || 'æ¯å¤©æ¯ä¸ªåœºæ™¯å¯å…è´¹æŠ½å–1æ¬¡'}}</text>
        </view>
        <view class="rules-item">
          <text class="rules-label">{{i18n.costRule || 'ä»˜è´¹æŠ½å–'}}</text>
          <text class="rules-value">{{costPerRoll}} {{i18n.points || 'é†’å¸'}} / {{i18n.perTime || 'æ¬¡'}}</text>
        </view>
      </view>

      <!-- å£°æ˜ -->
      <view class="rules-disclaimer">
        <text class="disclaimer-text">{{i18n.disclaimer || 'æŠ½å–ç»“æœå®Œå…¨éšæœºï¼Œæ¦‚ç‡ä»…ä¾›å‚è€ƒ'}}</text>
      </view>

      <!-- é€‰é¡¹æ¸…å• -->
      <view class="pool-section">
        <view class="pool-title">{{i18n.poolTitle || 'å¯æŠ½å–å†…å®¹'}}</view>
        <scroll-view class="pool-list" scroll-y>
          <view class="pool-item" wx:for="{{poolItems}}" wx:key="id">
            <image class="pool-item-img" wx:if="{{item.image}}" src="{{item.image}}" mode="aspectFit" />
            <view class="pool-item-icon" wx:else>
              <text wx:if="{{drawType === 'horse'}}">ğŸ´</text>
              <text wx:else>ğŸ“œ</text>
            </view>
            <view class="pool-item-info">
              <text class="pool-item-name">{{item.name}}</text>
              <text class="pool-item-rarity {{item.rarity}}" wx:if="{{item.rarity_name}}">{{item.rarity_name}}</text>
            </view>
            <text class="pool-item-prob">{{item.probability}}</text>
          </view>
          <view class="pool-empty" wx:if="{{!poolItems || poolItems.length === 0}}">
            <text>{{i18n.loadingPool || 'åŠ è½½ä¸­...'}}</text>
          </view>
        </scroll-view>
      </view>
    </view>
  </view>
</view>
