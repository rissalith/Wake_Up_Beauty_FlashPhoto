<!-- æ‘‡éª°å­å®¹å™¨ç»„ä»¶ - æ¨ªå‘å¸ƒå±€ç‰ˆ -->
<view class="dice-roller">
  <!-- ä¸»å†…å®¹åŒºï¼šç»“æœå¡ç‰‡ + éª°å­ -->
  <view class="dice-main">
    <!-- å·¦ä¾§ï¼šç»“æœå¡ç‰‡ -->
    <view class="result-area">
      <block wx:if="{{result && !isRolling}}">
        <!-- æˆè¯­ç»“æœ -->
        <view class="phrase-card" wx:if="{{drawType === 'phrase'}}">
          <text class="phrase-text">{{result.phrase}}</text>
          <text class="phrase-en" wx:if="{{result.phrase_en}}">{{result.phrase_en}}</text>
        </view>
        <!-- é©¬å“çº§ç»“æœ -->
        <view class="horse-card {{result.grade_key}}" wx:else>
          <image class="horse-img" src="{{result.image}}" mode="aspectFit" wx:if="{{result.image}}"/>
          <view class="horse-placeholder" wx:else>ğŸ´</view>
          <text class="horse-name">{{result.name}}</text>
        </view>
      </block>
      <!-- æœªæŠ½å–æ—¶çš„å ä½ -->
      <view class="empty-placeholder" wx:else>
        <text class="empty-text">ç‚¹å‡»éª°å­æŠ½å–</text>
      </view>
    </view>

    <!-- å³ä¾§ï¼šéª°å­/å“çº§æ˜¾ç¤º -->
    <view class="dice-area">
      <view class="dice-wrapper {{result && !isRolling ? 'show-rarity rarity-' + (result.rarity || 'common') : ''}}" bindtap="onDiceTap">
        <!-- æŠ½å–åæ˜¾ç¤ºå“çº§ -->
        <block wx:if="{{result && !isRolling}}">
          <text class="rarity-text">{{result.rarity_name || 'æ™®é€š'}}</text>
        </block>
        <!-- æœªæŠ½å–æˆ–æŠ½å–ä¸­æ˜¾ç¤ºéª°å­ -->
        <block wx:else>
          <dice-cube
            is-rolling="{{isRolling}}"
            current-face="{{currentDiceFace}}"
            size="{{80}}"
          />
        </block>
      </view>
      <!-- çŠ¶æ€æç¤º -->
      <view class="dice-status">
        <text class="status-text rolling" wx:if="{{isRolling}}">æŠ½å–ä¸­...</text>
        <text class="status-text" wx:elif="{{result}}">å†æ‘‡ä¸€æ¬¡</text>
        <text class="status-text" wx:else>ç‚¹å‡»æŠ½å–</text>
      </view>
      <!-- è´¹ç”¨æç¤º -->
      <view class="cost-hint">
        <text wx:if="{{freeCount > 0}}" class="free-tag">å…è´¹</text>
        <text wx:else class="cost-tag">{{costPerRoll}}é†’å¸</text>
      </view>
    </view>
  </view>

  <!-- ä»˜è´¹ç¡®è®¤å¼¹çª— -->
  <view class="confirm-modal" wx:if="{{showPayConfirm}}">
    <view class="confirm-mask" bindtap="onCancelPay"></view>
    <view class="confirm-content">
      <view class="confirm-title">ç¡®è®¤æ¶ˆè€—é†’å¸</view>
      <view class="confirm-desc">æœ¬æ¬¡æ‘‡éª°å­å°†æ¶ˆè€— {{costPerRoll}} é†’å¸</view>
      <view class="confirm-balance">å½“å‰ä½™é¢: {{userPoints}} é†’å¸</view>
      <view class="confirm-btns">
        <view class="confirm-btn cancel" bindtap="onCancelPay">å–æ¶ˆ</view>
        <view class="confirm-btn ok" bindtap="onConfirmPay">ç¡®è®¤</view>
      </view>
    </view>
  </view>
</view>
