import{r as e,x as a,a as s,i as l,c as t,o as n,d as c,e as i,w as r,f as o,E as u,I as d,G as v,h as m,j as p,t as f,a6 as b,W as y,O as g,P as h,H as k,J as w,Y as _,l as N}from"./index-1m_ef7t3.js";import{d as C}from"./vuedraggable.umd-D2kgnyty.js";import{_ as z,c as V}from"./_plugin-vue_export-helper-D4xNqaWu.js";const x={class:"assets-management"},B={class:"asset-section"},I={class:"section-header"},U={class:"banner-list"},G={class:"banner-item"},D={class:"banner-order"},E={class:"banner-actions"},T={class:"upload-placeholder"},j={class:"asset-section"},P={class:"feature-list"},L={class:"feature-label"},W={class:"feature-upload-area"},S={key:1,class:"upload-placeholder small"},O={class:"asset-section"},R={class:"feature-list"},A={class:"feature-label"},J={class:"feature-upload-area"},$={key:1,class:"upload-placeholder small"},H={class:"asset-section"},K={class:"tabbar-list"},M={class:"tabbar-name"},Y={class:"tabbar-icons"},q={class:"tabbar-icon-item"},F={key:1,class:"icon-placeholder"},Q={class:"tabbar-icon-item"},X={key:1,class:"icon-placeholder"},Z={class:"asset-section"},ee={class:"scene-upload-area"},ae={class:"upload-placeholder"},se={class:"scene-assets-grid"},le=["onClick"],te={class:"scene-asset-preview"},ne={class:"scene-asset-info"},ce=["title"],ie={class:"scene-asset-actions"},re={key:0,class:"empty-tip"},oe={class:"asset-section"},ue={class:"section-header"},de={class:"section-actions"},ve={class:"ui-icons-grid"},me=["onClick"],pe={class:"ui-icon-preview"},fe=["src","alt"],be={class:"ui-icon-name"},ye={class:"upload-placeholder small"},ge="/api/assets/upload",he=z({__name:"Assets",setup(z){const he=e(!1),ke=e("banner"),we=a(()=>({Authorization:`Bearer ${localStorage.getItem("admin_token")}`})),_e=[{label:"简体中文",value:"zh-CN"},{label:"English",value:"en"}],Ne=e("zh-CN"),Ce=e([]),ze=s({"zh-CN":"","zh-TW":"",en:""}),Ve=s({"zh-CN":"","zh-TW":"",en:""}),xe=e([{name:"home",label:"首页",normal:"",active:""},{name:"history",label:"历史",normal:"",active:""},{name:"mine",label:"我的",normal:"",active:""}]),Be=e([]),Ie=e(""),Ue=e(!1),Ge=e([]),De=e(!1),Ee=a(()=>{if(!Ie.value)return Be.value;const e=Ie.value.toLowerCase();return Be.value.filter(a=>a.fileName.toLowerCase().includes(e))});async function Te(){var e;he.value=!0;try{const a=await V.get("/assets/list");if(200===a.code||0===a.code){const s=a.data||{};Ce.value=(null==(e=s.banners)?void 0:e[Ne.value])||[],s.features&&Object.keys(s.features).forEach(e=>{ze[e]=s.features[e]?s.features[e]+"?t="+Date.now():""}),s.titles&&Object.keys(s.titles).forEach(e=>{Ve[e]=s.titles[e]?s.titles[e]+"?t="+Date.now():""}),s.tabbar&&xe.value.forEach(e=>{var a,l;e.normal=(null==(a=s.tabbar[e.name])?void 0:a.normal)?s.tabbar[e.name].normal+"?t="+Date.now():"",e.active=(null==(l=s.tabbar[e.name])?void 0:l.active)?s.tabbar[e.name].active+"?t="+Date.now():""}),Be.value=s.uiIcons||[],Ge.value=s.sceneIcons||[]}}catch(a){console.error("加载素材失败:",a),u.error("加载素材列表失败")}finally{he.value=!1}}async function je(){he.value=!0;try{const e=await V.get("/assets/banners",{params:{lang:Ne.value}});200!==e.code&&0!==e.code||(Ce.value=e.data||[])}catch(e){console.error("加载Banner失败:",e)}finally{he.value=!1}}function Pe(e){const a=e.type.startsWith("image/"),s=e.size/1024/1024<2;return a?!!s||(u.error("图片大小不能超过 2MB!"),!1):(u.error("只能上传图片文件!"),!1)}function Le(e){const a="image/svg+xml"===e.type||"image/png"===e.type,s=e.size/1024<500;return a?!!s||(u.error("图标大小不能超过 500KB!"),!1):(u.error("只能上传 SVG 或 PNG 文件!"),!1)}function We(e){var a;200===e.code&&(null==(a=e.data)?void 0:a.url)?(Ce.value.push({key:e.data.key,url:e.data.url,fileName:e.data.fileName}),u.success("Banner上传成功")):u.error(e.message||"上传失败")}async function Se(){try{const e=Ce.value.map(e=>e.key);await V.post("/assets/banners/sort",{lang:Ne.value,keys:e}),u.success("排序已更新")}catch(e){u.error("排序更新失败")}}function Oe(e,a,s){var l;if(200===e.code&&(null==(l=e.data)?void 0:l.url)){const l=xe.value.find(e=>e.name===a);l&&(l[s]=e.data.url+"?t="+Date.now()),u.success("上传成功")}else u.error(e.message||"上传失败")}function Re(e){var a;200===e.code&&(null==(a=e.data)?void 0:a.url)?(Be.value.push({key:e.data.key,url:e.data.url,fileName:e.data.fileName}),u.success("上传成功")):u.error(e.message||"上传失败")}async function Ae(){try{await N.confirm("这将上传100+个常用SVG图标到图标库，是否继续？","初始化图标库",{type:"info"}),Ue.value=!0;const e=await V.post("/assets/init-icons");200===e.code||0===e.code?(u.success(e.message),await Te()):u.error(e.message||"初始化失败")}catch(e){"cancel"!==e&&u.error("初始化失败: "+(e.message||e))}finally{Ue.value=!1}}function Je(e){"banner"===e?je():"scene-assets"===e&&async function(){var e;De.value=!0;try{const a=await V.get("/assets/list");200!==a.code&&0!==a.code||(Ge.value=(null==(e=a.data)?void 0:e.sceneIcons)||[])}catch(a){console.error("加载场景素材失败:",a)}finally{De.value=!1}}()}function $e(e){var a;200===e.code&&(null==(a=e.data)?void 0:a.url)?(Ge.value.push({key:e.data.key,url:e.data.url,fileName:e.data.fileName}),u.success("场景素材上传成功")):u.error(e.message||"上传失败")}function He(e){navigator.clipboard.writeText(e.url),u.success("已复制素材URL: "+e.fileName)}return l(()=>{Te()}),(e,a)=>{const s=o("el-radio-button"),l=o("el-radio-group"),z=o("el-image"),Be=o("el-icon"),Te=o("el-button"),Ke=o("el-upload"),Me=o("el-tab-pane"),Ye=o("el-input"),qe=o("el-tabs"),Fe=d("loading");return n(),t("div",x,[a[24]||(a[24]=c("div",{class:"page-header"},[c("div",{class:"header-left"},[c("h2",null,"素材管理"),c("span",{class:"subtitle"},"管理Banner、特色图、导航标题、TabBar、场景素材等UI素材")])],-1)),i(qe,{modelValue:ke.value,"onUpdate:modelValue":a[3]||(a[3]=e=>ke.value=e),type:"card",onTabChange:Je},{default:r(()=>[i(Me,{label:"Banner轮播",name:"banner"},{default:r(()=>[c("div",B,[c("div",I,[a[6]||(a[6]=c("span",{class:"section-title"},"首页轮播图",-1)),i(l,{modelValue:Ne.value,"onUpdate:modelValue":a[0]||(a[0]=e=>Ne.value=e),size:"small",onChange:je},{default:r(()=>[i(s,{label:"zh-CN"},{default:r(()=>[...a[4]||(a[4]=[m("简体中文",-1)])]),_:1}),i(s,{label:"en"},{default:r(()=>[...a[5]||(a[5]=[m("English",-1)])]),_:1})]),_:1},8,["modelValue"])]),v((n(),t("div",U,[i(p(C),{modelValue:Ce.value,"onUpdate:modelValue":a[1]||(a[1]=e=>Ce.value=e),"item-key":"key",onEnd:Se,class:"banner-grid"},{item:r(({element:e,index:a})=>[c("div",G,[c("div",D,f(a+1),1),i(z,{src:e.url,fit:"cover",class:"banner-img","preview-src-list":Ce.value.map(e=>e.url)},null,8,["src","preview-src-list"]),c("div",E,[i(Te,{size:"small",type:"danger",onClick:s=>async function(e,a){try{await N.confirm("确定删除这张Banner吗？","删除确认",{type:"warning"}),await V.delete("/assets/delete",{data:{key:e.key}}),Ce.value.splice(a,1),u.success("删除成功")}catch{}}(e,a)},{default:r(()=>[i(Be,null,{default:r(()=>[i(p(b))]),_:1})]),_:1},8,["onClick"])])])]),_:1},8,["modelValue"]),i(Ke,{class:"banner-upload",action:ge,headers:we.value,data:{category:"banner",lang:Ne.value},"show-file-list":!1,"on-success":We,"before-upload":Pe,accept:"image/*"},{default:r(()=>[c("div",T,[i(Be,null,{default:r(()=>[i(p(y))]),_:1}),a[7]||(a[7]=c("span",null,"上传Banner",-1)),a[8]||(a[8]=c("p",null,"建议尺寸: 750×400px",-1))])]),_:1},8,["headers","data"])])),[[Fe,he.value]])])]),_:1}),i(Me,{label:"特色功能图",name:"feature"},{default:r(()=>[c("div",j,[a[10]||(a[10]=c("div",{class:"section-header"},[c("span",{class:"section-title"},"首页特色功能区图片")],-1)),c("div",P,[(n(),t(g,null,h(_e,e=>c("div",{class:"feature-item",key:e.value},[c("div",L,f(e.label),1),c("div",W,[i(Ke,{class:"feature-uploader",action:ge,headers:we.value,data:{category:"feature",lang:e.value},"show-file-list":!1,"on-success":a=>function(e,a){var s;200===e.code&&(null==(s=e.data)?void 0:s.url)?(ze[a]=e.data.url+"?t="+Date.now(),u.success("上传成功")):u.error(e.message||"上传失败")}(a,e.value),"before-upload":Pe,accept:"image/*"},{default:r(()=>[ze[e.value]?(n(),k(z,{key:0,src:ze[e.value],fit:"contain",class:"feature-preview"},null,8,["src"])):(n(),t("div",S,[i(Be,null,{default:r(()=>[i(p(y))]),_:1}),a[9]||(a[9]=c("span",null,"上传图片",-1))]))]),_:2},1032,["headers","data","on-success"])])])),64))])])]),_:1}),i(Me,{label:"导航标题",name:"title"},{default:r(()=>[c("div",O,[a[12]||(a[12]=c("div",{class:"section-header"},[c("span",{class:"section-title"},"导航栏标题图片")],-1)),c("div",R,[(n(),t(g,null,h(_e,e=>c("div",{class:"feature-item",key:e.value},[c("div",A,f(e.label),1),c("div",J,[i(Ke,{class:"title-uploader",action:ge,headers:we.value,data:{category:"title",lang:e.value},"show-file-list":!1,"on-success":a=>function(e,a){var s;200===e.code&&(null==(s=e.data)?void 0:s.url)?(Ve[a]=e.data.url+"?t="+Date.now(),u.success("上传成功")):u.error(e.message||"上传失败")}(a,e.value),"before-upload":Pe,accept:"image/*"},{default:r(()=>[Ve[e.value]?(n(),k(z,{key:0,src:Ve[e.value],fit:"contain",class:"title-preview"},null,8,["src"])):(n(),t("div",$,[i(Be,null,{default:r(()=>[i(p(y))]),_:1}),a[11]||(a[11]=c("span",null,"上传图片",-1))]))]),_:2},1032,["headers","data","on-success"])])])),64))])])]),_:1}),i(Me,{label:"TabBar图标",name:"tabbar"},{default:r(()=>[c("div",H,[a[15]||(a[15]=c("div",{class:"section-header"},[c("span",{class:"section-title"},"底部导航栏图标")],-1)),c("div",K,[(n(!0),t(g,null,h(xe.value,e=>(n(),t("div",{class:"tabbar-item",key:e.name},[c("div",M,f(e.label),1),c("div",Y,[c("div",q,[a[13]||(a[13]=c("span",{class:"icon-state"},"默认",-1)),i(Ke,{class:"tabbar-uploader",action:ge,headers:we.value,data:{category:"tabbar",name:e.name,state:"normal"},"show-file-list":!1,"on-success":a=>Oe(a,e.name,"normal"),"before-upload":Pe,accept:"image/*"},{default:r(()=>[e.normal?(n(),k(z,{key:0,src:e.normal,fit:"contain",class:"tabbar-icon-preview"},null,8,["src"])):(n(),t("div",F,[i(Be,null,{default:r(()=>[i(p(y))]),_:1})]))]),_:2},1032,["headers","data","on-success"])]),c("div",Q,[a[14]||(a[14]=c("span",{class:"icon-state"},"选中",-1)),i(Ke,{class:"tabbar-uploader",action:ge,headers:we.value,data:{category:"tabbar",name:e.name,state:"active"},"show-file-list":!1,"on-success":a=>Oe(a,e.name,"active"),"before-upload":Pe,accept:"image/*"},{default:r(()=>[e.active?(n(),k(z,{key:0,src:e.active,fit:"contain",class:"tabbar-icon-preview"},null,8,["src"])):(n(),t("div",X,[i(Be,null,{default:r(()=>[i(p(y))]),_:1})]))]),_:2},1032,["headers","data","on-success"])])])]))),128))])])]),_:1}),i(Me,{label:"场景素材",name:"scene-assets"},{default:r(()=>[c("div",Z,[a[20]||(a[20]=c("div",{class:"section-header"},[c("span",{class:"section-title"},"场景配置素材"),c("span",{class:"section-tip"},"用于场景图标、步骤选项示意图等")],-1)),c("div",ee,[i(Ke,{class:"scene-asset-upload",action:ge,headers:we.value,data:{category:"scene-icon"},"show-file-list":!1,"on-success":$e,"before-upload":Pe,accept:"image/*",multiple:""},{default:r(()=>[c("div",ae,[i(Be,null,{default:r(()=>[i(p(y))]),_:1}),a[16]||(a[16]=c("span",null,"上传场景素材",-1)),a[17]||(a[17]=c("p",null,"支持 PNG/JPG/WebP，建议尺寸 512×512px",-1))])]),_:1},8,["headers"])]),v((n(),t("div",se,[(n(!0),t(g,null,h(Ge.value,e=>(n(),t("div",{class:"scene-asset-item",key:e.key,onClick:a=>He(e)},[c("div",te,[i(z,{src:e.url,fit:"contain","preview-src-list":[e.url]},null,8,["src","preview-src-list"])]),c("div",ne,[c("span",{class:"scene-asset-name",title:e.fileName},f(e.fileName),9,ce),c("div",ie,[i(Te,{size:"small",type:"primary",link:"",onClick:_(a=>He(e),["stop"])},{default:r(()=>[...a[18]||(a[18]=[m(" 复制URL ",-1)])]),_:1},8,["onClick"]),i(Te,{size:"small",type:"danger",link:"",onClick:_(a=>async function(e){try{await N.confirm(`确定删除素材 "${e.fileName}" 吗？`,"删除确认",{type:"warning"}),await V.delete("/assets/delete",{data:{key:e.key}});const a=Ge.value.findIndex(a=>a.key===e.key);a>-1&&Ge.value.splice(a,1),u.success("删除成功")}catch(a){"cancel"!==a&&u.error("删除失败: "+(a.message||a))}}(e),["stop"])},{default:r(()=>[...a[19]||(a[19]=[m(" 删除 ",-1)])]),_:1},8,["onClick"])])])],8,le))),128)),0!==Ge.value.length||De.value?w("",!0):(n(),t("div",re," 暂无场景素材，请上传图片 "))])),[[Fe,De.value]])])]),_:1}),i(Me,{label:"UI图标",name:"ui-icons"},{default:r(()=>[c("div",oe,[c("div",ue,[a[22]||(a[22]=c("span",{class:"section-title"},"通用UI图标 (SVG/PNG)",-1)),c("div",de,[i(Te,{type:"primary",size:"small",onClick:Ae,loading:Ue.value},{default:r(()=>[...a[21]||(a[21]=[m(" 初始化图标库 ",-1)])]),_:1},8,["loading"]),i(Ye,{modelValue:Ie.value,"onUpdate:modelValue":a[2]||(a[2]=e=>Ie.value=e),placeholder:"搜索图标...",style:{width:"200px","margin-left":"10px"},clearable:""},null,8,["modelValue"])])]),v((n(),t("div",ve,[(n(!0),t(g,null,h(Ee.value,e=>(n(),t("div",{class:"ui-icon-item",key:e.key,onClick:a=>function(e){navigator.clipboard.writeText(e.url),u.success("已复制图标URL")}(e)},[c("div",pe,[c("img",{src:e.url,alt:e.fileName},null,8,fe)]),c("div",be,f(e.fileName),1)],8,me))),128)),i(Ke,{class:"ui-icon-upload",action:ge,headers:we.value,data:{category:"ui-icon"},"show-file-list":!1,"on-success":Re,"before-upload":Le,accept:"image/svg+xml,image/png"},{default:r(()=>[c("div",ye,[i(Be,null,{default:r(()=>[i(p(y))]),_:1}),a[23]||(a[23]=c("span",null,"上传图标",-1))])]),_:1},8,["headers"])])),[[Fe,he.value]])])]),_:1})]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-753ae2cd"]]);export{he as default};
