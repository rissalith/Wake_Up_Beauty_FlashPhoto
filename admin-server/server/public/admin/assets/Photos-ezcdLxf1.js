import{F as e,r as a,x as l,i as s,c as t,o as i,d as u,G as o,H as d,J as c,e as r,w as n,f as v,O as p,t as m,I as g,P as y,E as f,h as b,l as h}from"./index-1m_ef7t3.js";import{u as _,t as w}from"./timezone-To2cqxMU.js";import{_ as k,p as C}from"./_plugin-vue_export-helper-D4xNqaWu.js";const V={class:"photos-page"},x={class:"page-card"},S={class:"card-header"},z={class:"filter-bar"},I={class:"user-id-hint"},O={class:"stats-summary"},U={class:"stat-item"},E={class:"value"},D={class:"stat-item"},P={class:"value"},M={class:"stat-item"},j={class:"value"},B={class:"stat-item"},F={class:"value"},H={class:"photo-grid"},R={class:"photo-img-wrap"},A={class:"image-error"},K={class:"photo-info"},T={key:0,class:"info-row"},G={key:1,class:"info-row"},J={class:"file-size"},L={class:"info-row"},N={class:"user-id"},Y={class:"info-row"},$={class:"time"},q={class:"pagination-wrap"},Q={key:0,class:"user-detail"},W={class:"detail-stats"},X={class:"records-grid"},Z={class:"record-images"},ee={class:"image-box"},ae={key:1,class:"no-image"},le={class:"image-box"},se={key:1,class:"no-image"},te={class:"record-time"},ie=k({__name:"Photos",setup(k){e.extend(_),e.extend(w);const ie=a(!1),ue=a([]),oe=a(1),de=a(48),ce=a(0),re=a(""),ne=a(""),ve=a({}),pe=a("cos"),me=a(!1),ge=a([]),ye=a(""),fe=a(""),be=a(""),he=a(!1),_e=a(null),we=l(()=>"cos"===pe.value?me.value?"暂无照片":"COS未配置，请先配置COS密钥":"暂无照片"),ke=a=>a?e.utc(a).tz("Asia/Shanghai").format("MM-DD HH:mm"):"-",Ce=e=>"cos"===pe.value?e.url:e.result_image,Ve=e=>({idphoto:"证件照",professional:"职业照",avatar:"头像",feedback:"反馈",default:"默认"}[e]||e),xe=async()=>{if(me.value)try{const e=await C.getCosUsers();200!==e.code&&0!==e.code||(ge.value=e.data)}catch(e){console.error("加载COS用户失败:",e)}},Se=async()=>{if(!me.value)return ue.value=[],void(ce.value=0);ie.value=!0;try{const e={page:oe.value,pageSize:de.value,userId:ye.value,type:fe.value,scene:be.value},a=await C.getCosPhotos(e);200!==a.code&&0!==a.code||(ue.value=a.data.list,ce.value=a.data.total)}catch(e){f.error("加载COS照片失败: "+e.message)}finally{ie.value=!1}},ze=async()=>{ie.value=!0;try{const e={page:oe.value,pageSize:de.value,userId:re.value,status:ne.value},a=await C.getList(e);200!==a.code&&0!==a.code||(ue.value=a.data.list,ce.value=a.data.total)}finally{ie.value=!1}},Ie=async()=>{try{const e=await C.getStats();200!==e.code&&0!==e.code||(ve.value=e.data)}catch(e){console.error(e)}},Oe=async()=>{oe.value=1,ue.value=[],ce.value=0,"cos"===pe.value?(await xe(),await Se()):(await ze(),await Ie())},Ue=()=>{oe.value=1,"cos"===pe.value?Se():ze()},Ee=()=>{"cos"===pe.value?Se():ze()};return s(async()=>{await(async()=>{try{const e=await C.getCosStatus();200!==e.code&&0!==e.code||(me.value=e.data.configured)}catch(e){me.value=!1}})(),"cos"===pe.value?(await xe(),await Se()):(await ze(),await Ie())}),(e,a)=>{var l,s,_,w;const k=v("el-radio-button"),xe=v("el-radio-group"),De=v("el-divider"),Pe=v("el-option"),Me=v("el-select"),je=v("el-input"),Be=v("Search"),Fe=v("el-icon"),He=v("el-button"),Re=v("el-alert"),Ae=v("Picture"),Ke=v("el-image"),Te=v("el-tag"),Ge=v("Delete"),Je=v("el-empty"),Le=v("el-pagination"),Ne=v("el-statistic"),Ye=v("Right"),$e=v("el-dialog"),qe=g("loading"),Qe=g("dialog-drag");return i(),t("div",V,[u("div",x,[u("div",S,[a[12]||(a[12]=u("span",{class:"card-title"},"照片管理",-1)),u("div",z,[r(xe,{modelValue:pe.value,"onUpdate:modelValue":a[0]||(a[0]=e=>pe.value=e),onChange:Oe},{default:n(()=>[r(k,{label:"cos"},{default:n(()=>[...a[9]||(a[9]=[b("COS存储",-1)])]),_:1}),r(k,{label:"db"},{default:n(()=>[...a[10]||(a[10]=[b("数据库",-1)])]),_:1})]),_:1},8,["modelValue"]),r(De,{direction:"vertical"}),"cos"===pe.value?(i(),t(p,{key:0},[r(Me,{modelValue:ye.value,"onUpdate:modelValue":a[1]||(a[1]=e=>ye.value=e),placeholder:"选择用户",clearable:"",filterable:"",style:{width:"220px"},onChange:Se},{default:n(()=>[(i(!0),t(p,null,y(ge.value,e=>(i(),d(Pe,{key:e.user_id,label:e.nickname||e.user_id,value:e.user_id},{default:n(()=>[u("span",null,m(e.nickname||"未知昵称"),1),u("span",I,m(e.user_id.substring(0,12))+"...",1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"]),r(Me,{modelValue:be.value,"onUpdate:modelValue":a[2]||(a[2]=e=>be.value=e),placeholder:"场景类型",clearable:"",style:{width:"120px"},onChange:Se},{default:n(()=>[r(Pe,{label:"证件照",value:"idphoto"}),r(Pe,{label:"职业照",value:"professional"}),r(Pe,{label:"头像",value:"avatar"}),r(Pe,{label:"反馈图片",value:"feedback"}),r(Pe,{label:"默认/旧版",value:"default"})]),_:1},8,["modelValue"]),r(Me,{modelValue:fe.value,"onUpdate:modelValue":a[3]||(a[3]=e=>fe.value=e),placeholder:"照片类型",clearable:"",style:{width:"120px"},onChange:Se},{default:n(()=>[r(Pe,{label:"原图",value:"temp"}),r(Pe,{label:"结果图",value:"output"})]),_:1},8,["modelValue"])],64)):(i(),t(p,{key:1},[r(je,{modelValue:re.value,"onUpdate:modelValue":a[4]||(a[4]=e=>re.value=e),placeholder:"用户ID",style:{width:"180px"},clearable:""},null,8,["modelValue"]),r(Me,{modelValue:ne.value,"onUpdate:modelValue":a[5]||(a[5]=e=>ne.value=e),placeholder:"状态",clearable:"",style:{width:"120px"}},{default:n(()=>[r(Pe,{label:"已完成",value:"done"}),r(Pe,{label:"生成中",value:"generating"}),r(Pe,{label:"失败",value:"failed"})]),_:1},8,["modelValue"])],64)),r(He,{type:"primary",onClick:Ue},{default:n(()=>[r(Fe,null,{default:n(()=>[r(Be)]),_:1}),a[11]||(a[11]=b(" 搜索 ",-1))]),_:1})])]),"cos"!==pe.value||me.value?c("",!0):(i(),d(Re,{key:0,type:"warning",closable:!1,"show-icon":"",style:{"margin-bottom":"16px"}},{title:n(()=>[...a[13]||(a[13]=[b(" COS未配置 - 请在服务端 .env 文件中设置 COS_SECRET_ID 和 COS_SECRET_KEY ",-1)])]),_:1})),u("div",O,["cos"===pe.value?(i(),t(p,{key:0},[u("div",U,[a[14]||(a[14]=u("span",{class:"label"},"COS用户数",-1)),u("span",E,m(ge.value.length),1)]),u("div",D,[a[15]||(a[15]=u("span",{class:"label"},"当前照片",-1)),u("span",P,m(ce.value),1)])],64)):(i(),t(p,{key:1},[u("div",M,[a[16]||(a[16]=u("span",{class:"label"},"照片总数",-1)),u("span",j,m(ve.value.total||0),1)]),u("div",B,[a[17]||(a[17]=u("span",{class:"label"},"今日生成",-1)),u("span",F,m(ve.value.today||0),1)])],64))]),o((i(),t("div",H,[(i(!0),t(p,null,y(ue.value,e=>{var a,l,s;return i(),t("div",{class:"photo-item",key:e.id||e.key},[u("div",R,[r(Ke,{src:Ce(e),"preview-src-list":ue.value.map(e=>Ce(e)),"initial-index":ue.value.findIndex(a=>(a.id||a.key)===(e.id||e.key)),fit:"cover",class:"photo-img"},{error:n(()=>[u("div",A,[r(Fe,null,{default:n(()=>[r(Ae)]),_:1})])]),_:1},8,["src","preview-src-list","initial-index"]),e.type?(i(),d(Te,{key:0,class:"type-tag",type:"output"===e.type?"success":"info",size:"small"},{default:n(()=>[b(m("output"===e.type?"结果图":"原图"),1)]),_:2},1032,["type"])):c("",!0),e.scene&&"default"!==e.scene?(i(),d(Te,{key:1,class:"scene-tag",type:(s=e.scene,{idphoto:"primary",professional:"warning",avatar:"",feedback:"danger",default:"info"}[s]||"info"),size:"small"},{default:n(()=>[b(m(e.sceneName||Ve(e.scene)),1)]),_:2},1032,["type"])):c("",!0),"db"===pe.value?(i(),d(He,{key:2,class:"delete-btn",type:"danger",circle:"",size:"small",onClick:a=>(async e=>{try{await h.confirm("确定要删除这张照片吗？此操作不可恢复","警告",{type:"warning"});const a=await C.delete(e.photo_id||e.id);200!==a.code&&0!==a.code||(f.success("删除成功"),ze(),Ie())}catch{}})(e)},{default:n(()=>[r(Fe,null,{default:n(()=>[r(Ge)]),_:1})]),_:1},8,["onClick"])):c("",!0)]),u("div",K,["db"===pe.value?(i(),t("div",T,[r(Te,{size:"small"},{default:n(()=>[b(m(e.spec||"未知规格"),1)]),_:2},1024),r(Te,{size:"small",type:"info"},{default:n(()=>[b(m(e.bg_color||"未知背景"),1)]),_:2},1024)])):(i(),t("div",G,[u("span",J,m((l=e.size,l?l<1024?l+" B":l<1048576?(l/1024).toFixed(1)+" KB":(l/1024/1024).toFixed(1)+" MB":"-")),1)])),u("div",L,[u("span",N,m(null==(a=e.user_id||e.userId)?void 0:a.substring(0,12))+"...",1)]),u("div",Y,[u("span",$,m(ke(e.created_at||e.lastModified)),1)])])])}),128))])),[[qe,ie.value]]),ie.value||0!==ue.value.length?c("",!0):(i(),d(Je,{key:1,description:we.value},null,8,["description"])),u("div",q,[r(Le,{"current-page":oe.value,"onUpdate:currentPage":a[6]||(a[6]=e=>oe.value=e),"page-size":de.value,"onUpdate:pageSize":a[7]||(a[7]=e=>de.value=e),total:ce.value,"page-sizes":[12,24,48],layout:"total, sizes, prev, pager, next",onChange:Ee},null,8,["current-page","page-size","total"])])]),o((i(),d($e,{modelValue:he.value,"onUpdate:modelValue":a[8]||(a[8]=e=>he.value=e),title:`用户照片详情 - ${(null==(s=null==(l=_e.value)?void 0:l.user)?void 0:s.nickname)||(null==(w=null==(_=_e.value)?void 0:_.user)?void 0:w.user_id)||""}`,width:"80%"},{default:n(()=>{var e,l,s;return[_e.value?(i(),t("div",Q,[u("div",W,[r(Ne,{title:"照片总数",value:(null==(e=_e.value.stats)?void 0:e.total)||0},null,8,["value"]),r(Ne,{title:"原图数量",value:(null==(l=_e.value.stats)?void 0:l.temp)||0},null,8,["value"]),r(Ne,{title:"证件照数量",value:(null==(s=_e.value.stats)?void 0:s.output)||0},null,8,["value"])]),u("div",X,[(i(!0),t(p,null,y(_e.value.records,e=>(i(),t("div",{class:"record-item",key:e.id},[u("div",Z,[u("div",ee,[a[18]||(a[18]=u("span",{class:"image-label"},"原图",-1)),e.originalImage?(i(),d(Ke,{key:0,src:e.originalImage,fit:"cover","preview-src-list":[e.originalImage]},null,8,["src","preview-src-list"])):(i(),t("div",ae,"无"))]),r(Fe,{class:"arrow-icon"},{default:n(()=>[r(Ye)]),_:1}),u("div",le,[a[19]||(a[19]=u("span",{class:"image-label"},"证件照",-1)),e.resultImage?(i(),d(Ke,{key:0,src:e.resultImage,fit:"cover","preview-src-list":[e.resultImage]},null,8,["src","preview-src-list"])):(i(),t("div",se,"无"))])]),u("div",te,m(ke(e.createdAt)),1)]))),128))])])):c("",!0)]}),_:1},8,["modelValue","title"])),[[Qe]])])}}},[["__scopeId","data-v-b02749e4"]]);export{ie as default};
