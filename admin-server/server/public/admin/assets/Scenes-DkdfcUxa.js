import{r as e,x as t,a as l,i as a,c as n,o,d as i,G as s,e as r,w as c,f as d,t as u,I as p,H as m,Q as v,E as f,h as g,j as h,W as _,X as b,J as y,Y as w,Z as k,O as C,P as V,_ as x,$ as E,a0 as S,a1 as D,a2 as T,a3 as I,a4 as P,a5 as O,g as A,l as z,C as N}from"./index-1m_ef7t3.js";import{d as U}from"./vuedraggable.umd-D2kgnyty.js";import{c as M,_ as R}from"./_plugin-vue_export-helper-D4xNqaWu.js";
/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function X(e,t){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),l.push.apply(l,a)}return l}function Y(e){for(var t=1;t<arguments.length;t++){var l=null!=arguments[t]?arguments[t]:{};t%2?X(Object(l),!0).forEach(function(t){L(e,t,l[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):X(Object(l)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(l,t))})}return e}function $(e){return($="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function L(e,t,l){return t in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e}function j(){return j=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var l=arguments[t];for(var a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a])}return e},j.apply(this,arguments)}function B(e,t){if(null==e)return{};var l,a,n=function(e,t){if(null==e)return{};var l,a,n={},o=Object.keys(e);for(a=0;a<o.length;a++)l=o[a],t.indexOf(l)>=0||(n[l]=e[l]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)l=o[a],t.indexOf(l)>=0||Object.prototype.propertyIsEnumerable.call(e,l)&&(n[l]=e[l])}return n}function F(e){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(e)}var H=F(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),W=F(/Edge/i),q=F(/firefox/i),G=F(/safari/i)&&!F(/chrome/i)&&!F(/android/i),J=F(/iP(ad|od|hone)/i),K=F(/chrome/i)&&F(/android/i),Z={capture:!1,passive:!1};function Q(e,t,l){e.addEventListener(t,l,!H&&Z)}function ee(e,t,l){e.removeEventListener(t,l,!H&&Z)}function te(e,t){if(t){if(">"===t[0]&&(t=t.substring(1)),e)try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch(l){return!1}return!1}}function le(e){return e.host&&e!==document&&e.host.nodeType?e.host:e.parentNode}function ae(e,t,l,a){if(e){l=l||document;do{if(null!=t&&(">"===t[0]?e.parentNode===l&&te(e,t):te(e,t))||a&&e===l)return e;if(e===l)break}while(e=le(e))}return null}var ne,oe=/\s+/g;function ie(e,t,l){if(e&&t)if(e.classList)e.classList[l?"add":"remove"](t);else{var a=(" "+e.className+" ").replace(oe," ").replace(" "+t+" "," ");e.className=(a+(l?" "+t:"")).replace(oe," ")}}function se(e,t,l){var a=e&&e.style;if(a){if(void 0===l)return document.defaultView&&document.defaultView.getComputedStyle?l=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(l=e.currentStyle),void 0===t?l:l[t];t in a||-1!==t.indexOf("webkit")||(t="-webkit-"+t),a[t]=l+("string"==typeof l?"":"px")}}function re(e,t){var l="";if("string"==typeof e)l=e;else do{var a=se(e,"transform");a&&"none"!==a&&(l=a+" "+l)}while(!t&&(e=e.parentNode));var n=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return n&&new n(l)}function ce(e,t,l){if(e){var a=e.getElementsByTagName(t),n=0,o=a.length;if(l)for(;n<o;n++)l(a[n],n);return a}return[]}function de(){var e=document.scrollingElement;return e||document.documentElement}function ue(e,t,l,a,n){if(e.getBoundingClientRect||e===window){var o,i,s,r,c,d,u;if(e!==window&&e.parentNode&&e!==de()?(i=(o=e.getBoundingClientRect()).top,s=o.left,r=o.bottom,c=o.right,d=o.height,u=o.width):(i=0,s=0,r=window.innerHeight,c=window.innerWidth,d=window.innerHeight,u=window.innerWidth),(t||l)&&e!==window&&(n=n||e.parentNode,!H))do{if(n&&n.getBoundingClientRect&&("none"!==se(n,"transform")||l&&"static"!==se(n,"position"))){var p=n.getBoundingClientRect();i-=p.top+parseInt(se(n,"border-top-width")),s-=p.left+parseInt(se(n,"border-left-width")),r=i+o.height,c=s+o.width;break}}while(n=n.parentNode);if(a&&e!==window){var m=re(n||e),v=m&&m.a,f=m&&m.d;m&&(r=(i/=f)+(d/=f),c=(s/=v)+(u/=v))}return{top:i,left:s,bottom:r,right:c,width:u,height:d}}}function pe(e,t,l){for(var a=he(e,!0),n=ue(e)[t];a;){if(!(n>=ue(a)[l]))return a;if(a===de())break;a=he(a,!1)}return!1}function me(e,t,l,a){for(var n=0,o=0,i=e.children;o<i.length;){if("none"!==i[o].style.display&&i[o]!==wt.ghost&&(a||i[o]!==wt.dragged)&&ae(i[o],l.draggable,e,!1)){if(n===t)return i[o];n++}o++}return null}function ve(e,t){for(var l=e.lastElementChild;l&&(l===wt.ghost||"none"===se(l,"display")||t&&!te(l,t));)l=l.previousElementSibling;return l||null}function fe(e,t){var l=0;if(!e||!e.parentNode)return-1;for(;e=e.previousElementSibling;)"TEMPLATE"===e.nodeName.toUpperCase()||e===wt.clone||t&&!te(e,t)||l++;return l}function ge(e){var t=0,l=0,a=de();if(e)do{var n=re(e),o=n.a,i=n.d;t+=e.scrollLeft*o,l+=e.scrollTop*i}while(e!==a&&(e=e.parentNode));return[t,l]}function he(e,t){if(!e||!e.getBoundingClientRect)return de();var l=e,a=!1;do{if(l.clientWidth<l.scrollWidth||l.clientHeight<l.scrollHeight){var n=se(l);if(l.clientWidth<l.scrollWidth&&("auto"==n.overflowX||"scroll"==n.overflowX)||l.clientHeight<l.scrollHeight&&("auto"==n.overflowY||"scroll"==n.overflowY)){if(!l.getBoundingClientRect||l===document.body)return de();if(a||t)return l;a=!0}}}while(l=l.parentNode);return de()}function _e(e,t){return Math.round(e.top)===Math.round(t.top)&&Math.round(e.left)===Math.round(t.left)&&Math.round(e.height)===Math.round(t.height)&&Math.round(e.width)===Math.round(t.width)}function be(e,t){return function(){if(!ne){var l=arguments;1===l.length?e.call(this,l[0]):e.apply(this,l),ne=setTimeout(function(){ne=void 0},t)}}}function ye(e,t,l){e.scrollLeft+=t,e.scrollTop+=l}function we(e){var t=window.Polymer,l=window.jQuery||window.Zepto;return t&&t.dom?t.dom(e).cloneNode(!0):l?l(e).clone(!0)[0]:e.cloneNode(!0)}function ke(e,t,l){var a={};return Array.from(e.children).forEach(function(n){var o,i,s,r;if(ae(n,t.draggable,e,!1)&&!n.animated&&n!==l){var c=ue(n);a.left=Math.min(null!==(o=a.left)&&void 0!==o?o:1/0,c.left),a.top=Math.min(null!==(i=a.top)&&void 0!==i?i:1/0,c.top),a.right=Math.max(null!==(s=a.right)&&void 0!==s?s:-1/0,c.right),a.bottom=Math.max(null!==(r=a.bottom)&&void 0!==r?r:-1/0,c.bottom)}}),a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}var Ce="Sortable"+(new Date).getTime();function Ve(){var e,t=[];return{captureAnimationState:function(){(t=[],this.options.animation)&&[].slice.call(this.el.children).forEach(function(e){if("none"!==se(e,"display")&&e!==wt.ghost){t.push({target:e,rect:ue(e)});var l=Y({},t[t.length-1].rect);if(e.thisAnimationDuration){var a=re(e,!0);a&&(l.top-=a.f,l.left-=a.e)}e.fromRect=l}})},addAnimationState:function(e){t.push(e)},removeAnimationState:function(e){t.splice(function(e,t){for(var l in e)if(e.hasOwnProperty(l))for(var a in t)if(t.hasOwnProperty(a)&&t[a]===e[l][a])return Number(l);return-1}(t,{target:e}),1)},animateAll:function(l){var a=this;if(!this.options.animation)return clearTimeout(e),void("function"==typeof l&&l());var n=!1,o=0;t.forEach(function(e){var t=0,l=e.target,i=l.fromRect,s=ue(l),r=l.prevFromRect,c=l.prevToRect,d=e.rect,u=re(l,!0);u&&(s.top-=u.f,s.left-=u.e),l.toRect=s,l.thisAnimationDuration&&_e(r,s)&&!_e(i,s)&&(d.top-s.top)/(d.left-s.left)===(i.top-s.top)/(i.left-s.left)&&(t=function(e,t,l,a){return Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))/Math.sqrt(Math.pow(t.top-l.top,2)+Math.pow(t.left-l.left,2))*a.animation}(d,r,c,a.options)),_e(s,i)||(l.prevFromRect=i,l.prevToRect=s,t||(t=a.options.animation),a.animate(l,d,s,t)),t&&(n=!0,o=Math.max(o,t),clearTimeout(l.animationResetTimer),l.animationResetTimer=setTimeout(function(){l.animationTime=0,l.prevFromRect=null,l.fromRect=null,l.prevToRect=null,l.thisAnimationDuration=null},t),l.thisAnimationDuration=t)}),clearTimeout(e),n?e=setTimeout(function(){"function"==typeof l&&l()},o):"function"==typeof l&&l(),t=[]},animate:function(e,t,l,a){if(a){se(e,"transition",""),se(e,"transform","");var n=re(this.el),o=n&&n.a,i=n&&n.d,s=(t.left-l.left)/(o||1),r=(t.top-l.top)/(i||1);e.animatingX=!!s,e.animatingY=!!r,se(e,"transform","translate3d("+s+"px,"+r+"px,0)"),this.forRepaintDummy=function(e){return e.offsetWidth}(e),se(e,"transition","transform "+a+"ms"+(this.options.easing?" "+this.options.easing:"")),se(e,"transform","translate3d(0,0,0)"),"number"==typeof e.animated&&clearTimeout(e.animated),e.animated=setTimeout(function(){se(e,"transition",""),se(e,"transform",""),e.animated=!1,e.animatingX=!1,e.animatingY=!1},a)}}}}var xe=[],Ee={initializeByDefault:!0},Se={mount:function(e){for(var t in Ee)Ee.hasOwnProperty(t)&&!(t in e)&&(e[t]=Ee[t]);xe.forEach(function(t){if(t.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),xe.push(e)},pluginEvent:function(e,t,l){var a=this;this.eventCanceled=!1,l.cancel=function(){a.eventCanceled=!0};var n=e+"Global";xe.forEach(function(a){t[a.pluginName]&&(t[a.pluginName][n]&&t[a.pluginName][n](Y({sortable:t},l)),t.options[a.pluginName]&&t[a.pluginName][e]&&t[a.pluginName][e](Y({sortable:t},l)))})},initializePlugins:function(e,t,l,a){for(var n in xe.forEach(function(a){var n=a.pluginName;if(e.options[n]||a.initializeByDefault){var o=new a(e,t,e.options);o.sortable=e,o.options=e.options,e[n]=o,j(l,o.defaults)}}),e.options)if(e.options.hasOwnProperty(n)){var o=this.modifyOption(e,n,e.options[n]);void 0!==o&&(e.options[n]=o)}},getEventProperties:function(e,t){var l={};return xe.forEach(function(a){"function"==typeof a.eventProperties&&j(l,a.eventProperties.call(t[a.pluginName],e))}),l},modifyOption:function(e,t,l){var a;return xe.forEach(function(n){e[n.pluginName]&&n.optionListeners&&"function"==typeof n.optionListeners[t]&&(a=n.optionListeners[t].call(e[n.pluginName],l))}),a}};var De=["evt"],Te=function(e,t){var l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=l.evt,n=B(l,De);Se.pluginEvent.bind(wt)(e,t,Y({dragEl:Pe,parentEl:Oe,ghostEl:Ae,rootEl:ze,nextEl:Ne,lastDownEl:Ue,cloneEl:Me,cloneHidden:Re,dragStarted:Ke,putSortable:Be,activeSortable:wt.active,originalEvent:a,oldIndex:Xe,oldDraggableIndex:$e,newIndex:Ye,newDraggableIndex:Le,hideGhostForTarget:ht,unhideGhostForTarget:_t,cloneNowHidden:function(){Re=!0},cloneNowShown:function(){Re=!1},dispatchSortableEvent:function(e){Ie({sortable:t,name:e,originalEvent:a})}},n))};function Ie(e){!function(e){var t=e.sortable,l=e.rootEl,a=e.name,n=e.targetEl,o=e.cloneEl,i=e.toEl,s=e.fromEl,r=e.oldIndex,c=e.newIndex,d=e.oldDraggableIndex,u=e.newDraggableIndex,p=e.originalEvent,m=e.putSortable,v=e.extraEventProperties;if(t=t||l&&l[Ce]){var f,g=t.options,h="on"+a.charAt(0).toUpperCase()+a.substr(1);!window.CustomEvent||H||W?(f=document.createEvent("Event")).initEvent(a,!0,!0):f=new CustomEvent(a,{bubbles:!0,cancelable:!0}),f.to=i||l,f.from=s||l,f.item=n||l,f.clone=o,f.oldIndex=r,f.newIndex=c,f.oldDraggableIndex=d,f.newDraggableIndex=u,f.originalEvent=p,f.pullMode=m?m.lastPutMode:void 0;var _=Y(Y({},v),Se.getEventProperties(a,t));for(var b in _)f[b]=_[b];l&&l.dispatchEvent(f),g[h]&&g[h].call(t,f)}}(Y({putSortable:Be,cloneEl:Me,targetEl:Pe,rootEl:ze,oldIndex:Xe,oldDraggableIndex:$e,newIndex:Ye,newDraggableIndex:Le},e))}var Pe,Oe,Ae,ze,Ne,Ue,Me,Re,Xe,Ye,$e,Le,je,Be,Fe,He,We,qe,Ge,Je,Ke,Ze,Qe,et,tt,lt=!1,at=!1,nt=[],ot=!1,it=!1,st=[],rt=!1,ct=[],dt="undefined"!=typeof document,ut=J,pt=W||H?"cssFloat":"float",mt=dt&&!K&&!J&&"draggable"in document.createElement("div"),vt=function(){if(dt){if(H)return!1;var e=document.createElement("x");return e.style.cssText="pointer-events:auto","auto"===e.style.pointerEvents}}(),ft=function(e,t){var l=se(e),a=parseInt(l.width)-parseInt(l.paddingLeft)-parseInt(l.paddingRight)-parseInt(l.borderLeftWidth)-parseInt(l.borderRightWidth),n=me(e,0,t),o=me(e,1,t),i=n&&se(n),s=o&&se(o),r=i&&parseInt(i.marginLeft)+parseInt(i.marginRight)+ue(n).width,c=s&&parseInt(s.marginLeft)+parseInt(s.marginRight)+ue(o).width;if("flex"===l.display)return"column"===l.flexDirection||"column-reverse"===l.flexDirection?"vertical":"horizontal";if("grid"===l.display)return l.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(n&&i.float&&"none"!==i.float){var d="left"===i.float?"left":"right";return!o||"both"!==s.clear&&s.clear!==d?"horizontal":"vertical"}return n&&("block"===i.display||"flex"===i.display||"table"===i.display||"grid"===i.display||r>=a&&"none"===l[pt]||o&&"none"===l[pt]&&r+c>a)?"vertical":"horizontal"},gt=function(e){function t(e,l){return function(a,n,o,i){var s=a.options.group.name&&n.options.group.name&&a.options.group.name===n.options.group.name;if(null==e&&(l||s))return!0;if(null==e||!1===e)return!1;if(l&&"clone"===e)return e;if("function"==typeof e)return t(e(a,n,o,i),l)(a,n,o,i);var r=(l?a:n).options.group.name;return!0===e||"string"==typeof e&&e===r||e.join&&e.indexOf(r)>-1}}var l={},a=e.group;a&&"object"==$(a)||(a={name:a}),l.name=a.name,l.checkPull=t(a.pull,!0),l.checkPut=t(a.put),l.revertClone=a.revertClone,e.group=l},ht=function(){!vt&&Ae&&se(Ae,"display","none")},_t=function(){!vt&&Ae&&se(Ae,"display","")};dt&&!K&&document.addEventListener("click",function(e){if(at)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),at=!1,!1},!0);var bt=function(e){if(Pe){e=e.touches?e.touches[0]:e;var t=(n=e.clientX,o=e.clientY,nt.some(function(e){var t=e[Ce].options.emptyInsertThreshold;if(t&&!ve(e)){var l=ue(e),a=n>=l.left-t&&n<=l.right+t,s=o>=l.top-t&&o<=l.bottom+t;return a&&s?i=e:void 0}}),i);if(t){var l={};for(var a in e)e.hasOwnProperty(a)&&(l[a]=e[a]);l.target=l.rootEl=t,l.preventDefault=void 0,l.stopPropagation=void 0,t[Ce]._onDragOver(l)}}var n,o,i},yt=function(e){Pe&&Pe.parentNode[Ce]._isOutsideThisEl(e.target)};function wt(e,t){if(!e||!e.nodeType||1!==e.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(e));this.el=e,this.options=t=j({},t),e[Ce]=this;var l={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return ft(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==wt.supportPointer&&"PointerEvent"in window&&(!G||J),emptyInsertThreshold:5};for(var a in Se.initializePlugins(this,e,l),l)!(a in t)&&(t[a]=l[a]);for(var n in gt(t),this)"_"===n.charAt(0)&&"function"==typeof this[n]&&(this[n]=this[n].bind(this));this.nativeDraggable=!t.forceFallback&&mt,this.nativeDraggable&&(this.options.touchStartThreshold=1),t.supportPointer?Q(e,"pointerdown",this._onTapStart):(Q(e,"mousedown",this._onTapStart),Q(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(Q(e,"dragover",this),Q(e,"dragenter",this)),nt.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[]),j(this,Ve())}function kt(e,t,l,a,n,o,i,s){var r,c,d=e[Ce],u=d.options.onMove;return!window.CustomEvent||H||W?(r=document.createEvent("Event")).initEvent("move",!0,!0):r=new CustomEvent("move",{bubbles:!0,cancelable:!0}),r.to=t,r.from=e,r.dragged=l,r.draggedRect=a,r.related=n||t,r.relatedRect=o||ue(t),r.willInsertAfter=s,r.originalEvent=i,e.dispatchEvent(r),u&&(c=u.call(d,r,i)),c}function Ct(e){e.draggable=!1}function Vt(){rt=!1}function xt(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,l=t.length,a=0;l--;)a+=t.charCodeAt(l);return a.toString(36)}function Et(e){return setTimeout(e,0)}function St(e){return clearTimeout(e)}wt.prototype={constructor:wt,_isOutsideThisEl:function(e){this.el.contains(e)||e===this.el||(Ze=null)},_getDirection:function(e,t){return"function"==typeof this.options.direction?this.options.direction.call(this,e,t,Pe):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,l=this.el,a=this.options,n=a.preventOnFilter,o=e.type,i=e.touches&&e.touches[0]||e.pointerType&&"touch"===e.pointerType&&e,s=(i||e).target,r=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||s,c=a.filter;if(function(e){ct.length=0;var t=e.getElementsByTagName("input"),l=t.length;for(;l--;){var a=t[l];a.checked&&ct.push(a)}}(l),!Pe&&!(/mousedown|pointerdown/.test(o)&&0!==e.button||a.disabled)&&!r.isContentEditable&&(this.nativeDraggable||!G||!s||"SELECT"!==s.tagName.toUpperCase())&&!((s=ae(s,a.draggable,l,!1))&&s.animated||Ue===s)){if(Xe=fe(s),$e=fe(s,a.draggable),"function"==typeof c){if(c.call(this,e,s,this))return Ie({sortable:t,rootEl:r,name:"filter",targetEl:s,toEl:l,fromEl:l}),Te("filter",t,{evt:e}),void(n&&e.preventDefault())}else if(c&&(c=c.split(",").some(function(a){if(a=ae(r,a.trim(),l,!1))return Ie({sortable:t,rootEl:a,name:"filter",targetEl:s,fromEl:l,toEl:l}),Te("filter",t,{evt:e}),!0})))return void(n&&e.preventDefault());a.handle&&!ae(r,a.handle,l,!1)||this._prepareDragStart(e,i,s)}}},_prepareDragStart:function(e,t,l){var a,n=this,o=n.el,i=n.options,s=o.ownerDocument;if(l&&!Pe&&l.parentNode===o){var r=ue(l);if(ze=o,Oe=(Pe=l).parentNode,Ne=Pe.nextSibling,Ue=l,je=i.group,wt.dragged=Pe,Fe={target:Pe,clientX:(t||e).clientX,clientY:(t||e).clientY},Ge=Fe.clientX-r.left,Je=Fe.clientY-r.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,Pe.style["will-change"]="all",a=function(){Te("delayEnded",n,{evt:e}),wt.eventCanceled?n._onDrop():(n._disableDelayedDragEvents(),!q&&n.nativeDraggable&&(Pe.draggable=!0),n._triggerDragStart(e,t),Ie({sortable:n,name:"choose",originalEvent:e}),ie(Pe,i.chosenClass,!0))},i.ignore.split(",").forEach(function(e){ce(Pe,e.trim(),Ct)}),Q(s,"dragover",bt),Q(s,"mousemove",bt),Q(s,"touchmove",bt),i.supportPointer?(Q(s,"pointerup",n._onDrop),!this.nativeDraggable&&Q(s,"pointercancel",n._onDrop)):(Q(s,"mouseup",n._onDrop),Q(s,"touchend",n._onDrop),Q(s,"touchcancel",n._onDrop)),q&&this.nativeDraggable&&(this.options.touchStartThreshold=4,Pe.draggable=!0),Te("delayStart",this,{evt:e}),!i.delay||i.delayOnTouchOnly&&!t||this.nativeDraggable&&(W||H))a();else{if(wt.eventCanceled)return void this._onDrop();i.supportPointer?(Q(s,"pointerup",n._disableDelayedDrag),Q(s,"pointercancel",n._disableDelayedDrag)):(Q(s,"mouseup",n._disableDelayedDrag),Q(s,"touchend",n._disableDelayedDrag),Q(s,"touchcancel",n._disableDelayedDrag)),Q(s,"mousemove",n._delayedDragTouchMoveHandler),Q(s,"touchmove",n._delayedDragTouchMoveHandler),i.supportPointer&&Q(s,"pointermove",n._delayedDragTouchMoveHandler),n._dragStartTimer=setTimeout(a,i.delay)}}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){Pe&&Ct(Pe),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;ee(e,"mouseup",this._disableDelayedDrag),ee(e,"touchend",this._disableDelayedDrag),ee(e,"touchcancel",this._disableDelayedDrag),ee(e,"pointerup",this._disableDelayedDrag),ee(e,"pointercancel",this._disableDelayedDrag),ee(e,"mousemove",this._delayedDragTouchMoveHandler),ee(e,"touchmove",this._delayedDragTouchMoveHandler),ee(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||"touch"==e.pointerType&&e,!this.nativeDraggable||t?this.options.supportPointer?Q(document,"pointermove",this._onTouchMove):Q(document,t?"touchmove":"mousemove",this._onTouchMove):(Q(Pe,"dragend",this),Q(ze,"dragstart",this._onDragStart));try{document.selection?Et(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch(l){}},_dragStarted:function(e,t){if(lt=!1,ze&&Pe){Te("dragStarted",this,{evt:t}),this.nativeDraggable&&Q(document,"dragover",yt);var l=this.options;!e&&ie(Pe,l.dragClass,!1),ie(Pe,l.ghostClass,!0),wt.active=this,e&&this._appendGhost(),Ie({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(He){this._lastX=He.clientX,this._lastY=He.clientY,ht();for(var e=document.elementFromPoint(He.clientX,He.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(He.clientX,He.clientY))!==t;)t=e;if(Pe.parentNode[Ce]._isOutsideThisEl(e),t)do{if(t[Ce]){if(t[Ce]._onDragOver({clientX:He.clientX,clientY:He.clientY,target:e,rootEl:t})&&!this.options.dragoverBubble)break}e=t}while(t=le(t));_t()}},_onTouchMove:function(e){if(Fe){var t=this.options,l=t.fallbackTolerance,a=t.fallbackOffset,n=e.touches?e.touches[0]:e,o=Ae&&re(Ae,!0),i=Ae&&o&&o.a,s=Ae&&o&&o.d,r=ut&&tt&&ge(tt),c=(n.clientX-Fe.clientX+a.x)/(i||1)+(r?r[0]-st[0]:0)/(i||1),d=(n.clientY-Fe.clientY+a.y)/(s||1)+(r?r[1]-st[1]:0)/(s||1);if(!wt.active&&!lt){if(l&&Math.max(Math.abs(n.clientX-this._lastX),Math.abs(n.clientY-this._lastY))<l)return;this._onDragStart(e,!0)}if(Ae){o?(o.e+=c-(We||0),o.f+=d-(qe||0)):o={a:1,b:0,c:0,d:1,e:c,f:d};var u="matrix(".concat(o.a,",").concat(o.b,",").concat(o.c,",").concat(o.d,",").concat(o.e,",").concat(o.f,")");se(Ae,"webkitTransform",u),se(Ae,"mozTransform",u),se(Ae,"msTransform",u),se(Ae,"transform",u),We=c,qe=d,He=n}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!Ae){var e=this.options.fallbackOnBody?document.body:ze,t=ue(Pe,!0,ut,!0,e),l=this.options;if(ut){for(tt=e;"static"===se(tt,"position")&&"none"===se(tt,"transform")&&tt!==document;)tt=tt.parentNode;tt!==document.body&&tt!==document.documentElement?(tt===document&&(tt=de()),t.top+=tt.scrollTop,t.left+=tt.scrollLeft):tt=de(),st=ge(tt)}ie(Ae=Pe.cloneNode(!0),l.ghostClass,!1),ie(Ae,l.fallbackClass,!0),ie(Ae,l.dragClass,!0),se(Ae,"transition",""),se(Ae,"transform",""),se(Ae,"box-sizing","border-box"),se(Ae,"margin",0),se(Ae,"top",t.top),se(Ae,"left",t.left),se(Ae,"width",t.width),se(Ae,"height",t.height),se(Ae,"opacity","0.8"),se(Ae,"position",ut?"absolute":"fixed"),se(Ae,"zIndex","100000"),se(Ae,"pointerEvents","none"),wt.ghost=Ae,e.appendChild(Ae),se(Ae,"transform-origin",Ge/parseInt(Ae.style.width)*100+"% "+Je/parseInt(Ae.style.height)*100+"%")}},_onDragStart:function(e,t){var l=this,a=e.dataTransfer,n=l.options;Te("dragStart",this,{evt:e}),wt.eventCanceled?this._onDrop():(Te("setupClone",this),wt.eventCanceled||((Me=we(Pe)).removeAttribute("id"),Me.draggable=!1,Me.style["will-change"]="",this._hideClone(),ie(Me,this.options.chosenClass,!1),wt.clone=Me),l.cloneId=Et(function(){Te("clone",l),wt.eventCanceled||(l.options.removeCloneOnHide||ze.insertBefore(Me,Pe),l._hideClone(),Ie({sortable:l,name:"clone"}))}),!t&&ie(Pe,n.dragClass,!0),t?(at=!0,l._loopId=setInterval(l._emulateDragOver,50)):(ee(document,"mouseup",l._onDrop),ee(document,"touchend",l._onDrop),ee(document,"touchcancel",l._onDrop),a&&(a.effectAllowed="move",n.setData&&n.setData.call(l,a,Pe)),Q(document,"drop",l),se(Pe,"transform","translateZ(0)")),lt=!0,l._dragStartId=Et(l._dragStarted.bind(l,t,e)),Q(document,"selectstart",l),Ke=!0,window.getSelection().removeAllRanges(),G&&se(document.body,"user-select","none"))},_onDragOver:function(e){var t,l,a,n,o=this.el,i=e.target,s=this.options,r=s.group,c=wt.active,d=je===r,u=s.sort,p=Be||c,m=this,v=!1;if(!rt){if(void 0!==e.preventDefault&&e.cancelable&&e.preventDefault(),i=ae(i,s.draggable,o,!0),T("dragOver"),wt.eventCanceled)return v;if(Pe.contains(e.target)||i.animated&&i.animatingX&&i.animatingY||m._ignoreWhileAnimating===i)return P(!1);if(at=!1,c&&!s.disabled&&(d?u||(a=Oe!==ze):Be===this||(this.lastPutMode=je.checkPull(this,c,Pe,e))&&r.checkPut(this,c,Pe,e))){if(n="vertical"===this._getDirection(e,i),t=ue(Pe),T("dragOverValid"),wt.eventCanceled)return v;if(a)return Oe=ze,I(),this._hideClone(),T("revert"),wt.eventCanceled||(Ne?ze.insertBefore(Pe,Ne):ze.appendChild(Pe)),P(!0);var f=ve(o,s.draggable);if(!f||function(e,t,l){var a=ue(ve(l.el,l.options.draggable)),n=ke(l.el,l.options,Ae),o=10;return t?e.clientX>n.right+o||e.clientY>a.bottom&&e.clientX>a.left:e.clientY>n.bottom+o||e.clientX>a.right&&e.clientY>a.top}(e,n,this)&&!f.animated){if(f===Pe)return P(!1);if(f&&o===e.target&&(i=f),i&&(l=ue(i)),!1!==kt(ze,o,Pe,t,i,l,e,!!i))return I(),f&&f.nextSibling?o.insertBefore(Pe,f.nextSibling):o.appendChild(Pe),Oe=o,O(),P(!0)}else if(f&&function(e,t,l){var a=ue(me(l.el,0,l.options,!0)),n=ke(l.el,l.options,Ae),o=10;return t?e.clientX<n.left-o||e.clientY<a.top&&e.clientX<a.right:e.clientY<n.top-o||e.clientY<a.bottom&&e.clientX<a.left}(e,n,this)){var g=me(o,0,s,!0);if(g===Pe)return P(!1);if(l=ue(i=g),!1!==kt(ze,o,Pe,t,i,l,e,!1))return I(),o.insertBefore(Pe,g),Oe=o,O(),P(!0)}else if(i.parentNode===o){l=ue(i);var h,_,b,y=Pe.parentNode!==o,w=!function(e,t,l){var a=l?e.left:e.top,n=l?e.right:e.bottom,o=l?e.width:e.height,i=l?t.left:t.top,s=l?t.right:t.bottom,r=l?t.width:t.height;return a===i||n===s||a+o/2===i+r/2}(Pe.animated&&Pe.toRect||t,i.animated&&i.toRect||l,n),k=n?"top":"left",C=pe(i,"top","top")||pe(Pe,"top","top"),V=C?C.scrollTop:void 0;if(Ze!==i&&(_=l[k],ot=!1,it=!w&&s.invertSwap||y),h=function(e,t,l,a,n,o,i,s){var r=a?e.clientY:e.clientX,c=a?l.height:l.width,d=a?l.top:l.left,u=a?l.bottom:l.right,p=!1;if(!i)if(s&&et<c*n){if(!ot&&(1===Qe?r>d+c*o/2:r<u-c*o/2)&&(ot=!0),ot)p=!0;else if(1===Qe?r<d+et:r>u-et)return-Qe}else if(r>d+c*(1-n)/2&&r<u-c*(1-n)/2)return function(e){return fe(Pe)<fe(e)?1:-1}(t);if((p=p||i)&&(r<d+c*o/2||r>u-c*o/2))return r>d+c/2?1:-1;return 0}(e,i,l,n,w?1:s.swapThreshold,null==s.invertedSwapThreshold?s.swapThreshold:s.invertedSwapThreshold,it,Ze===i),0!==h){var x=fe(Pe);do{x-=h,b=Oe.children[x]}while(b&&("none"===se(b,"display")||b===Ae))}if(0===h||b===i)return P(!1);Ze=i,Qe=h;var E=i.nextElementSibling,S=!1,D=kt(ze,o,Pe,t,i,l,e,S=1===h);if(!1!==D)return 1!==D&&-1!==D||(S=1===D),rt=!0,setTimeout(Vt,30),I(),S&&!E?o.appendChild(Pe):i.parentNode.insertBefore(Pe,S?E:i),C&&ye(C,0,V-C.scrollTop),Oe=Pe.parentNode,void 0===_||it||(et=Math.abs(_-ue(i)[k])),O(),P(!0)}if(o.contains(Pe))return P(!1)}return!1}function T(s,r){Te(s,m,Y({evt:e,isOwner:d,axis:n?"vertical":"horizontal",revert:a,dragRect:t,targetRect:l,canSort:u,fromSortable:p,target:i,completed:P,onMove:function(l,a){return kt(ze,o,Pe,t,l,ue(l),e,a)},changed:O},r))}function I(){T("dragOverAnimationCapture"),m.captureAnimationState(),m!==p&&p.captureAnimationState()}function P(t){return T("dragOverCompleted",{insertion:t}),t&&(d?c._hideClone():c._showClone(m),m!==p&&(ie(Pe,Be?Be.options.ghostClass:c.options.ghostClass,!1),ie(Pe,s.ghostClass,!0)),Be!==m&&m!==wt.active?Be=m:m===wt.active&&Be&&(Be=null),p===m&&(m._ignoreWhileAnimating=i),m.animateAll(function(){T("dragOverAnimationComplete"),m._ignoreWhileAnimating=null}),m!==p&&(p.animateAll(),p._ignoreWhileAnimating=null)),(i===Pe&&!Pe.animated||i===o&&!i.animated)&&(Ze=null),s.dragoverBubble||e.rootEl||i===document||(Pe.parentNode[Ce]._isOutsideThisEl(e.target),!t&&bt(e)),!s.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),v=!0}function O(){Ye=fe(Pe),Le=fe(Pe,s.draggable),Ie({sortable:m,name:"change",toEl:o,newIndex:Ye,newDraggableIndex:Le,originalEvent:e})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){ee(document,"mousemove",this._onTouchMove),ee(document,"touchmove",this._onTouchMove),ee(document,"pointermove",this._onTouchMove),ee(document,"dragover",bt),ee(document,"mousemove",bt),ee(document,"touchmove",bt)},_offUpEvents:function(){var e=this.el.ownerDocument;ee(e,"mouseup",this._onDrop),ee(e,"touchend",this._onDrop),ee(e,"pointerup",this._onDrop),ee(e,"pointercancel",this._onDrop),ee(e,"touchcancel",this._onDrop),ee(document,"selectstart",this)},_onDrop:function(e){var t=this.el,l=this.options;Ye=fe(Pe),Le=fe(Pe,l.draggable),Te("drop",this,{evt:e}),Oe=Pe&&Pe.parentNode,Ye=fe(Pe),Le=fe(Pe,l.draggable),wt.eventCanceled||(lt=!1,it=!1,ot=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),St(this.cloneId),St(this._dragStartId),this.nativeDraggable&&(ee(document,"drop",this),ee(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),G&&se(document.body,"user-select",""),se(Pe,"transform",""),e&&(Ke&&(e.cancelable&&e.preventDefault(),!l.dropBubble&&e.stopPropagation()),Ae&&Ae.parentNode&&Ae.parentNode.removeChild(Ae),(ze===Oe||Be&&"clone"!==Be.lastPutMode)&&Me&&Me.parentNode&&Me.parentNode.removeChild(Me),Pe&&(this.nativeDraggable&&ee(Pe,"dragend",this),Ct(Pe),Pe.style["will-change"]="",Ke&&!lt&&ie(Pe,Be?Be.options.ghostClass:this.options.ghostClass,!1),ie(Pe,this.options.chosenClass,!1),Ie({sortable:this,name:"unchoose",toEl:Oe,newIndex:null,newDraggableIndex:null,originalEvent:e}),ze!==Oe?(Ye>=0&&(Ie({rootEl:Oe,name:"add",toEl:Oe,fromEl:ze,originalEvent:e}),Ie({sortable:this,name:"remove",toEl:Oe,originalEvent:e}),Ie({rootEl:Oe,name:"sort",toEl:Oe,fromEl:ze,originalEvent:e}),Ie({sortable:this,name:"sort",toEl:Oe,originalEvent:e})),Be&&Be.save()):Ye!==Xe&&Ye>=0&&(Ie({sortable:this,name:"update",toEl:Oe,originalEvent:e}),Ie({sortable:this,name:"sort",toEl:Oe,originalEvent:e})),wt.active&&(null!=Ye&&-1!==Ye||(Ye=Xe,Le=$e),Ie({sortable:this,name:"end",toEl:Oe,originalEvent:e}),this.save())))),this._nulling()},_nulling:function(){Te("nulling",this),ze=Pe=Oe=Ae=Ne=Me=Ue=Re=Fe=He=Ke=Ye=Le=Xe=$e=Ze=Qe=Be=je=wt.dragged=wt.ghost=wt.clone=wt.active=null,ct.forEach(function(e){e.checked=!0}),ct.length=We=qe=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":Pe&&(this._onDragOver(e),function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move");e.cancelable&&e.preventDefault()}(e));break;case"selectstart":e.preventDefault()}},toArray:function(){for(var e,t=[],l=this.el.children,a=0,n=l.length,o=this.options;a<n;a++)ae(e=l[a],o.draggable,this.el,!1)&&t.push(e.getAttribute(o.dataIdAttr)||xt(e));return t},sort:function(e,t){var l={},a=this.el;this.toArray().forEach(function(e,t){var n=a.children[t];ae(n,this.options.draggable,a,!1)&&(l[e]=n)},this),t&&this.captureAnimationState(),e.forEach(function(e){l[e]&&(a.removeChild(l[e]),a.appendChild(l[e]))}),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return ae(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var l=this.options;if(void 0===t)return l[e];var a=Se.modifyOption(this,e,t);l[e]=void 0!==a?a:t,"group"===e&&gt(l)},destroy:function(){Te("destroy",this);var e=this.el;e[Ce]=null,ee(e,"mousedown",this._onTapStart),ee(e,"touchstart",this._onTapStart),ee(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(ee(e,"dragover",this),ee(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(e){e.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),nt.splice(nt.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!Re){if(Te("hideClone",this),wt.eventCanceled)return;se(Me,"display","none"),this.options.removeCloneOnHide&&Me.parentNode&&Me.parentNode.removeChild(Me),Re=!0}},_showClone:function(e){if("clone"===e.lastPutMode){if(Re){if(Te("showClone",this),wt.eventCanceled)return;Pe.parentNode!=ze||this.options.group.revertClone?Ne?ze.insertBefore(Me,Ne):ze.appendChild(Me):ze.insertBefore(Me,Pe),this.options.group.revertClone&&this.animate(Pe,Me),se(Me,"display",""),Re=!1}}else this._hideClone()}},dt&&Q(document,"touchmove",function(e){(wt.active||lt)&&e.cancelable&&e.preventDefault()}),wt.utils={on:Q,off:ee,css:se,find:ce,is:function(e,t){return!!ae(e,t,e,!1)},extend:function(e,t){if(e&&t)for(var l in t)t.hasOwnProperty(l)&&(e[l]=t[l]);return e},throttle:be,closest:ae,toggleClass:ie,clone:we,index:fe,nextTick:Et,cancelNextTick:St,detectDirection:ft,getChild:me,expando:Ce},wt.get=function(e){return e[Ce]},wt.mount=function(){for(var e=arguments.length,t=new Array(e),l=0;l<e;l++)t[l]=arguments[l];t[0].constructor===Array&&(t=t[0]),t.forEach(function(e){if(!e.prototype||!e.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(e));e.utils&&(wt.utils=Y(Y({},wt.utils),e.utils)),Se.mount(e)})},wt.create=function(e,t){return new wt(e,t)},wt.version="1.15.6";var Dt,Tt,It,Pt,Ot,At,zt=[],Nt=!1;function Ut(){zt.forEach(function(e){clearInterval(e.pid)}),zt=[]}function Mt(){clearInterval(At)}var Rt=be(function(e,t,l,a){if(t.scroll){var n,o=(e.touches?e.touches[0]:e).clientX,i=(e.touches?e.touches[0]:e).clientY,s=t.scrollSensitivity,r=t.scrollSpeed,c=de(),d=!1;Tt!==l&&(Tt=l,Ut(),Dt=t.scroll,n=t.scrollFn,!0===Dt&&(Dt=he(l,!0)));var u=0,p=Dt;do{var m=p,v=ue(m),f=v.top,g=v.bottom,h=v.left,_=v.right,b=v.width,y=v.height,w=void 0,k=void 0,C=m.scrollWidth,V=m.scrollHeight,x=se(m),E=m.scrollLeft,S=m.scrollTop;m===c?(w=b<C&&("auto"===x.overflowX||"scroll"===x.overflowX||"visible"===x.overflowX),k=y<V&&("auto"===x.overflowY||"scroll"===x.overflowY||"visible"===x.overflowY)):(w=b<C&&("auto"===x.overflowX||"scroll"===x.overflowX),k=y<V&&("auto"===x.overflowY||"scroll"===x.overflowY));var D=w&&(Math.abs(_-o)<=s&&E+b<C)-(Math.abs(h-o)<=s&&!!E),T=k&&(Math.abs(g-i)<=s&&S+y<V)-(Math.abs(f-i)<=s&&!!S);if(!zt[u])for(var I=0;I<=u;I++)zt[I]||(zt[I]={});zt[u].vx==D&&zt[u].vy==T&&zt[u].el===m||(zt[u].el=m,zt[u].vx=D,zt[u].vy=T,clearInterval(zt[u].pid),0==D&&0==T||(d=!0,zt[u].pid=setInterval(function(){a&&0===this.layer&&wt.active._onTouchMove(Ot);var t=zt[this.layer].vy?zt[this.layer].vy*r:0,l=zt[this.layer].vx?zt[this.layer].vx*r:0;"function"==typeof n&&"continue"!==n.call(wt.dragged.parentNode[Ce],l,t,e,Ot,zt[this.layer].el)||ye(zt[this.layer].el,l,t)}.bind({layer:u}),24))),u++}while(t.bubbleScroll&&p!==c&&(p=he(p,!1)));Nt=d}},30),Xt=function(e){var t=e.originalEvent,l=e.putSortable,a=e.dragEl,n=e.activeSortable,o=e.dispatchSortableEvent,i=e.hideGhostForTarget,s=e.unhideGhostForTarget;if(t){var r=l||n;i();var c=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,d=document.elementFromPoint(c.clientX,c.clientY);s(),r&&!r.el.contains(d)&&(o("spill"),this.onSpill({dragEl:a,putSortable:l}))}};function Yt(){}function $t(){}async function Lt(e){if(!e)return"";try{const t=await M.post("/translate/to-english",{text:e});return 200===t.code&&t.data?t.data.translated:(console.warn("翻译失败:",t.message),e)}catch(t){return console.error("翻译API调用失败:",t),e}}Yt.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,l=e.putSortable;this.sortable.captureAnimationState(),l&&l.captureAnimationState();var a=me(this.sortable.el,this.startIndex,this.options);a?this.sortable.el.insertBefore(t,a):this.sortable.el.appendChild(t),this.sortable.animateAll(),l&&l.animateAll()},drop:Xt},j(Yt,{pluginName:"revertOnSpill"}),$t.prototype={onSpill:function(e){var t=e.dragEl,l=e.putSortable||this.sortable;l.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),l.animateAll()},drop:Xt},j($t,{pluginName:"removeOnSpill"}),wt.mount(new function(){function e(){for(var e in this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===e.charAt(0)&&"function"==typeof this[e]&&(this[e]=this[e].bind(this))}return e.prototype={dragStarted:function(e){var t=e.originalEvent;this.sortable.nativeDraggable?Q(document,"dragover",this._handleAutoScroll):this.options.supportPointer?Q(document,"pointermove",this._handleFallbackAutoScroll):t.touches?Q(document,"touchmove",this._handleFallbackAutoScroll):Q(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(e){var t=e.originalEvent;this.options.dragOverBubble||t.rootEl||this._handleAutoScroll(t)},drop:function(){this.sortable.nativeDraggable?ee(document,"dragover",this._handleAutoScroll):(ee(document,"pointermove",this._handleFallbackAutoScroll),ee(document,"touchmove",this._handleFallbackAutoScroll),ee(document,"mousemove",this._handleFallbackAutoScroll)),Mt(),Ut(),clearTimeout(ne),ne=void 0},nulling:function(){Ot=Tt=Dt=Nt=At=It=Pt=null,zt.length=0},_handleFallbackAutoScroll:function(e){this._handleAutoScroll(e,!0)},_handleAutoScroll:function(e,t){var l=this,a=(e.touches?e.touches[0]:e).clientX,n=(e.touches?e.touches[0]:e).clientY,o=document.elementFromPoint(a,n);if(Ot=e,t||this.options.forceAutoScrollFallback||W||H||G){Rt(e,this.options,o,t);var i=he(o,!0);!Nt||At&&a===It&&n===Pt||(At&&Mt(),At=setInterval(function(){var o=he(document.elementFromPoint(a,n),!0);o!==i&&(i=o,Ut()),Rt(e,l.options,o,t)},10),It=a,Pt=n)}else{if(!this.options.bubbleScroll||he(o,!0)===de())return void Ut();Rt(e,this.options,he(o,!1),!1)}}},j(e,{pluginName:"scroll",initializeByDefault:!0})}),wt.mount($t,Yt);const jt={class:"scene-management"},Bt={class:"page-header"},Ft={class:"header-right"},Ht={class:"status-tabs"},Wt={class:"scene-count"},qt={class:"scene-list"},Gt={class:"scene-info"},Jt={class:"image-placeholder"},Kt={class:"scene-detail"},Zt={class:"scene-name"},Qt={class:"scene-desc"},el={class:"scene-key"},tl={class:"status-switch"},ll=["onClick"],al=["onClick"],nl=["onClick"],ol={class:"points-value"},il={class:"action-btns-row"},sl={class:"input-with-translate"},rl={class:"input-with-translate"},cl={class:"icon-upload-inline"},dl={key:1,class:"icon-placeholder-inline"},ul={class:"icon-upload-actions"},pl={class:"steps-config-3col"},ml={class:"steps-sidebar"},vl=["onClick"],fl={class:"step-order"},gl={class:"step-info-compact"},hl={class:"step-title-compact"},_l={key:0,class:"step-basic-config"},bl={class:"step-icon-selector"},yl=["src"],wl={key:1,class:"step-icon-empty"},kl={class:"input-with-translate-compact"},Cl={class:"switch-row"},Vl={key:1,class:"step-basic-empty"},xl={key:2,class:"step-options-config"},El={class:"config-section-title"},Sl={class:"config-title-actions"},Dl={key:0,class:"options-filter-compact"},Tl={class:"options-count"},Il={key:1,class:"spec-tip-compact"},Pl={class:"options-scroll-area"},Ol={class:"image-tag-left"},Al=["onClick"],zl={key:1,class:"option-thumb-empty"},Nl={class:"image-tag-right"},Ul={class:"image-tag-row1"},Ml={class:"image-tag-field"},Rl={class:"image-tag-field"},Xl={class:"field-with-btn"},Yl={key:0,class:"image-tag-field"},$l={class:"image-tag-field"},Ll={class:"image-tag-field"},jl={class:"image-tag-row2"},Bl={class:"tags-col tags-col-label-main"},Fl={class:"tags-col tags-col-label"},Hl={class:"field-with-btn-inline"},Wl={class:"tags-col tags-col-prompt"},ql={class:"tags-col tags-col-default"},Gl={class:"tags-col tags-col-action"},Jl={class:"spec-col spec-col-label-main"},Kl={class:"spec-col spec-col-label"},Zl={class:"field-with-btn-inline"},Ql={class:"spec-col spec-col-size"},ea={class:"spec-col spec-col-size"},ta={class:"spec-col spec-col-default"},la={class:"spec-col spec-col-action"},aa={class:"common-table-header"},na={key:0,class:"common-col common-col-extra"},oa={key:1,class:"common-col common-col-extra"},ia={class:"common-col common-col-label-main"},sa={class:"common-col common-col-label"},ra={class:"field-with-btn-inline"},ca={class:"common-col common-col-extra"},da={class:"common-col common-col-prompt"},ua={class:"common-col common-col-default"},pa={class:"common-col common-col-action"},ma={key:3,class:"step-options-empty"},va={class:"template-vars"},fa={class:"cos-picker"},ga={class:"cos-picker-header"},ha={key:0,class:"cos-filter-tags"},_a={class:"filter-result"},ba={class:"cos-image-grid"},ya=["onClick"],wa={class:"cos-image-info"},ka={class:"cos-image-name"},Ca={class:"cos-image-tags"},Va={class:"step-icon-picker"},xa={class:"step-icon-grid"},Ea=["onClick"],Sa=["src","alt"],Da={class:"step-icon-name"},Ta={class:"scene-icon-picker"},Ia={class:"scene-icon-picker-header"},Pa={key:0,class:"scene-icon-count"},Oa={class:"scene-icon-grid"},Aa=["onClick"],za={class:"scene-icon-info"},Na={class:"scene-icon-name"},Ua={class:"scene-icon-tags"},Ma={class:"ai-sidebar-content"},Ra={class:"ai-mode-switch"},Xa={key:0,class:"ai-current-scene"},Ya={key:1,class:"ai-image-generator"},$a={class:"image-gen-disabled-notice"},La={class:"quick-actions",style:{"margin-top":"16px"}},ja={key:0,class:"current-scene-info",style:{"margin-top":"16px"}},Ba={key:0,class:"ai-welcome"},Fa={key:0},Ha={key:1},Wa={class:"ai-suggestions"},qa={class:"message-avatar"},Ga={key:0},Ja={key:1},Ka={class:"message-content"},Za=["innerHTML"],Qa={key:0,class:"ai-config-preview"},en={class:"config-preview-header"},tn={class:"config-preview-info"},ln={key:0,class:"preview-icon"},an=["src"],nn={key:1,class:"image-tasks-pending"},on={class:"tasks-header"},sn={class:"tasks-list"},rn={class:"tasks-confirm"},cn={key:2,class:"generating-images-progress"},dn={class:"progress-header"},un={class:"progress-tasks"},pn={class:"config-preview-actions"},mn={key:1,class:"ai-message assistant"},vn={class:"ai-input-area"},fn={class:"ai-input-actions"},gn={key:0,class:"ai-config-detail"},hn=["src"],_n={key:1,class:"no-icon-hint"},bn={class:"preview-step-header"},yn={class:"step-num"},wn={class:"step-name"},kn={key:0,class:"preview-step-options"},Cn={class:"option-grid"},Vn=["src","alt"],xn={key:1,class:"option-no-image"},En={class:"option-label"},Sn={class:"preview-prompt"},Dn={key:0,class:"prompt-label"},Tn={key:1},In=R({__name:"Scenes",setup(R){const X=e(!1),Y=e(!1);e(!1),e(!1);const $=e([]),L=e(!1),j=e(!1),B=e(null),F=e(null),H=e([]),W=e(-1),q=e("all"),G=e("basic"),J=e(!1),K=e(!1),Z=e([]),Q=e([]),ee=e([]),te=e(""),le=e(""),ae=e(""),ne=e(""),oe=e(-1),ie=e(!1),se=e(!1),re=e([]),ce=e(""),de=e(""),ue=e(!1),pe=e(!1),me=e([]),ve=e([]),fe=e(""),ge=e(""),he=e(""),_e=e([]),be=t(()=>{if(!ce.value)return re.value;const e=ce.value.toLowerCase();return re.value.filter(t=>t.fileName.toLowerCase().includes(e))});function ye(){let e=me.value;if(ge.value&&(e=e.filter(e=>e.folderPath===ge.value)),fe.value){const t=fe.value.toLowerCase();e=e.filter(e=>{var l,a,n;return(null==(l=e.fileName)?void 0:l.toLowerCase().includes(t))||(null==(a=e.key)?void 0:a.toLowerCase().includes(t))||(null==(n=e.folderPath)?void 0:n.toLowerCase().includes(t))})}_e.value=e}const we=t(()=>({Authorization:`Bearer ${localStorage.getItem("admin_token")}`})),ke=l({id:null,name:"",template:"",negative_prompt:"",is_active:!0}),Ce=l({id:"",name:"",name_en:"",description:"",description_en:"",icon:"",status:"active",is_review_safe:!0,points_cost:50,sort_order:0}),Ve={id:[{required:!0,message:"请输入场景ID",trigger:"blur"}],name:[{required:!0,message:"请输入场景名称",trigger:"blur"}]},xe=t(()=>"all"===q.value?$.value:$.value.filter(e=>e.status===q.value)),Ee=t(()=>W.value>=0?H.value[W.value]:null),Se=e(""),De=t(()=>Ee.value&&Ee.value.options?Se.value?Ee.value.options.filter(e=>e.gender===Se.value):Ee.value.options:[]),Te=t(()=>H.value.map(e=>e.step_key).filter(e=>e&&"upload"!==e));function Ie(e){return"{{"+e+"}}"}function Pe(){}async function Oe(){X.value=!0;try{const e=await M.get("/config/admin/scenes");$.value=(e.data||[]).map(e=>({...e,points_cost:e.price||50})),setTimeout(()=>{const e=document.querySelector(".scene-list .el-table__body-wrapper tbody");e&&new wt(e,{handle:".drag-handle",animation:150,onEnd:async e=>{const{oldIndex:t,newIndex:l}=e;if(t!==l){const e=$.value.splice(t,1)[0];$.value.splice(l,0,e),await async function(){const e=$.value.map((e,t)=>({id:e.id,sort_order:t}));try{await M.post("/config/admin/scenes/sort",{scenes:e}),f.success("排序已更新")}catch{f.error("排序更新失败")}}()}}})},100)}catch(e){console.error("加载场景失败:",e),f.error("加载场景列表失败")}finally{X.value=!1}}function Ae(){j.value=!1,Object.assign(Ce,{id:"",name:"",name_en:"",description:"",description_en:"",icon:"",status:"active",is_review_safe:!0,points_cost:50,sort_order:$.value.length}),L.value=!0}function ze(e){var t;200===e.code&&(null==(t=e.data)?void 0:t.url)?(Ce.icon=e.data.url,f.success("图标上传成功")):f.error(e.message||"上传失败")}function Ne(){f.error("图标上传失败")}function Ue(e){const t=e.type.startsWith("image/"),l=e.size/1024<500;return t?!!l||(f.error("图片大小不能超过 500KB!"),!1):(f.error("只能上传图片文件!"),!1)}async function Me(){try{await B.value.validate()}catch{return}Y.value=!0;try{const e={...Ce,scene_key:Ce.id,price:Ce.points_cost,is_review_safe:Ce.is_review_safe?1:0,use_dynamic_render:1};if(j.value&&(e.id=Ce.id),await M.post("/config/admin/scene",e),j.value&&(H.value.length>0||ke.template)){const e=H.value.map(e=>({...e,icon:e.icon||"",gender_based:e.gender_based||!1,config:e.config||{}})),t={steps:e,prompt:ke.template?{...ke,scene_id:Ce.id}:null},l=JSON.stringify(t);console.log("[保存调试] 总体积:",(l.length/1024).toFixed(2),"KB"),console.log("[保存调试] 步骤数:",e.length),e.forEach((e,t)=>{console.log(`[保存调试] 步骤${t+1} "${e.title}": icon="${e.icon}", gender_based=${e.gender_based}`)}),await M.post(`/config/admin/scene/${Ce.id}/batch-save`,t)}f.success("保存成功"),L.value=!1,Oe()}catch(e){f.error("保存失败: "+(e.message||"未知错误"))}finally{Y.value=!1}}async function Re(e,t){if(e.status===t)return;const l=e.status;e.status=t;try{const a=await M.post("/config/admin/scene/status",{id:e.id,status:t});200===a.code||0===a.code?f.success("状态更新成功"):(e.status=l,f.error(a.message||"状态更新失败"))}catch(a){e.status=l,f.error(a.message||"状态更新失败")}}function Xe(){const e={id:null,step_order:H.value.length+1,step_key:"",title:"新步骤",title_en:"",icon:"",component_type:"radio",is_required:!1,is_visible:!0,gender_based:!1,config:{},options:[]};H.value.push(e),W.value=H.value.length-1}function Ye(){if(!Ee.value)return;const e={option_key:`opt_${Date.now().toString(36)}_${Math.random().toString(36).substr(2,4)}`,label:"",label_en:"",color:"",image:"",prompt_text:"",is_default:0===Ee.value.options.length?1:0};"spec_select"===Ee.value.component_type&&(e.width=25,e.height=35),Ee.value.options.push(e)}function $e(e){const t=Ee.value.options,l=1===t[e].is_default;t.splice(e,1),l&&t.length>0&&!t.some(e=>1===e.is_default)&&(t[0].is_default=1)}function Le(e){Ee.value&&(Ee.value.options.forEach(e=>{e.is_default=0}),e.is_default=1)}function je(){H.value.forEach((e,t)=>{e.step_order=t+1})}const Be=e(null);async function Fe(){K.value=!0;try{const e=await M.get("/photos/cos-images");200===e.code||0===e.code?(Z.value=e.data||[],ee.value=e.folders||[],He()):(console.warn("photos/cos-images返回非200:",e),f.warning("素材加载失败，请检查COS配置"))}catch(e){console.error("加载COS图片失败:",e),f.error("加载图片列表失败: "+(e.message||"网络错误"))}finally{K.value=!1}}function He(){var e;let t=Z.value;if(ae.value&&(null==(e=Ee.value)?void 0:e.gender_based)&&(t=t.filter(e=>{const t=(e.folderPath||"").toLowerCase(),l=(e.category||"").toLowerCase();return t.includes(ae.value)||l===ae.value})),le.value&&(t=t.filter(e=>e.folderPath===le.value)),te.value){const e=te.value.toLowerCase();t=t.filter(t=>{var l,a;return(null==(l=t.fileName)?void 0:l.toLowerCase().includes(e))||(null==(a=t.key)?void 0:a.toLowerCase().includes(e))})}Q.value=t}function We(){ne.value&&(Be.value?(Be.value.image=ne.value,f.success("图片已选择")):oe.value>=0&&(Ee.value.options[oe.value].image=ne.value,f.success("图片已选择"))),J.value=!1,Be.value=null}async function qe(){var e;de.value=(null==(e=Ee.value)?void 0:e.icon)||"",ie.value=!0,0===re.value.length&&await async function(){var e;se.value=!0;try{const t=await M.get("/assets/list");200!==t.code&&0!==t.code||(re.value=(null==(e=t.data)?void 0:e.uiIcons)||[])}catch(t){console.error("加载图标失败:",t),f.error("加载图标列表失败")}finally{se.value=!1}}()}function Ge(){de.value&&Ee.value&&(Ee.value.icon=de.value,f.success("图标已选择")),ie.value=!1}async function Je(){he.value=Ce.icon||"",ge.value="",fe.value="",ue.value=!0,0===me.value.length?await Ke():ye()}async function Ke(){pe.value=!0;try{const e=await M.get("/photos/cos-images");200!==e.code&&0!==e.code||(me.value=e.data||[],ve.value=e.folders||[],ye())}catch(e){console.error("加载场景图标失败:",e),f.error("加载图标列表失败")}finally{pe.value=!1}}function Ze(){he.value&&(Ce.icon=he.value,f.success("图标已选择")),ue.value=!1}const Qe=l({name:!1,desc:!1,step:!1,options:!1});async function et(){if(Ce.name){Qe.name=!0;try{Ce.name_en=await Lt(Ce.name),f.success("翻译成功")}catch(e){f.error("翻译失败")}finally{Qe.name=!1}}else f.warning("请先输入中文名称")}async function tt(){if(Ce.description){Qe.desc=!0;try{Ce.description_en=await Lt(Ce.description),f.success("翻译成功")}catch(e){f.error("翻译失败")}finally{Qe.desc=!1}}else f.warning("请先输入中文描述")}async function lt(){if(Ee.value)if(Ee.value.title){Qe.step=!0;try{Ee.value.title_en=await Lt(Ee.value.title),f.success("翻译成功")}catch(e){f.error("翻译失败")}finally{Qe.step=!1}}else f.warning("请先输入中文标题")}async function at(){if(!Ee.value||!Ee.value.options||0===Ee.value.options.length)return void f.warning("当前步骤没有选项");const e=Ee.value.options.filter(e=>e.label&&!e.label_en).map(e=>e.label);if(0!==e.length){Qe.options=!0;try{const t=await async function(e){if(!e||0===e.length)return[];try{const t=await M.post("/translate/batch",{texts:e,target:"en"});return 200===t.code&&t.data?t.data:(console.warn("批量翻译失败:",t.message),e.map(e=>({original:e,translated:e})))}catch(t){return console.error("批量翻译API调用失败:",t),e.map(e=>({original:e,translated:e}))}}(e);let l=0;Ee.value.options.forEach(e=>{var a;e.label&&!e.label_en&&(e.label_en=(null==(a=t[l])?void 0:a.translated)||e.label,l++)}),f.success(`已翻译 ${t.length} 个选项`)}catch(t){f.error("批量翻译失败")}finally{Qe.options=!1}}else f.warning("没有需要翻译的选项")}async function nt(e){if(e.label)try{e.label_en=await Lt(e.label),f.success("翻译成功")}catch(t){f.error("翻译失败")}else f.warning("请先输入中文名称")}const ot=e(!1),it=e("create"),st=e(""),rt=e(!1),ct=e([]),dt=e(null),ut=e(!1),pt=e(null);function mt(){ot.value=!ot.value,ot.value&&(console.log("%c🤖 AI场景生成助手已更新","color: #67C23A; font-size: 16px; font-weight: bold;"),console.log("%c版本: v2.3.0 (2026-01-20 12:22:00)","color: #409EFF; font-size: 14px;"),console.log("%c✨ 新功能:","color: #E6A23C; font-size: 14px; font-weight: bold;"),console.log("  • 禁用AI图片生成功能（绿幕抠图效果不理想）"),console.log("  • 改为使用占位图，请通过素材管理上传图片"),console.log("  • 新增「素材管理」→「场景素材」TAB"),console.log("  • 在场景配置中点击图片区域从素材库选择"),console.log("%c━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━","color: #909399;"))}function vt(e){st.value=e}function ft(){N(()=>{dt.value&&(dt.value.scrollTop=dt.value.scrollHeight)})}function gt(){window.location.href="/admin/#/assets"}async function ht(e){var t,l;const a=ct.value[e];if(a&&a.generatedConfig){a.imageTasksPending=!1,a.generatingImages=!0,a.imageProgress={current:0,total:a.imageTasks.length};try{const e=await async function(e,t,l){var a,n;try{const t=JSON.parse(JSON.stringify(e)),i=5;let s=0;if(null==(a=t.scene)?void 0:a.icon_description){l(s,"processing");try{const e=await M.post("/ai-agent/generate-icon",{description:t.scene.icon_description,type:"scene",scene_id:t.scene.scene_key,auto_upload:!0});200===e.code&&(null==(n=e.data)?void 0:n.url)?(t.scene.icon=e.data.url,l(s,"completed")):l(s,"failed")}catch(o){console.error("生成场景图标失败:",o),l(s,"failed")}s++}const r=[];if(t.steps&&Array.isArray(t.steps))for(const e of t.steps)if("image_upload"!==e.component_type&&e.options&&Array.isArray(e.options))for(const t of e.options)t.image_description&&r.push({step:e,opt:t,taskIndex:s++,description:t.image_description,step_key:e.step_key,option_key:t.option_key});const c=async e=>{var a,n;l(e.taskIndex,"processing");try{const o=await M.post("/ai-agent/generate-icon",{description:e.description,type:"step",scene_id:null==(a=t.scene)?void 0:a.scene_key,step_key:e.step_key,option_key:e.option_key,auto_upload:!0});return 200===o.code&&(null==(n=o.data)?void 0:n.url)?(e.opt.image=o.data.url,l(e.taskIndex,"completed"),{success:!0}):(l(e.taskIndex,"failed"),{success:!1})}catch(o){return console.error(`生成选项 ${e.option_key} 示意图失败:`,o),l(e.taskIndex,"failed"),{success:!1}}};for(let e=0;e<r.length;e+=i){const t=r.slice(e,e+i);console.log(`[并发生成] 批次 ${Math.floor(e/i)+1}/${Math.ceil(r.length/i)}, 任务数: ${t.length}`),await Promise.all(t.map(e=>c(e))),e+i<r.length&&await new Promise(e=>setTimeout(e,200))}return t}catch(i){throw console.error("生成配置图片失败:",i),i}}(a.generatedConfig,a.imageTasks,(e,t)=>{a.imageTasks[e].status=t,"completed"===t&&a.imageProgress.current++});a.generatedConfig=e,a.generatingImages=!1,a.content="create"===it.value?`已为您生成「${(null==(t=e.scene)?void 0:t.name)||"新场景"}」的完整配置，包含 ${(null==(l=e.steps)?void 0:l.length)||0} 个步骤。所有图片已生成完成，点击下方按钮可预览详情或直接应用。`:"已根据您的要求修改了场景配置。所有图片已生成完成，点击下方按钮查看修改结果。",f.success("图片生成完成")}catch(n){console.error("图片生成失败:",n),a.generatingImages=!1,f.error("图片生成失败: "+(n.message||"未知错误"))}ft()}}async function _t(){var e,t;const l=st.value.trim();if(l&&!rt.value){ct.value.push({role:"user",content:l}),st.value="",rt.value=!0,ft();try{let a;if("create"===it.value)a=await M.post("/ai-agent/generate-scene",{description:l,reference_scene:null});else{if(!F.value)throw new Error("请先选择要修改的场景");const e={scene:{scene_key:F.value.id,name:F.value.name,name_en:F.value.name_en,description:F.value.description,description_en:F.value.description_en,points_cost:F.value.points_cost||F.value.price,status:F.value.status},steps:H.value.map(e=>{var t;return{step_key:e.step_key,title:e.title,title_en:e.title_en,component_type:e.component_type,is_required:e.is_required,is_visible:e.is_visible,gender_based:e.gender_based,options:null==(t=e.options)?void 0:t.map(e=>({option_key:e.option_key,label:e.label,label_en:e.label_en,color:e.color,image:e.image,prompt_text:e.prompt_text,is_default:e.is_default}))}}),prompt_template:{name:ke.name,template:ke.template,negative_prompt:ke.negative_prompt}};a=await M.post("/ai-agent/modify-scene",{current_config:e,instruction:l})}if(200===a.code){const l=a.data,n=[];ct.value.push({role:"assistant",content:"create"===it.value?`已为您生成「${(null==(e=l.scene)?void 0:e.name)||"新场景"}」的完整配置，包含 ${(null==(t=l.steps)?void 0:t.length)||0} 个步骤。检测到需要生成 ${n.length} 张图片，请确认是否继续。`:`已根据您的要求修改了场景配置。检测到需要生成 ${n.length} 张图片，请确认是否继续。`,generatedConfig:l,imageTasks:n,imageTasksPending:!0,generatingImages:!1}),ft()}else ct.value.push({role:"assistant",content:`抱歉，生成失败：${a.message||"未知错误"}。请重试或换个描述方式。`})}catch(a){console.error("AI 请求失败:",a),ct.value.push({role:"assistant",content:`请求失败：${a.message||"网络错误"}。请检查网络连接后重试。`})}finally{rt.value=!1,ft()}}}async function bt(e){var t,l;if(e)try{if(await z.confirm("create"===it.value?"确定要创建此场景吗？将自动保存场景基本信息、步骤和Prompt模板。":"确定要应用这些修改吗？这将覆盖当前场景的配置。","确认应用",{type:"info"}),"create"===it.value){const l={scene_key:e.scene.scene_key,name:e.scene.name,name_en:e.scene.name_en||"",description:e.scene.description,description_en:e.scene.description_en||"",icon:e.scene.icon||"",status:"inactive",is_review_safe:e.scene.is_review_safe?1:0,points_cost:e.scene.points_cost||50,price:e.scene.points_cost||50,use_dynamic_render:1},a=await M.post("/config/admin/scene",l);if(200!==a.code&&0!==a.code)throw new Error(a.message||"创建场景失败");const n=(null==(t=e.steps)?void 0:t.map((e,t)=>{var l;return{step_key:e.step_key,title:e.title,title_en:e.title_en||"",title_tw:"",component_type:e.component_type,step_order:t+1,is_required:!1!==e.is_required,is_visible:!1!==e.is_visible,gender_based:e.gender_based||!1,icon:"",config:{},options:(null==(l=e.options)?void 0:l.map((e,t)=>({option_key:e.option_key||`opt_${Date.now().toString(36)}_${t}`,label:e.label,label_en:e.label_en||"",label_tw:"",color:e.color||"",image:e.image||"",prompt_text:e.prompt_text||e.label,sort_order:t+1,is_visible:!0,is_default:e.is_default||0===t?1:0,gender:e.gender||null})))||[]}}))||[],o=e.prompt_template?{name:e.prompt_template.name||`${e.scene.name}模板`,template:e.prompt_template.template||"",negative_prompt:e.prompt_template.negative_prompt||""}:null;await M.post(`/config/admin/scene/${e.scene.scene_key}/batch-save`,{steps:n,prompt:o}),f.success("场景创建成功！"),ot.value=!1,Oe()}else{if(!F.value)return;Object.assign(Ce,{name:e.scene.name,name_en:e.scene.name_en,description:e.scene.description,description_en:e.scene.description_en,points_cost:e.scene.points_cost,icon:e.scene.icon||Ce.icon}),H.value=(null==(l=e.steps)?void 0:l.map((e,t)=>{var l;return{id:null,step_key:e.step_key,title:e.title,title_en:e.title_en||"",title_tw:"",component_type:e.component_type,step_order:t+1,is_required:!1!==e.is_required,is_visible:!1!==e.is_visible,gender_based:e.gender_based||!1,icon:"",config:{},options:(null==(l=e.options)?void 0:l.map((e,t)=>({option_key:e.option_key||`opt_${Date.now().toString(36)}_${t}`,label:e.label,label_en:e.label_en||"",label_tw:"",color:e.color||"",image:e.image||"",prompt_text:e.prompt_text||e.label,sort_order:t+1,is_visible:1,is_default:e.is_default||0===t?1:0,gender:e.gender||null})))||[]}}))||[],e.prompt_template&&(ke.name=e.prompt_template.name||ke.name,ke.template=e.prompt_template.template||"",ke.negative_prompt=e.prompt_template.negative_prompt||""),W.value=H.value.length>0?0:-1,f.success("配置已应用，请检查后保存"),ot.value=!1}}catch(a){"cancel"!==a&&f.error("应用配置失败: "+(a.message||"未知错误"))}}return e(!1),e(null),l({description:"",type:"scene"}),e(""),e(!1),a(()=>{Oe()}),(e,t)=>{const l=d("el-icon"),a=d("el-button"),N=d("el-radio-button"),R=d("el-radio-group"),$=d("el-table-column"),re=d("el-image"),me=d("el-switch"),yt=d("el-table"),wt=d("el-input"),kt=d("el-form-item"),Ct=d("el-tooltip"),Vt=d("el-upload"),xt=d("el-option"),Et=d("el-select"),St=d("el-col"),Dt=d("el-input-number"),Tt=d("el-row"),It=d("el-form"),Pt=d("el-tab-pane"),Ot=d("el-tag"),At=d("el-empty"),zt=d("el-checkbox"),Nt=d("el-color-picker"),Ut=d("el-tabs"),Mt=d("el-dialog"),Rt=d("el-alert"),Xt=d("el-card"),Yt=d("el-drawer"),$t=d("el-descriptions-item"),Lt=d("el-descriptions"),In=p("loading"),Pn=p("dialog-drag");return o(),n("div",jt,[i("div",Bt,[t[49]||(t[49]=i("div",{class:"header-left"},[i("h2",null,"场景管理"),i("span",{class:"subtitle"},"管理所有AI生成场景，配置步骤和定价")],-1)),i("div",Ft,[r(a,{type:"primary",onClick:Ae},{default:c(()=>[r(l,null,{default:c(()=>[r(h(_))]),_:1}),t[48]||(t[48]=g(" 新增场景 ",-1))]),_:1})])]),i("div",Ht,[r(R,{modelValue:q.value,"onUpdate:modelValue":t[0]||(t[0]=e=>q.value=e),onChange:Pe},{default:c(()=>[r(N,{label:"all"},{default:c(()=>[...t[50]||(t[50]=[g("全部",-1)])]),_:1}),r(N,{label:"active"},{default:c(()=>[...t[51]||(t[51]=[g("上线中",-1)])]),_:1}),r(N,{label:"coming_soon"},{default:c(()=>[...t[52]||(t[52]=[g("即将上线",-1)])]),_:1}),r(N,{label:"inactive"},{default:c(()=>[...t[53]||(t[53]=[g("未上线",-1)])]),_:1})]),_:1},8,["modelValue"]),i("span",Wt,"共 "+u(xe.value.length)+" 个场景",1)]),s((o(),n("div",qt,[r(yt,{data:xe.value,"row-key":"id","empty-text":"暂无场景数据，请点击「新增场景」按钮添加"},{default:c(()=>[r($,{label:"排序",width:"60",align:"center"},{default:c(()=>[...t[54]||(t[54]=[i("span",{class:"drag-handle"},"☰",-1)])]),_:1}),r($,{label:"场景","min-width":"240"},{default:c(({row:e})=>[i("div",Gt,[r(re,{class:"scene-icon-img",src:e.icon,fit:"cover","preview-src-list":[e.icon],"preview-teleported":""},{error:c(()=>{var t;return[i("div",Jt,u((null==(t=e.name)?void 0:t.charAt(0))||"?"),1)]}),_:2},1032,["src","preview-src-list"]),i("div",Kt,[i("div",Zt,u(e.name),1),i("div",Qt,u(e.description),1),i("div",el,"ID: "+u(e.scene_key||e.id),1)])])]),_:1}),r($,{label:"状态",width:"200",align:"center"},{default:c(({row:e})=>[i("div",tl,[i("div",{class:v(["status-option",{active:"active"===e.status}]),onClick:t=>Re(e,"active")},[...t[55]||(t[55]=[i("span",{class:"status-dot green"},null,-1),i("span",{class:"status-text"},"上线",-1)])],10,ll),i("div",{class:v(["status-option",{active:"coming_soon"===e.status}]),onClick:t=>Re(e,"coming_soon")},[...t[56]||(t[56]=[i("span",{class:"status-dot yellow"},null,-1),i("span",{class:"status-text"},"即将",-1)])],10,al),i("div",{class:v(["status-option",{active:"inactive"===e.status}]),onClick:t=>Re(e,"inactive")},[...t[57]||(t[57]=[i("span",{class:"status-dot gray"},null,-1),i("span",{class:"status-text"},"下线",-1)])],10,nl)])]),_:1}),r($,{label:"审核安全",width:"90",align:"center"},{default:c(({row:e})=>[r(me,{modelValue:e.is_review_safe,"onUpdate:modelValue":t=>e.is_review_safe=t,"active-value":1,"inactive-value":0,onChange:t=>async function(e){try{const t={...e,price:e.points_cost||e.price,use_dynamic_render:1};await M.post("/config/admin/scene",t),f.success("更新成功")}catch(t){f.error("更新失败"),Oe()}}(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),r($,{label:"醒币",width:"80",align:"center"},{default:c(({row:e})=>[i("span",ol,u(e.points_cost||e.price),1)]),_:1}),r($,{label:"操作",width:"120",fixed:"right"},{default:c(({row:e})=>[i("div",il,[r(a,{type:"primary",link:"",size:"small",onClick:t=>async function(e){j.value=!0,F.value=e,Object.assign(Ce,e),Ce.is_review_safe=1===e.is_review_safe,G.value="basic";try{const t=await M.get(`/config/admin/scene/${e.id}/steps`);H.value=(t.data||[]).map(e=>{let t={};try{t=e.config?JSON.parse(e.config):{}}catch(n){t={}}const l=(e.options||[]).map(e=>{let t={};try{t=e.metadata?JSON.parse(e.metadata):{}}catch(n){t={}}return{...e,width:t.width||null,height:t.height||null}});let a=!1;return l.forEach(e=>{1===e.is_default&&(a?e.is_default=0:a=!0)}),!a&&l.length>0&&(l[0].is_default=1),{...e,config:t,is_required:1===e.is_required,is_visible:1===e.is_visible,gender_based:1===e.gender_based||!0===e.gender_based||t.gender_based||!1,icon:e.icon||t.icon||"",options:l}}),W.value=H.value.length>0?0:-1}catch(t){console.error("加载步骤失败:",t),H.value=[],W.value=-1}try{const t=(await M.get(`/config/admin/prompts/${e.id}`)).data||[];t.length>0?(Object.assign(ke,t[0]),ke.is_active=1===t[0].is_active):Object.assign(ke,{id:null,name:`${e.name}模板`,template:"",negative_prompt:"",is_active:!0})}catch(t){console.error("加载Prompt失败:",t),Object.assign(ke,{id:null,name:`${e.name}模板`,template:"",negative_prompt:"",is_active:!0})}L.value=!0}(e)},{default:c(()=>[...t[58]||(t[58]=[g("编辑",-1)])]),_:1},8,["onClick"]),r(a,{type:"danger",link:"",size:"small",onClick:t=>async function(e){try{await z.confirm(`确定删除场景"${e.name}"吗？`,"删除确认",{type:"warning"}),await M.delete(`/config/admin/scene/${e.id}`),f.success("删除成功"),Oe()}catch{}}(e)},{default:c(()=>[...t[59]||(t[59]=[g("删除",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])])),[[In,X.value]]),s((o(),m(Mt,{modelValue:L.value,"onUpdate:modelValue":t[25]||(t[25]=e=>L.value=e),title:j.value?"编辑场景":"新增场景",width:"90%",style:{"max-width":"1200px"},top:"5vh"},{footer:c(()=>[r(a,{onClick:t[24]||(t[24]=e=>L.value=!1)},{default:c(()=>[...t[100]||(t[100]=[g("取消",-1)])]),_:1}),r(a,{type:"primary",onClick:Me,loading:Y.value},{default:c(()=>[...t[101]||(t[101]=[g("保存",-1)])]),_:1},8,["loading"])]),default:c(()=>[r(Ut,{modelValue:G.value,"onUpdate:modelValue":t[23]||(t[23]=e=>G.value=e),type:"card"},{default:c(()=>[r(Pt,{label:"基本信息",name:"basic"},{default:c(()=>[r(It,{model:Ce,rules:Ve,ref_key:"formRef",ref:B,"label-width":"100px"},{default:c(()=>[r(kt,{label:"场景ID",prop:"id"},{default:c(()=>[r(wt,{modelValue:Ce.id,"onUpdate:modelValue":t[1]||(t[1]=e=>Ce.id=e),disabled:j.value,placeholder:"如: idphoto, portrait"},null,8,["modelValue","disabled"])]),_:1}),r(kt,{label:"场景名称",prop:"name"},{default:c(()=>[i("div",sl,[r(wt,{modelValue:Ce.name,"onUpdate:modelValue":t[2]||(t[2]=e=>Ce.name=e),placeholder:"中文名称",style:{flex:"1"}},null,8,["modelValue"]),r(wt,{modelValue:Ce.name_en,"onUpdate:modelValue":t[3]||(t[3]=e=>Ce.name_en=e),placeholder:"English name",style:{flex:"1"}},null,8,["modelValue"]),r(Ct,{content:"调用腾讯翻译API",placement:"top"},{default:c(()=>[r(a,{type:"primary",link:"",onClick:et,icon:h(b),loading:Qe.name,class:"translate-btn"},{default:c(()=>[...t[60]||(t[60]=[g("翻译",-1)])]),_:1},8,["icon","loading"])]),_:1})])]),_:1}),r(kt,{label:"场景描述",prop:"description"},{default:c(()=>[i("div",rl,[r(wt,{modelValue:Ce.description,"onUpdate:modelValue":t[4]||(t[4]=e=>Ce.description=e),type:"textarea",rows:2,placeholder:"简短描述（中文）",style:{flex:"1"}},null,8,["modelValue"]),r(wt,{modelValue:Ce.description_en,"onUpdate:modelValue":t[5]||(t[5]=e=>Ce.description_en=e),type:"textarea",rows:2,placeholder:"English description",style:{flex:"1"}},null,8,["modelValue"]),r(Ct,{content:"调用腾讯翻译API",placement:"top"},{default:c(()=>[r(a,{type:"primary",link:"",onClick:tt,icon:h(b),loading:Qe.desc,class:"translate-btn"},{default:c(()=>[...t[61]||(t[61]=[g("翻译",-1)])]),_:1},8,["icon","loading"])]),_:1})])]),_:1}),r(kt,{label:"场景图标"},{default:c(()=>[i("div",cl,[i("div",{class:"scene-icon-selector",onClick:Je,title:"点击从素材库选择图标"},[Ce.icon?(o(),m(re,{key:0,class:"icon-preview-inline",src:Ce.icon,fit:"cover"},null,8,["src"])):(o(),n("div",dl,[r(l,null,{default:c(()=>[r(h(_))]),_:1}),t[62]||(t[62]=i("span",null,"选择图标",-1))]))]),i("div",ul,[Ce.icon?(o(),m(a,{key:0,size:"small",link:"",type:"danger",onClick:t[6]||(t[6]=w(e=>Ce.icon="",["stop"]))},{default:c(()=>[...t[63]||(t[63]=[g("清除",-1)])]),_:1})):y("",!0),r(Vt,{class:"icon-upload-btn",action:"/api/upload/icon",headers:we.value,data:{sceneId:Ce.id},"show-file-list":!1,"on-success":ze,"on-error":Ne,"before-upload":Ue,accept:"image/*"},{default:c(()=>[r(a,{size:"small",link:""},{default:c(()=>[...t[64]||(t[64]=[g("本地上传",-1)])]),_:1})]),_:1},8,["headers","data"])]),t[65]||(t[65]=i("div",{class:"icon-upload-tips"},[i("p",null,"点击图标从COS选择"),i("p",null,"建议: 200×200px PNG")],-1))])]),_:1}),r(Tt,{gutter:20},{default:c(()=>[r(St,{span:12},{default:c(()=>[r(kt,{label:"状态"},{default:c(()=>[r(Et,{modelValue:Ce.status,"onUpdate:modelValue":t[7]||(t[7]=e=>Ce.status=e),style:{width:"100%"}},{default:c(()=>[r(xt,{label:"上线中",value:"active"}),r(xt,{label:"即将上线",value:"coming_soon"}),r(xt,{label:"未上线",value:"inactive"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),r(St,{span:12},{default:c(()=>[r(kt,{label:"消耗醒币"},{default:c(()=>[r(Dt,{modelValue:Ce.points_cost,"onUpdate:modelValue":t[8]||(t[8]=e=>Ce.points_cost=e),min:1,max:1e3,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),r(kt,{label:"审核安全"},{default:c(()=>[r(me,{modelValue:Ce.is_review_safe,"onUpdate:modelValue":t[9]||(t[9]=e=>Ce.is_review_safe=e)},null,8,["modelValue"]),t[66]||(t[66]=i("span",{class:"form-tip"},"审核模式下是否显示此场景",-1))]),_:1})]),_:1},8,["model"])]),_:1}),r(Pt,{label:"步骤配置",name:"steps",disabled:!j.value},{default:c(()=>[i("div",pl,[i("div",ml,[t[70]||(t[70]=i("div",{class:"sidebar-title"},"步骤列表",-1)),r(h(U),{modelValue:H.value,"onUpdate:modelValue":t[10]||(t[10]=e=>H.value=e),"item-key":"id",handle:".drag-handle",onEnd:je,class:"steps-list-compact"},{item:c(({element:e,index:l})=>[i("div",{class:v(["step-item-compact",{active:W.value===l}]),onClick:e=>function(e){W.value=e}(l)},[t[68]||(t[68]=i("span",{class:"drag-handle"},"☰",-1)),i("span",fl,u(l+1),1),i("div",gl,[i("span",hl,u(e.title),1),r(Ot,{size:"small",type:"info"},{default:c(()=>[g(u(e.step_key||"未设置"),1)]),_:2},1024)]),r(a,{size:"small",link:"",type:"danger",onClick:w(e=>function(e){H.value.splice(e,1),W.value>=H.value.length&&(W.value=H.value.length-1)}(l),["stop"])},{default:c(()=>[...t[67]||(t[67]=[g("×",-1)])]),_:1},8,["onClick"])],10,vl)]),_:1},8,["modelValue"]),r(a,{class:"add-step-btn",size:"small",onClick:Xe},{default:c(()=>[...t[69]||(t[69]=[g("+ 添加步骤",-1)])]),_:1})]),Ee.value?(o(),n("div",_l,[t[72]||(t[72]=i("div",{class:"config-section-title"},"基本配置",-1)),r(It,{model:Ee.value,"label-width":"80px",size:"small","label-position":"top"},{default:c(()=>[r(kt,{label:"步骤图标"},{default:c(()=>[i("div",bl,[i("div",{class:"step-icon-preview",onClick:qe},[Ee.value.icon?(o(),n("img",{key:0,src:Ee.value.icon,class:"step-icon-img"},null,8,yl)):(o(),n("div",wl,[r(l,null,{default:c(()=>[r(h(_))]),_:1})]))]),Ee.value.icon?(o(),m(a,{key:0,size:"small",link:"",type:"danger",onClick:t[11]||(t[11]=e=>Ee.value.icon="")},{default:c(()=>[...t[71]||(t[71]=[g("清除",-1)])]),_:1})):y("",!0)])]),_:1}),r(kt,{label:"步骤标识"},{default:c(()=>[r(wt,{modelValue:Ee.value.step_key,"onUpdate:modelValue":t[12]||(t[12]=e=>Ee.value.step_key=e),placeholder:"如: gender, background"},null,8,["modelValue"])]),_:1}),r(kt,{label:"步骤标题"},{default:c(()=>[i("div",kl,[r(wt,{modelValue:Ee.value.title,"onUpdate:modelValue":t[13]||(t[13]=e=>Ee.value.title=e),placeholder:"中文"},null,8,["modelValue"]),r(wt,{modelValue:Ee.value.title_en,"onUpdate:modelValue":t[14]||(t[14]=e=>Ee.value.title_en=e),placeholder:"English"},null,8,["modelValue"]),r(Ct,{content:"翻译",placement:"top"},{default:c(()=>[r(a,{type:"primary",link:"",size:"small",onClick:lt,icon:h(b),loading:Qe.step},null,8,["icon","loading"])]),_:1})])]),_:1}),r(kt,{label:"组件类型"},{default:c(()=>[r(Et,{modelValue:Ee.value.component_type,"onUpdate:modelValue":t[15]||(t[15]=e=>Ee.value.component_type=e),style:{width:"100%"}},{default:c(()=>[r(xt,{label:"图片上传",value:"image_upload"}),r(xt,{label:"性别选择",value:"gender_select"}),r(xt,{label:"单选框",value:"radio"}),r(xt,{label:"标签选择",value:"tags"}),r(xt,{label:"规格选择",value:"spec_select"}),r(xt,{label:"颜色选择",value:"color_picker"}),r(xt,{label:"图片标签",value:"image_tags"}),r(xt,{label:"滑块",value:"slider"})]),_:1},8,["modelValue"])]),_:1}),i("div",Cl,[r(kt,{label:"必填"},{default:c(()=>[r(me,{modelValue:Ee.value.is_required,"onUpdate:modelValue":t[16]||(t[16]=e=>Ee.value.is_required=e)},null,8,["modelValue"])]),_:1}),r(kt,{label:"显示"},{default:c(()=>[r(me,{modelValue:Ee.value.is_visible,"onUpdate:modelValue":t[17]||(t[17]=e=>Ee.value.is_visible=e)},null,8,["modelValue"])]),_:1}),"image_tags"===Ee.value.component_type?(o(),m(kt,{key:0,label:"性别分类"},{default:c(()=>[r(me,{modelValue:Ee.value.gender_based,"onUpdate:modelValue":t[18]||(t[18]=e=>Ee.value.gender_based=e)},null,8,["modelValue"])]),_:1})):y("",!0)])]),_:1},8,["model"])])):(o(),n("div",Vl,[r(At,{description:"请选择步骤","image-size":60})])),Ee.value?(o(),n("div",xl,[i("div",El,[t[75]||(t[75]=g(" 选项配置 ",-1)),i("div",Sl,[r(Ct,{content:"批量翻译所有选项为英文",placement:"top"},{default:c(()=>[r(a,{size:"small",type:"success",link:"",onClick:at,icon:h(b)},{default:c(()=>[...t[73]||(t[73]=[g("批量翻译",-1)])]),_:1},8,["icon"])]),_:1}),r(a,{size:"small",type:"primary",link:"",onClick:Ye},{default:c(()=>[...t[74]||(t[74]=[g("+ 添加选项",-1)])]),_:1})])]),"image_tags"===Ee.value.component_type&&Ee.value.gender_based?(o(),n("div",Dl,[r(R,{modelValue:Se.value,"onUpdate:modelValue":t[19]||(t[19]=e=>Se.value=e),size:"small"},{default:c(()=>[r(N,{label:""},{default:c(()=>[...t[76]||(t[76]=[g("全部",-1)])]),_:1}),r(N,{label:"male"},{default:c(()=>[...t[77]||(t[77]=[g("男",-1)])]),_:1}),r(N,{label:"female"},{default:c(()=>[...t[78]||(t[78]=[g("女",-1)])]),_:1})]),_:1},8,["modelValue"]),i("span",Tl,u(De.value.length)+" 项",1)])):y("",!0),"spec_select"===Ee.value.component_type?(o(),n("div",Il,[r(l,null,{default:c(()=>[r(h(k))]),_:1}),t[79]||(t[79]=i("span",null,"尺寸用于后端动态裁剪",-1))])):y("",!0),i("div",Pl,["image_tags"===Ee.value.component_type?(o(!0),n(C,{key:0},V(De.value,(e,s)=>(o(),n("div",{key:e.option_key||s,class:"image-tag-row"},[i("div",Ol,[i("div",{class:"option-thumb-selector",onClick:t=>async function(e){var t;Be.value=e,oe.value=-1,ne.value=e.image||"",(null==(t=Ee.value)?void 0:t.gender_based)&&e.gender?ae.value=e.gender:ae.value="",J.value=!0,0===Z.value.length?await Fe():He()}(e),title:"点击从素材库选择图片"},[e.image?(o(),m(re,{key:0,class:"option-thumb",src:e.image,fit:"cover"},null,8,["src"])):(o(),n("div",zl,[r(l,null,{default:c(()=>[r(h(_))]),_:1})]))],8,Al),e.image?(o(),m(a,{key:0,size:"small",link:"",type:"danger",onClick:w(t=>e.image="",["stop"]),title:"清除图片"},{default:c(()=>[...t[80]||(t[80]=[g("清除",-1)])]),_:1},8,["onClick"])):y("",!0)]),i("div",Nl,[i("div",Ul,[i("div",Ml,[t[81]||(t[81]=i("label",null,"中文",-1)),r(wt,{modelValue:e.label,"onUpdate:modelValue":t=>e.label=t,size:"small",style:{width:"90px"},placeholder:"名称"},null,8,["modelValue","onUpdate:modelValue"])]),i("div",Rl,[t[82]||(t[82]=i("label",null,"English",-1)),i("div",Xl,[r(wt,{modelValue:e.label_en,"onUpdate:modelValue":t=>e.label_en=t,size:"small",style:{width:"100px"},placeholder:"Name"},null,8,["modelValue","onUpdate:modelValue"]),r(Ct,{content:"翻译",placement:"top"},{default:c(()=>[r(a,{type:"primary",link:"",size:"small",onClick:t=>nt(e),class:"mini-translate-btn"},{default:c(()=>[r(l,{size:12},{default:c(()=>[r(h(b))]),_:1})]),_:1},8,["onClick"])]),_:2},1024)])]),Ee.value.gender_based?(o(),n("div",Yl,[t[83]||(t[83]=i("label",null,"性别",-1)),r(Et,{modelValue:e.gender,"onUpdate:modelValue":t=>e.gender=t,size:"small",style:{width:"65px"},clearable:""},{default:c(()=>[r(xt,{label:"男",value:"male"}),r(xt,{label:"女",value:"female"})]),_:1},8,["modelValue","onUpdate:modelValue"])])):y("",!0),i("div",$l,[t[85]||(t[85]=i("label",null," ",-1)),r(zt,{"model-value":1===e.is_default,onChange:t=>Le(e),size:"small",disabled:1===e.is_default},{default:c(()=>[...t[84]||(t[84]=[g("默认",-1)])]),_:1},8,["model-value","onChange","disabled"])]),i("div",Ll,[t[87]||(t[87]=i("label",null," ",-1)),r(a,{size:"small",link:"",type:"danger",onClick:t=>function(e){const t=Ee.value.options.indexOf(e);t>=0&&$e(t)}(e)},{default:c(()=>[...t[86]||(t[86]=[g("删除",-1)])]),_:1},8,["onClick"])])]),i("div",jl,[t[88]||(t[88]=i("label",null,"AI提示词",-1)),r(wt,{modelValue:e.prompt_text,"onUpdate:modelValue":t=>e.prompt_text=t,size:"small",placeholder:"发送给AI的描述文字"},null,8,["modelValue","onUpdate:modelValue"])])])]))),128)):"tags"===Ee.value.component_type?(o(),n(C,{key:1},[t[90]||(t[90]=i("div",{class:"tags-table-header"},[i("div",{class:"tags-col tags-col-label-main"},"中文"),i("div",{class:"tags-col tags-col-label"},"English"),i("div",{class:"tags-col tags-col-prompt"},"AI提示词"),i("div",{class:"tags-col tags-col-default"},"默认"),i("div",{class:"tags-col tags-col-action"},"操作")],-1)),(o(!0),n(C,null,V(Ee.value.options,(e,s)=>(o(),n("div",{key:s,class:"tags-table-row"},[i("div",Bl,[r(wt,{modelValue:e.label,"onUpdate:modelValue":t=>e.label=t,placeholder:"标签名",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),i("div",Fl,[i("div",Hl,[r(wt,{modelValue:e.label_en,"onUpdate:modelValue":t=>e.label_en=t,placeholder:"Tag",size:"small"},null,8,["modelValue","onUpdate:modelValue"]),r(a,{type:"primary",link:"",size:"small",onClick:t=>nt(e),class:"mini-translate-btn"},{default:c(()=>[r(l,{size:12},{default:c(()=>[r(h(b))]),_:1})]),_:1},8,["onClick"])])]),i("div",Wl,[r(wt,{modelValue:e.prompt_text,"onUpdate:modelValue":t=>e.prompt_text=t,placeholder:"发送给AI的描述",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),i("div",ql,[r(zt,{"model-value":1===e.is_default,onChange:t=>Le(e),size:"small",disabled:1===e.is_default},null,8,["model-value","onChange","disabled"])]),i("div",Gl,[r(a,{size:"small",link:"",type:"danger",onClick:e=>$e(s)},{default:c(()=>[...t[89]||(t[89]=[g("删除",-1)])]),_:1},8,["onClick"])])]))),128))],64)):"spec_select"===Ee.value.component_type?(o(),n(C,{key:2},[t[92]||(t[92]=i("div",{class:"spec-table-header"},[i("div",{class:"spec-col spec-col-label-main"},"中文"),i("div",{class:"spec-col spec-col-label"},"English"),i("div",{class:"spec-col spec-col-size"},"宽度(mm)"),i("div",{class:"spec-col spec-col-size"},"高度(mm)"),i("div",{class:"spec-col spec-col-default"},"默认"),i("div",{class:"spec-col spec-col-action"},"操作")],-1)),(o(!0),n(C,null,V(Ee.value.options,(e,s)=>(o(),n("div",{key:s,class:"spec-table-row"},[i("div",Jl,[r(wt,{modelValue:e.label,"onUpdate:modelValue":t=>e.label=t,placeholder:"一寸",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),i("div",Kl,[i("div",Zl,[r(wt,{modelValue:e.label_en,"onUpdate:modelValue":t=>e.label_en=t,placeholder:"1 inch",size:"small"},null,8,["modelValue","onUpdate:modelValue"]),r(a,{type:"primary",link:"",size:"small",onClick:t=>nt(e),class:"mini-translate-btn"},{default:c(()=>[r(l,{size:12},{default:c(()=>[r(h(b))]),_:1})]),_:1},8,["onClick"])])]),i("div",Ql,[r(wt,{modelValue:e.width,"onUpdate:modelValue":t=>e.width=t,modelModifiers:{number:!0},type:"number",size:"small",placeholder:"25"},null,8,["modelValue","onUpdate:modelValue"])]),i("div",ea,[r(wt,{modelValue:e.height,"onUpdate:modelValue":t=>e.height=t,modelModifiers:{number:!0},type:"number",size:"small",placeholder:"35"},null,8,["modelValue","onUpdate:modelValue"])]),i("div",ta,[r(zt,{"model-value":1===e.is_default,onChange:t=>Le(e),size:"small",disabled:1===e.is_default},null,8,["model-value","onChange","disabled"])]),i("div",la,[r(a,{size:"small",link:"",type:"danger",onClick:e=>$e(s)},{default:c(()=>[...t[91]||(t[91]=[g("删除",-1)])]),_:1},8,["onClick"])])]))),128))],64)):(o(),n(C,{key:3},[i("div",aa,[t[93]||(t[93]=i("div",{class:"common-col common-col-label-main"},"中文",-1)),t[94]||(t[94]=i("div",{class:"common-col common-col-label"},"English",-1)),"color_picker"===Ee.value.component_type?(o(),n("div",na,"颜色")):(o(),n("div",oa,"图片URL")),t[95]||(t[95]=i("div",{class:"common-col common-col-prompt"},"AI提示词",-1)),t[96]||(t[96]=i("div",{class:"common-col common-col-default"},"默认",-1)),t[97]||(t[97]=i("div",{class:"common-col common-col-action"},"操作",-1))]),(o(!0),n(C,null,V(Ee.value.options,(e,s)=>(o(),n("div",{key:s,class:"common-table-row"},[i("div",ia,[r(wt,{modelValue:e.label,"onUpdate:modelValue":t=>e.label=t,placeholder:"选项名",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),i("div",sa,[i("div",ra,[r(wt,{modelValue:e.label_en,"onUpdate:modelValue":t=>e.label_en=t,placeholder:"Option",size:"small"},null,8,["modelValue","onUpdate:modelValue"]),r(a,{type:"primary",link:"",size:"small",onClick:t=>nt(e),class:"mini-translate-btn"},{default:c(()=>[r(l,{size:12},{default:c(()=>[r(h(b))]),_:1})]),_:1},8,["onClick"])])]),i("div",ca,["color_picker"===Ee.value.component_type?(o(),m(Nt,{key:0,modelValue:e.color,"onUpdate:modelValue":t=>e.color=t,size:"small"},null,8,["modelValue","onUpdate:modelValue"])):(o(),m(wt,{key:1,modelValue:e.image,"onUpdate:modelValue":t=>e.image=t,placeholder:"URL",size:"small"},null,8,["modelValue","onUpdate:modelValue"]))]),i("div",da,[r(wt,{modelValue:e.prompt_text,"onUpdate:modelValue":t=>e.prompt_text=t,placeholder:"发送给AI的描述",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),i("div",ua,[r(zt,{"model-value":1===e.is_default,onChange:t=>Le(e),size:"small",disabled:1===e.is_default},null,8,["model-value","onChange","disabled"])]),i("div",pa,[r(a,{size:"small",link:"",type:"danger",onClick:e=>$e(s)},{default:c(()=>[...t[98]||(t[98]=[g("删除",-1)])]),_:1},8,["onClick"])])]))),128))],64))])])):(o(),n("div",ma,[r(At,{description:"选择步骤后配置选项","image-size":60})]))])]),_:1},8,["disabled"]),r(Pt,{label:"Prompt模板",name:"prompt",disabled:!j.value},{default:c(()=>[r(It,{model:ke,"label-width":"100px"},{default:c(()=>[r(kt,{label:"模板名称"},{default:c(()=>[r(wt,{modelValue:ke.name,"onUpdate:modelValue":t[20]||(t[20]=e=>ke.name=e),placeholder:"如: 标准证件照模板"},null,8,["modelValue"])]),_:1}),r(kt,{label:"Prompt模板"},{default:c(()=>[r(wt,{modelValue:ke.template,"onUpdate:modelValue":t[21]||(t[21]=e=>ke.template=e),type:"textarea",rows:8,placeholder:"支持变量: {{gender}}, {{background}}, {{spec}} 等"},null,8,["modelValue"]),i("div",va,[t[99]||(t[99]=g(" 可用变量: ",-1)),(o(!0),n(C,null,V(Te.value,e=>(o(),m(Ot,{size:"small",key:e,onClick:t=>{return l=e,void(ke.template+=`{{${l}}}`);var l}},{default:c(()=>[g(u(Ie(e)),1)]),_:2},1032,["onClick"]))),128))])]),_:1}),r(kt,{label:"负面提示词"},{default:c(()=>[r(wt,{modelValue:ke.negative_prompt,"onUpdate:modelValue":t[22]||(t[22]=e=>ke.negative_prompt=e),type:"textarea",rows:2,placeholder:"模糊, 变形, 多人..."},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"])),[[Pn]]),s((o(),m(Mt,{modelValue:J.value,"onUpdate:modelValue":t[30]||(t[30]=e=>J.value=e),title:"从COS选择图片",width:"90%",style:{"max-width":"900px"},"append-to-body":""},{footer:c(()=>[r(a,{onClick:t[29]||(t[29]=e=>J.value=!1)},{default:c(()=>[...t[106]||(t[106]=[g("取消",-1)])]),_:1}),r(a,{type:"primary",onClick:We,disabled:!ne.value},{default:c(()=>[...t[107]||(t[107]=[g("确定选择",-1)])]),_:1},8,["disabled"])]),default:c(()=>[i("div",fa,[i("div",ga,[Ee.value&&Ee.value.gender_based?(o(),m(R,{key:0,modelValue:ae.value,"onUpdate:modelValue":t[26]||(t[26]=e=>ae.value=e),size:"small",onChange:He},{default:c(()=>[r(N,{label:""},{default:c(()=>[...t[102]||(t[102]=[g("全部",-1)])]),_:1}),r(N,{label:"male"},{default:c(()=>[...t[103]||(t[103]=[g("男",-1)])]),_:1}),r(N,{label:"female"},{default:c(()=>[...t[104]||(t[104]=[g("女",-1)])]),_:1})]),_:1},8,["modelValue"])):y("",!0),r(Et,{modelValue:le.value,"onUpdate:modelValue":t[27]||(t[27]=e=>le.value=e),placeholder:"选择文件夹",clearable:"",style:{width:"200px"},onChange:He},{default:c(()=>[r(xt,{label:"全部文件夹",value:""}),(o(!0),n(C,null,V(ee.value,e=>(o(),m(xt,{key:e,label:e||"根目录",value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),r(wt,{modelValue:te.value,"onUpdate:modelValue":t[28]||(t[28]=e=>te.value=e),placeholder:"搜索文件名...",clearable:"",style:{width:"180px"},onInput:He},null,8,["modelValue"]),r(a,{onClick:Fe,loading:K.value},{default:c(()=>[...t[105]||(t[105]=[g("刷新",-1)])]),_:1},8,["loading"])]),Q.value.length>0?(o(),n("div",ha,[i("span",_a,"共 "+u(Q.value.length)+" 张图片",1)])):y("",!0),s((o(),n("div",ba,[(o(!0),n(C,null,V(Q.value,e=>(o(),n("div",{key:e.key,class:v(["cos-image-item",{selected:ne.value===e.url}]),onClick:t=>function(e){ne.value=e.url}(e)},[r(re,{src:e.url,fit:"cover",lazy:""},null,8,["src"]),i("div",wa,[i("div",ka,u(e.fileName),1),i("div",Ca,[e.folderPath&&"根目录"!==e.folderPath?(o(),m(Ot,{key:0,size:"small",type:"info"},{default:c(()=>[g(u(e.folderPath),1)]),_:2},1024)):y("",!0)])])],10,ya))),128)),K.value||0!==Q.value.length?y("",!0):(o(),m(At,{key:0,description:"暂无图片，请调整筛选条件"}))])),[[In,K.value]])])]),_:1},8,["modelValue"])),[[Pn]]),s((o(),m(Mt,{modelValue:ie.value,"onUpdate:modelValue":t[33]||(t[33]=e=>ie.value=e),title:"选择步骤图标",width:"90%",style:{"max-width":"600px"},"append-to-body":""},{footer:c(()=>[r(a,{onClick:t[32]||(t[32]=e=>ie.value=!1)},{default:c(()=>[...t[108]||(t[108]=[g("取消",-1)])]),_:1}),r(a,{type:"primary",onClick:Ge,disabled:!de.value},{default:c(()=>[...t[109]||(t[109]=[g("确定选择",-1)])]),_:1},8,["disabled"])]),default:c(()=>[i("div",Va,[r(wt,{modelValue:ce.value,"onUpdate:modelValue":t[31]||(t[31]=e=>ce.value=e),placeholder:"搜索图标...",clearable:"",style:{width:"200px","margin-bottom":"12px"}},null,8,["modelValue"]),s((o(),n("div",xa,[(o(!0),n(C,null,V(be.value,e=>(o(),n("div",{key:e.key,class:v(["step-icon-item",{selected:de.value===e.url}]),onClick:t=>function(e){de.value=e.url}(e)},[i("img",{src:e.url,alt:e.fileName},null,8,Sa),i("div",Da,u(e.fileName),1)],10,Ea))),128)),se.value||0!==be.value.length?y("",!0):(o(),m(At,{key:0,description:"暂无图标"}))])),[[In,se.value]])])]),_:1},8,["modelValue"])),[[Pn]]),s((o(),m(Mt,{modelValue:ue.value,"onUpdate:modelValue":t[37]||(t[37]=e=>ue.value=e),title:"从COS选择场景图标",width:"90%",style:{"max-width":"900px"},"append-to-body":""},{footer:c(()=>[r(a,{onClick:t[36]||(t[36]=e=>ue.value=!1)},{default:c(()=>[...t[111]||(t[111]=[g("取消",-1)])]),_:1}),r(a,{type:"primary",onClick:Ze,disabled:!he.value},{default:c(()=>[...t[112]||(t[112]=[g("确定选择",-1)])]),_:1},8,["disabled"])]),default:c(()=>[i("div",Ta,[i("div",Ia,[r(Et,{modelValue:ge.value,"onUpdate:modelValue":t[34]||(t[34]=e=>ge.value=e),placeholder:"选择文件夹",clearable:"",style:{width:"160px"},onChange:ye},{default:c(()=>[r(xt,{label:"全部文件夹",value:""}),(o(!0),n(C,null,V(ve.value,e=>(o(),m(xt,{key:e,label:e||"根目录",value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),r(wt,{modelValue:fe.value,"onUpdate:modelValue":t[35]||(t[35]=e=>fe.value=e),placeholder:"搜索图片...",clearable:"",style:{width:"200px"},onInput:ye},null,8,["modelValue"]),r(a,{onClick:Ke,loading:pe.value,size:"small"},{default:c(()=>[...t[110]||(t[110]=[g("刷新",-1)])]),_:1},8,["loading"]),_e.value.length>0?(o(),n("span",Pa,"共 "+u(_e.value.length)+" 张图片",1)):y("",!0)]),s((o(),n("div",Oa,[(o(!0),n(C,null,V(_e.value,e=>(o(),n("div",{key:e.key,class:v(["scene-icon-item",{selected:he.value===e.url}]),onClick:t=>function(e){he.value=e.url}(e)},[r(re,{src:e.url,fit:"cover",lazy:""},null,8,["src"]),i("div",za,[i("div",Na,u(e.fileName),1),i("div",Ua,[e.folderPath?(o(),m(Ot,{key:0,size:"small",type:"info"},{default:c(()=>[g(u(e.folderPath),1)]),_:2},1024)):y("",!0)])])],10,Aa))),128)),pe.value||0!==_e.value.length?y("",!0):(o(),m(At,{key:0,description:"暂无图片"}))])),[[In,pe.value]])])]),_:1},8,["modelValue"])),[[Pn]]),i("div",{class:v(["ai-assistant-fab",{active:ot.value}]),onClick:mt},[r(l,{size:24},{default:c(()=>[r(h(b))]),_:1}),t[113]||(t[113]=i("span",{class:"fab-label"},"AI助手",-1))],2),r(Yt,{modelValue:ot.value,"onUpdate:modelValue":t[44]||(t[44]=e=>ot.value=e),title:"AI 场景生成助手",direction:"rtl",size:"420px","close-on-click-modal":!1},{default:c(()=>[i("div",Ma,[i("div",Ra,[r(R,{modelValue:it.value,"onUpdate:modelValue":t[38]||(t[38]=e=>it.value=e),size:"small"},{default:c(()=>[r(N,{label:"create"},{default:c(()=>[...t[114]||(t[114]=[g("新建场景",-1)])]),_:1}),r(N,{label:"modify",disabled:!F.value},{default:c(()=>[...t[115]||(t[115]=[g("修改场景",-1)])]),_:1},8,["disabled"]),r(N,{label:"image"},{default:c(()=>[...t[116]||(t[116]=[g("生成图标",-1)])]),_:1})]),_:1},8,["modelValue"])]),"modify"===it.value&&F.value?(o(),n("div",Xa,[r(l,null,{default:c(()=>[r(h(x))]),_:1}),i("span",null,"当前场景: "+u(F.value.name),1)])):y("",!0),"image"===it.value?(o(),n("div",Ya,[i("div",$a,[r(Rt,{title:"AI图片生成已禁用",type:"info",closable:!1,"show-icon":""},{default:c(()=>[...t[117]||(t[117]=[i("p",null,"由于绿幕抠图效果不理想，AI图片生成功能已暂时禁用。",-1),i("p",{style:{"margin-top":"8px"}},"请使用以下方式管理图片：",-1),i("ol",{style:{margin:"8px 0 0 16px",padding:"0"}},[i("li",null,"在「素材管理」中上传图片素材"),i("li",null,"在「场景配置」的步骤选项中点击图片区域从素材库选择")],-1)])]),_:1})]),i("div",La,[r(a,{type:"primary",onClick:gt},{default:c(()=>[r(l,null,{default:c(()=>[r(h(x))]),_:1}),t[118]||(t[118]=g(" 前往素材管理 ",-1))]),_:1})]),F.value?(o(),n("div",ja,[r(Xt,{shadow:"never"},{header:c(()=>[i("span",null,"当前场景: "+u(F.value.name),1)]),default:c(()=>[t[119]||(t[119]=i("p",{style:{"font-size":"13px",color:"#909399"}}," 请在编辑场景时，点击步骤选项的图片区域从COS素材库选择图片。 ",-1))]),_:1})])):y("",!0)])):y("",!0),s(i("div",{class:"ai-chat-history",ref_key:"chatHistoryRef",ref:dt},[0===ct.value.length?(o(),n("div",Ba,[t[121]||(t[121]=i("div",{class:"welcome-icon"},"🤖",-1)),t[122]||(t[122]=i("h3",null,"AI 场景生成助手",-1)),"create"===it.value?(o(),n("p",Fa,"描述您想要创建的场景，我将自动生成完整配置")):(o(),n("p",Ha,"描述您想要修改的内容，我将帮您调整当前场景")),i("div",Wa,[t[120]||(t[120]=i("div",{class:"suggestion-title"},"试试这样说:",-1)),"create"===it.value?(o(),n("div",{key:0,class:"suggestion-item",onClick:t[39]||(t[39]=e=>vt("帮我创建一个宠物写真场景，包含宠物类型选择、背景风格、滤镜效果等步骤"))},' "帮我创建一个宠物写真场景" ')):y("",!0),"create"===it.value?(o(),n("div",{key:1,class:"suggestion-item",onClick:t[40]||(t[40]=e=>vt("创建一个职业形象照场景，需要性别选择、行业选择、着装风格、背景颜色等配置"))},' "创建一个职业形象照场景" ')):y("",!0),"modify"===it.value?(o(),n("div",{key:2,class:"suggestion-item",onClick:t[41]||(t[41]=e=>vt("添加一个新的背景颜色选项：渐变紫色"))},' "添加一个新的背景颜色选项" ')):y("",!0),"modify"===it.value?(o(),n("div",{key:3,class:"suggestion-item",onClick:t[42]||(t[42]=e=>vt("优化当前场景的Prompt模板，使生成效果更专业"))},' "优化Prompt模板" ')):y("",!0)])])):y("",!0),(o(!0),n(C,null,V(ct.value,(e,s)=>{var d,p,_,b,w,k,x;return o(),n("div",{key:s,class:v(["ai-message",e.role])},[i("div",qa,["user"===e.role?(o(),n("span",Ga,"👤")):(o(),n("span",Ja,"🤖"))]),i("div",Ka,[i("div",{class:"message-text",innerHTML:(x=e.content,x?x.replace(/\n/g,"<br>"):"")},null,8,Za),"assistant"===e.role&&e.generatedConfig?(o(),n("div",Qa,[i("div",en,[r(l,null,{default:c(()=>[r(h(E))]),_:1}),t[123]||(t[123]=i("span",null,"已生成场景配置",-1))]),i("div",tn,[i("div",null,"场景: "+u((null==(d=e.generatedConfig.scene)?void 0:d.name)||"未命名"),1),i("div",null,"步骤数: "+u((null==(p=e.generatedConfig.steps)?void 0:p.length)||0),1),(null==(_=e.generatedConfig.scene)?void 0:_.icon)?(o(),n("div",ln,[i("img",{src:e.generatedConfig.scene.icon,alt:"场景图标",style:{width:"40px",height:"40px","border-radius":"4px"}},null,8,an)])):y("",!0),e.imageTasksPending?(o(),n("div",nn,[i("div",on,[r(l,null,{default:c(()=>[r(h(S))]),_:1}),i("span",null,"需要生成 "+u((null==(b=e.imageTasks)?void 0:b.length)||0)+" 张图片",1)]),i("div",sn,[(o(!0),n(C,null,V(e.imageTasks,(e,t)=>(o(),n("div",{key:t,class:"task-item"},[r(l,null,{default:c(()=>[r(h(D))]),_:1}),i("span",null,u(e.label),1)]))),128))]),i("div",rn,[r(a,{type:"primary",size:"small",onClick:e=>ht(s)},{default:c(()=>{var t;return[g(" 确认生成（消耗 "+u((null==(t=e.imageTasks)?void 0:t.length)||0)+" 次调用） ",1)]}),_:2},1032,["onClick"]),r(a,{size:"small",onClick:e=>function(e){var t,l;const a=ct.value[e];a&&(a.imageTasksPending=!1,a.imageTasks=[],a.content="create"===it.value?`已为您生成「${(null==(t=a.generatedConfig.scene)?void 0:t.name)||"新场景"}」的完整配置，包含 ${(null==(l=a.generatedConfig.steps)?void 0:l.length)||0} 个步骤。已跳过图片生成，点击下方按钮可预览详情或直接应用。`:"已根据您的要求修改了场景配置。已跳过图片生成，点击下方按钮查看修改结果。",f.info("已跳过图片生成"),ft())}(s)},{default:c(()=>[...t[124]||(t[124]=[g(" 跳过图片生成 ",-1)])]),_:1},8,["onClick"])])])):y("",!0),e.generatingImages?(o(),n("div",cn,[i("div",dn,[r(l,{class:"is-loading"},{default:c(()=>[r(h(T))]),_:1}),i("span",null,"正在生成图标和示意图 ("+u((null==(w=e.imageProgress)?void 0:w.current)||0)+"/"+u((null==(k=e.imageProgress)?void 0:k.total)||0)+")",1)]),i("div",un,[(o(!0),n(C,null,V(e.imageTasks,(e,t)=>(o(),n("div",{key:t,class:v(["progress-task-item",e.status])},["completed"===e.status?(o(),m(l,{key:0},{default:c(()=>[r(h(I))]),_:1})):"processing"===e.status?(o(),m(l,{key:1,class:"is-loading"},{default:c(()=>[r(h(T))]),_:1})):(o(),m(l,{key:2},{default:c(()=>[r(h(P))]),_:1})),i("span",null,u(e.label),1)],2))),128))])])):y("",!0)]),i("div",pn,[r(a,{type:"primary",size:"small",onClick:t=>bt(e.generatedConfig),disabled:e.generatingImages||e.imageTasksPending},{default:c(()=>[...t[125]||(t[125]=[g(" 应用配置 ",-1)])]),_:1},8,["onClick","disabled"]),r(a,{size:"small",onClick:t=>{return l=e.generatedConfig,pt.value=l,void(ut.value=!0);var l}},{default:c(()=>[...t[126]||(t[126]=[g(" 预览详情 ",-1)])]),_:1},8,["onClick"])])])):y("",!0)])],2)}),128)),rt.value?(o(),n("div",mn,[...t[127]||(t[127]=[i("div",{class:"message-avatar"},"🤖",-1),i("div",{class:"message-content"},[i("div",{class:"message-loading"},[i("span"),i("span"),i("span")])],-1)])])):y("",!0)],512),[[O,"image"!==it.value]]),i("div",vn,[r(wt,{modelValue:st.value,"onUpdate:modelValue":t[43]||(t[43]=e=>st.value=e),type:"textarea",rows:3,placeholder:"create"===it.value?"描述您想创建的场景...":"描述您想修改的内容...",onKeydown:A(w(_t,["ctrl"]),["enter"]),disabled:rt.value},null,8,["modelValue","placeholder","onKeydown","disabled"]),i("div",fn,[t[129]||(t[129]=i("span",{class:"input-hint"},"Ctrl + Enter 发送",-1)),r(a,{type:"primary",onClick:_t,loading:rt.value,disabled:!st.value.trim()},{default:c(()=>[...t[128]||(t[128]=[g(" 发送 ",-1)])]),_:1},8,["loading","disabled"])])])])]),_:1},8,["modelValue"]),r(Mt,{modelValue:ut.value,"onUpdate:modelValue":t[47]||(t[47]=e=>ut.value=e),title:"AI 生成配置预览",width:"80%",style:{"max-width":"900px"},"append-to-body":""},{footer:c(()=>[r(a,{onClick:t[45]||(t[45]=e=>ut.value=!1)},{default:c(()=>[...t[131]||(t[131]=[g("关闭",-1)])]),_:1}),r(a,{type:"primary",onClick:t[46]||(t[46]=e=>{bt(pt.value),ut.value=!1})},{default:c(()=>[...t[132]||(t[132]=[g(" 应用此配置 ",-1)])]),_:1})]),default:c(()=>[pt.value?(o(),n("div",gn,[r(Ut,null,{default:c(()=>{var e;return[r(Pt,{label:"场景信息"},{default:c(()=>[r(Lt,{column:2,border:""},{default:c(()=>[r($t,{label:"场景ID"},{default:c(()=>{var e;return[g(u(null==(e=pt.value.scene)?void 0:e.scene_key),1)]}),_:1}),r($t,{label:"场景名称"},{default:c(()=>{var e;return[g(u(null==(e=pt.value.scene)?void 0:e.name),1)]}),_:1}),r($t,{label:"英文名称"},{default:c(()=>{var e;return[g(u(null==(e=pt.value.scene)?void 0:e.name_en),1)]}),_:1}),r($t,{label:"消耗醒币"},{default:c(()=>{var e;return[g(u(null==(e=pt.value.scene)?void 0:e.points_cost),1)]}),_:1}),r($t,{label:"场景图标"},{default:c(()=>{var e;return[(null==(e=pt.value.scene)?void 0:e.icon)?(o(),n("img",{key:0,src:pt.value.scene.icon,alt:"场景图标",style:{width:"60px",height:"60px","border-radius":"8px","object-fit":"cover"}},null,8,hn)):(o(),n("span",_n,"暂无图标"))]}),_:1}),r($t,{label:"图标描述"},{default:c(()=>{var e;return[g(u((null==(e=pt.value.scene)?void 0:e.icon_description)||"无"),1)]}),_:1}),r($t,{label:"中文描述",span:2},{default:c(()=>{var e;return[g(u(null==(e=pt.value.scene)?void 0:e.description),1)]}),_:1}),r($t,{label:"英文描述",span:2},{default:c(()=>{var e;return[g(u(null==(e=pt.value.scene)?void 0:e.description_en),1)]}),_:1})]),_:1})]),_:1}),r(Pt,{label:`步骤配置 (${(null==(e=pt.value.steps)?void 0:e.length)||0})`},{default:c(()=>[(o(!0),n(C,null,V(pt.value.steps,(e,t)=>{var a;return o(),n("div",{key:t,class:"preview-step-card"},[i("div",bn,[i("span",yn,u(t+1),1),i("span",wn,u(e.title)+" ("+u(e.step_key)+")",1),r(Ot,{size:"small"},{default:c(()=>[g(u(e.component_type),1)]),_:2},1024)]),(null==(a=e.options)?void 0:a.length)?(o(),n("div",kn,[i("div",Cn,[(o(!0),n(C,null,V(e.options,e=>(o(),n("div",{key:e.option_key,class:"option-item"},[e.image?(o(),n("img",{key:0,src:e.image,alt:e.label,class:"option-preview-image"},null,8,Vn)):(o(),n("div",xn,[r(l,null,{default:c(()=>[r(h(S))]),_:1})])),i("div",En,u(e.label),1)]))),128))])])):y("",!0)])}),128))]),_:1},8,["label"]),r(Pt,{label:"Prompt模板"},{default:c(()=>{var e,l,a;return[i("div",Sn,[t[130]||(t[130]=i("div",{class:"prompt-label"},"正向提示词:",-1)),i("pre",null,u(null==(e=pt.value.prompt_template)?void 0:e.template),1),(null==(l=pt.value.prompt_template)?void 0:l.negative_prompt)?(o(),n("div",Dn,"负面提示词:")):y("",!0),(null==(a=pt.value.prompt_template)?void 0:a.negative_prompt)?(o(),n("pre",Tn,u(pt.value.prompt_template.negative_prompt),1)):y("",!0)])]}),_:1})]}),_:1})])):y("",!0)]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-5f75e6c0"]]);export{In as default};
