# 场景配置中台系统 软件说明书

## 一、软件基本信息

- **软件全称**：场景配置中台系统软件
- **软件简称**：场景配置中台
- **版本号**：V1.0
- **开发完成日期**：2026年1月
- **软件分类**：应用软件/配置管理系统
- **运行平台**：Linux服务器
- **开发语言**：JavaScript (Node.js)
- **软件规模**：约8000行代码

---

## 二、软件概述

### 2.1 软件背景

在AI图片生成应用中，场景配置是核心业务逻辑的载体。不同的场景需要不同的交互步骤、参数选项和AI提示词模板。本系统提供灵活的场景配置能力，支持运营人员通过可视化界面动态配置场景，无需开发人员介入即可上线新场景。

### 2.2 软件目的

本软件的主要目的是：
1. 提供场景的动态配置和管理能力
2. 支持多步骤、多选项的复杂场景配置
3. 实现AI提示词模板的可视化编辑
4. 支持多语言场景配置

### 2.3 软件功能概述

本软件主要包含以下功能模块：
- 场景管理模块
- 步骤配置模块
- 选项配置模块
- 提示词模板模块
- 多语言配置模块
- 配置发布模块

---

## 三、运行环境

### 3.1 硬件环境

- **服务器**：Linux服务器（推荐配置：2核CPU、4GB内存）
- **存储**：SSD硬盘，至少20GB可用空间

### 3.2 软件环境

- **操作系统**：Linux (Ubuntu 20.04+/CentOS 7+)
- **运行时**：Node.js 18.x
- **数据库**：SQLite 3.x

---

## 四、功能详细说明

### 4.1 场景管理模块

#### 4.1.1 场景列表

管理所有配置的场景：

**场景属性**：
| 属性 | 说明 |
|-----|------|
| scene_key | 场景唯一标识 |
| name | 场景名称 |
| name_en | 英文名称 |
| description | 场景描述 |
| icon | 场景图标 |
| status | 状态（active/inactive/coming_soon） |
| points_cost | 消费积分 |
| sort_order | 排序权重 |

#### 4.1.2 场景创建

创建新的场景配置：
- 填写基本信息
- 设置场景图标
- 配置消费积分
- 设置上线状态

#### 4.1.3 场景编辑

编辑已有场景的配置：
- 修改基本信息
- 调整步骤配置
- 更新提示词模板
- 切换上线状态

#### 4.1.4 场景状态管理

管理场景的上线状态：
- **active**：已上线，用户可见可用
- **inactive**：已下线，用户不可见
- **coming_soon**：即将上线，用户可见但不可用

### 4.2 步骤配置模块

#### 4.2.1 步骤定义

定义场景的交互步骤：

**步骤属性**：
| 属性 | 说明 |
|-----|------|
| step_key | 步骤唯一标识 |
| title | 步骤标题 |
| title_en | 英文标题 |
| component_type | 组件类型 |
| sort_order | 步骤顺序 |
| is_visible | 是否可见 |
| is_required | 是否必填 |
| depends_on | 依赖条件 |

#### 4.2.2 组件类型

支持多种交互组件类型：

| 组件类型 | 说明 | 适用场景 |
|---------|------|---------|
| gender_select | 性别选择 | 证件照场景 |
| single_select | 单选 | 风格选择 |
| multi_select | 多选 | 特效叠加 |
| image_tags | 图片标签选择 | 模板选择 |
| color_picker | 颜色选择 | 背景色选择 |
| slider | 滑块 | 参数调节 |
| image_upload | 图片上传 | 用户照片 |

#### 4.2.3 步骤依赖

配置步骤间的依赖关系：
- 依赖步骤（depends_on.step）
- 过滤字段（depends_on.filter_field）
- 条件值（depends_on.filter_value）

**示例**：发型选项依赖性别选择，男性显示男性发型，女性显示女性发型。

#### 4.2.4 步骤排序

支持拖拽调整步骤顺序：
- 可视化排序
- 自动更新sort_order
- 实时预览效果

### 4.3 选项配置模块

#### 4.3.1 选项定义

为每个步骤配置可选项：

**选项属性**：
| 属性 | 说明 |
|-----|------|
| option_key | 选项唯一标识 |
| label | 选项显示名称 |
| label_en | 英文名称 |
| prompt_text | 提示词文本 |
| image | 选项图片（可选） |
| color | 选项颜色（可选） |
| is_default | 是否默认选中 |
| metadata | 扩展元数据 |

#### 4.3.2 选项分组

支持选项的分组管理：
- 按类别分组
- 按条件过滤
- 动态显示/隐藏

#### 4.3.3 选项图片

为选项配置预览图片：
- 图片上传
- CDN存储
- 缩略图生成

### 4.4 提示词模板模块

#### 4.4.1 模板定义

定义AI生成的提示词模板：

**模板语法**：
```
生成一张{{gender}}的证件照，
背景颜色为{{bgColor}}，
发型为{{hairStyle}}，
着装为{{clothing}}。
```

#### 4.4.2 变量替换

支持模板变量的动态替换：
- `{{变量名}}`：替换为用户选择的值
- 支持嵌套变量
- 支持条件变量

#### 4.4.3 模板预览

实时预览模板效果：
- 选择测试参数
- 生成预览提示词
- 验证模板正确性

#### 4.4.4 多模板支持

支持一个场景配置多个模板：
- 主模板
- 备用模板
- A/B测试模板

### 4.5 多语言配置模块

#### 4.5.1 语言支持

支持多语言配置：
- 简体中文（zh-CN）
- 英文（en）
- 可扩展其他语言

#### 4.5.2 翻译字段

需要翻译的字段：
- 场景名称和描述
- 步骤标题
- 选项名称
- 提示词模板

#### 4.5.3 语言切换

根据客户端语言返回对应配置：
- 自动检测语言
- 降级到默认语言
- 缓存优化

### 4.6 配置发布模块

#### 4.6.1 配置版本

管理配置的版本：
- 版本号自动递增
- 版本历史记录
- 版本回滚

#### 4.6.2 配置缓存

配置数据的缓存策略：
- 内存缓存
- 缓存过期时间
- 主动刷新机制

#### 4.6.3 配置同步

配置变更的同步机制：
- 实时生效
- 客户端拉取
- 增量更新

---

## 五、系统架构

### 5.1 整体架构

```
┌─────────────────────────────────────────┐
│           场景配置中台系统               │
│  ┌─────────────────────────────────┐   │
│  │         API层                    │   │
│  │  场景API | 步骤API | 选项API     │   │
│  └─────────────────────────────────┘   │
│  ┌─────────────────────────────────┐   │
│  │        业务逻辑层                │   │
│  │  场景管理 | 步骤管理 | 模板引擎   │   │
│  └─────────────────────────────────┘   │
│  ┌─────────────────────────────────┐   │
│  │        缓存层                    │   │
│  │  配置缓存 | 版本缓存             │   │
│  └─────────────────────────────────┘   │
│  ┌─────────────────────────────────┐   │
│  │        数据层                    │   │
│  │  scenes | scene_steps | step_options │
│  └─────────────────────────────────┘   │
└─────────────────────────────────────────┘
```

### 5.2 数据模型

```
scenes (场景表)
├── scene_steps (步骤表)
│   └── step_options (选项表)
└── prompt_templates (模板表)
```

---

## 六、API接口说明

### 6.1 获取场景列表

**接口地址**：GET /api/config/scenes

**请求参数**：
```
lang: 语言代码（zh-CN/en）
status: 状态筛选（可选）
```

**响应参数**：
```json
{
  "code": 200,
  "data": {
    "scenes": [
      {
        "scene_key": "idphoto",
        "name": "证件照",
        "name_en": "ID Photo",
        "description": "AI智能证件照生成",
        "icon": "https://cdn.example.com/idphoto.png",
        "status": "active",
        "points_cost": 50
      }
    ]
  }
}
```

### 6.2 获取场景详情

**接口地址**：GET /api/config/scenes/:sceneKey

**请求参数**：
```
lang: 语言代码
```

**响应参数**：
```json
{
  "code": 200,
  "data": {
    "scene_key": "idphoto",
    "name": "证件照",
    "steps": [
      {
        "step_key": "gender",
        "title": "选择性别",
        "component_type": "gender_select",
        "options": [
          {"id": "male", "label": "男"},
          {"id": "female", "label": "女"}
        ]
      }
    ],
    "promptTemplate": "生成{{gender}}证件照..."
  }
}
```

### 6.3 保存场景配置

**接口地址**：POST /api/admin/scenes

**请求参数**：
```json
{
  "scene_key": "newscene",
  "name": "新场景",
  "name_en": "New Scene",
  "description": "场景描述",
  "points_cost": 100,
  "status": "inactive",
  "steps": [...],
  "promptTemplate": "..."
}
```

### 6.4 更新场景状态

**接口地址**：PUT /api/admin/scenes/:sceneKey/status

**请求参数**：
```json
{
  "status": "active"
}
```

---

## 七、数据流程

### 7.1 配置加载流程

```
客户端请求配置 → 检查缓存 → 缓存命中返回
     ↓
缓存未命中 → 查询数据库 → 组装配置数据
     ↓
写入缓存 → 返回客户端
```

### 7.2 配置更新流程

```
管理员修改配置 → 验证配置 → 保存数据库
     ↓
清除缓存 → 版本号递增 → 通知客户端
```

---

## 八、配置示例

### 8.1 证件照场景配置

```json
{
  "scene_key": "idphoto",
  "name": "AI证件照",
  "name_en": "AI ID Photo",
  "points_cost": 50,
  "steps": [
    {
      "step_key": "gender",
      "title": "选择性别",
      "component_type": "gender_select",
      "is_required": true
    },
    {
      "step_key": "bgColor",
      "title": "背景颜色",
      "component_type": "color_picker",
      "options": [
        {"id": "blue", "label": "蓝色", "color": "#438EDB"},
        {"id": "white", "label": "白色", "color": "#FFFFFF"},
        {"id": "red", "label": "红色", "color": "#FF0000"}
      ]
    },
    {
      "step_key": "upload",
      "title": "上传照片",
      "component_type": "image_upload",
      "is_required": true
    }
  ],
  "promptTemplate": "生成一张{{gender}}的标准证件照，背景颜色为{{bgColor}}，正面免冠，表情自然。"
}
```

---

## 九、著作权声明

本软件由开发者独立开发完成，拥有完整的知识产权。软件中使用的所有代码均为原创开发，未使用任何侵犯他人知识产权的内容。

---

**文档编写日期**：2026年1月
**文档版本**：V1.0
