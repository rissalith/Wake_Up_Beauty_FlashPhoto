import{r as e,a,i as l,c as t,o as s,e as r,w as o,f as n,E as d,I as c,d as i,t as u,h as p,G as v,H as _,j as f,a8 as g,J as m,O as w,l as h}from"./index-zvIQdR65.js";import{_ as b,c as y}from"./_plugin-vue_export-helper-D822DtMY.js";const k={class:"creator-scenes-page"},C={class:"stat-content"},z={class:"stat-value"},V={class:"stat-content"},j={class:"stat-value"},x={class:"stat-content"},S={class:"stat-value"},U={class:"stat-content"},$={class:"stat-value"},P={class:"scene-info"},I={class:"image-placeholder"},q={class:"scene-detail"},D={class:"scene-name"},E={class:"scene-desc"},G={class:"creator-info"},H={class:"creator-name"},J={class:"points-cost"},L={class:"pagination-wrap"},N={key:0,class:"detail-content"},O={class:"section-title"},A=b({__name:"CreatorScenes",setup(b){const A=e({pending:0,approved:0,rejected:0,draft:0,total:0}),B=a({status:"pending"}),F=a({page:1,pageSize:20,total:0}),K=e(!1),M=e([]),Q=e(null),R=e(!1),T=e(!1),W=e(""),X=e(!1),Y=e(null),Z=async()=>{try{const e=await y.get("/admin/creator-scenes/stats/overview");0===e.code&&(A.value=e.data)}catch(e){console.error("加载统计失败:",e)}},ee=async()=>{K.value=!0;try{const e=await y.get("/admin/creator-scenes/pending",{params:{status:B.status,page:F.page,pageSize:F.pageSize}});0===e.code&&(M.value=e.data.list,F.total=e.data.total)}catch(e){console.error("加载场景列表失败:",e),d.error("加载失败")}finally{K.value=!1}},ae=async()=>{if(W.value.trim()){X.value=!0;try{const e=await y.post(`/admin/creator-scenes/${Y.value.id}/reject`,{reason:W.value});0===e.code?(d.success("已拒绝"),T.value=!1,ee(),Z()):d.error(e.message||"操作失败")}catch(e){console.error("拒绝失败:",e),d.error("操作失败")}finally{X.value=!1}}else d.warning("请输入拒绝原因")},le=e=>({draft:"info",pending:"warning",approved:"success",rejected:"danger"}[e]||"info"),te=e=>({draft:"草稿",pending:"待审核",approved:"已通过",rejected:"已拒绝"}[e]||e);return l(()=>{Z(),ee()}),(e,a)=>{const l=n("el-card"),b=n("el-col"),se=n("el-row"),re=n("el-option"),oe=n("el-select"),ne=n("el-form-item"),de=n("el-button"),ce=n("el-form"),ie=n("el-icon"),ue=n("el-image"),pe=n("el-table-column"),ve=n("el-avatar"),_e=n("el-tag"),fe=n("el-table"),ge=n("el-pagination"),me=n("el-descriptions-item"),we=n("el-descriptions"),he=n("el-input"),be=n("el-dialog"),ye=c("loading");return s(),t("div",k,[r(se,{gutter:20,class:"stats-row"},{default:o(()=>[r(b,{span:6},{default:o(()=>[r(l,{shadow:"hover",class:"stat-card pending"},{default:o(()=>[i("div",C,[i("div",z,u(A.value.pending),1),a[7]||(a[7]=i("div",{class:"stat-label"},"待审核",-1))])]),_:1})]),_:1}),r(b,{span:6},{default:o(()=>[r(l,{shadow:"hover",class:"stat-card approved"},{default:o(()=>[i("div",V,[i("div",j,u(A.value.approved),1),a[8]||(a[8]=i("div",{class:"stat-label"},"已通过",-1))])]),_:1})]),_:1}),r(b,{span:6},{default:o(()=>[r(l,{shadow:"hover",class:"stat-card rejected"},{default:o(()=>[i("div",x,[i("div",S,u(A.value.rejected),1),a[9]||(a[9]=i("div",{class:"stat-label"},"已拒绝",-1))])]),_:1})]),_:1}),r(b,{span:6},{default:o(()=>[r(l,{shadow:"hover",class:"stat-card total"},{default:o(()=>[i("div",U,[i("div",$,u(A.value.total),1),a[10]||(a[10]=i("div",{class:"stat-label"},"总数",-1))])]),_:1})]),_:1})]),_:1}),r(l,{class:"filter-card"},{default:o(()=>[r(ce,{inline:!0},{default:o(()=>[r(ne,{label:"状态"},{default:o(()=>[r(oe,{modelValue:B.status,"onUpdate:modelValue":a[0]||(a[0]=e=>B.status=e),placeholder:"全部",clearable:"",onChange:ee},{default:o(()=>[r(re,{label:"全部",value:"all"}),r(re,{label:"待审核",value:"pending"}),r(re,{label:"已通过",value:"approved"}),r(re,{label:"已拒绝",value:"rejected"}),r(re,{label:"草稿",value:"draft"})]),_:1},8,["modelValue"])]),_:1}),r(ne,null,{default:o(()=>[r(de,{type:"primary",onClick:ee},{default:o(()=>[...a[11]||(a[11]=[p("刷新",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),r(l,{class:"table-card"},{default:o(()=>[v((s(),_(fe,{data:M.value,stripe:""},{default:o(()=>[r(pe,{label:"场景","min-width":"200"},{default:o(({row:e})=>[i("div",P,[r(ue,{src:e.icon,class:"scene-icon",fit:"cover","preview-src-list":[e.icon]},{error:o(()=>[i("div",I,[r(ie,null,{default:o(()=>[r(f(g))]),_:1})])]),_:1},8,["src","preview-src-list"]),i("div",q,[i("div",D,u(e.name),1),i("div",E,u(e.description||"暂无描述"),1)])])]),_:1}),r(pe,{label:"创作者",width:"150"},{default:o(({row:e})=>[i("div",G,[r(ve,{src:e.creator_avatar,size:32},null,8,["src"]),i("span",H,u(e.creator_pen_name||e.creator_nickname||"未知"),1)])]),_:1}),r(pe,{label:"消耗",width:"100",align:"center"},{default:o(({row:e})=>[i("span",J,u(e.points_cost)+"醒币",1)]),_:1}),r(pe,{label:"步骤数",width:"80",align:"center"},{default:o(({row:e})=>[p(u(e.step_count||0),1)]),_:1}),r(pe,{label:"状态",width:"100",align:"center"},{default:o(({row:e})=>[r(_e,{type:le(e.review_status)},{default:o(()=>[p(u(te(e.review_status)),1)]),_:2},1032,["type"])]),_:1}),r(pe,{label:"提交时间",width:"160"},{default:o(({row:e})=>{return[p(u((a=e.submitted_at,a?new Date(a).toLocaleString("zh-CN"):"-")),1)];var a}),_:1}),r(pe,{label:"操作",width:"200",fixed:"right"},{default:o(({row:e})=>[r(de,{type:"primary",link:"",onClick:a=>(async e=>{try{const a=await y.get(`/admin/creator-scenes/${e.id}`);0===a.code&&(Q.value=a.data,R.value=!0)}catch(a){console.error("加载详情失败:",a),d.error("加载详情失败")}})(e)},{default:o(()=>[...a[12]||(a[12]=[p("查看",-1)])]),_:1},8,["onClick"]),"pending"===e.review_status?(s(),t(w,{key:0},[r(de,{type:"success",link:"",onClick:a=>(async e=>{try{await h.confirm("确定要通过该场景的审核吗？","确认通过",{type:"success"});const a=await y.post(`/admin/creator-scenes/${e.id}/approve`);0===a.code?(d.success("审核通过"),ee(),Z()):d.error(a.message||"操作失败")}catch(a){"cancel"!==a&&(console.error("审核通过失败:",a),d.error("操作失败"))}})(e)},{default:o(()=>[...a[13]||(a[13]=[p("通过",-1)])]),_:1},8,["onClick"]),r(de,{type:"danger",link:"",onClick:a=>(e=>{Y.value=e,W.value="",T.value=!0})(e)},{default:o(()=>[...a[14]||(a[14]=[p("拒绝",-1)])]),_:1},8,["onClick"])],64)):m("",!0),"approved"===e.review_status?(s(),_(de,{key:1,type:"warning",link:"",onClick:a=>(async e=>{try{const{value:a}=await h.prompt("请输入下架原因","下架场景",{inputPlaceholder:"可选",type:"warning"}),l=await y.post(`/admin/creator-scenes/${e.id}/offline`,{reason:a||"管理员下架"});0===l.code?(d.success("已下架"),ee(),Z()):d.error(l.message||"操作失败")}catch(a){"cancel"!==a&&(console.error("下架失败:",a),d.error("操作失败"))}})(e)},{default:o(()=>[...a[15]||(a[15]=[p("下架",-1)])]),_:1},8,["onClick"])):m("",!0)]),_:1})]),_:1},8,["data"])),[[ye,K.value]]),i("div",L,[r(ge,{"current-page":F.page,"onUpdate:currentPage":a[1]||(a[1]=e=>F.page=e),"page-size":F.pageSize,"onUpdate:pageSize":a[2]||(a[2]=e=>F.pageSize=e),total:F.total,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",onSizeChange:ee,onCurrentChange:ee},null,8,["current-page","page-size","total"])])]),_:1}),r(be,{modelValue:R.value,"onUpdate:modelValue":a[3]||(a[3]=e=>R.value=e),title:"场景详情",width:"800px"},{default:o(()=>{var e,l,n;return[Q.value?(s(),t("div",N,[r(we,{column:2,border:""},{default:o(()=>[r(me,{label:"场景名称"},{default:o(()=>[p(u(Q.value.name),1)]),_:1}),r(me,{label:"消耗醒币"},{default:o(()=>[p(u(Q.value.points_cost),1)]),_:1}),r(me,{label:"创作者"},{default:o(()=>[p(u(Q.value.creator_pen_name||Q.value.creator_nickname),1)]),_:1}),r(me,{label:"状态"},{default:o(()=>[r(_e,{type:le(Q.value.review_status)},{default:o(()=>[p(u(te(Q.value.review_status)),1)]),_:1},8,["type"])]),_:1}),r(me,{label:"描述",span:2},{default:o(()=>[p(u(Q.value.description||"暂无"),1)]),_:1})]),_:1}),i("div",O,"步骤配置 ("+u((null==(e=Q.value.steps)?void 0:e.length)||0)+"步)",1),r(fe,{data:Q.value.steps,size:"small",border:""},{default:o(()=>[r(pe,{prop:"step_order",label:"序号",width:"60"}),r(pe,{prop:"title",label:"标题"}),r(pe,{prop:"step_type",label:"类型",width:"120"}),r(pe,{label:"选项数",width:"80"},{default:o(({row:e})=>{var a;return[p(u((null==(a=e.options)?void 0:a.length)||0),1)]}),_:1})]),_:1},8,["data"]),a[16]||(a[16]=i("div",{class:"section-title"},"Prompt模板",-1)),r(he,{type:"textarea",rows:4,value:(null==(n=null==(l=Q.value.prompts)?void 0:l[0])?void 0:n.prompt_template)||"未配置",readonly:""},null,8,["value"])])):m("",!0)]}),_:1},8,["modelValue"]),r(be,{modelValue:T.value,"onUpdate:modelValue":a[6]||(a[6]=e=>T.value=e),title:"拒绝原因",width:"500px"},{footer:o(()=>[r(de,{onClick:a[5]||(a[5]=e=>T.value=!1)},{default:o(()=>[...a[17]||(a[17]=[p("取消",-1)])]),_:1}),r(de,{type:"danger",onClick:ae,loading:X.value},{default:o(()=>[...a[18]||(a[18]=[p("确认拒绝",-1)])]),_:1},8,["loading"])]),default:o(()=>[r(ce,null,{default:o(()=>[r(ne,{label:"拒绝原因",required:""},{default:o(()=>[r(he,{modelValue:W.value,"onUpdate:modelValue":a[4]||(a[4]=e=>W.value=e),type:"textarea",rows:4,placeholder:"请输入拒绝原因，将展示给创作者"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-8e1eb340"]]);export{A as default};
