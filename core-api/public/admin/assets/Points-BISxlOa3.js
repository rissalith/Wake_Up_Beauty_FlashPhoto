import{F as a,r as e,a as l,i as t,c as s,o as i,d,G as o,e as r,w as u,f as n,t as c,I as p,H as v,j as m,R as _,S as f,L as w,h,T as b,E as y}from"./index-CloVKrZX.js";import{u as g,t as V}from"./timezone-BcjbeZGR.js";import{_ as k,b as x}from"./_plugin-vue_export-helper-DZWByd4S.js";const z={class:"points-page"},I={class:"stats-row"},U={class:"stat-card"},j={class:"stat-icon recharge"},C={class:"stat-info"},R={class:"stat-value"},S={class:"stat-card"},W={class:"stat-icon granted"},D={class:"stat-info"},Y={class:"stat-value"},H={class:"stat-card"},P={class:"stat-icon consumed"},G={class:"stat-info"},M={class:"stat-value"},A={class:"config-row"},E={class:"page-card flex-1"},F={key:0},L={key:1},O={class:"page-card flex-1"},T={class:"page-card records-card"},q={class:"card-header"},B={class:"filter-bar"},J={class:"table-wrapper"},K={class:"user-cell"},N={key:1,class:"mini-avatar"},Q={class:"user-info"},X={class:"nickname"},Z={class:"user-id"},$={class:"pagination-wrap"},aa=k({__name:"Points",setup(k){a.extend(g),a.extend(V);const aa=e({}),ea=e(!1),la=e([]),ta=e(!1),sa=e([]),ia=e(!1),da=e(!1),oa=l({type:"",points:0,description:"",is_active:1}),ra=e(!1),ua=e([]),na=e(1),ca=e(20),pa=e(0),va=l({userId:"",type:""}),ma=a=>({new_user:"新用户注册",daily_login:"每日登录",share_image:"分享图片",share_photo:"分享照片",invite_friend:"邀请好友",invite_reward:"被邀请奖励",recharge:"充值",consume:"消费",admin_adjust:"系统调整",reward:"打赏奖励",feedback_reward:"反馈奖励",refund:"退款","打赏":"打赏奖励"}[a]||a),_a=async()=>{ta.value=!0;try{const a=await x.getRewards();200!==a.code&&0!==a.code||(sa.value=a.data)}finally{ta.value=!1}},fa=async()=>{ra.value=!0;try{const a={page:na.value,pageSize:ca.value,userId:va.userId,type:va.type},e=await x.getRecords(a);200!==e.code&&0!==e.code||(ua.value=e.data.list,pa.value=e.data.total)}finally{ra.value=!1}},wa=async()=>{da.value=!0;try{const a=await x.updateReward(oa.type,oa);200!==a.code&&0!==a.code||(y.success("更新成功"),ia.value=!1,_a())}finally{da.value=!1}};return t(()=>{(async()=>{try{const a=await x.getStats();200!==a.code&&0!==a.code||(aa.value=a.data)}catch(a){console.error(a)}})(),(async()=>{ea.value=!0;try{const a=await x.getPackages();200!==a.code&&0!==a.code||(la.value=a.data)}finally{ea.value=!1}})(),_a(),fa()}),(e,l)=>{const t=n("el-icon"),y=n("el-table-column"),g=n("el-tag"),V=n("el-table"),k=n("el-button"),x=n("el-input"),_a=n("el-option"),ha=n("el-select"),ba=n("el-avatar"),ya=n("el-pagination"),ga=n("el-form-item"),Va=n("el-input-number"),ka=n("el-switch"),xa=n("el-form"),za=n("el-dialog"),Ia=p("loading"),Ua=p("dialog-drag");return i(),s("div",z,[d("div",I,[d("div",U,[d("div",j,[r(t,null,{default:u(()=>[r(m(_))]),_:1})]),d("div",C,[l[9]||(l[9]=d("div",{class:"stat-label"},"总充值金额",-1)),d("div",R,"¥"+c(aa.value.totalRecharge||0),1)])]),d("div",S,[d("div",W,[r(t,null,{default:u(()=>[r(m(f))]),_:1})]),d("div",D,[l[10]||(l[10]=d("div",{class:"stat-label"},"总发放醒币",-1)),d("div",Y,c(aa.value.totalGranted||0),1)])]),d("div",H,[d("div",P,[r(t,null,{default:u(()=>[r(m(w))]),_:1})]),d("div",G,[l[11]||(l[11]=d("div",{class:"stat-label"},"总消费醒币",-1)),d("div",M,c(aa.value.totalConsumed||0),1)])])]),d("div",A,[d("div",E,[l[12]||(l[12]=d("div",{class:"card-header"},[d("span",{class:"card-title"},"充值套餐列表")],-1)),o((i(),v(V,{data:la.value,style:{width:"100%"}},{default:u(()=>[r(y,{prop:"amount",label:"金额","min-width":"100"},{default:u(({row:a})=>[h("¥"+c(a.amount),1)]),_:1}),r(y,{prop:"points",label:"醒币","min-width":"100"},{default:u(({row:a})=>[h(c(a.points),1)]),_:1}),r(y,{prop:"bonus_points",label:"赠送","min-width":"100"},{default:u(({row:a})=>[a.bonus_points?(i(),s("span",F,"+"+c(a.bonus_points),1)):(i(),s("span",L,"-"))]),_:1}),r(y,{prop:"is_active",label:"状态","min-width":"100"},{default:u(({row:a})=>[r(g,{type:a.is_active?"success":"info",size:"small"},{default:u(()=>[h(c(a.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),r(y,{prop:"sort_order",label:"排序","min-width":"80"})]),_:1},8,["data"])),[[Ia,ea.value]])]),d("div",O,[l[14]||(l[14]=d("div",{class:"card-header"},[d("span",{class:"card-title"},"奖励配置")],-1)),o((i(),v(V,{data:sa.value,style:{width:"100%"}},{default:u(()=>[r(y,{prop:"name",label:"类型","min-width":"100"}),r(y,{prop:"points",label:"奖励","min-width":"80"}),r(y,{prop:"description",label:"描述","min-width":"150","show-overflow-tooltip":""}),r(y,{prop:"is_active",label:"状态","min-width":"80"},{default:u(({row:a})=>[r(g,{type:a.is_active?"success":"info",size:"small"},{default:u(()=>[h(c(a.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),r(y,{label:"操作",width:"80",fixed:"right"},{default:u(({row:a})=>[r(k,{type:"primary",link:"",onClick:e=>{return l=a,Object.assign(oa,l),void(ia.value=!0);var l}},{default:u(()=>[...l[13]||(l[13]=[h("编辑",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Ia,ta.value]])])]),d("div",T,[d("div",q,[l[16]||(l[16]=d("span",{class:"card-title"},"醒币记录",-1)),d("div",B,[r(x,{modelValue:va.userId,"onUpdate:modelValue":l[0]||(l[0]=a=>va.userId=a),placeholder:"用户ID",style:{width:"180px"},clearable:""},null,8,["modelValue"]),r(ha,{modelValue:va.type,"onUpdate:modelValue":l[1]||(l[1]=a=>va.type=a),placeholder:"类型",clearable:"",style:{width:"140px"}},{default:u(()=>[r(_a,{label:"新用户",value:"new_user"}),r(_a,{label:"分享",value:"share_image"}),r(_a,{label:"邀请",value:"invite_friend"}),r(_a,{label:"充值",value:"recharge"}),r(_a,{label:"消费",value:"consume"}),r(_a,{label:"调整",value:"admin_adjust"})]),_:1},8,["modelValue"]),r(k,{type:"primary",onClick:fa},{default:u(()=>[...l[15]||(l[15]=[h("搜索",-1)])]),_:1})])]),d("div",J,[o((i(),v(V,{data:ua.value,style:{width:"100%"}},{default:u(()=>[r(y,{prop:"record_id",label:"记录ID",width:"180","show-overflow-tooltip":""}),r(y,{label:"用户",width:"200"},{default:u(({row:a})=>{return[d("div",K,[(e=a.avatar_url,!e||"string"!=typeof e||e.startsWith("wxfile://")||e.startsWith("http://tmp")||e.startsWith("https://tmp")||!e.startsWith("http://")&&!e.startsWith("https://")?(i(),s("div",N,c((a.nickname||"用")[0]),1)):(i(),v(ba,{key:0,src:a.avatar_url,size:28},{default:u(()=>[d("span",null,c((a.nickname||"用")[0]),1)]),_:2},1032,["src"]))),d("div",Q,[d("div",X,c(a.nickname||"未知用户"),1),d("div",Z,c(a.user_id),1)])])];var e}),_:1}),r(y,{prop:"type",label:"类型",width:"100"},{default:u(({row:a})=>[r(g,{size:"small"},{default:u(()=>[h(c(ma(a.type)),1)]),_:2},1024)]),_:1}),r(y,{prop:"amount",label:"变动",width:"100"},{default:u(({row:a})=>[d("span",{style:b({color:a.amount>0?"#67c23a":"#f56c6c"})},c(a.amount>0?"+":"")+c(a.amount),5)]),_:1}),r(y,{prop:"balance",label:"余额",width:"100"}),r(y,{prop:"description",label:"描述","min-width":"150"}),r(y,{prop:"created_at",label:"时间",width:"160"},{default:u(({row:e})=>{return[h(c((l=e.created_at,l?a.utc(l).tz("Asia/Shanghai").format("YYYY-MM-DD HH:mm"):"-")),1)];var l}),_:1})]),_:1},8,["data"])),[[Ia,ra.value]])]),d("div",$,[r(ya,{"current-page":na.value,"onUpdate:currentPage":l[2]||(l[2]=a=>na.value=a),"page-size":ca.value,"onUpdate:pageSize":l[3]||(l[3]=a=>ca.value=a),total:pa.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",onChange:fa},null,8,["current-page","page-size","total"])])]),o((i(),v(za,{modelValue:ia.value,"onUpdate:modelValue":l[8]||(l[8]=a=>ia.value=a),title:"编辑奖励配置",width:"500px"},{footer:u(()=>[r(k,{onClick:l[7]||(l[7]=a=>ia.value=!1)},{default:u(()=>[...l[17]||(l[17]=[h("取消",-1)])]),_:1}),r(k,{type:"primary",onClick:wa,loading:da.value},{default:u(()=>[...l[18]||(l[18]=[h("保存",-1)])]),_:1},8,["loading"])]),default:u(()=>[r(xa,{model:oa,"label-width":"100px"},{default:u(()=>[r(ga,{label:"类型"},{default:u(()=>[r(x,{value:ma(oa.type),disabled:""},null,8,["value"])]),_:1}),r(ga,{label:"奖励醒币"},{default:u(()=>[r(Va,{modelValue:oa.points,"onUpdate:modelValue":l[4]||(l[4]=a=>oa.points=a),min:0},null,8,["modelValue"])]),_:1}),r(ga,{label:"描述"},{default:u(()=>[r(x,{modelValue:oa.description,"onUpdate:modelValue":l[5]||(l[5]=a=>oa.description=a)},null,8,["modelValue"])]),_:1}),r(ga,{label:"状态"},{default:u(()=>[r(ka,{modelValue:oa.is_active,"onUpdate:modelValue":l[6]||(l[6]=a=>oa.is_active=a),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])),[[Ua]])])}}},[["__scopeId","data-v-22127a92"]]);export{aa as default};
