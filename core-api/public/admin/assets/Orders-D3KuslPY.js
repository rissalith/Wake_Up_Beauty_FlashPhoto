import{F as a,r as e,i as l,c as t,o as s,e as d,w as n,f as i,I as r,d as u,G as o,t as p,H as c,h as v}from"./index-CHOzxtOa.js";import{u as m,t as h}from"./timezone-bSrhj2J5.js";import{_ as f,o as g}from"./_plugin-vue_export-helper-Sp67ay3B.js";const _={class:"orders-page"},w={class:"card-header"},b={class:"filter-bar"},y={class:"stats-summary"},x={class:"stat-item"},z={class:"value"},k={class:"stat-item"},V={class:"value"},Y={class:"stat-item"},D={class:"value amount"},U={class:"stat-item"},W={class:"value"},M={class:"stat-item"},O={class:"value amount"},S={class:"user-cell"},j={key:1,class:"mini-avatar"},A={class:"user-info"},H={class:"nickname"},I={class:"user-id"},C={class:"amount-text"},F={class:"points-text"},G={class:"pagination-wrap"},L=f({__name:"Orders",setup(f){a.extend(m),a.extend(h);const L=e(!1),P=e([]),q=e(1),B=e(20),E=e(0),J=e(""),K=e(""),N=e([]),Q=e({}),R=e=>e?a.utc(e).tz("Asia/Shanghai").format("YYYY-MM-DD HH:mm:ss"):"-",T=a=>(a||0).toFixed(2),X=a=>({paid:"已支付",pending:"未支付",cancelled:"已取消"}[a]||a),Z=async()=>{var a;L.value=!0;try{const e={page:q.value,pageSize:B.value,keyword:J.value,status:K.value};2===(null==(a=N.value)?void 0:a.length)&&(e.startDate=N.value[0],e.endDate=N.value[1]);const l=await g.getList(e);200!==l.code&&0!==l.code||(P.value=l.data.list,E.value=l.data.total)}finally{L.value=!1}};return l(()=>{Z(),(async()=>{try{const a=await g.getStats();200!==a.code&&0!==a.code||(Q.value=a.data)}catch(a){console.error(a)}})()}),(a,e)=>{const l=i("el-input"),m=i("el-option"),h=i("el-select"),f=i("el-date-picker"),g=i("el-button"),$=i("el-table-column"),aa=i("el-avatar"),ea=i("el-tag"),la=i("el-table"),ta=i("el-pagination"),sa=i("el-card"),da=r("loading");return s(),t("div",_,[d(sa,null,{header:n(()=>[u("div",w,[e[6]||(e[6]=u("span",null,"订单管理",-1)),u("div",b,[d(l,{modelValue:J.value,"onUpdate:modelValue":e[0]||(e[0]=a=>J.value=a),placeholder:"搜索订单号/用户ID/昵称",style:{width:"200px"},clearable:""},null,8,["modelValue"]),d(h,{modelValue:K.value,"onUpdate:modelValue":e[1]||(e[1]=a=>K.value=a),placeholder:"状态",clearable:"",style:{width:"120px"}},{default:n(()=>[d(m,{label:"已支付",value:"paid"}),d(m,{label:"未支付",value:"pending"}),d(m,{label:"已取消",value:"cancelled"})]),_:1},8,["modelValue"]),d(f,{modelValue:N.value,"onUpdate:modelValue":e[2]||(e[2]=a=>N.value=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",style:{width:"240px"}},null,8,["modelValue"]),d(g,{type:"primary",onClick:Z},{default:n(()=>[...e[5]||(e[5]=[v("搜索",-1)])]),_:1})])])]),default:n(()=>[u("div",y,[u("div",x,[e[7]||(e[7]=u("span",{class:"label"},"总订单",-1)),u("span",z,p(Q.value.totalOrders||0),1)]),u("div",k,[e[8]||(e[8]=u("span",{class:"label"},"已支付",-1)),u("span",V,p(Q.value.paidOrders||0),1)]),u("div",Y,[e[9]||(e[9]=u("span",{class:"label"},"总金额",-1)),u("span",D,"¥"+p(T(Q.value.totalAmount)),1)]),u("div",U,[e[10]||(e[10]=u("span",{class:"label"},"今日订单",-1)),u("span",W,p(Q.value.todayOrders||0),1)]),u("div",M,[e[11]||(e[11]=u("span",{class:"label"},"今日金额",-1)),u("span",O,"¥"+p(T(Q.value.todayAmount)),1)])]),o((s(),c(la,{data:P.value,stripe:"",style:{width:"100%"}},{default:n(()=>[d($,{prop:"order_id",label:"订单号","min-width":"200","show-overflow-tooltip":""}),d($,{label:"用户","min-width":"200"},{default:n(({row:a})=>{return[u("div",S,[(e=a.avatar_url,!e||"string"!=typeof e||e.startsWith("wxfile://")||e.startsWith("http://tmp")||e.startsWith("https://tmp")||!e.startsWith("http://")&&!e.startsWith("https://")?(s(),t("div",j,p((a.nickname||"用")[0]),1)):(s(),c(aa,{key:0,src:a.avatar_url,size:28},{default:n(()=>[u("span",null,p((a.nickname||"用")[0]),1)]),_:2},1032,["src"]))),u("div",A,[u("div",H,p(a.nickname||"未知用户"),1),u("div",I,p(a.user_id),1)])])];var e}),_:1}),d($,{prop:"amount",label:"金额","min-width":"100"},{default:n(({row:a})=>[u("span",C,"¥"+p(a.amount),1)]),_:1}),d($,{prop:"points",label:"醒币","min-width":"100"},{default:n(({row:a})=>[u("span",F,p(a.points),1)]),_:1}),d($,{prop:"status",label:"状态","min-width":"100"},{default:n(({row:a})=>{return[d(ea,{type:(e=a.status,{paid:"success",pending:"warning",cancelled:"info"}[e]||"info"),size:"small"},{default:n(()=>[v(p(X(a.status)),1)]),_:2},1032,["type"])];var e}),_:1}),d($,{prop:"created_at",label:"创建时间","min-width":"170"},{default:n(({row:a})=>[v(p(R(a.created_at)),1)]),_:1}),d($,{prop:"paid_at",label:"支付时间","min-width":"170"},{default:n(({row:a})=>[v(p(a.paid_at?R(a.paid_at):"-"),1)]),_:1})]),_:1},8,["data"])),[[da,L.value]]),u("div",G,[d(ta,{"current-page":q.value,"onUpdate:currentPage":e[3]||(e[3]=a=>q.value=a),"page-size":B.value,"onUpdate:pageSize":e[4]||(e[4]=a=>B.value=a),total:E.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",onChange:Z},null,8,["current-page","page-size","total"])])]),_:1})])}}},[["__scopeId","data-v-50b6182d"]]);export{L as default};
