import{r as e,a,i as l,c as t,o,d as i,G as n,e as s,w as u,f as d,g as r,t as c,I as m,J as p,h as v,j as _,ad as f,X as g,W as y,O as h,P as w,H as V,E as b,l as k}from"./index-DQJe672r.js";import{_ as x,d as U,e as C,f as j}from"./_plugin-vue_export-helper-DhoNb-KX.js";const z={class:"official-templates"},L={class:"page-header"},T={class:"header-right"},B={class:"filter-bar"},O={class:"template-count"},R={class:"template-list"},q={class:"template-info"},A={class:"image-placeholder"},I={class:"template-detail"},P={class:"template-name"},S={class:"template-desc"},E={class:"template-id"},$={class:"points-value"},D={class:"action-btns"},F={key:0,class:"pagination-wrap"},G=x({__name:"OfficialTemplates",setup(x){const G=e([]),H=e(0),J=e(1),K=e(20),W=e(!1),X=e(""),M=e(""),N=e([]),Q=e([]),Y=e(!1),Z=e(!1),ee=e(null),ae=e(!1),le=e(!1),te=e(""),oe=e(!1),ie=a({id:"",name:"",name_en:"",description:"",description_en:"",cover_image:"",reference_image:"",category_id:null,tags:"",points_cost:50,is_featured:0}),ne={name:[{required:!0,message:"请输入模板名称",trigger:"blur"}],cover_image:[{required:!0,message:"请输入封面图URL",trigger:"blur"}],points_cost:[{required:!0,message:"请输入消耗醒币",trigger:"blur"}]},se=async()=>{W.value=!0;try{const e=await U.getList({page:J.value,pageSize:K.value,status:X.value,keyword:M.value});200===e.code&&(G.value=e.data.list||[],H.value=e.data.total||0)}catch(e){console.error("加载模板列表失败:",e)}finally{W.value=!1}},ue=()=>{Z.value=!1,Object.assign(ie,{id:"",name:"",name_en:"",description:"",description_en:"",cover_image:"",reference_image:"",category_id:null,tags:"",points_cost:50,is_featured:0}),Y.value=!0},de=async()=>{if(ee.value){await ee.value.validate(),ae.value=!0;try{Z.value?(await U.update(ie.id,ie),b.success("更新成功")):(await U.create(ie),b.success("创建成功")),Y.value=!1,se()}catch(e){console.error("提交失败:",e)}finally{ae.value=!1}}},re=()=>{te.value="",le.value=!0},ce=async()=>{if(te.value){oe.value=!0;try{const e=await U.syncFromScene({scene_key:te.value});200===e.code&&(b.success(e.msg||"同步成功"),le.value=!1,se())}catch(e){console.error("同步失败:",e)}finally{oe.value=!1}}else b.warning("请选择要同步的场景")};return l(()=>{se(),(async()=>{try{const e=await C.getList();200===e.code&&(N.value=e.data||[])}catch(e){console.error("加载分类失败:",e)}})(),(async()=>{try{const e=await j.getList();200!==e.code&&0!==e.code||(Q.value=e.data||[])}catch(e){console.error("加载场景失败:",e)}})()}),(e,a)=>{const l=d("el-icon"),x=d("el-button"),C=d("el-radio-button"),j=d("el-radio-group"),me=d("el-input"),pe=d("el-image"),ve=d("el-table-column"),_e=d("el-tag"),fe=d("el-switch"),ge=d("el-table"),ye=d("el-pagination"),he=d("el-form-item"),we=d("el-option"),Ve=d("el-select"),be=d("el-input-number"),ke=d("el-form"),xe=d("el-dialog"),Ue=d("el-alert"),Ce=m("loading");return o(),t("div",z,[i("div",L,[a[19]||(a[19]=i("div",{class:"header-left"},[i("h2",null,"官方模板管理"),i("span",{class:"subtitle"},"管理官方模板，支持从场景同步")],-1)),i("div",T,[s(x,{onClick:re},{default:u(()=>[s(l,null,{default:u(()=>[s(_(f))]),_:1}),a[17]||(a[17]=v(" 从场景同步 ",-1))]),_:1}),s(x,{type:"primary",onClick:ue},{default:u(()=>[s(l,null,{default:u(()=>[s(_(g))]),_:1}),a[18]||(a[18]=v(" 新增模板 ",-1))]),_:1})])]),i("div",B,[s(j,{modelValue:X.value,"onUpdate:modelValue":a[0]||(a[0]=e=>X.value=e),onChange:se},{default:u(()=>[s(C,{label:""},{default:u(()=>[...a[20]||(a[20]=[v("全部",-1)])]),_:1}),s(C,{label:"active"},{default:u(()=>[...a[21]||(a[21]=[v("已上架",-1)])]),_:1}),s(C,{label:"offline"},{default:u(()=>[...a[22]||(a[22]=[v("已下架",-1)])]),_:1})]),_:1},8,["modelValue"]),s(me,{modelValue:M.value,"onUpdate:modelValue":a[1]||(a[1]=e=>M.value=e),placeholder:"搜索模板名称",clearable:"",style:{width:"200px","margin-left":"16px"},onClear:se,onKeyup:r(se,["enter"])},{prefix:u(()=>[s(l,null,{default:u(()=>[s(_(y))]),_:1})]),_:1},8,["modelValue"]),i("span",O,"共 "+c(H.value)+" 个模板",1)]),n((o(),t("div",R,[s(ge,{data:G.value,"row-key":"id","empty-text":"暂无官方模板"},{default:u(()=>[s(ve,{label:"模板","min-width":"280"},{default:u(({row:e})=>[i("div",q,[s(pe,{class:"template-cover",src:e.cover_image,fit:"cover","preview-src-list":[e.cover_image],"preview-teleported":""},{error:u(()=>{var a;return[i("div",A,c((null==(a=e.name)?void 0:a.charAt(0))||"?"),1)]}),_:2},1032,["src","preview-src-list"]),i("div",I,[i("div",P,c(e.name),1),i("div",S,c(e.description||"暂无描述"),1),i("div",E,"ID: "+c(e.id),1)])])]),_:1}),s(ve,{label:"分类",width:"120",align:"center"},{default:u(({row:e})=>[s(_e,{size:"small"},{default:u(()=>[v(c(e.category_name||"未分类"),1)]),_:2},1024)]),_:1}),s(ve,{label:"状态",width:"120",align:"center"},{default:u(({row:e})=>[s(_e,{type:"active"===e.status?"success":"info"},{default:u(()=>[v(c("active"===e.status?"已上架":"已下架"),1)]),_:2},1032,["type"])]),_:1}),s(ve,{label:"精选",width:"80",align:"center"},{default:u(({row:e})=>[s(fe,{modelValue:e.is_featured,"onUpdate:modelValue":a=>e.is_featured=a,"active-value":1,"inactive-value":0,onChange:a=>(async e=>{try{await U.update(e.id,{is_featured:e.is_featured}),b.success("更新成功")}catch(a){console.error("更新失败:",a),se()}})(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),s(ve,{label:"醒币",width:"80",align:"center"},{default:u(({row:e})=>[i("span",$,c(e.points_cost),1)]),_:1}),s(ve,{label:"使用次数",width:"100",align:"center"},{default:u(({row:e})=>[v(c(e.use_count||0),1)]),_:1}),s(ve,{label:"操作",width:"200",fixed:"right"},{default:u(({row:e})=>[i("div",D,[s(x,{type:"primary",link:"",size:"small",onClick:a=>(e=>{Z.value=!0,Object.assign(ie,{id:e.id,name:e.name,name_en:e.name_en||"",description:e.description||"",description_en:e.description_en||"",cover_image:e.cover_image,reference_image:e.reference_image||"",category_id:e.category_id,tags:Array.isArray(e.tags)?e.tags.join(","):e.tags||"",points_cost:e.points_cost,is_featured:e.is_featured}),Y.value=!0})(e)},{default:u(()=>[...a[23]||(a[23]=[v("编辑",-1)])]),_:1},8,["onClick"]),s(x,{type:"active"===e.status?"warning":"success",link:"",size:"small",onClick:a=>(async e=>{const a="active"===e.status?"offline":"active",l="active"===a?"上架":"下架";try{await k.confirm(`确定要${l}该模板吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await U.toggleStatus(e.id,{status:a}),b.success(`${l}成功`),se()}catch(t){"cancel"!==t&&console.error("操作失败:",t)}})(e)},{default:u(()=>[v(c("active"===e.status?"下架":"上架"),1)]),_:2},1032,["type","onClick"]),s(x,{type:"danger",link:"",size:"small",onClick:a=>(async e=>{try{await k.confirm("确定要删除该模板吗？此操作不可恢复。","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await U.delete(e.id),b.success("删除成功"),se()}catch(a){"cancel"!==a&&console.error("删除失败:",a)}})(e)},{default:u(()=>[...a[24]||(a[24]=[v("删除",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"]),H.value>K.value?(o(),t("div",F,[s(ye,{"current-page":J.value,"onUpdate:currentPage":a[2]||(a[2]=e=>J.value=e),"page-size":K.value,total:H.value,layout:"prev, pager, next",onCurrentChange:se},null,8,["current-page","page-size","total"])])):p("",!0)])),[[Ce,W.value]]),s(xe,{modelValue:Y.value,"onUpdate:modelValue":a[13]||(a[13]=e=>Y.value=e),title:Z.value?"编辑官方模板":"新增官方模板",width:"700px",top:"5vh"},{footer:u(()=>[s(x,{onClick:a[12]||(a[12]=e=>Y.value=!1)},{default:u(()=>[...a[25]||(a[25]=[v("取消",-1)])]),_:1}),s(x,{type:"primary",onClick:de,loading:ae.value},{default:u(()=>[...a[26]||(a[26]=[v("确定",-1)])]),_:1},8,["loading"])]),default:u(()=>[s(ke,{model:ie,rules:ne,ref_key:"formRef",ref:ee,"label-width":"100px"},{default:u(()=>[s(he,{label:"模板名称",prop:"name"},{default:u(()=>[s(me,{modelValue:ie.name,"onUpdate:modelValue":a[3]||(a[3]=e=>ie.name=e),placeholder:"中文名称"},null,8,["modelValue"])]),_:1}),s(he,{label:"英文名称"},{default:u(()=>[s(me,{modelValue:ie.name_en,"onUpdate:modelValue":a[4]||(a[4]=e=>ie.name_en=e),placeholder:"English name"},null,8,["modelValue"])]),_:1}),s(he,{label:"模板描述"},{default:u(()=>[s(me,{modelValue:ie.description,"onUpdate:modelValue":a[5]||(a[5]=e=>ie.description=e),type:"textarea",rows:2,placeholder:"简短描述"},null,8,["modelValue"])]),_:1}),s(he,{label:"封面图",prop:"cover_image"},{default:u(()=>[s(me,{modelValue:ie.cover_image,"onUpdate:modelValue":a[6]||(a[6]=e=>ie.cover_image=e),placeholder:"封面图URL"},null,8,["modelValue"])]),_:1}),s(he,{label:"参考图"},{default:u(()=>[s(me,{modelValue:ie.reference_image,"onUpdate:modelValue":a[7]||(a[7]=e=>ie.reference_image=e),placeholder:"参考图URL（可选）"},null,8,["modelValue"])]),_:1}),s(he,{label:"分类"},{default:u(()=>[s(Ve,{modelValue:ie.category_id,"onUpdate:modelValue":a[8]||(a[8]=e=>ie.category_id=e),placeholder:"选择分类",clearable:""},{default:u(()=>[(o(!0),t(h,null,w(N.value,e=>(o(),V(we,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(he,{label:"标签"},{default:u(()=>[s(me,{modelValue:ie.tags,"onUpdate:modelValue":a[9]||(a[9]=e=>ie.tags=e),placeholder:"多个标签用逗号分隔"},null,8,["modelValue"])]),_:1}),s(he,{label:"消耗醒币",prop:"points_cost"},{default:u(()=>[s(be,{modelValue:ie.points_cost,"onUpdate:modelValue":a[10]||(a[10]=e=>ie.points_cost=e),min:0,max:9999},null,8,["modelValue"])]),_:1}),s(he,{label:"精选"},{default:u(()=>[s(fe,{modelValue:ie.is_featured,"onUpdate:modelValue":a[11]||(a[11]=e=>ie.is_featured=e),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),s(xe,{modelValue:le.value,"onUpdate:modelValue":a[16]||(a[16]=e=>le.value=e),title:"从场景同步",width:"500px"},{footer:u(()=>[s(x,{onClick:a[15]||(a[15]=e=>le.value=!1)},{default:u(()=>[...a[28]||(a[28]=[v("取消",-1)])]),_:1}),s(x,{type:"primary",onClick:ce,loading:oe.value},{default:u(()=>[...a[29]||(a[29]=[v("同步",-1)])]),_:1},8,["loading"])]),default:u(()=>[s(ke,{"label-width":"100px"},{default:u(()=>[s(he,{label:"选择场景"},{default:u(()=>[s(Ve,{modelValue:te.value,"onUpdate:modelValue":a[14]||(a[14]=e=>te.value=e),placeholder:"选择要同步的场景",style:{width:"100%"}},{default:u(()=>[(o(!0),t(h,null,w(Q.value,e=>(o(),V(we,{key:e.scene_key||e.id,label:e.name,value:e.scene_key||e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(Ue,{type:"info",closable:!1,"show-icon":"",style:{"margin-top":"16px"}},{default:u(()=>[...a[27]||(a[27]=[v(" 同步将复制场景的基本信息、步骤配置和Prompt模板到官方模板系统。 如果模板已存在，将更新现有数据。 ",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-934773e8"]]);export{G as default};
