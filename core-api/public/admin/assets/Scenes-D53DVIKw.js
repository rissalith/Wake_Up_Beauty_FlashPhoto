import{r as e,a as l,x as a,z as t,i as n,f as o,I as i,c as s,o as r,d as c,G as d,e as u,w as p,O as m,P as v,H as g,g as f,j as h,W as y,h as _,X as b,Y as w,t as k,T as V,J as x,Q as C,E as S,l as E,Z as I,_ as z,$ as D,a0 as U,a1 as T,C as O,a2 as A,a3 as $,a4 as P,a5 as N,a6 as F,a7 as M,a8 as j,a9 as B,aa as R,ab as L,ac as K}from"./index-D6JlIXC0.js";import{d as Y}from"./vuedraggable.umd-BCjcxhvl.js";import{c as X,_ as W}from"./_plugin-vue_export-helper-DddUIWaG.js";
/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function q(e,l){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);l&&(t=t.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),a.push.apply(a,t)}return a}function H(e){for(var l=1;l<arguments.length;l++){var a=null!=arguments[l]?arguments[l]:{};l%2?q(Object(a),!0).forEach(function(l){G(e,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):q(Object(a)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))})}return e}function J(e){return(J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function G(e,l,a){return l in e?Object.defineProperty(e,l,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[l]=a,e}function Z(){return Z=Object.assign||function(e){for(var l=1;l<arguments.length;l++){var a=arguments[l];for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&(e[t]=a[t])}return e},Z.apply(this,arguments)}function Q(e,l){if(null==e)return{};var a,t,n=function(e,l){if(null==e)return{};var a,t,n={},o=Object.keys(e);for(t=0;t<o.length;t++)a=o[t],l.indexOf(a)>=0||(n[a]=e[a]);return n}(e,l);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)a=o[t],l.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function ee(e){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(e)}var le=ee(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),ae=ee(/Edge/i),te=ee(/firefox/i),ne=ee(/safari/i)&&!ee(/chrome/i)&&!ee(/android/i),oe=ee(/iP(ad|od|hone)/i),ie=ee(/chrome/i)&&ee(/android/i),se={capture:!1,passive:!1};function re(e,l,a){e.addEventListener(l,a,!le&&se)}function ce(e,l,a){e.removeEventListener(l,a,!le&&se)}function de(e,l){if(l){if(">"===l[0]&&(l=l.substring(1)),e)try{if(e.matches)return e.matches(l);if(e.msMatchesSelector)return e.msMatchesSelector(l);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(l)}catch(a){return!1}return!1}}function ue(e){return e.host&&e!==document&&e.host.nodeType?e.host:e.parentNode}function pe(e,l,a,t){if(e){a=a||document;do{if(null!=l&&(">"===l[0]?e.parentNode===a&&de(e,l):de(e,l))||t&&e===a)return e;if(e===a)break}while(e=ue(e))}return null}var me,ve=/\s+/g;function ge(e,l,a){if(e&&l)if(e.classList)e.classList[a?"add":"remove"](l);else{var t=(" "+e.className+" ").replace(ve," ").replace(" "+l+" "," ");e.className=(t+(a?" "+l:"")).replace(ve," ")}}function fe(e,l,a){var t=e&&e.style;if(t){if(void 0===a)return document.defaultView&&document.defaultView.getComputedStyle?a=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(a=e.currentStyle),void 0===l?a:a[l];l in t||-1!==l.indexOf("webkit")||(l="-webkit-"+l),t[l]=a+("string"==typeof a?"":"px")}}function he(e,l){var a="";if("string"==typeof e)a=e;else do{var t=fe(e,"transform");t&&"none"!==t&&(a=t+" "+a)}while(!l&&(e=e.parentNode));var n=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return n&&new n(a)}function ye(e,l,a){if(e){var t=e.getElementsByTagName(l),n=0,o=t.length;if(a)for(;n<o;n++)a(t[n],n);return t}return[]}function _e(){var e=document.scrollingElement;return e||document.documentElement}function be(e,l,a,t,n){if(e.getBoundingClientRect||e===window){var o,i,s,r,c,d,u;if(e!==window&&e.parentNode&&e!==_e()?(i=(o=e.getBoundingClientRect()).top,s=o.left,r=o.bottom,c=o.right,d=o.height,u=o.width):(i=0,s=0,r=window.innerHeight,c=window.innerWidth,d=window.innerHeight,u=window.innerWidth),(l||a)&&e!==window&&(n=n||e.parentNode,!le))do{if(n&&n.getBoundingClientRect&&("none"!==fe(n,"transform")||a&&"static"!==fe(n,"position"))){var p=n.getBoundingClientRect();i-=p.top+parseInt(fe(n,"border-top-width")),s-=p.left+parseInt(fe(n,"border-left-width")),r=i+o.height,c=s+o.width;break}}while(n=n.parentNode);if(t&&e!==window){var m=he(n||e),v=m&&m.a,g=m&&m.d;m&&(r=(i/=g)+(d/=g),c=(s/=v)+(u/=v))}return{top:i,left:s,bottom:r,right:c,width:u,height:d}}}function we(e,l,a){for(var t=Se(e,!0),n=be(e)[l];t;){if(!(n>=be(t)[a]))return t;if(t===_e())break;t=Se(t,!1)}return!1}function ke(e,l,a,t){for(var n=0,o=0,i=e.children;o<i.length;){if("none"!==i[o].style.display&&i[o]!==Dl.ghost&&(t||i[o]!==Dl.dragged)&&pe(i[o],a.draggable,e,!1)){if(n===l)return i[o];n++}o++}return null}function Ve(e,l){for(var a=e.lastElementChild;a&&(a===Dl.ghost||"none"===fe(a,"display")||l&&!de(a,l));)a=a.previousElementSibling;return a||null}function xe(e,l){var a=0;if(!e||!e.parentNode)return-1;for(;e=e.previousElementSibling;)"TEMPLATE"===e.nodeName.toUpperCase()||e===Dl.clone||l&&!de(e,l)||a++;return a}function Ce(e){var l=0,a=0,t=_e();if(e)do{var n=he(e),o=n.a,i=n.d;l+=e.scrollLeft*o,a+=e.scrollTop*i}while(e!==t&&(e=e.parentNode));return[l,a]}function Se(e,l){if(!e||!e.getBoundingClientRect)return _e();var a=e,t=!1;do{if(a.clientWidth<a.scrollWidth||a.clientHeight<a.scrollHeight){var n=fe(a);if(a.clientWidth<a.scrollWidth&&("auto"==n.overflowX||"scroll"==n.overflowX)||a.clientHeight<a.scrollHeight&&("auto"==n.overflowY||"scroll"==n.overflowY)){if(!a.getBoundingClientRect||a===document.body)return _e();if(t||l)return a;t=!0}}}while(a=a.parentNode);return _e()}function Ee(e,l){return Math.round(e.top)===Math.round(l.top)&&Math.round(e.left)===Math.round(l.left)&&Math.round(e.height)===Math.round(l.height)&&Math.round(e.width)===Math.round(l.width)}function Ie(e,l){return function(){if(!me){var a=arguments;1===a.length?e.call(this,a[0]):e.apply(this,a),me=setTimeout(function(){me=void 0},l)}}}function ze(e,l,a){e.scrollLeft+=l,e.scrollTop+=a}function De(e){var l=window.Polymer,a=window.jQuery||window.Zepto;return l&&l.dom?l.dom(e).cloneNode(!0):a?a(e).clone(!0)[0]:e.cloneNode(!0)}function Ue(e,l,a){var t={};return Array.from(e.children).forEach(function(n){var o,i,s,r;if(pe(n,l.draggable,e,!1)&&!n.animated&&n!==a){var c=be(n);t.left=Math.min(null!==(o=t.left)&&void 0!==o?o:1/0,c.left),t.top=Math.min(null!==(i=t.top)&&void 0!==i?i:1/0,c.top),t.right=Math.max(null!==(s=t.right)&&void 0!==s?s:-1/0,c.right),t.bottom=Math.max(null!==(r=t.bottom)&&void 0!==r?r:-1/0,c.bottom)}}),t.width=t.right-t.left,t.height=t.bottom-t.top,t.x=t.left,t.y=t.top,t}var Te="Sortable"+(new Date).getTime();function Oe(){var e,l=[];return{captureAnimationState:function(){(l=[],this.options.animation)&&[].slice.call(this.el.children).forEach(function(e){if("none"!==fe(e,"display")&&e!==Dl.ghost){l.push({target:e,rect:be(e)});var a=H({},l[l.length-1].rect);if(e.thisAnimationDuration){var t=he(e,!0);t&&(a.top-=t.f,a.left-=t.e)}e.fromRect=a}})},addAnimationState:function(e){l.push(e)},removeAnimationState:function(e){l.splice(function(e,l){for(var a in e)if(e.hasOwnProperty(a))for(var t in l)if(l.hasOwnProperty(t)&&l[t]===e[a][t])return Number(a);return-1}(l,{target:e}),1)},animateAll:function(a){var t=this;if(!this.options.animation)return clearTimeout(e),void("function"==typeof a&&a());var n=!1,o=0;l.forEach(function(e){var l=0,a=e.target,i=a.fromRect,s=be(a),r=a.prevFromRect,c=a.prevToRect,d=e.rect,u=he(a,!0);u&&(s.top-=u.f,s.left-=u.e),a.toRect=s,a.thisAnimationDuration&&Ee(r,s)&&!Ee(i,s)&&(d.top-s.top)/(d.left-s.left)===(i.top-s.top)/(i.left-s.left)&&(l=function(e,l,a,t){return Math.sqrt(Math.pow(l.top-e.top,2)+Math.pow(l.left-e.left,2))/Math.sqrt(Math.pow(l.top-a.top,2)+Math.pow(l.left-a.left,2))*t.animation}(d,r,c,t.options)),Ee(s,i)||(a.prevFromRect=i,a.prevToRect=s,l||(l=t.options.animation),t.animate(a,d,s,l)),l&&(n=!0,o=Math.max(o,l),clearTimeout(a.animationResetTimer),a.animationResetTimer=setTimeout(function(){a.animationTime=0,a.prevFromRect=null,a.fromRect=null,a.prevToRect=null,a.thisAnimationDuration=null},l),a.thisAnimationDuration=l)}),clearTimeout(e),n?e=setTimeout(function(){"function"==typeof a&&a()},o):"function"==typeof a&&a(),l=[]},animate:function(e,l,a,t){if(t){fe(e,"transition",""),fe(e,"transform","");var n=he(this.el),o=n&&n.a,i=n&&n.d,s=(l.left-a.left)/(o||1),r=(l.top-a.top)/(i||1);e.animatingX=!!s,e.animatingY=!!r,fe(e,"transform","translate3d("+s+"px,"+r+"px,0)"),this.forRepaintDummy=function(e){return e.offsetWidth}(e),fe(e,"transition","transform "+t+"ms"+(this.options.easing?" "+this.options.easing:"")),fe(e,"transform","translate3d(0,0,0)"),"number"==typeof e.animated&&clearTimeout(e.animated),e.animated=setTimeout(function(){fe(e,"transition",""),fe(e,"transform",""),e.animated=!1,e.animatingX=!1,e.animatingY=!1},t)}}}}var Ae=[],$e={initializeByDefault:!0},Pe={mount:function(e){for(var l in $e)$e.hasOwnProperty(l)&&!(l in e)&&(e[l]=$e[l]);Ae.forEach(function(l){if(l.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),Ae.push(e)},pluginEvent:function(e,l,a){var t=this;this.eventCanceled=!1,a.cancel=function(){t.eventCanceled=!0};var n=e+"Global";Ae.forEach(function(t){l[t.pluginName]&&(l[t.pluginName][n]&&l[t.pluginName][n](H({sortable:l},a)),l.options[t.pluginName]&&l[t.pluginName][e]&&l[t.pluginName][e](H({sortable:l},a)))})},initializePlugins:function(e,l,a,t){for(var n in Ae.forEach(function(t){var n=t.pluginName;if(e.options[n]||t.initializeByDefault){var o=new t(e,l,e.options);o.sortable=e,o.options=e.options,e[n]=o,Z(a,o.defaults)}}),e.options)if(e.options.hasOwnProperty(n)){var o=this.modifyOption(e,n,e.options[n]);void 0!==o&&(e.options[n]=o)}},getEventProperties:function(e,l){var a={};return Ae.forEach(function(t){"function"==typeof t.eventProperties&&Z(a,t.eventProperties.call(l[t.pluginName],e))}),a},modifyOption:function(e,l,a){var t;return Ae.forEach(function(n){e[n.pluginName]&&n.optionListeners&&"function"==typeof n.optionListeners[l]&&(t=n.optionListeners[l].call(e[n.pluginName],a))}),t}};var Ne=["evt"],Fe=function(e,l){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},t=a.evt,n=Q(a,Ne);Pe.pluginEvent.bind(Dl)(e,l,H({dragEl:je,parentEl:Be,ghostEl:Re,rootEl:Le,nextEl:Ke,lastDownEl:Ye,cloneEl:Xe,cloneHidden:We,dragStarted:il,putSortable:Qe,activeSortable:Dl.active,originalEvent:t,oldIndex:qe,oldDraggableIndex:Je,newIndex:He,newDraggableIndex:Ge,hideGhostForTarget:Sl,unhideGhostForTarget:El,cloneNowHidden:function(){We=!0},cloneNowShown:function(){We=!1},dispatchSortableEvent:function(e){Me({sortable:l,name:e,originalEvent:t})}},n))};function Me(e){!function(e){var l=e.sortable,a=e.rootEl,t=e.name,n=e.targetEl,o=e.cloneEl,i=e.toEl,s=e.fromEl,r=e.oldIndex,c=e.newIndex,d=e.oldDraggableIndex,u=e.newDraggableIndex,p=e.originalEvent,m=e.putSortable,v=e.extraEventProperties;if(l=l||a&&a[Te]){var g,f=l.options,h="on"+t.charAt(0).toUpperCase()+t.substr(1);!window.CustomEvent||le||ae?(g=document.createEvent("Event")).initEvent(t,!0,!0):g=new CustomEvent(t,{bubbles:!0,cancelable:!0}),g.to=i||a,g.from=s||a,g.item=n||a,g.clone=o,g.oldIndex=r,g.newIndex=c,g.oldDraggableIndex=d,g.newDraggableIndex=u,g.originalEvent=p,g.pullMode=m?m.lastPutMode:void 0;var y=H(H({},v),Pe.getEventProperties(t,l));for(var _ in y)g[_]=y[_];a&&a.dispatchEvent(g),f[h]&&f[h].call(l,g)}}(H({putSortable:Qe,cloneEl:Xe,targetEl:je,rootEl:Le,oldIndex:qe,oldDraggableIndex:Je,newIndex:He,newDraggableIndex:Ge},e))}var je,Be,Re,Le,Ke,Ye,Xe,We,qe,He,Je,Ge,Ze,Qe,el,ll,al,tl,nl,ol,il,sl,rl,cl,dl,ul=!1,pl=!1,ml=[],vl=!1,gl=!1,fl=[],hl=!1,yl=[],_l="undefined"!=typeof document,bl=oe,wl=ae||le?"cssFloat":"float",kl=_l&&!ie&&!oe&&"draggable"in document.createElement("div"),Vl=function(){if(_l){if(le)return!1;var e=document.createElement("x");return e.style.cssText="pointer-events:auto","auto"===e.style.pointerEvents}}(),xl=function(e,l){var a=fe(e),t=parseInt(a.width)-parseInt(a.paddingLeft)-parseInt(a.paddingRight)-parseInt(a.borderLeftWidth)-parseInt(a.borderRightWidth),n=ke(e,0,l),o=ke(e,1,l),i=n&&fe(n),s=o&&fe(o),r=i&&parseInt(i.marginLeft)+parseInt(i.marginRight)+be(n).width,c=s&&parseInt(s.marginLeft)+parseInt(s.marginRight)+be(o).width;if("flex"===a.display)return"column"===a.flexDirection||"column-reverse"===a.flexDirection?"vertical":"horizontal";if("grid"===a.display)return a.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(n&&i.float&&"none"!==i.float){var d="left"===i.float?"left":"right";return!o||"both"!==s.clear&&s.clear!==d?"horizontal":"vertical"}return n&&("block"===i.display||"flex"===i.display||"table"===i.display||"grid"===i.display||r>=t&&"none"===a[wl]||o&&"none"===a[wl]&&r+c>t)?"vertical":"horizontal"},Cl=function(e){function l(e,a){return function(t,n,o,i){var s=t.options.group.name&&n.options.group.name&&t.options.group.name===n.options.group.name;if(null==e&&(a||s))return!0;if(null==e||!1===e)return!1;if(a&&"clone"===e)return e;if("function"==typeof e)return l(e(t,n,o,i),a)(t,n,o,i);var r=(a?t:n).options.group.name;return!0===e||"string"==typeof e&&e===r||e.join&&e.indexOf(r)>-1}}var a={},t=e.group;t&&"object"==J(t)||(t={name:t}),a.name=t.name,a.checkPull=l(t.pull,!0),a.checkPut=l(t.put),a.revertClone=t.revertClone,e.group=a},Sl=function(){!Vl&&Re&&fe(Re,"display","none")},El=function(){!Vl&&Re&&fe(Re,"display","")};_l&&!ie&&document.addEventListener("click",function(e){if(pl)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),pl=!1,!1},!0);var Il=function(e){if(je){e=e.touches?e.touches[0]:e;var l=(n=e.clientX,o=e.clientY,ml.some(function(e){var l=e[Te].options.emptyInsertThreshold;if(l&&!Ve(e)){var a=be(e),t=n>=a.left-l&&n<=a.right+l,s=o>=a.top-l&&o<=a.bottom+l;return t&&s?i=e:void 0}}),i);if(l){var a={};for(var t in e)e.hasOwnProperty(t)&&(a[t]=e[t]);a.target=a.rootEl=l,a.preventDefault=void 0,a.stopPropagation=void 0,l[Te]._onDragOver(a)}}var n,o,i},zl=function(e){je&&je.parentNode[Te]._isOutsideThisEl(e.target)};function Dl(e,l){if(!e||!e.nodeType||1!==e.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(e));this.el=e,this.options=l=Z({},l),e[Te]=this;var a={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return xl(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(e,l){e.setData("Text",l.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==Dl.supportPointer&&"PointerEvent"in window&&(!ne||oe),emptyInsertThreshold:5};for(var t in Pe.initializePlugins(this,e,a),a)!(t in l)&&(l[t]=a[t]);for(var n in Cl(l),this)"_"===n.charAt(0)&&"function"==typeof this[n]&&(this[n]=this[n].bind(this));this.nativeDraggable=!l.forceFallback&&kl,this.nativeDraggable&&(this.options.touchStartThreshold=1),l.supportPointer?re(e,"pointerdown",this._onTapStart):(re(e,"mousedown",this._onTapStart),re(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(re(e,"dragover",this),re(e,"dragenter",this)),ml.push(this.el),l.store&&l.store.get&&this.sort(l.store.get(this)||[]),Z(this,Oe())}function Ul(e,l,a,t,n,o,i,s){var r,c,d=e[Te],u=d.options.onMove;return!window.CustomEvent||le||ae?(r=document.createEvent("Event")).initEvent("move",!0,!0):r=new CustomEvent("move",{bubbles:!0,cancelable:!0}),r.to=l,r.from=e,r.dragged=a,r.draggedRect=t,r.related=n||l,r.relatedRect=o||be(l),r.willInsertAfter=s,r.originalEvent=i,e.dispatchEvent(r),u&&(c=u.call(d,r,i)),c}function Tl(e){e.draggable=!1}function Ol(){hl=!1}function Al(e){for(var l=e.tagName+e.className+e.src+e.href+e.textContent,a=l.length,t=0;a--;)t+=l.charCodeAt(a);return t.toString(36)}function $l(e){return setTimeout(e,0)}function Pl(e){return clearTimeout(e)}Dl.prototype={constructor:Dl,_isOutsideThisEl:function(e){this.el.contains(e)||e===this.el||(sl=null)},_getDirection:function(e,l){return"function"==typeof this.options.direction?this.options.direction.call(this,e,l,je):this.options.direction},_onTapStart:function(e){if(e.cancelable){var l=this,a=this.el,t=this.options,n=t.preventOnFilter,o=e.type,i=e.touches&&e.touches[0]||e.pointerType&&"touch"===e.pointerType&&e,s=(i||e).target,r=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||s,c=t.filter;if(function(e){yl.length=0;var l=e.getElementsByTagName("input"),a=l.length;for(;a--;){var t=l[a];t.checked&&yl.push(t)}}(a),!je&&!(/mousedown|pointerdown/.test(o)&&0!==e.button||t.disabled)&&!r.isContentEditable&&(this.nativeDraggable||!ne||!s||"SELECT"!==s.tagName.toUpperCase())&&!((s=pe(s,t.draggable,a,!1))&&s.animated||Ye===s)){if(qe=xe(s),Je=xe(s,t.draggable),"function"==typeof c){if(c.call(this,e,s,this))return Me({sortable:l,rootEl:r,name:"filter",targetEl:s,toEl:a,fromEl:a}),Fe("filter",l,{evt:e}),void(n&&e.preventDefault())}else if(c&&(c=c.split(",").some(function(t){if(t=pe(r,t.trim(),a,!1))return Me({sortable:l,rootEl:t,name:"filter",targetEl:s,fromEl:a,toEl:a}),Fe("filter",l,{evt:e}),!0})))return void(n&&e.preventDefault());t.handle&&!pe(r,t.handle,a,!1)||this._prepareDragStart(e,i,s)}}},_prepareDragStart:function(e,l,a){var t,n=this,o=n.el,i=n.options,s=o.ownerDocument;if(a&&!je&&a.parentNode===o){var r=be(a);if(Le=o,Be=(je=a).parentNode,Ke=je.nextSibling,Ye=a,Ze=i.group,Dl.dragged=je,el={target:je,clientX:(l||e).clientX,clientY:(l||e).clientY},nl=el.clientX-r.left,ol=el.clientY-r.top,this._lastX=(l||e).clientX,this._lastY=(l||e).clientY,je.style["will-change"]="all",t=function(){Fe("delayEnded",n,{evt:e}),Dl.eventCanceled?n._onDrop():(n._disableDelayedDragEvents(),!te&&n.nativeDraggable&&(je.draggable=!0),n._triggerDragStart(e,l),Me({sortable:n,name:"choose",originalEvent:e}),ge(je,i.chosenClass,!0))},i.ignore.split(",").forEach(function(e){ye(je,e.trim(),Tl)}),re(s,"dragover",Il),re(s,"mousemove",Il),re(s,"touchmove",Il),i.supportPointer?(re(s,"pointerup",n._onDrop),!this.nativeDraggable&&re(s,"pointercancel",n._onDrop)):(re(s,"mouseup",n._onDrop),re(s,"touchend",n._onDrop),re(s,"touchcancel",n._onDrop)),te&&this.nativeDraggable&&(this.options.touchStartThreshold=4,je.draggable=!0),Fe("delayStart",this,{evt:e}),!i.delay||i.delayOnTouchOnly&&!l||this.nativeDraggable&&(ae||le))t();else{if(Dl.eventCanceled)return void this._onDrop();i.supportPointer?(re(s,"pointerup",n._disableDelayedDrag),re(s,"pointercancel",n._disableDelayedDrag)):(re(s,"mouseup",n._disableDelayedDrag),re(s,"touchend",n._disableDelayedDrag),re(s,"touchcancel",n._disableDelayedDrag)),re(s,"mousemove",n._delayedDragTouchMoveHandler),re(s,"touchmove",n._delayedDragTouchMoveHandler),i.supportPointer&&re(s,"pointermove",n._delayedDragTouchMoveHandler),n._dragStartTimer=setTimeout(t,i.delay)}}},_delayedDragTouchMoveHandler:function(e){var l=e.touches?e.touches[0]:e;Math.max(Math.abs(l.clientX-this._lastX),Math.abs(l.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){je&&Tl(je),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;ce(e,"mouseup",this._disableDelayedDrag),ce(e,"touchend",this._disableDelayedDrag),ce(e,"touchcancel",this._disableDelayedDrag),ce(e,"pointerup",this._disableDelayedDrag),ce(e,"pointercancel",this._disableDelayedDrag),ce(e,"mousemove",this._delayedDragTouchMoveHandler),ce(e,"touchmove",this._delayedDragTouchMoveHandler),ce(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,l){l=l||"touch"==e.pointerType&&e,!this.nativeDraggable||l?this.options.supportPointer?re(document,"pointermove",this._onTouchMove):re(document,l?"touchmove":"mousemove",this._onTouchMove):(re(je,"dragend",this),re(Le,"dragstart",this._onDragStart));try{document.selection?$l(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch(a){}},_dragStarted:function(e,l){if(ul=!1,Le&&je){Fe("dragStarted",this,{evt:l}),this.nativeDraggable&&re(document,"dragover",zl);var a=this.options;!e&&ge(je,a.dragClass,!1),ge(je,a.ghostClass,!0),Dl.active=this,e&&this._appendGhost(),Me({sortable:this,name:"start",originalEvent:l})}else this._nulling()},_emulateDragOver:function(){if(ll){this._lastX=ll.clientX,this._lastY=ll.clientY,Sl();for(var e=document.elementFromPoint(ll.clientX,ll.clientY),l=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(ll.clientX,ll.clientY))!==l;)l=e;if(je.parentNode[Te]._isOutsideThisEl(e),l)do{if(l[Te]){if(l[Te]._onDragOver({clientX:ll.clientX,clientY:ll.clientY,target:e,rootEl:l})&&!this.options.dragoverBubble)break}e=l}while(l=ue(l));El()}},_onTouchMove:function(e){if(el){var l=this.options,a=l.fallbackTolerance,t=l.fallbackOffset,n=e.touches?e.touches[0]:e,o=Re&&he(Re,!0),i=Re&&o&&o.a,s=Re&&o&&o.d,r=bl&&dl&&Ce(dl),c=(n.clientX-el.clientX+t.x)/(i||1)+(r?r[0]-fl[0]:0)/(i||1),d=(n.clientY-el.clientY+t.y)/(s||1)+(r?r[1]-fl[1]:0)/(s||1);if(!Dl.active&&!ul){if(a&&Math.max(Math.abs(n.clientX-this._lastX),Math.abs(n.clientY-this._lastY))<a)return;this._onDragStart(e,!0)}if(Re){o?(o.e+=c-(al||0),o.f+=d-(tl||0)):o={a:1,b:0,c:0,d:1,e:c,f:d};var u="matrix(".concat(o.a,",").concat(o.b,",").concat(o.c,",").concat(o.d,",").concat(o.e,",").concat(o.f,")");fe(Re,"webkitTransform",u),fe(Re,"mozTransform",u),fe(Re,"msTransform",u),fe(Re,"transform",u),al=c,tl=d,ll=n}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!Re){var e=this.options.fallbackOnBody?document.body:Le,l=be(je,!0,bl,!0,e),a=this.options;if(bl){for(dl=e;"static"===fe(dl,"position")&&"none"===fe(dl,"transform")&&dl!==document;)dl=dl.parentNode;dl!==document.body&&dl!==document.documentElement?(dl===document&&(dl=_e()),l.top+=dl.scrollTop,l.left+=dl.scrollLeft):dl=_e(),fl=Ce(dl)}ge(Re=je.cloneNode(!0),a.ghostClass,!1),ge(Re,a.fallbackClass,!0),ge(Re,a.dragClass,!0),fe(Re,"transition",""),fe(Re,"transform",""),fe(Re,"box-sizing","border-box"),fe(Re,"margin",0),fe(Re,"top",l.top),fe(Re,"left",l.left),fe(Re,"width",l.width),fe(Re,"height",l.height),fe(Re,"opacity","0.8"),fe(Re,"position",bl?"absolute":"fixed"),fe(Re,"zIndex","100000"),fe(Re,"pointerEvents","none"),Dl.ghost=Re,e.appendChild(Re),fe(Re,"transform-origin",nl/parseInt(Re.style.width)*100+"% "+ol/parseInt(Re.style.height)*100+"%")}},_onDragStart:function(e,l){var a=this,t=e.dataTransfer,n=a.options;Fe("dragStart",this,{evt:e}),Dl.eventCanceled?this._onDrop():(Fe("setupClone",this),Dl.eventCanceled||((Xe=De(je)).removeAttribute("id"),Xe.draggable=!1,Xe.style["will-change"]="",this._hideClone(),ge(Xe,this.options.chosenClass,!1),Dl.clone=Xe),a.cloneId=$l(function(){Fe("clone",a),Dl.eventCanceled||(a.options.removeCloneOnHide||Le.insertBefore(Xe,je),a._hideClone(),Me({sortable:a,name:"clone"}))}),!l&&ge(je,n.dragClass,!0),l?(pl=!0,a._loopId=setInterval(a._emulateDragOver,50)):(ce(document,"mouseup",a._onDrop),ce(document,"touchend",a._onDrop),ce(document,"touchcancel",a._onDrop),t&&(t.effectAllowed="move",n.setData&&n.setData.call(a,t,je)),re(document,"drop",a),fe(je,"transform","translateZ(0)")),ul=!0,a._dragStartId=$l(a._dragStarted.bind(a,l,e)),re(document,"selectstart",a),il=!0,window.getSelection().removeAllRanges(),ne&&fe(document.body,"user-select","none"))},_onDragOver:function(e){var l,a,t,n,o=this.el,i=e.target,s=this.options,r=s.group,c=Dl.active,d=Ze===r,u=s.sort,p=Qe||c,m=this,v=!1;if(!hl){if(void 0!==e.preventDefault&&e.cancelable&&e.preventDefault(),i=pe(i,s.draggable,o,!0),z("dragOver"),Dl.eventCanceled)return v;if(je.contains(e.target)||i.animated&&i.animatingX&&i.animatingY||m._ignoreWhileAnimating===i)return U(!1);if(pl=!1,c&&!s.disabled&&(d?u||(t=Be!==Le):Qe===this||(this.lastPutMode=Ze.checkPull(this,c,je,e))&&r.checkPut(this,c,je,e))){if(n="vertical"===this._getDirection(e,i),l=be(je),z("dragOverValid"),Dl.eventCanceled)return v;if(t)return Be=Le,D(),this._hideClone(),z("revert"),Dl.eventCanceled||(Ke?Le.insertBefore(je,Ke):Le.appendChild(je)),U(!0);var g=Ve(o,s.draggable);if(!g||function(e,l,a){var t=be(Ve(a.el,a.options.draggable)),n=Ue(a.el,a.options,Re),o=10;return l?e.clientX>n.right+o||e.clientY>t.bottom&&e.clientX>t.left:e.clientY>n.bottom+o||e.clientX>t.right&&e.clientY>t.top}(e,n,this)&&!g.animated){if(g===je)return U(!1);if(g&&o===e.target&&(i=g),i&&(a=be(i)),!1!==Ul(Le,o,je,l,i,a,e,!!i))return D(),g&&g.nextSibling?o.insertBefore(je,g.nextSibling):o.appendChild(je),Be=o,T(),U(!0)}else if(g&&function(e,l,a){var t=be(ke(a.el,0,a.options,!0)),n=Ue(a.el,a.options,Re),o=10;return l?e.clientX<n.left-o||e.clientY<t.top&&e.clientX<t.right:e.clientY<n.top-o||e.clientY<t.bottom&&e.clientX<t.left}(e,n,this)){var f=ke(o,0,s,!0);if(f===je)return U(!1);if(a=be(i=f),!1!==Ul(Le,o,je,l,i,a,e,!1))return D(),o.insertBefore(je,f),Be=o,T(),U(!0)}else if(i.parentNode===o){a=be(i);var h,y,_,b=je.parentNode!==o,w=!function(e,l,a){var t=a?e.left:e.top,n=a?e.right:e.bottom,o=a?e.width:e.height,i=a?l.left:l.top,s=a?l.right:l.bottom,r=a?l.width:l.height;return t===i||n===s||t+o/2===i+r/2}(je.animated&&je.toRect||l,i.animated&&i.toRect||a,n),k=n?"top":"left",V=we(i,"top","top")||we(je,"top","top"),x=V?V.scrollTop:void 0;if(sl!==i&&(y=a[k],vl=!1,gl=!w&&s.invertSwap||b),h=function(e,l,a,t,n,o,i,s){var r=t?e.clientY:e.clientX,c=t?a.height:a.width,d=t?a.top:a.left,u=t?a.bottom:a.right,p=!1;if(!i)if(s&&cl<c*n){if(!vl&&(1===rl?r>d+c*o/2:r<u-c*o/2)&&(vl=!0),vl)p=!0;else if(1===rl?r<d+cl:r>u-cl)return-rl}else if(r>d+c*(1-n)/2&&r<u-c*(1-n)/2)return function(e){return xe(je)<xe(e)?1:-1}(l);if((p=p||i)&&(r<d+c*o/2||r>u-c*o/2))return r>d+c/2?1:-1;return 0}(e,i,a,n,w?1:s.swapThreshold,null==s.invertedSwapThreshold?s.swapThreshold:s.invertedSwapThreshold,gl,sl===i),0!==h){var C=xe(je);do{C-=h,_=Be.children[C]}while(_&&("none"===fe(_,"display")||_===Re))}if(0===h||_===i)return U(!1);sl=i,rl=h;var S=i.nextElementSibling,E=!1,I=Ul(Le,o,je,l,i,a,e,E=1===h);if(!1!==I)return 1!==I&&-1!==I||(E=1===I),hl=!0,setTimeout(Ol,30),D(),E&&!S?o.appendChild(je):i.parentNode.insertBefore(je,E?S:i),V&&ze(V,0,x-V.scrollTop),Be=je.parentNode,void 0===y||gl||(cl=Math.abs(y-be(i)[k])),T(),U(!0)}if(o.contains(je))return U(!1)}return!1}function z(s,r){Fe(s,m,H({evt:e,isOwner:d,axis:n?"vertical":"horizontal",revert:t,dragRect:l,targetRect:a,canSort:u,fromSortable:p,target:i,completed:U,onMove:function(a,t){return Ul(Le,o,je,l,a,be(a),e,t)},changed:T},r))}function D(){z("dragOverAnimationCapture"),m.captureAnimationState(),m!==p&&p.captureAnimationState()}function U(l){return z("dragOverCompleted",{insertion:l}),l&&(d?c._hideClone():c._showClone(m),m!==p&&(ge(je,Qe?Qe.options.ghostClass:c.options.ghostClass,!1),ge(je,s.ghostClass,!0)),Qe!==m&&m!==Dl.active?Qe=m:m===Dl.active&&Qe&&(Qe=null),p===m&&(m._ignoreWhileAnimating=i),m.animateAll(function(){z("dragOverAnimationComplete"),m._ignoreWhileAnimating=null}),m!==p&&(p.animateAll(),p._ignoreWhileAnimating=null)),(i===je&&!je.animated||i===o&&!i.animated)&&(sl=null),s.dragoverBubble||e.rootEl||i===document||(je.parentNode[Te]._isOutsideThisEl(e.target),!l&&Il(e)),!s.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),v=!0}function T(){He=xe(je),Ge=xe(je,s.draggable),Me({sortable:m,name:"change",toEl:o,newIndex:He,newDraggableIndex:Ge,originalEvent:e})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){ce(document,"mousemove",this._onTouchMove),ce(document,"touchmove",this._onTouchMove),ce(document,"pointermove",this._onTouchMove),ce(document,"dragover",Il),ce(document,"mousemove",Il),ce(document,"touchmove",Il)},_offUpEvents:function(){var e=this.el.ownerDocument;ce(e,"mouseup",this._onDrop),ce(e,"touchend",this._onDrop),ce(e,"pointerup",this._onDrop),ce(e,"pointercancel",this._onDrop),ce(e,"touchcancel",this._onDrop),ce(document,"selectstart",this)},_onDrop:function(e){var l=this.el,a=this.options;He=xe(je),Ge=xe(je,a.draggable),Fe("drop",this,{evt:e}),Be=je&&je.parentNode,He=xe(je),Ge=xe(je,a.draggable),Dl.eventCanceled||(ul=!1,gl=!1,vl=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Pl(this.cloneId),Pl(this._dragStartId),this.nativeDraggable&&(ce(document,"drop",this),ce(l,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),ne&&fe(document.body,"user-select",""),fe(je,"transform",""),e&&(il&&(e.cancelable&&e.preventDefault(),!a.dropBubble&&e.stopPropagation()),Re&&Re.parentNode&&Re.parentNode.removeChild(Re),(Le===Be||Qe&&"clone"!==Qe.lastPutMode)&&Xe&&Xe.parentNode&&Xe.parentNode.removeChild(Xe),je&&(this.nativeDraggable&&ce(je,"dragend",this),Tl(je),je.style["will-change"]="",il&&!ul&&ge(je,Qe?Qe.options.ghostClass:this.options.ghostClass,!1),ge(je,this.options.chosenClass,!1),Me({sortable:this,name:"unchoose",toEl:Be,newIndex:null,newDraggableIndex:null,originalEvent:e}),Le!==Be?(He>=0&&(Me({rootEl:Be,name:"add",toEl:Be,fromEl:Le,originalEvent:e}),Me({sortable:this,name:"remove",toEl:Be,originalEvent:e}),Me({rootEl:Be,name:"sort",toEl:Be,fromEl:Le,originalEvent:e}),Me({sortable:this,name:"sort",toEl:Be,originalEvent:e})),Qe&&Qe.save()):He!==qe&&He>=0&&(Me({sortable:this,name:"update",toEl:Be,originalEvent:e}),Me({sortable:this,name:"sort",toEl:Be,originalEvent:e})),Dl.active&&(null!=He&&-1!==He||(He=qe,Ge=Je),Me({sortable:this,name:"end",toEl:Be,originalEvent:e}),this.save())))),this._nulling()},_nulling:function(){Fe("nulling",this),Le=je=Be=Re=Ke=Xe=Ye=We=el=ll=il=He=Ge=qe=Je=sl=rl=Qe=Ze=Dl.dragged=Dl.ghost=Dl.clone=Dl.active=null,yl.forEach(function(e){e.checked=!0}),yl.length=al=tl=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":je&&(this._onDragOver(e),function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move");e.cancelable&&e.preventDefault()}(e));break;case"selectstart":e.preventDefault()}},toArray:function(){for(var e,l=[],a=this.el.children,t=0,n=a.length,o=this.options;t<n;t++)pe(e=a[t],o.draggable,this.el,!1)&&l.push(e.getAttribute(o.dataIdAttr)||Al(e));return l},sort:function(e,l){var a={},t=this.el;this.toArray().forEach(function(e,l){var n=t.children[l];pe(n,this.options.draggable,t,!1)&&(a[e]=n)},this),l&&this.captureAnimationState(),e.forEach(function(e){a[e]&&(t.removeChild(a[e]),t.appendChild(a[e]))}),l&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,l){return pe(e,l||this.options.draggable,this.el,!1)},option:function(e,l){var a=this.options;if(void 0===l)return a[e];var t=Pe.modifyOption(this,e,l);a[e]=void 0!==t?t:l,"group"===e&&Cl(a)},destroy:function(){Fe("destroy",this);var e=this.el;e[Te]=null,ce(e,"mousedown",this._onTapStart),ce(e,"touchstart",this._onTapStart),ce(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(ce(e,"dragover",this),ce(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(e){e.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),ml.splice(ml.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!We){if(Fe("hideClone",this),Dl.eventCanceled)return;fe(Xe,"display","none"),this.options.removeCloneOnHide&&Xe.parentNode&&Xe.parentNode.removeChild(Xe),We=!0}},_showClone:function(e){if("clone"===e.lastPutMode){if(We){if(Fe("showClone",this),Dl.eventCanceled)return;je.parentNode!=Le||this.options.group.revertClone?Ke?Le.insertBefore(Xe,Ke):Le.appendChild(Xe):Le.insertBefore(Xe,je),this.options.group.revertClone&&this.animate(je,Xe),fe(Xe,"display",""),We=!1}}else this._hideClone()}},_l&&re(document,"touchmove",function(e){(Dl.active||ul)&&e.cancelable&&e.preventDefault()}),Dl.utils={on:re,off:ce,css:fe,find:ye,is:function(e,l){return!!pe(e,l,e,!1)},extend:function(e,l){if(e&&l)for(var a in l)l.hasOwnProperty(a)&&(e[a]=l[a]);return e},throttle:Ie,closest:pe,toggleClass:ge,clone:De,index:xe,nextTick:$l,cancelNextTick:Pl,detectDirection:xl,getChild:ke,expando:Te},Dl.get=function(e){return e[Te]},Dl.mount=function(){for(var e=arguments.length,l=new Array(e),a=0;a<e;a++)l[a]=arguments[a];l[0].constructor===Array&&(l=l[0]),l.forEach(function(e){if(!e.prototype||!e.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(e));e.utils&&(Dl.utils=H(H({},Dl.utils),e.utils)),Pe.mount(e)})},Dl.create=function(e,l){return new Dl(e,l)},Dl.version="1.15.6";var Nl,Fl,Ml,jl,Bl,Rl,Ll=[],Kl=!1;function Yl(){Ll.forEach(function(e){clearInterval(e.pid)}),Ll=[]}function Xl(){clearInterval(Rl)}var Wl=Ie(function(e,l,a,t){if(l.scroll){var n,o=(e.touches?e.touches[0]:e).clientX,i=(e.touches?e.touches[0]:e).clientY,s=l.scrollSensitivity,r=l.scrollSpeed,c=_e(),d=!1;Fl!==a&&(Fl=a,Yl(),Nl=l.scroll,n=l.scrollFn,!0===Nl&&(Nl=Se(a,!0)));var u=0,p=Nl;do{var m=p,v=be(m),g=v.top,f=v.bottom,h=v.left,y=v.right,_=v.width,b=v.height,w=void 0,k=void 0,V=m.scrollWidth,x=m.scrollHeight,C=fe(m),S=m.scrollLeft,E=m.scrollTop;m===c?(w=_<V&&("auto"===C.overflowX||"scroll"===C.overflowX||"visible"===C.overflowX),k=b<x&&("auto"===C.overflowY||"scroll"===C.overflowY||"visible"===C.overflowY)):(w=_<V&&("auto"===C.overflowX||"scroll"===C.overflowX),k=b<x&&("auto"===C.overflowY||"scroll"===C.overflowY));var I=w&&(Math.abs(y-o)<=s&&S+_<V)-(Math.abs(h-o)<=s&&!!S),z=k&&(Math.abs(f-i)<=s&&E+b<x)-(Math.abs(g-i)<=s&&!!E);if(!Ll[u])for(var D=0;D<=u;D++)Ll[D]||(Ll[D]={});Ll[u].vx==I&&Ll[u].vy==z&&Ll[u].el===m||(Ll[u].el=m,Ll[u].vx=I,Ll[u].vy=z,clearInterval(Ll[u].pid),0==I&&0==z||(d=!0,Ll[u].pid=setInterval(function(){t&&0===this.layer&&Dl.active._onTouchMove(Bl);var l=Ll[this.layer].vy?Ll[this.layer].vy*r:0,a=Ll[this.layer].vx?Ll[this.layer].vx*r:0;"function"==typeof n&&"continue"!==n.call(Dl.dragged.parentNode[Te],a,l,e,Bl,Ll[this.layer].el)||ze(Ll[this.layer].el,a,l)}.bind({layer:u}),24))),u++}while(l.bubbleScroll&&p!==c&&(p=Se(p,!1)));Kl=d}},30),ql=function(e){var l=e.originalEvent,a=e.putSortable,t=e.dragEl,n=e.activeSortable,o=e.dispatchSortableEvent,i=e.hideGhostForTarget,s=e.unhideGhostForTarget;if(l){var r=a||n;i();var c=l.changedTouches&&l.changedTouches.length?l.changedTouches[0]:l,d=document.elementFromPoint(c.clientX,c.clientY);s(),r&&!r.el.contains(d)&&(o("spill"),this.onSpill({dragEl:t,putSortable:a}))}};function Hl(){}function Jl(){}async function Gl(e){if(!e)return"";try{const l=await X.post("/translate/to-english",{text:e});return 0===l.code&&l.data?l.data.translated:(console.warn("翻译失败:",l.message),e)}catch(l){return console.error("翻译API调用失败:",l),e}}Hl.prototype={startIndex:null,dragStart:function(e){var l=e.oldDraggableIndex;this.startIndex=l},onSpill:function(e){var l=e.dragEl,a=e.putSortable;this.sortable.captureAnimationState(),a&&a.captureAnimationState();var t=ke(this.sortable.el,this.startIndex,this.options);t?this.sortable.el.insertBefore(l,t):this.sortable.el.appendChild(l),this.sortable.animateAll(),a&&a.animateAll()},drop:ql},Z(Hl,{pluginName:"revertOnSpill"}),Jl.prototype={onSpill:function(e){var l=e.dragEl,a=e.putSortable||this.sortable;a.captureAnimationState(),l.parentNode&&l.parentNode.removeChild(l),a.animateAll()},drop:ql},Z(Jl,{pluginName:"removeOnSpill"}),Dl.mount(new function(){function e(){for(var e in this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===e.charAt(0)&&"function"==typeof this[e]&&(this[e]=this[e].bind(this))}return e.prototype={dragStarted:function(e){var l=e.originalEvent;this.sortable.nativeDraggable?re(document,"dragover",this._handleAutoScroll):this.options.supportPointer?re(document,"pointermove",this._handleFallbackAutoScroll):l.touches?re(document,"touchmove",this._handleFallbackAutoScroll):re(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(e){var l=e.originalEvent;this.options.dragOverBubble||l.rootEl||this._handleAutoScroll(l)},drop:function(){this.sortable.nativeDraggable?ce(document,"dragover",this._handleAutoScroll):(ce(document,"pointermove",this._handleFallbackAutoScroll),ce(document,"touchmove",this._handleFallbackAutoScroll),ce(document,"mousemove",this._handleFallbackAutoScroll)),Xl(),Yl(),clearTimeout(me),me=void 0},nulling:function(){Bl=Fl=Nl=Kl=Rl=Ml=jl=null,Ll.length=0},_handleFallbackAutoScroll:function(e){this._handleAutoScroll(e,!0)},_handleAutoScroll:function(e,l){var a=this,t=(e.touches?e.touches[0]:e).clientX,n=(e.touches?e.touches[0]:e).clientY,o=document.elementFromPoint(t,n);if(Bl=e,l||this.options.forceAutoScrollFallback||ae||le||ne){Wl(e,this.options,o,l);var i=Se(o,!0);!Kl||Rl&&t===Ml&&n===jl||(Rl&&Xl(),Rl=setInterval(function(){var o=Se(document.elementFromPoint(t,n),!0);o!==i&&(i=o,Yl()),Wl(e,a.options,o,l)},10),Ml=t,jl=n)}else{if(!this.options.bubbleScroll||Se(o,!0)===_e())return void Yl();Wl(e,this.options,Se(o,!1),!1)}}},Z(e,{pluginName:"scroll",initializeByDefault:!0})}),Dl.mount(Jl,Hl);const Zl={class:"draw-pool-manager"},Ql={class:"toolbar"},ea={class:"toolbar-left"},la={class:"toolbar-right"},aa={class:"stats-bar"},ta={class:"batch-bar"},na={class:"batch-select-row"},oa={key:0,class:"batch-action-row"},ia={class:"selected-count"},sa={key:1,class:"placeholder-icon"},ra={class:"probability"},ca={class:"action-btns"},da={class:"image-picker"},ua={class:"image-picker-actions"},pa={class:"cos-picker"},ma={class:"cos-picker-header"},va={key:0,class:"filter-result"},ga={class:"cos-image-grid"},fa=["onClick"],ha={class:"cos-image-info"},ya={class:"cos-image-name"},_a={__name:"DrawPoolManager",props:{sceneId:{type:String,required:!0},stepKey:{type:String,default:""},showImage:{type:Boolean,default:!1}},setup(I,{expose:z}){const D=I,U=e([]),T=async()=>{if(D.sceneId&&D.stepKey)try{const e=await X.get(`/admin/grade-schemes/mapping/${D.sceneId}/${D.stepKey}`);if(0===e.code&&e.data&&e.data.grades)U.value=e.data.grades||[];else{const e=await X.get(`/admin/scenes/${D.sceneId}/draw-pool/${D.stepKey}/grades`);0===e.code&&(U.value=e.data||[])}}catch(e){try{const e=await X.get(`/admin/scenes/${D.sceneId}/draw-pool/${D.stepKey}/grades`);0===e.code&&(U.value=e.data||[])}catch(l){console.error("加载品级失败:",l)}}},O=e=>{const l=U.value.find(l=>l.grade_key===e||l.name===e);return(null==l?void 0:l.color)||"#909399"},A=e=>{const l=U.value.find(l=>l.grade_key===e||l.name===e);return(null==l?void 0:l.name)||e||"-"},$=e=>{if(!e.rarity||0===U.value.length)return"-";const l=U.value.reduce((e,l)=>e+(l.weight||0),0);if(0===l)return"-";const a=U.value.find(l=>l.grade_key===e.rarity||l.name===e.rarity);if(!a)return"-";const t=N.value.filter(l=>l.rarity===e.rarity&&1===l.is_active).length;if(0===t)return"-";const n=a.weight/l*(1/t)*100;return n<.01?"<0.01%":n<1?n.toFixed(2)+"%":n.toFixed(1)+"%"},P=e(!1),N=e([]),F=e(0),M=e(1),j=e(500),B=e(""),R=e(""),L=e(null),K=e([]),Y=e(""),W=e(""),q=e(!1),H=e(!1),J=e(!1),G=e(null),Z=e(!1),Q=e(!1),ee=e([]),le=e([]),ae=e([]),te=e(""),ne=e("all"),oe=e(""),ie={all:null,banner:["banner","banner-en","banner-tw"],scene:["scene","scenes"],"ai-generated":["ai-generated"],horses:["horses"],icon:["icon","icons"],misc:["misc","feedback"]},se=l({id:null,name:"",nameEn:"",image:"",rarity:"",promptText:""}),re=e(""),ce={name:[{required:!0,message:"请输入名称",trigger:"blur"}],rarity:[{required:!0,message:"请选择品级",trigger:"change"}]},de=a(()=>`draw-pool/${D.stepKey||"default"}`),ue=async()=>{if(D.sceneId&&D.stepKey){P.value=!0;try{const e={page:M.value,pageSize:j.value};B.value&&(e.rarity=B.value);const l=await X.get(`/admin/scenes/${D.sceneId}/${de.value}`,{params:e});if(0===l.code&&(N.value=l.data.list||l.data||[],F.value=l.data.total||N.value.length,R.value)){const e=R.value.toLowerCase();N.value=N.value.filter(l=>{var a,t;return(null==(a=l.name)?void 0:a.toLowerCase().includes(e))||(null==(t=l.name_en)?void 0:t.toLowerCase().includes(e))})}}catch(e){console.error("加载列表失败:",e)}finally{P.value=!1}}},pe=()=>{var e;J.value=!1,Object.assign(se,{id:null,name:"",nameEn:"",image:"",rarity:(null==(e=U.value[0])?void 0:e.name)||"",promptText:""}),q.value=!0},me=async()=>{try{await G.value.validate();const e={name:se.name,nameEn:se.nameEn,image:se.image||null,rarity:se.rarity,weight:100,promptText:se.promptText||se.name};J.value?(await X.put(`/admin/scenes/${D.sceneId}/${de.value}/${se.id}`,e),S.success("更新成功")):(await X.post(`/admin/scenes/${D.sceneId}/${de.value}`,e),S.success("添加成功")),q.value=!1,ue()}catch(e){"cancel"!==e&&(console.error("保存失败:",e),S.error("保存失败"))}},ve=e=>{K.value=e},ge=()=>{var e;null==(e=L.value)||e.clearSelection(),K.value=[],Y.value="",W.value=""},fe=e=>(M.value-1)*j.value+e+1,he=()=>{N.value.forEach(e=>{var l;null==(l=L.value)||l.toggleRowSelection(e,!0)})},ye=()=>{var e;if(!W.value.trim())return void S.warning("请输入序号范围");null==(e=L.value)||e.clearSelection();const l=new Set,a=W.value.split(",");for(const i of a){const e=i.trim();if(e.includes("-")){const[a,t]=e.split("-").map(e=>parseInt(e.trim()));if(!isNaN(a)&&!isNaN(t))for(let e=a;e<=t;e++)l.add(e)}else{const a=parseInt(e);isNaN(a)||l.add(a)}}const t=(M.value-1)*j.value+1,n=t+N.value.length-1;let o=0;l.forEach(e=>{var l;if(e>=t&&e<=n){const a=e-t;N.value[a]&&(null==(l=L.value)||l.toggleRowSelection(N.value[a],!0),o++)}}),o>0?S.success(`已选择 ${o} 项`):S.warning("未找到匹配的序号，请检查范围是否在当前页内")},_e=async()=>{if(K.value.length&&Y.value)try{const e=K.value.map(e=>e.id),l=U.value.find(e=>e.name===Y.value),a=(null==l?void 0:l.weight)||100;await X.put(`/admin/scenes/${D.sceneId}/${de.value}/batch-rarity`,{ids:e,rarity:Y.value,weight:a}),S.success(`已更新 ${e.length} 个词条的品级`),ge(),ue()}catch(e){console.error("批量设置品级失败:",e),S.error("批量设置品级失败")}},be=()=>{re.value="",H.value=!0},we=async()=>{if(!re.value.trim())return void S.warning("请输入要导入的数据");const e=re.value.trim().split("\n"),l=[],a=U.value.map(e=>e.name);for(const n of e){const e=n.split(",").map(e=>e.trim());if(e[0]){const t=e[2]||a[0]||"";if(!a.includes(t))return void S.warning(`品级"${t}"不存在，请先在品级管理中添加`);l.push({name:e[0],nameEn:e[1]||"",rarity:t,weight:100})}}if(0!==l.length)try{await X.post(`/admin/scenes/${D.sceneId}/${de.value}/batch`,{items:l}),S.success(`成功导入 ${l.length} 项`),H.value=!1,ue()}catch(t){console.error("批量导入失败:",t),S.error("批量导入失败")}else S.warning("没有有效的数据")};async function ke(){oe.value=se.image||"",Z.value=!0,await Ve()}async function Ve(){Q.value=!0;try{const e=await X.get("/photos/cos-images");200===e.code||0===e.code?(ee.value=e.data||[],ae.value=e.folders||[],Ce()):S.warning("素材加载失败")}catch(e){console.error("加载COS图片失败:",e),S.error("加载图片列表失败")}finally{Q.value=!1}}function xe(){Ce()}function Ce(){let e=ee.value;if("all"!==ne.value){const l=ie[ne.value]||[];l.length>0&&(e=e.filter(e=>{const a=(e.folderPath||"").toLowerCase();return l.some(e=>a.includes(e.toLowerCase()))}))}if(te.value){const l=te.value.toLowerCase();e=e.filter(e=>{var a,t;return(null==(a=e.fileName)?void 0:a.toLowerCase().includes(l))||(null==(t=e.key)?void 0:t.toLowerCase().includes(l))})}le.value=e}function Se(){oe.value&&(se.image=oe.value,S.success("图片已选择")),Z.value=!1}return t(()=>D.sceneId,e=>{e&&D.stepKey&&(T(),ue())}),t(()=>D.stepKey,e=>{D.sceneId&&e&&(T(),ue())}),n(()=>{D.sceneId&&D.stepKey&&(T(),ue())}),z({reload:()=>{T(),ue()}}),(e,l)=>{const a=o("el-option"),t=o("el-select"),n=o("el-input"),z=o("el-button"),T=o("el-table-column"),M=o("el-image"),j=o("el-tag"),ee=o("el-switch"),ae=o("el-table"),ie=o("el-form-item"),Ee=o("el-form"),Ie=o("el-dialog"),ze=o("el-alert"),De=o("el-tab-pane"),Ue=o("el-tabs"),Te=o("el-icon"),Oe=o("el-empty"),Ae=i("loading");return r(),s("div",Zl,[c("div",Ql,[c("div",ea,[u(t,{modelValue:B.value,"onUpdate:modelValue":l[0]||(l[0]=e=>B.value=e),placeholder:"品级筛选",clearable:"",size:"small",style:{width:"100px"},onChange:ue},{default:p(()=>[u(a,{label:"全部",value:""}),(r(!0),s(m,null,v(U.value,e=>(r(),g(a,{key:e.id,label:e.name,value:e.grade_key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),u(n,{modelValue:R.value,"onUpdate:modelValue":l[1]||(l[1]=e=>R.value=e),placeholder:"搜索",clearable:"",size:"small",style:{width:"120px"},onClear:ue,onKeyup:f(ue,["enter"])},null,8,["modelValue"]),u(z,{icon:h(y),size:"small",onClick:ue},null,8,["icon"])]),c("div",la,[u(z,{type:"primary",size:"small",icon:h(b),onClick:pe,disabled:0===U.value.length},{default:p(()=>[...l[18]||(l[18]=[_("添加",-1)])]),_:1},8,["icon","disabled"]),u(z,{size:"small",icon:h(w),onClick:be,disabled:0===U.value.length},{default:p(()=>[...l[19]||(l[19]=[_("批量导入",-1)])]),_:1},8,["icon","disabled"])])]),c("div",aa,[c("span",null,"共 "+k(F.value)+" 项",1),(r(!0),s(m,null,v(U.value,e=>{return r(),s("span",{key:e.id,class:"stat-item",style:V({background:e.color})},k(e.name)+": "+k((l=e.grade_key,N.value.filter(e=>e.rarity===l).length)),5);var l}),128))]),c("div",ta,[c("div",na,[l[23]||(l[23]=c("span",{class:"batch-label"},"快速选择:",-1)),u(n,{modelValue:W.value,"onUpdate:modelValue":l[2]||(l[2]=e=>W.value=e),placeholder:"序号范围，如 1-20 或 1,3,5,10-15",size:"small",style:{width:"200px"},onKeyup:f(ye,["enter"])},null,8,["modelValue"]),u(z,{size:"small",onClick:ye},{default:p(()=>[...l[20]||(l[20]=[_("选取",-1)])]),_:1}),u(z,{size:"small",onClick:he},{default:p(()=>[...l[21]||(l[21]=[_("全选",-1)])]),_:1}),K.value.length>0?(r(),g(z,{key:0,size:"small",onClick:ge},{default:p(()=>[...l[22]||(l[22]=[_("清除",-1)])]),_:1})):x("",!0)]),K.value.length>0?(r(),s("div",oa,[c("span",ia,"已选 "+k(K.value.length)+" 项",1),u(t,{modelValue:Y.value,"onUpdate:modelValue":l[3]||(l[3]=e=>Y.value=e),placeholder:"选择品级",size:"small",style:{width:"100px"}},{default:p(()=>[(r(!0),s(m,null,v(U.value,e=>(r(),g(a,{key:e.id,label:e.name,value:e.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),u(z,{type:"primary",size:"small",onClick:_e,disabled:!Y.value},{default:p(()=>[...l[24]||(l[24]=[_("设置品级",-1)])]),_:1},8,["disabled"])])):x("",!0)]),d((r(),g(ae,{ref_key:"tableRef",ref:L,data:N.value,stripe:"",size:"small","max-height":"500",onSelectionChange:ve},{default:p(()=>[u(T,{type:"index",label:"#",width:"45",index:fe}),u(T,{type:"selection",width:"40"}),I.showImage?(r(),g(T,{key:0,prop:"image",label:"图",width:"50",align:"center"},{default:p(({row:e})=>[e.image?(r(),g(M,{key:0,src:e.image,style:{width:"30px",height:"30px"},fit:"cover","preview-src-list":[e.image]},null,8,["src","preview-src-list"])):(r(),s("span",sa,"-"))]),_:1})):x("",!0),u(T,{prop:"name",label:"名称",width:"100","show-overflow-tooltip":""}),u(T,{prop:"name_en",label:"英文","min-width":"140","show-overflow-tooltip":""}),u(T,{prop:"rarity",label:"品级",width:"100",align:"center"},{default:p(({row:e})=>[u(j,{size:"small",color:O(e.rarity),style:{color:"#fff",border:"none"}},{default:p(()=>[_(k(A(e.rarity)),1)]),_:2},1032,["color"])]),_:1}),u(T,{label:"概率",width:"60",align:"center"},{default:p(({row:e})=>[c("span",ra,k($(e)),1)]),_:1}),u(T,{prop:"is_active",label:"启用",width:"55",align:"center"},{default:p(({row:e})=>[u(ee,{modelValue:e.is_active,"onUpdate:modelValue":l=>e.is_active=l,"active-value":1,"inactive-value":0,onChange:l=>(async e=>{try{await X.put(`/admin/scenes/${D.sceneId}/${de.value}/${e.id}`,{isActive:e.is_active})}catch(l){console.error("更新失败:",l),S.error("更新失败"),e.is_active=1===e.is_active?0:1}})(e),size:"small"},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),u(T,{label:"操作",width:"90",align:"center",fixed:"right"},{default:p(({row:e})=>[c("div",ca,[u(z,{type:"primary",link:"",size:"small",onClick:l=>(e=>{J.value=!0,Object.assign(se,{id:e.id,name:e.name,nameEn:e.name_en,image:e.image||"",rarity:e.rarity||"",promptText:e.prompt_text||""}),q.value=!0})(e)},{default:p(()=>[...l[25]||(l[25]=[_("编辑",-1)])]),_:1},8,["onClick"]),u(z,{type:"danger",link:"",size:"small",onClick:l=>(async e=>{try{await E.confirm(`确定删除"${e.name}"吗？`,"确认删除",{type:"warning"}),await X.delete(`/admin/scenes/${D.sceneId}/${de.value}/${e.id}`),S.success("删除成功"),ue()}catch(l){"cancel"!==l&&(console.error("删除失败:",l),S.error("删除失败"))}})(e)},{default:p(()=>[...l[26]||(l[26]=[_("删除",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[Ae,P.value]]),u(Ie,{modelValue:q.value,"onUpdate:modelValue":l[10]||(l[10]=e=>q.value=e),title:J.value?"编辑词条":"添加词条",width:"450px"},{footer:p(()=>[u(z,{size:"small",onClick:l[9]||(l[9]=e=>q.value=!1)},{default:p(()=>[...l[29]||(l[29]=[_("取消",-1)])]),_:1}),u(z,{type:"primary",size:"small",onClick:me},{default:p(()=>[...l[30]||(l[30]=[_("保存",-1)])]),_:1})]),default:p(()=>[u(Ee,{model:se,rules:ce,ref_key:"formRef",ref:G,"label-width":"80px",size:"small"},{default:p(()=>[u(ie,{label:"名称",prop:"name"},{default:p(()=>[u(n,{modelValue:se.name,"onUpdate:modelValue":l[4]||(l[4]=e=>se.name=e),placeholder:"如：马到成功"},null,8,["modelValue"])]),_:1}),u(ie,{label:"英文"},{default:p(()=>[u(n,{modelValue:se.nameEn,"onUpdate:modelValue":l[5]||(l[5]=e=>se.nameEn=e),placeholder:"如：Instant Success"},null,8,["modelValue"])]),_:1}),I.showImage?(r(),g(ie,{key:0,label:"图片"},{default:p(()=>[c("div",da,[se.image?(r(),g(M,{key:0,src:se.image,fit:"cover",style:{width:"80px",height:"80px","border-radius":"4px","margin-right":"10px"}},null,8,["src"])):x("",!0),c("div",ua,[u(z,{size:"small",onClick:ke},{default:p(()=>[...l[27]||(l[27]=[_("选择素材",-1)])]),_:1}),se.image?(r(),g(z,{key:0,size:"small",type:"danger",onClick:l[6]||(l[6]=e=>se.image="")},{default:p(()=>[...l[28]||(l[28]=[_("清除",-1)])]),_:1})):x("",!0)])])]),_:1})):x("",!0),u(ie,{label:"品级",prop:"rarity"},{default:p(()=>[u(t,{modelValue:se.rarity,"onUpdate:modelValue":l[7]||(l[7]=e=>se.rarity=e),style:{width:"100%"}},{default:p(()=>[(r(!0),s(m,null,v(U.value,e=>(r(),g(a,{key:e.id,label:e.name,value:e.grade_key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),u(ie,{label:"Prompt"},{default:p(()=>[u(n,{modelValue:se.promptText,"onUpdate:modelValue":l[8]||(l[8]=e=>se.promptText=e),type:"textarea",rows:2,placeholder:"用于AI生成的文本描述（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),u(Ie,{modelValue:H.value,"onUpdate:modelValue":l[13]||(l[13]=e=>H.value=e),title:"批量导入词条",width:"500px"},{footer:p(()=>[u(z,{size:"small",onClick:l[12]||(l[12]=e=>H.value=!1)},{default:p(()=>[...l[32]||(l[32]=[_("取消",-1)])]),_:1}),u(z,{type:"primary",size:"small",onClick:we},{default:p(()=>[...l[33]||(l[33]=[_("导入",-1)])]),_:1})]),default:p(()=>[u(ze,{type:"info",closable:!1,style:{"margin-bottom":"15px"}},{title:p(()=>[...l[31]||(l[31]=[_(" 每行一项，格式：名称,英文,品级",-1),c("br",null,null,-1),_(" 品级必须是已定义的品级名称",-1),c("br",null,null,-1),_(" 示例：马到成功,Instant Success,rare ",-1)])]),_:1}),u(n,{modelValue:re.value,"onUpdate:modelValue":l[11]||(l[11]=e=>re.value=e),type:"textarea",rows:8,placeholder:"马到成功,Instant Success,rare\n龙马精神,Vigorous Spirit,epic\n万事如意,All the Best,common"},null,8,["modelValue"])]),_:1},8,["modelValue"]),u(Ie,{modelValue:Z.value,"onUpdate:modelValue":l[17]||(l[17]=e=>Z.value=e),title:"选择素材图片",width:"85%",style:{"max-width":"900px"}},{footer:p(()=>[u(z,{onClick:l[16]||(l[16]=e=>Z.value=!1)},{default:p(()=>[...l[35]||(l[35]=[_("取消",-1)])]),_:1}),u(z,{type:"primary",onClick:Se,disabled:!oe.value},{default:p(()=>[...l[36]||(l[36]=[_("确定选择",-1)])]),_:1},8,["disabled"])]),default:p(()=>[c("div",pa,[u(Ue,{modelValue:ne.value,"onUpdate:modelValue":l[14]||(l[14]=e=>ne.value=e),type:"card",onTabChange:xe},{default:p(()=>[u(De,{label:"全部",name:"all"}),u(De,{label:"Banner",name:"banner"}),u(De,{label:"场景素材",name:"scene"}),u(De,{label:"AI生成",name:"ai-generated"}),u(De,{label:"马匹素材",name:"horses"}),u(De,{label:"图标",name:"icon"}),u(De,{label:"其他",name:"misc"})]),_:1},8,["modelValue"]),c("div",ma,[u(n,{modelValue:te.value,"onUpdate:modelValue":l[15]||(l[15]=e=>te.value=e),placeholder:"搜索文件名...",clearable:"",style:{width:"200px"},onInput:Ce},{prefix:p(()=>[u(Te,null,{default:p(()=>[u(h(y))]),_:1})]),_:1},8,["modelValue"]),u(z,{onClick:Ve,loading:Q.value},{default:p(()=>[...l[34]||(l[34]=[_("刷新",-1)])]),_:1},8,["loading"]),le.value.length>0?(r(),s("span",va,"共 "+k(le.value.length)+" 张",1)):x("",!0)]),d((r(),s("div",ga,[(r(!0),s(m,null,v(le.value,e=>(r(),s("div",{key:e.key,class:C(["cos-image-item",{selected:oe.value===e.url}]),onClick:l=>function(e){oe.value=e.url}(e)},[u(M,{src:e.url,fit:"cover",lazy:""},null,8,["src"]),c("div",ha,[c("div",ya,k(e.fileName),1)])],10,fa))),128)),Q.value||0!==le.value.length?x("",!0):(r(),g(Oe,{key:0,description:"暂无图片"}))])),[[Ae,Q.value]])])]),_:1},8,["modelValue"])])}}},ba=W(_a,[["__scopeId","data-v-b1485b6b"]]),wa={class:"grade-style-editor"},ka={class:"editor-layout"},Va={class:"config-panel"},xa={class:"config-section"},Ca={class:"config-item"},Sa={key:0,class:"config-item"},Ea={class:"config-item"},Ia={class:"gradient-colors"},za={class:"config-item"},Da={class:"config-section"},Ua={class:"config-item"},Ta={class:"config-item"},Oa={class:"config-item"},Aa={class:"config-item"},$a={class:"config-section"},Pa={class:"config-item"},Na={class:"config-item"},Fa={class:"config-item"},Ma={class:"config-item"},ja={class:"config-section"},Ba={class:"config-item"},Ra={class:"config-item"},La={class:"config-item"},Ka={class:"config-item"},Ya={class:"config-section"},Xa={class:"config-item"},Wa={key:0,class:"config-item"},qa={class:"config-section"},Ha={class:"config-item"},Ja={class:"config-item"},Ga={class:"presets-section"},Za={class:"presets-list"},Qa=["onClick"],et={class:"preview-panel"},lt={class:"preview-container"},at={class:"preview-subtext"},tt={class:"editor-footer"},nt=W({__name:"GradeStyleEditor",props:{grade:{type:Object,required:!0}},emits:["save","cancel"],setup(i,{emit:d}){const g=i,f=d,h=e("background"),y=e("马到成功"),b=l({card:{background:{type:"gradient",color:"#409eff",colors:["#FFD700","#FFA500"],direction:"135deg"},border:{width:"2rpx",style:"solid",color:"#B8860B",radius:"16rpx"},shadow:{x:"0",y:"8rpx",blur:"30rpx",color:"rgba(255, 215, 0, 0.3)"}},text:{primary:{color:"#C41E3A",fontSize:"56rpx",fontWeight:"bold",letterSpacing:"8rpx"}},badge:{background:{type:"solid",color:"#C41E3A"},textColor:"#FFD700"},animation:{type:"none",duration:"2s"}}),w=a({get:()=>parseInt(b.text.primary.fontSize)||56,set:e=>{b.text.primary.fontSize=e+"rpx"}}),S=a({get:()=>parseInt(b.text.primary.letterSpacing)||8,set:e=>{b.text.primary.letterSpacing=e+"rpx"}}),E=a({get:()=>parseInt(b.card.border.width)||2,set:e=>{b.card.border.width=e+"rpx"}}),I=a({get:()=>parseInt(b.card.border.radius)||16,set:e=>{b.card.border.radius=e+"rpx"}}),z=a({get:()=>parseInt(b.card.shadow.blur)||30,set:e=>{b.card.shadow.blur=e+"rpx"}}),D=a({get:()=>parseInt(b.card.shadow.y)||8,set:e=>{b.card.shadow.y=e+"rpx"}}),U=a({get:()=>"0rpx"!==b.card.shadow.blur,set:e=>{e?(b.card.shadow.blur="30rpx",b.card.shadow.y="8rpx"):(b.card.shadow.blur="0rpx",b.card.shadow.y="0rpx")}}),T=a({get:()=>b.badge.background.color||"#C41E3A",set:e=>{b.badge.background.color=e}}),O=a(()=>{const e={};"gradient"===b.card.background.type?e.background=`linear-gradient(${b.card.background.direction}, ${b.card.background.colors.join(", ")})`:e.background=b.card.background.color;const l=parseInt(b.card.border.width)||0;if(e.border=`${l}px ${b.card.border.style} ${b.card.border.color}`,e.borderRadius=(parseInt(b.card.border.radius)||0)+"px",U.value){const l=parseInt(b.card.shadow.y)||0,a=parseInt(b.card.shadow.blur)||0;e.boxShadow=`0 ${l}px ${a}px ${b.card.shadow.color}`}return e}),A=a(()=>({color:b.text.primary.color,fontSize:(parseInt(b.text.primary.fontSize)||56)/2+"px",fontWeight:b.text.primary.fontWeight,letterSpacing:(parseInt(b.text.primary.letterSpacing)||0)/2+"px"})),$=a(()=>({background:b.badge.background.color,color:b.badge.textColor})),P=a(()=>"none"===b.animation.type?"":`animation-${b.animation.type}`),N=[{name:"gold-red",label:"金底红字",config:{card:{background:{type:"gradient",colors:["#FFD700","#FFA500"],direction:"135deg"},border:{width:"4rpx",style:"solid",color:"#B8860B",radius:"16rpx"},shadow:{x:"0",y:"8rpx",blur:"40rpx",color:"rgba(255, 215, 0, 0.5)"}},text:{primary:{color:"#C41E3A",fontSize:"64rpx",fontWeight:"bold",letterSpacing:"12rpx"}},badge:{background:{type:"solid",color:"#C41E3A"},textColor:"#FFD700"},animation:{type:"shimmer",duration:"3s"}}},{name:"red-gold",label:"红底金字",config:{card:{background:{type:"gradient",colors:["#DC143C","#8B0000"],direction:"135deg"},border:{width:"3rpx",style:"solid",color:"#FFD700",radius:"16rpx"},shadow:{x:"0",y:"6rpx",blur:"30rpx",color:"rgba(220, 20, 60, 0.4)"}},text:{primary:{color:"#FFD700",fontSize:"56rpx",fontWeight:"bold",letterSpacing:"10rpx"}},badge:{background:{type:"solid",color:"#FFD700"},textColor:"#8B0000"},animation:{type:"pulse",duration:"2s"}}},{name:"light-red",label:"浅红白字",config:{card:{background:{type:"gradient",colors:["#FF6B6B","#EE5A5A"],direction:"135deg"},border:{width:"2rpx",style:"solid",color:"#FFFFFF",radius:"16rpx"},shadow:{x:"0",y:"4rpx",blur:"20rpx",color:"rgba(255, 107, 107, 0.3)"}},text:{primary:{color:"#FFFFFF",fontSize:"52rpx",fontWeight:"bold",letterSpacing:"8rpx"}},badge:{background:{type:"solid",color:"#FFFFFF"},textColor:"#FF6B6B"},animation:{type:"none",duration:"2s"}}},{name:"pink",label:"粉色调",config:{card:{background:{type:"gradient",colors:["#FFB6C1","#FF69B4"],direction:"135deg"},border:{width:"2rpx",style:"solid",color:"#FFFFFF",radius:"16rpx"},shadow:{x:"0",y:"4rpx",blur:"15rpx",color:"rgba(255, 182, 193, 0.3)"}},text:{primary:{color:"#8B0000",fontSize:"48rpx",fontWeight:"bold",letterSpacing:"6rpx"}},badge:{background:{type:"solid",color:"#8B0000"},textColor:"#FFB6C1"},animation:{type:"none",duration:"2s"}}},{name:"dark",label:"灰黑色",config:{card:{background:{type:"gradient",colors:["#4A4A4A","#2C2C2C"],direction:"135deg"},border:{width:"2rpx",style:"solid",color:"#666666",radius:"16rpx"},shadow:{x:"0",y:"4rpx",blur:"15rpx",color:"rgba(0, 0, 0, 0.3)"}},text:{primary:{color:"#AAAAAA",fontSize:"48rpx",fontWeight:"normal",letterSpacing:"6rpx"}},badge:{background:{type:"solid",color:"#666666"},textColor:"#CCCCCC"},animation:{type:"none",duration:"2s"}}}],F=e=>{const l=e.config.card.background;return"gradient"===l.type?{background:`linear-gradient(${l.direction}, ${l.colors.join(", ")})`}:{background:l.color}},M=()=>{B()},j=()=>{f("save",JSON.parse(JSON.stringify(b)))},B=()=>{const e=g.grade.styleConfig||g.grade.style_config;if(e){const l="string"==typeof e?JSON.parse(e):e;l.card&&Object.assign(b.card,l.card),l.text&&Object.assign(b.text,l.text),l.badge&&Object.assign(b.badge,l.badge),l.animation&&Object.assign(b.animation,l.animation)}else b.card.background.colors[0]=g.grade.color||"#409eff",b.card.background.colors[1]=g.grade.color||"#409eff"};return n(()=>{B()}),t(()=>g.grade,()=>{B()},{deep:!0}),(e,l)=>{const a=o("el-radio-button"),t=o("el-radio-group"),n=o("el-color-picker"),d=o("el-option"),g=o("el-select"),f=o("el-tab-pane"),B=o("el-slider"),R=o("el-switch"),L=o("el-tabs"),K=o("el-button");return r(),s("div",wa,[c("div",ka,[c("div",Va,[u(L,{modelValue:h.value,"onUpdate:modelValue":l[21]||(l[21]=e=>h.value=e)},{default:p(()=>[u(f,{label:"背景",name:"background"},{default:p(()=>[c("div",xa,[c("div",Ca,[l[25]||(l[25]=c("span",{class:"config-label"},"背景类型",-1)),u(t,{modelValue:b.card.background.type,"onUpdate:modelValue":l[0]||(l[0]=e=>b.card.background.type=e),size:"small"},{default:p(()=>[u(a,{label:"solid"},{default:p(()=>[...l[23]||(l[23]=[_("纯色",-1)])]),_:1}),u(a,{label:"gradient"},{default:p(()=>[...l[24]||(l[24]=[_("渐变",-1)])]),_:1})]),_:1},8,["modelValue"])]),"solid"===b.card.background.type?(r(),s("div",Sa,[l[26]||(l[26]=c("span",{class:"config-label"},"背景颜色",-1)),u(n,{modelValue:b.card.background.color,"onUpdate:modelValue":l[1]||(l[1]=e=>b.card.background.color=e),"show-alpha":""},null,8,["modelValue"])])):(r(),s(m,{key:1},[c("div",Ea,[l[28]||(l[28]=c("span",{class:"config-label"},"渐变颜色",-1)),c("div",Ia,[u(n,{modelValue:b.card.background.colors[0],"onUpdate:modelValue":l[2]||(l[2]=e=>b.card.background.colors[0]=e),"show-alpha":""},null,8,["modelValue"]),l[27]||(l[27]=c("span",{class:"arrow"},"→",-1)),u(n,{modelValue:b.card.background.colors[1],"onUpdate:modelValue":l[3]||(l[3]=e=>b.card.background.colors[1]=e),"show-alpha":""},null,8,["modelValue"])])]),c("div",za,[l[29]||(l[29]=c("span",{class:"config-label"},"渐变方向",-1)),u(g,{modelValue:b.card.background.direction,"onUpdate:modelValue":l[4]||(l[4]=e=>b.card.background.direction=e),size:"small",style:{width:"120px"}},{default:p(()=>[u(d,{label:"↘ 135°",value:"135deg"}),u(d,{label:"→ 90°",value:"90deg"}),u(d,{label:"↓ 180°",value:"180deg"}),u(d,{label:"↗ 45°",value:"45deg"}),u(d,{label:"← 270°",value:"270deg"})]),_:1},8,["modelValue"])])],64))])]),_:1}),u(f,{label:"文字",name:"text"},{default:p(()=>[c("div",Da,[c("div",Ua,[l[30]||(l[30]=c("span",{class:"config-label"},"文字颜色",-1)),u(n,{modelValue:b.text.primary.color,"onUpdate:modelValue":l[5]||(l[5]=e=>b.text.primary.color=e)},null,8,["modelValue"])]),c("div",Ta,[l[31]||(l[31]=c("span",{class:"config-label"},"字号",-1)),u(B,{modelValue:w.value,"onUpdate:modelValue":l[6]||(l[6]=e=>w.value=e),min:24,max:80,step:2,"show-input":"",size:"small"},null,8,["modelValue"])]),c("div",Oa,[l[32]||(l[32]=c("span",{class:"config-label"},"字重",-1)),u(g,{modelValue:b.text.primary.fontWeight,"onUpdate:modelValue":l[7]||(l[7]=e=>b.text.primary.fontWeight=e),size:"small",style:{width:"120px"}},{default:p(()=>[u(d,{label:"正常",value:"normal"}),u(d,{label:"中等",value:"500"}),u(d,{label:"粗体",value:"bold"}),u(d,{label:"特粗",value:"800"})]),_:1},8,["modelValue"])]),c("div",Aa,[l[33]||(l[33]=c("span",{class:"config-label"},"字间距",-1)),u(B,{modelValue:S.value,"onUpdate:modelValue":l[8]||(l[8]=e=>S.value=e),min:0,max:20,step:1,"show-input":"",size:"small"},null,8,["modelValue"])])])]),_:1}),u(f,{label:"边框",name:"border"},{default:p(()=>[c("div",$a,[c("div",Pa,[l[34]||(l[34]=c("span",{class:"config-label"},"边框宽度",-1)),u(B,{modelValue:E.value,"onUpdate:modelValue":l[9]||(l[9]=e=>E.value=e),min:0,max:10,step:1,"show-input":"",size:"small"},null,8,["modelValue"])]),c("div",Na,[l[35]||(l[35]=c("span",{class:"config-label"},"边框颜色",-1)),u(n,{modelValue:b.card.border.color,"onUpdate:modelValue":l[10]||(l[10]=e=>b.card.border.color=e),"show-alpha":""},null,8,["modelValue"])]),c("div",Fa,[l[36]||(l[36]=c("span",{class:"config-label"},"边框样式",-1)),u(g,{modelValue:b.card.border.style,"onUpdate:modelValue":l[11]||(l[11]=e=>b.card.border.style=e),size:"small",style:{width:"120px"}},{default:p(()=>[u(d,{label:"实线",value:"solid"}),u(d,{label:"虚线",value:"dashed"}),u(d,{label:"点线",value:"dotted"}),u(d,{label:"双线",value:"double"})]),_:1},8,["modelValue"])]),c("div",Ma,[l[37]||(l[37]=c("span",{class:"config-label"},"圆角",-1)),u(B,{modelValue:I.value,"onUpdate:modelValue":l[12]||(l[12]=e=>I.value=e),min:0,max:30,step:2,"show-input":"",size:"small"},null,8,["modelValue"])])])]),_:1}),u(f,{label:"阴影",name:"shadow"},{default:p(()=>[c("div",ja,[c("div",Ba,[l[38]||(l[38]=c("span",{class:"config-label"},"启用阴影",-1)),u(R,{modelValue:U.value,"onUpdate:modelValue":l[13]||(l[13]=e=>U.value=e)},null,8,["modelValue"])]),U.value?(r(),s(m,{key:0},[c("div",Ra,[l[39]||(l[39]=c("span",{class:"config-label"},"阴影颜色",-1)),u(n,{modelValue:b.card.shadow.color,"onUpdate:modelValue":l[14]||(l[14]=e=>b.card.shadow.color=e),"show-alpha":""},null,8,["modelValue"])]),c("div",La,[l[40]||(l[40]=c("span",{class:"config-label"},"模糊半径",-1)),u(B,{modelValue:z.value,"onUpdate:modelValue":l[15]||(l[15]=e=>z.value=e),min:0,max:50,step:2,"show-input":"",size:"small"},null,8,["modelValue"])]),c("div",Ka,[l[41]||(l[41]=c("span",{class:"config-label"},"Y偏移",-1)),u(B,{modelValue:D.value,"onUpdate:modelValue":l[16]||(l[16]=e=>D.value=e),min:0,max:20,step:1,"show-input":"",size:"small"},null,8,["modelValue"])])],64)):x("",!0)])]),_:1}),u(f,{label:"动画",name:"animation"},{default:p(()=>[c("div",Ya,[c("div",Xa,[l[42]||(l[42]=c("span",{class:"config-label"},"动画效果",-1)),u(g,{modelValue:b.animation.type,"onUpdate:modelValue":l[17]||(l[17]=e=>b.animation.type=e),size:"small",style:{width:"150px"}},{default:p(()=>[u(d,{label:"无",value:"none"}),u(d,{label:"闪烁",value:"shimmer"}),u(d,{label:"发光",value:"glow"}),u(d,{label:"脉冲",value:"pulse"})]),_:1},8,["modelValue"])]),"none"!==b.animation.type?(r(),s("div",Wa,[l[43]||(l[43]=c("span",{class:"config-label"},"动画时长",-1)),u(g,{modelValue:b.animation.duration,"onUpdate:modelValue":l[18]||(l[18]=e=>b.animation.duration=e),size:"small",style:{width:"120px"}},{default:p(()=>[u(d,{label:"快速 (1s)",value:"1s"}),u(d,{label:"正常 (2s)",value:"2s"}),u(d,{label:"慢速 (3s)",value:"3s"})]),_:1},8,["modelValue"])])):x("",!0)])]),_:1}),u(f,{label:"徽章",name:"badge"},{default:p(()=>[c("div",qa,[c("div",Ha,[l[44]||(l[44]=c("span",{class:"config-label"},"徽章背景",-1)),u(n,{modelValue:T.value,"onUpdate:modelValue":l[19]||(l[19]=e=>T.value=e)},null,8,["modelValue"])]),c("div",Ja,[l[45]||(l[45]=c("span",{class:"config-label"},"徽章文字",-1)),u(n,{modelValue:b.badge.textColor,"onUpdate:modelValue":l[20]||(l[20]=e=>b.badge.textColor=e)},null,8,["modelValue"])])])]),_:1})]),_:1},8,["modelValue"]),c("div",Ga,[l[46]||(l[46]=c("div",{class:"presets-header"},"快速预设",-1)),c("div",Za,[(r(),s(m,null,v(N,e=>c("div",{key:e.name,class:"preset-item",style:V(F(e)),onClick:l=>(e=>{Object.assign(b.card,JSON.parse(JSON.stringify(e.config.card))),Object.assign(b.text,JSON.parse(JSON.stringify(e.config.text))),Object.assign(b.badge,JSON.parse(JSON.stringify(e.config.badge))),Object.assign(b.animation,JSON.parse(JSON.stringify(e.config.animation)))})(e)},k(e.label),13,Qa)),64))])])]),c("div",et,[l[47]||(l[47]=c("div",{class:"preview-header"},"实时预览",-1)),c("div",lt,[c("div",{class:C(["preview-card",P.value]),style:V(O.value)},[c("div",{class:"preview-badge",style:V($.value)},k(i.grade.name),5),c("div",{class:"preview-text",style:V(A.value)},k(y.value),5),c("div",at,k(i.grade.name_en||"English Name"),1)],6)]),l[48]||(l[48]=c("div",{class:"preview-tip"}," 预览效果仅供参考，实际效果以小程序端为准 ",-1))])]),c("div",tt,[u(K,{onClick:l[22]||(l[22]=l=>e.$emit("cancel"))},{default:p(()=>[...l[49]||(l[49]=[_("取消",-1)])]),_:1}),u(K,{onClick:M},{default:p(()=>[...l[50]||(l[50]=[_("重置",-1)])]),_:1}),u(K,{type:"primary",onClick:j},{default:p(()=>[...l[51]||(l[51]=[_("保存样式",-1)])]),_:1})])])}}},[["__scopeId","data-v-3e39388b"]]),ot={class:"grade-scheme-manager"},it={class:"scheme-selector"},st={class:"selector-header"},rt={key:0,class:"scheme-detail"},ct={class:"scheme-header"},dt={class:"scheme-info"},ut={class:"scheme-name"},pt={class:"scheme-actions"},mt={class:"grades-section"},vt={class:"section-header"},gt={key:0,class:"grades-list"},ft={class:"drag-handle"},ht={class:"preview-text"},yt={class:"grade-info"},_t={class:"grade-name"},bt={class:"grade-meta"},wt={class:"grade-actions"},kt={key:1,class:"grades-empty"},Vt={key:1,class:"no-scheme-tip"},xt={class:"input-with-translate"},Ct={class:"input-with-translate"},St=W({__name:"GradeSchemeManager",props:{sceneId:{type:String,required:!0},stepKey:{type:String,required:!0}},emits:["change"],setup(a,{expose:i,emit:d}){const f=a,y=d,w=e([]),C=e(null),O=e(null),A=e([]),$=e(!1),P=e(!1),N=e(null),F=l({id:null,schemeKey:"",name:"",nameEn:"",description:"",category:"general"}),M={schemeKey:[{required:!0,message:"请输入方案标识",trigger:"blur"}],name:[{required:!0,message:"请输入方案名称",trigger:"blur"}]},j=async()=>{try{const e=await X.get("/admin/grade-schemes");0===e.code&&(w.value=e.data.list||[])}catch(e){console.error("加载方案列表失败:",e)}},B=async()=>{if(f.sceneId&&f.stepKey)try{const e=await X.get(`/admin/grade-schemes/mapping/${f.sceneId}/${f.stepKey}`);0===e.code&&e.data?(C.value=e.data.scheme_id,O.value=e.data,A.value=e.data.grades||[]):(C.value=null,O.value=null,A.value=[])}catch(e){console.error("加载方案映射失败:",e)}},R=async e=>{if(e)try{await X.put(`/admin/grade-schemes/mapping/${f.sceneId}/${f.stepKey}`,{schemeId:e}),S.success("方案已绑定"),await L(e),y("change",e)}catch(l){console.error("绑定方案失败:",l),S.error("绑定失败")}else try{await X.delete(`/admin/grade-schemes/mapping/${f.sceneId}/${f.stepKey}`),O.value=null,A.value=[],y("change",null)}catch(l){console.error("移除映射失败:",l)}},L=async e=>{try{const l=await X.get(`/admin/grade-schemes/${e}`);0===l.code&&(O.value=l.data,A.value=l.data.grades||[])}catch(l){console.error("加载方案详情失败:",l)}},K=()=>{P.value=!1,Object.assign(F,{id:null,schemeKey:"",name:"",nameEn:"",description:"",category:"general"}),$.value=!0},W=()=>{O.value&&(P.value=!0,Object.assign(F,{id:O.value.id,schemeKey:O.value.scheme_key,name:O.value.name,nameEn:O.value.name_en||"",description:O.value.description||"",category:O.value.category||"general"}),$.value=!0)},q=async()=>{var e;try{if(await N.value.validate(),P.value)await X.put(`/admin/grade-schemes/${F.id}`,{name:F.name,nameEn:F.nameEn,description:F.description,category:F.category}),S.success("更新成功"),await L(F.id);else{const l=await X.post("/admin/grade-schemes",{schemeKey:F.schemeKey,name:F.name,nameEn:F.nameEn,description:F.description,category:F.category});S.success("创建成功"),await j(),(null==(e=l.data)?void 0:e.id)&&(C.value=l.data.id,await R(l.data.id))}$.value=!1}catch(l){"cancel"!==l&&(console.error("保存方案失败:",l),S.error("保存失败"))}},H=async()=>{var e,l;if(O.value)try{await E.confirm(`确定删除方案"${O.value.name}"吗？删除后无法恢复。`,"确认删除",{type:"warning"}),await X.delete(`/admin/grade-schemes/${O.value.id}`),S.success("删除成功"),C.value=null,O.value=null,A.value=[],await j()}catch(a){"cancel"!==a&&(console.error("删除方案失败:",a),S.error((null==(l=null==(e=a.response)?void 0:e.data)?void 0:l.msg)||"删除失败"))}},J=e(!1),G=e(!1),Z=e(null),Q=l({id:null,gradeKey:"",name:"",nameEn:"",weight:100,promptText:"",color:"#409eff"}),ee={name:[{required:!0,message:"请输入品级名称",trigger:"blur"}],weight:[{required:!0,message:"请输入权重",trigger:"blur"}]},le=()=>{G.value=!1,Object.assign(Q,{id:null,gradeKey:"",name:"",nameEn:"",weight:100,promptText:"",color:"#409eff"}),J.value=!0},ae=e(!1),te=async()=>{if(Q.name){ae.value=!0;try{const e=await Gl(Q.name);Q.nameEn=e,S.success("翻译成功")}catch(e){S.error("翻译失败")}finally{ae.value=!1}}else S.warning("请先输入品级名称")},ne=e(!1),oe=async()=>{if(F.name){ne.value=!0;try{const e=await Gl(F.name);F.nameEn=e,S.success("翻译成功")}catch(e){S.error("翻译失败")}finally{ne.value=!1}}else S.warning("请先输入方案名称")},ie=async()=>{if(O.value)try{await Z.value.validate();const e={gradeKey:Q.gradeKey||void 0,name:Q.name,nameEn:Q.nameEn,weight:Q.weight,promptText:Q.promptText,color:Q.color};G.value?(await X.put(`/admin/grade-schemes/${O.value.id}/grades/${Q.id}`,e),S.success("更新成功")):(await X.post(`/admin/grade-schemes/${O.value.id}/grades`,e),S.success("添加成功")),J.value=!1,await L(O.value.id)}catch(e){"cancel"!==e&&(console.error("保存品级失败:",e),S.error("保存失败"))}},se=async()=>{if(O.value)try{const e=A.value.map(e=>e.id);await X.put(`/admin/grade-schemes/${O.value.id}/grades/reorder`,{gradeIds:e})}catch(e){console.error("更新排序失败:",e)}},re=e=>{const l=A.value.reduce((e,l)=>e+(l.weight||0),0);if(0===l)return"-";const a=e.weight/l*100;return a<1?a.toFixed(2)+"%":a.toFixed(1)+"%"},ce=e(!1),de=e(null),ue=async e=>{if(O.value&&de.value)try{await X.put(`/admin/grade-schemes/${O.value.id}/grades/${de.value.id}`,{styleConfig:e}),S.success("样式已保存"),ce.value=!1,await L(O.value.id)}catch(l){console.error("保存样式失败:",l),S.error("保存失败")}},pe=e=>({borderLeftColor:e.color||"#409eff"}),me=e=>{var l,a,t,n;const o=e.styleConfig||e.style_config;if(!o)return{background:e.color||"#409eff",color:"#fff"};const i="string"==typeof o?JSON.parse(o):o,s={};if(null==(l=i.card)?void 0:l.background){const e=i.card.background;"gradient"===e.type&&e.colors?s.background=`linear-gradient(${e.direction||"135deg"}, ${e.colors.join(", ")})`:e.color&&(s.background=e.color)}else s.background=e.color||"#409eff";if((null==(t=null==(a=i.text)?void 0:a.primary)?void 0:t.color)?s.color=i.text.primary.color:s.color="#fff",null==(n=i.card)?void 0:n.border){const e=i.card.border;s.border=`${e.width||"2px"} ${e.style||"solid"} ${e.color||"transparent"}`,s.borderRadius=e.radius||"8px"}return s};return t(()=>[f.sceneId,f.stepKey],()=>{f.sceneId&&f.stepKey&&(j(),B())},{immediate:!0}),n(()=>{j(),f.sceneId&&f.stepKey&&B()}),i({reload:()=>{j(),B()}}),(e,l)=>{const a=o("el-option"),t=o("el-select"),n=o("el-button"),i=o("el-tag"),d=o("el-icon"),f=o("el-empty"),y=o("el-input"),j=o("el-form-item"),B=o("el-tooltip"),ve=o("el-form"),ge=o("el-dialog"),fe=o("el-input-number"),he=o("el-color-picker");return r(),s("div",ot,[c("div",it,[c("div",st,[l[19]||(l[19]=c("span",{class:"label"},"品级方案",-1)),u(t,{modelValue:C.value,"onUpdate:modelValue":l[0]||(l[0]=e=>C.value=e),placeholder:"选择品级方案",size:"small",style:{width:"200px"},onChange:R},{default:p(()=>[u(a,{label:"不使用品级方案",value:null}),(r(!0),s(m,null,v(w.value,e=>(r(),g(a,{key:e.id,label:`${e.name} (${e.gradeCount||0}个品级)`,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),u(n,{type:"primary",size:"small",icon:h(b),onClick:K},{default:p(()=>[...l[18]||(l[18]=[_(" 新建方案 ",-1)])]),_:1},8,["icon"])])]),O.value?(r(),s("div",rt,[c("div",ct,[c("div",dt,[c("span",ut,k(O.value.name),1),u(i,{size:"small",type:"info"},{default:p(()=>[_(k(O.value.category),1)]),_:1})]),c("div",pt,[u(n,{size:"small",onClick:W},{default:p(()=>[...l[20]||(l[20]=[_("编辑方案",-1)])]),_:1}),u(n,{size:"small",type:"danger",onClick:H,disabled:O.value.is_system},{default:p(()=>[...l[21]||(l[21]=[_("删除",-1)])]),_:1},8,["disabled"])])]),c("div",mt,[c("div",vt,[l[23]||(l[23]=c("span",null,"品级列表",-1)),u(n,{type:"primary",size:"small",icon:h(b),onClick:le},{default:p(()=>[...l[22]||(l[22]=[_("添加品级",-1)])]),_:1},8,["icon"])]),A.value.length>0?(r(),s("div",gt,[u(h(Y),{modelValue:A.value,"onUpdate:modelValue":l[1]||(l[1]=e=>A.value=e),"item-key":"id",handle:".drag-handle",onEnd:se},{item:p(({element:e})=>[c("div",{class:"grade-item",style:V(pe(e))},[c("div",ft,[u(d,null,{default:p(()=>[u(h(I))]),_:1})]),c("div",{class:"grade-preview",style:V(me(e))},[c("span",ht,k(e.name),1)],4),c("div",yt,[c("div",_t,k(e.name),1),c("div",bt,[c("span",null,"权重: "+k(e.weight),1),c("span",null,"概率: "+k(re(e)),1)])]),c("div",wt,[u(n,{type:"primary",link:"",size:"small",onClick:l=>(e=>{G.value=!0,Object.assign(Q,{id:e.id,gradeKey:e.grade_key,name:e.name,nameEn:e.name_en||"",weight:e.weight,promptText:e.prompt_text||"",color:e.color||"#409eff"}),J.value=!0})(e)},{default:p(()=>[u(d,null,{default:p(()=>[u(h(z))]),_:1})]),_:1},8,["onClick"]),u(n,{type:"primary",link:"",size:"small",onClick:l=>(e=>{de.value={...e},ce.value=!0})(e)},{default:p(()=>[u(d,null,{default:p(()=>[u(h(D))]),_:1})]),_:1},8,["onClick"]),u(n,{type:"danger",link:"",size:"small",onClick:l=>(async e=>{if(O.value)try{await E.confirm(`确定删除品级"${e.name}"吗？`,"确认删除",{type:"warning"}),await X.delete(`/admin/grade-schemes/${O.value.id}/grades/${e.id}`),S.success("删除成功"),await L(O.value.id)}catch(l){"cancel"!==l&&(console.error("删除品级失败:",l),S.error("删除失败"))}})(e)},{default:p(()=>[u(d,null,{default:p(()=>[u(h(U))]),_:1})]),_:1},8,["onClick"])])],4)]),_:1},8,["modelValue"])])):(r(),s("div",kt,[u(f,{description:"暂无品级，请添加","image-size":60})]))])])):(r(),s("div",Vt,[u(f,{description:"请选择或创建品级方案","image-size":80},{default:p(()=>[u(n,{type:"primary",onClick:K},{default:p(()=>[...l[24]||(l[24]=[_("创建品级方案",-1)])]),_:1})]),_:1})])),u(ge,{modelValue:$.value,"onUpdate:modelValue":l[8]||(l[8]=e=>$.value=e),title:P.value?"编辑品级方案":"创建品级方案",width:"450px"},{footer:p(()=>[u(n,{onClick:l[7]||(l[7]=e=>$.value=!1)},{default:p(()=>[...l[26]||(l[26]=[_("取消",-1)])]),_:1}),u(n,{type:"primary",onClick:q},{default:p(()=>[...l[27]||(l[27]=[_("保存",-1)])]),_:1})]),default:p(()=>[u(ve,{model:F,rules:M,ref_key:"schemeFormRef",ref:N,"label-width":"80px"},{default:p(()=>[P.value?x("",!0):(r(),g(j,{key:0,label:"方案标识",prop:"schemeKey"},{default:p(()=>[u(y,{modelValue:F.schemeKey,"onUpdate:modelValue":l[2]||(l[2]=e=>F.schemeKey=e),placeholder:"如: couplet_fortune"},null,8,["modelValue"]),l[25]||(l[25]=c("div",{class:"form-tip"},"唯一标识，创建后不可修改",-1))]),_:1})),u(j,{label:"方案名称",prop:"name"},{default:p(()=>[u(y,{modelValue:F.name,"onUpdate:modelValue":l[3]||(l[3]=e=>F.name=e),placeholder:"如: 对联品级方案"},null,8,["modelValue"])]),_:1}),u(j,{label:"英文名称"},{default:p(()=>[c("div",xt,[u(y,{modelValue:F.nameEn,"onUpdate:modelValue":l[4]||(l[4]=e=>F.nameEn=e),placeholder:"如: Couplet Fortune Scheme"},null,8,["modelValue"]),u(B,{content:"翻译为英文",placement:"top"},{default:p(()=>[u(n,{type:"primary",link:"",onClick:oe,loading:ne.value},{default:p(()=>[u(d,null,{default:p(()=>[u(h(T))]),_:1})]),_:1},8,["loading"])]),_:1})])]),_:1}),u(j,{label:"分类"},{default:p(()=>[u(t,{modelValue:F.category,"onUpdate:modelValue":l[5]||(l[5]=e=>F.category=e),style:{width:"100%"}},{default:p(()=>[u(a,{label:"通用",value:"general"}),u(a,{label:"对联/题词",value:"couplet"}),u(a,{label:"坐骑",value:"mount"})]),_:1},8,["modelValue"])]),_:1}),u(j,{label:"描述"},{default:p(()=>[u(y,{modelValue:F.description,"onUpdate:modelValue":l[6]||(l[6]=e=>F.description=e),type:"textarea",rows:2,placeholder:"方案描述（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),u(ge,{modelValue:J.value,"onUpdate:modelValue":l[15]||(l[15]=e=>J.value=e),title:G.value?"编辑品级":"添加品级",width:"500px"},{footer:p(()=>[u(n,{onClick:l[14]||(l[14]=e=>J.value=!1)},{default:p(()=>[...l[29]||(l[29]=[_("取消",-1)])]),_:1}),u(n,{type:"primary",onClick:ie},{default:p(()=>[...l[30]||(l[30]=[_("保存",-1)])]),_:1})]),default:p(()=>[u(ve,{model:Q,rules:ee,ref_key:"gradeFormRef",ref:Z,"label-width":"80px"},{default:p(()=>[u(j,{label:"品级名称",prop:"name"},{default:p(()=>[u(y,{modelValue:Q.name,"onUpdate:modelValue":l[9]||(l[9]=e=>Q.name=e),placeholder:"如: 大吉、上上签、传说"},null,8,["modelValue"])]),_:1}),u(j,{label:"英文名称"},{default:p(()=>[c("div",Ct,[u(y,{modelValue:Q.nameEn,"onUpdate:modelValue":l[10]||(l[10]=e=>Q.nameEn=e),placeholder:"如: Great Fortune"},null,8,["modelValue"]),u(B,{content:"翻译为英文",placement:"top"},{default:p(()=>[u(n,{type:"primary",link:"",onClick:te,loading:ae.value},{default:p(()=>[u(d,null,{default:p(()=>[u(h(T))]),_:1})]),_:1},8,["loading"])]),_:1})])]),_:1}),u(j,{label:"权重",prop:"weight"},{default:p(()=>[u(fe,{modelValue:Q.weight,"onUpdate:modelValue":l[11]||(l[11]=e=>Q.weight=e),min:1,max:1e4,style:{width:"100%"}},null,8,["modelValue"]),l[28]||(l[28]=c("div",{class:"form-tip"},"权重越高，抽中该品级的概率越大",-1))]),_:1}),u(j,{label:"AI Prompt"},{default:p(()=>[u(y,{modelValue:Q.promptText,"onUpdate:modelValue":l[12]||(l[12]=e=>Q.promptText=e),type:"textarea",rows:3,placeholder:"用于AI生成时的风格提示，如: 极其华丽喜庆的风格，金光闪闪"},null,8,["modelValue"])]),_:1}),u(j,{label:"主题色"},{default:p(()=>[u(he,{modelValue:Q.color,"onUpdate:modelValue":l[13]||(l[13]=e=>Q.color=e)},null,8,["modelValue"]),c("span",{class:"color-preview",style:V({background:Q.color})},k(Q.color),5)]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),u(ge,{modelValue:ce.value,"onUpdate:modelValue":l[17]||(l[17]=e=>ce.value=e),title:"样式配置",width:"800px",class:"style-editor-dialog"},{default:p(()=>[de.value?(r(),g(nt,{key:0,grade:de.value,onSave:ue,onCancel:l[16]||(l[16]=e=>ce.value=!1)},null,8,["grade"])):x("",!0)]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-04abe1d6"]]),Et={class:"prompt-template-editor"},It={class:"editor-layout"},zt={class:"editor-left"},Dt={class:"section-header"},Ut={class:"variable-section"},Tt={key:0,class:"variable-buttons"},Ot=["textContent"],At={class:"editor-right"},$t={key:0,class:"preview-selectors"},Pt={class:"selector-label"},Nt={class:"preview-result"},Ft=W({__name:"PromptTemplateEditor",props:{modelValue:{type:Object,default:()=>({name:"",template:"",negative_prompt:"",segments:null,model_config:null})},sceneSteps:{type:Array,default:()=>[]},sceneId:{type:String,default:""}},emits:["update:modelValue"],setup(l,{emit:i}){const d=l,f=i,h=e(null),y=e(""),b=e({}),w=e({});function V(e){return"dice"===e.component_type||"random_dice"===e.component_type}t(()=>d.sceneSteps,()=>{!async function(){if(d.sceneId)for(const l of d.sceneSteps)if(V(l)&&l.step_key)try{const e=await X.get(`/admin/scenes/${d.sceneId}/draw-pool/${l.step_key}`,{params:{pageSize:200}});0===e.code&&(w.value[l.step_key]=e.data.list||[])}catch(e){console.error("加载词条池失败:",e)}}()},{immediate:!0}),a(()=>d.sceneSteps.filter(e=>e.options&&e.options.length>0));const E=a(()=>{if(!y.value)return[{text:"(暂无内容，请在左侧输入 Prompt 模板)",type:"empty"}];const e=[],l=/(\{\{(\w+)\}\})/g;let a,t=0;for(;null!==(a=l.exec(y.value));){a.index>t&&e.push({text:y.value.slice(t,a.index),type:"text"});const n=a[2],o=b.value[n];o?e.push({text:o,type:"replaced",varKey:n}):e.push({text:a[1],type:"variable",varKey:n}),t=l.lastIndex}return t<y.value.length&&e.push({text:y.value.slice(t),type:"text"}),e.length>0?e:[{text:"(暂无内容)",type:"empty"}]});function I(e){return"upload"===e.step_key||"image_upload"===e.component_type}function z(e){return{gender:"如：男士/女士",phrase:"如：马到成功",horse:"如：金色骏马",upload:"用户照片"}[e.step_key]||"输入测试值"}function D(e){if(!e.options||0===e.options.length)return[];if(e.gender_based){const l=d.sceneSteps.find(e=>"gender_select"===e.component_type),a=l?b.value[l.step_key]:null;if(a){const l={"男士":"male","女士":"female",male:"male",female:"female"}[a];if(l)return e.options.filter(e=>e.gender===l)}}return e.options}function U(e){return{"part-text":"text"===e.type,"part-variable":"variable"===e.type,"part-replaced":"replaced"===e.type,"part-empty":"empty"===e.type}}function T(){y.value?(navigator.clipboard.writeText(y.value),S.success("已复制到剪贴板")):S.warning("暂无内容可复制")}function A(){d.modelValue&&(y.value=d.modelValue.template_content||d.modelValue.template||"")}let $=!1;return t(y,()=>{$||f("update:modelValue",{...d.modelValue,template:y.value})}),t(()=>d.modelValue,(e,l)=>{((null==e?void 0:e.template_content)||(null==e?void 0:e.template)||"")!==((null==l?void 0:l.template_content)||(null==l?void 0:l.template)||"")&&($=!0,A(),setTimeout(()=>{$=!1},0))},{deep:!0}),t(()=>{const e=d.sceneSteps.find(e=>"gender_select"===e.component_type);return e?b.value[e.step_key]:null},(e,l)=>{e!==l&&d.sceneSteps.forEach(e=>{e.gender_based&&e.step_key&&(b.value[e.step_key]="")})}),n(()=>{A()}),(e,a)=>{const t=o("el-button"),n=o("el-input"),i=o("el-tag"),d=o("el-option"),f=o("el-select");return r(),s("div",Et,[c("div",It,[c("div",zt,[c("div",Dt,[a[2]||(a[2]=c("span",{class:"section-title"},"Prompt 模板",-1)),u(t,{size:"small",onClick:T},{default:p(()=>[...a[1]||(a[1]=[_("复制",-1)])]),_:1})]),u(n,{ref_key:"textareaRef",ref:h,modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=e=>y.value=e),type:"textarea",rows:16,placeholder:"输入 Prompt 模板，点击下方变量按钮插入步骤参数..."},null,8,["modelValue"]),c("div",Ut,[a[3]||(a[3]=c("span",{class:"section-label"},"插入变量:",-1)),l.sceneSteps.length>0?(r(),s("div",Tt,[(r(!0),s(m,null,v(l.sceneSteps,e=>(r(),g(t,{key:e.step_key,size:"small",class:"var-btn",onClick:l=>function(e){var l;const a=null==(l=h.value)?void 0:l.textarea;if(a){const l=a.selectionStart,t=a.selectionEnd,n=`{{${e}}}`;y.value=y.value.slice(0,l)+n+y.value.slice(t),O(()=>{a.focus(),a.setSelectionRange(l+n.length,l+n.length)})}else y.value+=`{{${e}}}`}(e.step_key)},{default:p(()=>{return[c("span",{textContent:k((l=e.step_key,"{{"+l+"}}"))},null,8,Ot)];var l}),_:2},1032,["onClick"]))),128))])):x("",!0)])]),c("div",At,[a[5]||(a[5]=c("div",{class:"section-header"},[c("span",{class:"section-title"},"实时预览")],-1)),l.sceneSteps.length>0?(r(),s("div",$t,[(r(!0),s(m,null,v(l.sceneSteps,e=>(r(),s("div",{key:e.step_key,class:"selector-item"},[c("span",Pt,k(e.title||e.step_key)+":",1),I(e)?(r(),g(i,{key:0,size:"small",type:"info"},{default:p(()=>[...a[4]||(a[4]=[_("用户照片",-1)])]),_:1})):"gender_select"===e.component_type?(r(),g(f,{key:1,modelValue:b.value[e.step_key],"onUpdate:modelValue":l=>b.value[e.step_key]=l,size:"small",placeholder:"选择",clearable:"",style:{width:"120px"}},{default:p(()=>[u(d,{label:"男士",value:"男士"}),u(d,{label:"女士",value:"女士"})]),_:1},8,["modelValue","onUpdate:modelValue"])):e.options&&e.options.length>0?(r(),g(f,{key:2,modelValue:b.value[e.step_key],"onUpdate:modelValue":l=>b.value[e.step_key]=l,size:"small",placeholder:"选择",clearable:"",style:{width:"160px"}},{default:p(()=>[(r(!0),s(m,null,v(D(e),e=>(r(),g(d,{key:e.id||e.option_key,label:e.label,value:e.prompt_text||e.label},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):V(e)&&w.value[e.step_key]?(r(),g(f,{key:3,modelValue:b.value[e.step_key],"onUpdate:modelValue":l=>b.value[e.step_key]=l,size:"small",placeholder:"选择",clearable:"",filterable:"",style:{width:"160px"}},{default:p(()=>[(r(!0),s(m,null,v(w.value[e.step_key],e=>(r(),g(d,{key:e.id,label:e.name,value:e.prompt_text||e.name},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(r(),g(n,{key:4,modelValue:b.value[e.step_key],"onUpdate:modelValue":l=>b.value[e.step_key]=l,size:"small",placeholder:z(e),style:{width:"160px"}},null,8,["modelValue","onUpdate:modelValue","placeholder"]))]))),128))])):x("",!0),c("div",Nt,[(r(!0),s(m,null,v(E.value,(e,l)=>(r(),s("span",{key:l,class:C(U(e))},k(e.text),3))),128))])])])])}}},[["__scopeId","data-v-f52e5fe1"]]),Mt={class:"scene-management"},jt={class:"page-header"},Bt={class:"header-right"},Rt={class:"status-tabs"},Lt={class:"scene-count"},Kt={class:"scene-list"},Yt={class:"scene-info"},Xt={class:"image-placeholder"},Wt={class:"scene-detail"},qt={class:"scene-name"},Ht={class:"scene-desc"},Jt={class:"scene-key"},Gt={class:"status-switch"},Zt=["onClick"],Qt=["onClick"],en=["onClick"],ln={class:"points-value"},an={class:"action-btns-row"},tn={class:"input-with-translate"},nn={class:"input-with-translate"},on={class:"icon-upload-inline"},sn={key:1,class:"icon-placeholder-inline"},rn={class:"icon-upload-actions"},cn={class:"steps-config-3col"},dn={class:"steps-sidebar"},un=["onClick"],pn={class:"step-order"},mn={class:"step-info-compact"},vn={class:"step-title-compact"},gn={key:0,class:"step-basic-config"},fn={class:"step-icon-selector"},hn=["src"],yn={key:1,class:"step-icon-empty"},_n={class:"input-with-translate-compact"},bn={key:0,class:"dice-pricing-config"},wn={class:"switch-row"},kn={key:1,class:"step-basic-empty"},Vn={key:2,class:"step-options-config"},xn={key:0,class:"no-options-tip"},Cn={key:1,class:"no-options-tip"},Sn={key:2,class:"random-dice-config-standalone"},En={class:"dice-config-header"},In={class:"grade-scheme-section"},zn={key:0,class:"grade-scheme-selector"},Dn={class:"grade-scheme-row"},Un={key:0,class:"grade-preview"},Tn={class:"dice-pool-manager"},On={class:"config-section-title"},An={class:"config-title-actions"},$n={key:0,class:"options-filter-compact"},Pn={class:"options-count"},Nn={key:1,class:"spec-tip-compact"},Fn={class:"options-scroll-area"},Mn={class:"image-tag-left"},jn=["onClick"],Bn={key:1,class:"option-thumb-empty"},Rn={class:"image-tag-right"},Ln={class:"image-tag-row1"},Kn={class:"image-tag-field"},Yn={class:"image-tag-field"},Xn={class:"field-with-btn"},Wn={key:0,class:"image-tag-field"},qn={class:"image-tag-field"},Hn={class:"image-tag-field"},Jn={class:"image-tag-row2"},Gn={class:"tags-col tags-col-label-main"},Zn={class:"tags-col tags-col-label"},Qn={class:"field-with-btn-inline"},eo={class:"tags-col tags-col-prompt"},lo={class:"tags-col tags-col-default"},ao={class:"tags-col tags-col-action"},to={class:"spec-col spec-col-label-main"},no={class:"spec-col spec-col-label"},oo={class:"field-with-btn-inline"},io={class:"spec-col spec-col-size"},so={class:"spec-col spec-col-size"},ro={class:"spec-col spec-col-default"},co={class:"spec-col spec-col-action"},uo={class:"common-table-header"},po={key:0,class:"common-col common-col-extra"},mo={key:1,class:"common-col common-col-extra"},vo={class:"common-col common-col-label-main"},go={class:"common-col common-col-label"},fo={class:"field-with-btn-inline"},ho={class:"common-col common-col-extra"},yo={class:"common-col common-col-prompt"},_o={class:"common-col common-col-default"},bo={class:"common-col common-col-action"},wo={key:3,class:"step-options-empty"},ko={class:"cos-picker"},Vo={class:"cos-picker-header"},xo={key:0,class:"cos-filter-tags"},Co={class:"filter-result"},So={class:"cos-image-grid"},Eo=["onClick"],Io={class:"cos-image-info"},zo={class:"cos-image-name"},Do={class:"cos-image-tags"},Uo={class:"step-icon-picker"},To={class:"step-icon-grid"},Oo=["onClick"],Ao=["src","alt"],$o={class:"step-icon-name"},Po={class:"scene-icon-picker"},No={class:"scene-icon-picker-header"},Fo={key:0,class:"scene-icon-count"},Mo={class:"scene-icon-grid"},jo=["onClick"],Bo={class:"scene-icon-info"},Ro={class:"scene-icon-name"},Lo={class:"scene-icon-tags"},Ko={class:"ai-sidebar-content"},Yo={class:"ai-mode-switch"},Xo={key:0,class:"ai-current-scene"},Wo={key:1,class:"ai-image-generator"},qo={class:"image-gen-disabled-notice"},Ho={class:"quick-actions",style:{"margin-top":"16px"}},Jo={key:0,class:"current-scene-info",style:{"margin-top":"16px"}},Go={key:0,class:"ai-welcome"},Zo={key:0},Qo={key:1},ei={class:"ai-suggestions"},li={class:"message-avatar"},ai={key:0},ti={key:1},ni={class:"message-content"},oi=["innerHTML"],ii={key:0,class:"ai-config-preview"},si={class:"config-preview-header"},ri={class:"config-preview-info"},ci={key:0,class:"preview-icon"},di=["src"],ui={key:1,class:"image-tasks-pending"},pi={class:"tasks-header"},mi={class:"tasks-list"},vi={class:"tasks-confirm"},gi={key:2,class:"generating-images-progress"},fi={class:"progress-header"},hi={class:"progress-tasks"},yi={class:"config-preview-actions"},_i={key:1,class:"ai-message assistant"},bi={class:"ai-input-area"},wi={class:"ai-input-actions"},ki={key:0,class:"ai-config-detail"},Vi=["src"],xi={key:1,class:"no-icon-hint"},Ci={class:"preview-step-header"},Si={class:"step-num"},Ei={class:"step-name"},Ii={key:0,class:"preview-step-options"},zi={class:"option-grid"},Di=["src","alt"],Ui={key:1,class:"option-no-image"},Ti={class:"option-label"},Oi={class:"preview-prompt"},Ai={key:0,class:"prompt-label"},$i={key:1},Pi=W({__name:"Scenes",setup(t){const y=e(!1),I=e(!1);e(!1),e(!1);const z=e([]),D=e(!1),U=e(!1),W=e(null),q=e(null),H=e([]),J=e(-1),G=e("all"),Z=e("basic"),Q=e(!1),ee=e(!1),le=e([]),ae=e([]),te=e([]),ne=e(""),oe=e(""),ie=e(""),se=e(""),re=e(-1),ce=e(!1),de=e(!1),ue=e([]),pe=e(""),me=e(""),ve=e(!1),ge=e(!1),fe=e([]),he=e([]),ye=e(""),_e=e(""),be=e(""),we=e([]),ke=e([]),Ve=e(!1),xe=a(()=>{var e,l;return(null==(l=null==(e=Ne.value)?void 0:e.config)?void 0:l.gradeSchemeId)?ke.value.find(e=>e.id===Ne.value.config.gradeSchemeId):null});function Ce(){var e;Ae.id&&(null==(e=Ne.value)?void 0:e.step_key)?Ve.value=!0:S.warning("请先保存场景")}function Se(){Ee()}async function Ee(){try{const l=(await X.get("/admin/grade-schemes")).data.list||[];for(const a of l)try{const e=await X.get(`/admin/grade-schemes/${a.id}`);0===e.code&&e.data&&(a.grades=e.data.grades||[])}catch(e){a.grades=[]}ke.value=l}catch(l){console.error("加载品级方案失败:",l)}}function Ie(e){Ne.value&&(Ne.value.config||(Ne.value.config={}),Ne.value.config.gradeSchemeId=e)}const ze=a(()=>{if(!pe.value)return ue.value;const e=pe.value.toLowerCase();return ue.value.filter(l=>l.fileName.toLowerCase().includes(e))});function De(){let e=fe.value;if(_e.value&&(e=e.filter(e=>e.folderPath===_e.value)),ye.value){const l=ye.value.toLowerCase();e=e.filter(e=>{var a,t,n;return(null==(a=e.fileName)?void 0:a.toLowerCase().includes(l))||(null==(t=e.key)?void 0:t.toLowerCase().includes(l))||(null==(n=e.folderPath)?void 0:n.toLowerCase().includes(l))})}we.value=e}const Ue=a(()=>({Authorization:`Bearer ${localStorage.getItem("admin_token")}`})),Te=l({id:null,name:"",template:"",negative_prompt:"",segments:null,model_config:null,is_active:!0}),Oe=e({name:"",template:"",negative_prompt:"",segments:null,model_config:null}),Ae=l({id:"",name:"",name_en:"",description:"",description_en:"",icon:"",status:"active",is_review_safe:!0,points_cost:50,sort_order:0}),$e={id:[{required:!0,message:"请输入场景ID",trigger:"blur"}],name:[{required:!0,message:"请输入场景名称",trigger:"blur"}]},Pe=a(()=>"all"===G.value?z.value:z.value.filter(e=>e.status===G.value)),Ne=a(()=>J.value>=0?H.value[J.value]:null),Fe=e(""),Me=a(()=>Ne.value&&Ne.value.options?Fe.value?Ne.value.options.filter(e=>e.gender===Fe.value):Ne.value.options:[]);a(()=>H.value.map(e=>e.step_key).filter(e=>e&&"upload"!==e));const je={image_upload:"图片上传",gender_select:"性别选择",radio:"单选框",tags:"标签选择",spec_select:"规格选择",color_picker:"颜色选择",image_tags:"图片标签",slider:"滑块",random_dice:"摇骰子"};function Be(){}async function Re(){y.value=!0;try{const e=await X.get("/config/admin/scenes");z.value=(e.data||[]).map(e=>({...e,points_cost:e.points_cost||e.price||50})),setTimeout(()=>{const e=document.querySelector(".scene-list .el-table__body-wrapper tbody");e&&new Dl(e,{handle:".drag-handle",animation:150,onEnd:async e=>{const{oldIndex:l,newIndex:a}=e;if(l!==a){const e=z.value.splice(l,1)[0];z.value.splice(a,0,e),await async function(){const e=z.value.map((e,l)=>({id:e.id,sort_order:l}));try{await X.post("/config/admin/scenes/sort",{scenes:e}),S.success("排序已更新")}catch{S.error("排序更新失败")}}()}}})},100)}catch(e){console.error("加载场景失败:",e),S.error("加载场景列表失败")}finally{y.value=!1}}function Le(){U.value=!1,Object.assign(Ae,{id:"",name:"",name_en:"",description:"",description_en:"",icon:"",status:"active",is_review_safe:!0,points_cost:50,sort_order:z.value.length}),D.value=!0}function Ke(e){var l;200===e.code&&(null==(l=e.data)?void 0:l.url)?(Ae.icon=e.data.url,S.success("图标上传成功")):S.error(e.message||"上传失败")}function Ye(){S.error("图标上传失败")}function Xe(e){const l=e.type.startsWith("image/"),a=e.size/1024<500;return l?!!a||(S.error("图片大小不能超过 500KB!"),!1):(S.error("只能上传图片文件!"),!1)}async function We(){try{await W.value.validate()}catch{return}I.value=!0;try{const e={...Ae,scene_key:Ae.id,price:Ae.points_cost,is_review_safe:Ae.is_review_safe?1:0,use_dynamic_render:1};if(U.value&&(e.id=Ae.id),await X.post("/config/admin/scene",e),U.value&&(H.value.length>0||Te.template)){const e=H.value.map(e=>({...e,icon:e.icon||"",gender_based:e.gender_based||!1,config:e.config||{}}));Oe.value&&(Te.name=Oe.value.name||Te.name,Te.template=Oe.value.template||"",Te.negative_prompt=Oe.value.negative_prompt||"",Te.segments=Oe.value.segments||null,Te.model_config=Oe.value.model_config||null);const l=Te.template?{...Te,scene_id:Ae.id}:null,a={steps:e,prompt:l},t=JSON.stringify(a);console.log("[保存调试] 总体积:",(t.length/1024).toFixed(2),"KB"),console.log("[保存调试] 步骤数:",e.length),console.log("[保存调试] promptFormData:",JSON.stringify(Oe.value)),console.log("[保存调试] promptForm.template:",Te.template),console.log("[保存调试] promptData:",l?JSON.stringify(l).substring(0,200):"null"),e.forEach((e,l)=>{console.log(`[保存调试] 步骤${l+1} "${e.title}": icon="${e.icon}", gender_based=${e.gender_based}`)}),await X.post(`/config/admin/scene/${Ae.id}/batch-save`,a)}S.success("保存成功"),D.value=!1,Re()}catch(e){S.error("保存失败: "+(e.message||"未知错误"))}finally{I.value=!1}}async function qe(e){try{const l={...e,price:e.points_cost||e.price,use_dynamic_render:1};await X.post("/config/admin/scene",l),S.success("更新成功")}catch(l){S.error("更新失败"),Re()}}async function He(e,l){if(e.status===l)return;const a=e.status;e.status=l;try{const t=await X.post("/config/admin/scene/status",{id:e.id,status:l});200===t.code||0===t.code?S.success("状态更新成功"):(e.status=a,S.error(t.message||"状态更新失败"))}catch(t){e.status=a,S.error(t.message||"状态更新失败")}}function Je(){const e={id:null,step_order:H.value.length+1,step_key:"",title:"新步骤",title_en:"",icon:"",component_type:"radio",is_required:!1,is_visible:!0,gender_based:!1,free_count:1,cost_per_roll:10,config:{},options:[]};H.value.push(e),J.value=H.value.length-1}function Ge(){if(!Ne.value)return;const e={option_key:`opt_${Date.now().toString(36)}_${Math.random().toString(36).substr(2,4)}`,label:"",label_en:"",color:"",image:"",prompt_text:"",is_default:0===Ne.value.options.length?1:0};"spec_select"===Ne.value.component_type&&(e.width=25,e.height=35),Ne.value.options.push(e)}function Ze(e){const l=Ne.value.options,a=l[e],t=1===a.is_default,n=a.gender;if(l.splice(e,1),t&&l.length>0)if(Ne.value.gender_based&&n){const e=l.filter(e=>e.gender===n);e.length>0&&!e.some(e=>1===e.is_default)&&(e[0].is_default=1)}else l.some(e=>1===e.is_default)||(l[0].is_default=1)}function Qe(e){Ne.value&&(Ne.value.gender_based&&e.gender?Ne.value.options.forEach(l=>{l.gender===e.gender&&(l.is_default=0)}):Ne.value.options.forEach(e=>{e.is_default=0}),e.is_default=1)}function el(e){if(!Ne.value)return!1;if(1!==e.is_default)return!1;if(Ne.value.gender_based&&e.gender){return Ne.value.options.filter(l=>l.gender===e.gender).filter(e=>1===e.is_default).length<=1}return Ne.value.options.filter(e=>1===e.is_default).length<=1}function ll(){H.value.forEach((e,l)=>{e.step_order=l+1})}const al=e(null);async function tl(){ee.value=!0;try{const e=await X.get("/photos/cos-images");200===e.code||0===e.code?(le.value=e.data||[],te.value=e.folders||[],nl()):(console.warn("photos/cos-images返回非200:",e),S.warning("素材加载失败，请检查COS配置"))}catch(e){console.error("加载COS图片失败:",e),S.error("加载图片列表失败: "+(e.message||"网络错误"))}finally{ee.value=!1}}function nl(){var e;let l=le.value;if(ie.value&&(null==(e=Ne.value)?void 0:e.gender_based)&&(l=l.filter(e=>{const l=(e.folderPath||"").toLowerCase(),a=(e.category||"").toLowerCase();return l.includes(ie.value)||a===ie.value})),oe.value&&(l=l.filter(e=>e.folderPath===oe.value)),ne.value){const e=ne.value.toLowerCase();l=l.filter(l=>{var a,t;return(null==(a=l.fileName)?void 0:a.toLowerCase().includes(e))||(null==(t=l.key)?void 0:t.toLowerCase().includes(e))})}ae.value=l}function ol(){se.value&&(al.value?(al.value.image=se.value,S.success("图片已选择")):re.value>=0&&(Ne.value.options[re.value].image=se.value,S.success("图片已选择"))),Q.value=!1,al.value=null}async function il(){var e;me.value=(null==(e=Ne.value)?void 0:e.icon)||"",ce.value=!0,0===ue.value.length&&await async function(){var e;de.value=!0;try{const l=await X.get("/assets/list");200!==l.code&&0!==l.code||(ue.value=(null==(e=l.data)?void 0:e.uiIcons)||[])}catch(l){console.error("加载图标失败:",l),S.error("加载图标列表失败")}finally{de.value=!1}}()}function sl(){me.value&&Ne.value&&(Ne.value.icon=me.value,S.success("图标已选择")),ce.value=!1}async function rl(){be.value=Ae.icon||"",_e.value="",ye.value="",ve.value=!0,0===fe.value.length?await cl():De()}async function cl(){ge.value=!0;try{const e=await X.get("/photos/cos-images");200!==e.code&&0!==e.code||(fe.value=e.data||[],he.value=e.folders||[],De())}catch(e){console.error("加载场景图标失败:",e),S.error("加载图标列表失败")}finally{ge.value=!1}}function dl(){be.value&&(Ae.icon=be.value,S.success("图标已选择")),ve.value=!1}const ul=l({name:!1,desc:!1,step:!1,options:!1});async function pl(){if(Ae.name){ul.name=!0;try{Ae.name_en=await Gl(Ae.name),S.success("翻译成功")}catch(e){S.error("翻译失败")}finally{ul.name=!1}}else S.warning("请先输入中文名称")}async function ml(){if(Ae.description){ul.desc=!0;try{Ae.description_en=await Gl(Ae.description),S.success("翻译成功")}catch(e){S.error("翻译失败")}finally{ul.desc=!1}}else S.warning("请先输入中文描述")}async function vl(){if(Ne.value)if(Ne.value.title){ul.step=!0;try{Ne.value.title_en=await Gl(Ne.value.title),S.success("翻译成功")}catch(e){S.error("翻译失败")}finally{ul.step=!1}}else S.warning("请先输入中文标题")}async function gl(){if(!Ne.value||!Ne.value.options||0===Ne.value.options.length)return void S.warning("当前步骤没有选项");const e=Ne.value.options.filter(e=>e.label&&!e.label_en).map(e=>e.label);if(0!==e.length){ul.options=!0;try{const l=await async function(e){if(!e||0===e.length)return[];try{const l=await X.post("/translate/batch",{texts:e,target:"en"});return 0===l.code&&l.data?l.data:(console.warn("批量翻译失败:",l.message),e.map(e=>({original:e,translated:e})))}catch(l){return console.error("批量翻译API调用失败:",l),e.map(e=>({original:e,translated:e}))}}(e);let a=0;Ne.value.options.forEach(e=>{var t;e.label&&!e.label_en&&(e.label_en=(null==(t=l[a])?void 0:t.translated)||e.label,a++)}),S.success(`已翻译 ${l.length} 个选项`)}catch(l){S.error("批量翻译失败")}finally{ul.options=!1}}else S.warning("没有需要翻译的选项")}async function fl(e){if(e.label)try{e.label_en=await Gl(e.label),S.success("翻译成功")}catch(l){S.error("翻译失败")}else S.warning("请先输入中文名称")}const hl=e(!1),yl=e("create"),_l=e(""),bl=e(!1),wl=e([]),kl=e(null),Vl=e(!1),xl=e(null);function Cl(){hl.value=!hl.value,hl.value&&(console.log("%c🤖 AI场景生成助手已更新","color: #67C23A; font-size: 16px; font-weight: bold;"),console.log("%c版本: v2.3.0 (2026-01-20 12:22:00)","color: #409EFF; font-size: 14px;"),console.log("%c✨ 新功能:","color: #E6A23C; font-size: 14px; font-weight: bold;"),console.log("  • 禁用AI图片生成功能（绿幕抠图效果不理想）"),console.log("  • 改为使用占位图，请通过素材管理上传图片"),console.log("  • 新增「素材管理」→「场景素材」TAB"),console.log("  • 在场景配置中点击图片区域从素材库选择"),console.log("%c━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━","color: #909399;"))}function Sl(e){_l.value=e}function El(){O(()=>{kl.value&&(kl.value.scrollTop=kl.value.scrollHeight)})}function Il(){window.location.href="/admin/#/assets"}async function zl(e){var l,a;const t=wl.value[e];if(t&&t.generatedConfig){t.imageTasksPending=!1,t.generatingImages=!0,t.imageProgress={current:0,total:t.imageTasks.length};try{const e=await async function(e,l,a){var t,n;try{const l=JSON.parse(JSON.stringify(e)),i=5;let s=0;if(null==(t=l.scene)?void 0:t.icon_description){a(s,"processing");try{const e=await X.post("/ai-agent/generate-icon",{description:l.scene.icon_description,type:"scene",scene_id:l.scene.scene_key,auto_upload:!0});200===e.code&&(null==(n=e.data)?void 0:n.url)?(l.scene.icon=e.data.url,a(s,"completed")):a(s,"failed")}catch(o){console.error("生成场景图标失败:",o),a(s,"failed")}s++}const r=[];if(l.steps&&Array.isArray(l.steps))for(const e of l.steps)if("image_upload"!==e.component_type&&e.options&&Array.isArray(e.options))for(const l of e.options)l.image_description&&r.push({step:e,opt:l,taskIndex:s++,description:l.image_description,step_key:e.step_key,option_key:l.option_key});const c=async e=>{var t,n;a(e.taskIndex,"processing");try{const o=await X.post("/ai-agent/generate-icon",{description:e.description,type:"step",scene_id:null==(t=l.scene)?void 0:t.scene_key,step_key:e.step_key,option_key:e.option_key,auto_upload:!0});return 200===o.code&&(null==(n=o.data)?void 0:n.url)?(e.opt.image=o.data.url,a(e.taskIndex,"completed"),{success:!0}):(a(e.taskIndex,"failed"),{success:!1})}catch(o){return console.error(`生成选项 ${e.option_key} 示意图失败:`,o),a(e.taskIndex,"failed"),{success:!1}}};for(let e=0;e<r.length;e+=i){const l=r.slice(e,e+i);console.log(`[并发生成] 批次 ${Math.floor(e/i)+1}/${Math.ceil(r.length/i)}, 任务数: ${l.length}`),await Promise.all(l.map(e=>c(e))),e+i<r.length&&await new Promise(e=>setTimeout(e,200))}return l}catch(i){throw console.error("生成配置图片失败:",i),i}}(t.generatedConfig,t.imageTasks,(e,l)=>{t.imageTasks[e].status=l,"completed"===l&&t.imageProgress.current++});t.generatedConfig=e,t.generatingImages=!1,t.content="create"===yl.value?`已为您生成「${(null==(l=e.scene)?void 0:l.name)||"新场景"}」的完整配置，包含 ${(null==(a=e.steps)?void 0:a.length)||0} 个步骤。所有图片已生成完成，点击下方按钮可预览详情或直接应用。`:"已根据您的要求修改了场景配置。所有图片已生成完成，点击下方按钮查看修改结果。",S.success("图片生成完成")}catch(n){console.error("图片生成失败:",n),t.generatingImages=!1,S.error("图片生成失败: "+(n.message||"未知错误"))}El()}}async function Ul(){var e,l;const a=_l.value.trim();if(a&&!bl.value){wl.value.push({role:"user",content:a}),_l.value="",bl.value=!0,El();try{let t;if("create"===yl.value)t=await X.post("/ai-agent/generate-scene",{description:a,reference_scene:null});else{if(!q.value)throw new Error("请先选择要修改的场景");const e={scene:{scene_key:q.value.id,name:q.value.name,name_en:q.value.name_en,description:q.value.description,description_en:q.value.description_en,points_cost:q.value.points_cost||q.value.price,status:q.value.status},steps:H.value.map(e=>{var l;return{step_key:e.step_key,title:e.title,title_en:e.title_en,component_type:e.component_type,is_required:e.is_required,is_visible:e.is_visible,gender_based:e.gender_based,options:null==(l=e.options)?void 0:l.map(e=>({option_key:e.option_key,label:e.label,label_en:e.label_en,color:e.color,image:e.image,prompt_text:e.prompt_text,is_default:e.is_default}))}}),prompt_template:{name:Te.name,template:Te.template,negative_prompt:Te.negative_prompt}};t=await X.post("/ai-agent/modify-scene",{current_config:e,instruction:a})}if(200===t.code){const a=t.data,n=[];wl.value.push({role:"assistant",content:"create"===yl.value?`已为您生成「${(null==(e=a.scene)?void 0:e.name)||"新场景"}」的完整配置，包含 ${(null==(l=a.steps)?void 0:l.length)||0} 个步骤。检测到需要生成 ${n.length} 张图片，请确认是否继续。`:`已根据您的要求修改了场景配置。检测到需要生成 ${n.length} 张图片，请确认是否继续。`,generatedConfig:a,imageTasks:n,imageTasksPending:!0,generatingImages:!1}),El()}else wl.value.push({role:"assistant",content:`抱歉，生成失败：${t.message||"未知错误"}。请重试或换个描述方式。`})}catch(t){console.error("AI 请求失败:",t),wl.value.push({role:"assistant",content:`请求失败：${t.message||"网络错误"}。请检查网络连接后重试。`})}finally{bl.value=!1,El()}}}async function Tl(e){var l,a;if(e)try{if(await E.confirm("create"===yl.value?"确定要创建此场景吗？将自动保存场景基本信息、步骤和Prompt模板。":"确定要应用这些修改吗？这将覆盖当前场景的配置。","确认应用",{type:"info"}),"create"===yl.value){const a={scene_key:e.scene.scene_key,name:e.scene.name,name_en:e.scene.name_en||"",description:e.scene.description,description_en:e.scene.description_en||"",icon:e.scene.icon||"",status:"inactive",is_review_safe:e.scene.is_review_safe?1:0,points_cost:e.scene.points_cost||50,price:e.scene.points_cost||50,use_dynamic_render:1},t=await X.post("/config/admin/scene",a);if(200!==t.code&&0!==t.code)throw new Error(t.message||"创建场景失败");const n=(null==(l=e.steps)?void 0:l.map((e,l)=>{var a;return{step_key:e.step_key,title:e.title,title_en:e.title_en||"",component_type:e.component_type,step_order:l+1,is_required:!1!==e.is_required,is_visible:!1!==e.is_visible,gender_based:e.gender_based||!1,free_count:void 0!==e.free_count?e.free_count:1,cost_per_roll:void 0!==e.cost_per_roll?e.cost_per_roll:10,icon:"",config:{},options:(null==(a=e.options)?void 0:a.map((e,l)=>({option_key:e.option_key||`opt_${Date.now().toString(36)}_${l}`,label:e.label,label_en:e.label_en||"",color:e.color||"",image:e.image||"",prompt_text:e.prompt_text||e.label,sort_order:l+1,is_visible:!0,is_default:e.is_default||0===l?1:0,gender:e.gender||null})))||[]}}))||[],o=e.prompt_template?{name:e.prompt_template.name||`${e.scene.name}模板`,template:e.prompt_template.template||"",negative_prompt:e.prompt_template.negative_prompt||""}:null;await X.post(`/config/admin/scene/${e.scene.scene_key}/batch-save`,{steps:n,prompt:o}),S.success("场景创建成功！"),hl.value=!1,Re()}else{if(!q.value)return;Object.assign(Ae,{name:e.scene.name,name_en:e.scene.name_en,description:e.scene.description,description_en:e.scene.description_en,points_cost:e.scene.points_cost,icon:e.scene.icon||Ae.icon}),H.value=(null==(a=e.steps)?void 0:a.map((e,l)=>{var a;return{id:null,step_key:e.step_key,title:e.title,title_en:e.title_en||"",component_type:e.component_type,step_order:l+1,is_required:!1!==e.is_required,is_visible:!1!==e.is_visible,gender_based:e.gender_based||!1,free_count:void 0!==e.free_count?e.free_count:1,cost_per_roll:void 0!==e.cost_per_roll?e.cost_per_roll:10,icon:"",config:{},options:(null==(a=e.options)?void 0:a.map((e,l)=>({option_key:e.option_key||`opt_${Date.now().toString(36)}_${l}`,label:e.label,label_en:e.label_en||"",color:e.color||"",image:e.image||"",prompt_text:e.prompt_text||e.label,sort_order:l+1,is_visible:1,is_default:e.is_default||0===l?1:0,gender:e.gender||null})))||[]}}))||[],e.prompt_template&&(Te.name=e.prompt_template.name||Te.name,Te.template=e.prompt_template.template||"",Te.negative_prompt=e.prompt_template.negative_prompt||""),J.value=H.value.length>0?0:-1,S.success("配置已应用，请检查后保存"),hl.value=!1}}catch(t){"cancel"!==t&&S.error("应用配置失败: "+(t.message||"未知错误"))}}return e(!1),e(null),l({description:"",type:"scene"}),e(""),e(!1),n(()=>{Re(),Ee()}),(e,l)=>{const a=o("el-icon"),t=o("el-button"),n=o("el-radio-button"),z=o("el-radio-group"),O=o("el-table-column"),ue=o("el-image"),fe=o("el-switch"),Ee=o("el-table"),Dl=o("el-input"),Ol=o("el-form-item"),Al=o("el-tooltip"),$l=o("el-upload"),Pl=o("el-option"),Nl=o("el-select"),Fl=o("el-col"),Ml=o("el-input-number"),jl=o("el-row"),Bl=o("el-form"),Rl=o("el-tab-pane"),Ll=o("el-tag"),Kl=o("el-empty"),Yl=o("el-checkbox"),Xl=o("el-color-picker"),Wl=o("el-tabs"),ql=o("el-dialog"),Hl=o("el-alert"),Jl=o("el-card"),Gl=o("el-drawer"),Zl=o("el-descriptions-item"),Ql=o("el-descriptions"),ea=i("loading"),la=i("dialog-drag");return r(),s("div",Mt,[c("div",jt,[l[53]||(l[53]=c("div",{class:"header-left"},[c("h2",null,"场景管理"),c("span",{class:"subtitle"},"管理所有AI生成场景，配置步骤和定价")],-1)),c("div",Bt,[u(t,{type:"primary",onClick:Le},{default:p(()=>[u(a,null,{default:p(()=>[u(h(b))]),_:1}),l[52]||(l[52]=_(" 新增场景 ",-1))]),_:1})])]),c("div",Rt,[u(z,{modelValue:G.value,"onUpdate:modelValue":l[0]||(l[0]=e=>G.value=e),onChange:Be},{default:p(()=>[u(n,{label:"all"},{default:p(()=>[...l[54]||(l[54]=[_("全部",-1)])]),_:1}),u(n,{label:"active"},{default:p(()=>[...l[55]||(l[55]=[_("上线中",-1)])]),_:1}),u(n,{label:"coming_soon"},{default:p(()=>[...l[56]||(l[56]=[_("即将上线",-1)])]),_:1}),u(n,{label:"inactive"},{default:p(()=>[...l[57]||(l[57]=[_("未上线",-1)])]),_:1})]),_:1},8,["modelValue"]),c("span",Lt,"共 "+k(Pe.value.length)+" 个场景",1)]),d((r(),s("div",Kt,[u(Ee,{data:Pe.value,"row-key":"id","empty-text":"暂无场景数据，请点击「新增场景」按钮添加"},{default:p(()=>[u(O,{label:"排序",width:"60",align:"center"},{default:p(()=>[...l[58]||(l[58]=[c("span",{class:"drag-handle"},"☰",-1)])]),_:1}),u(O,{label:"场景","min-width":"240"},{default:p(({row:e})=>[c("div",Yt,[u(ue,{class:"scene-icon-img",src:e.icon,fit:"cover","preview-src-list":[e.icon],"preview-teleported":""},{error:p(()=>{var l;return[c("div",Xt,k((null==(l=e.name)?void 0:l.charAt(0))||"?"),1)]}),_:2},1032,["src","preview-src-list"]),c("div",Wt,[c("div",qt,k(e.name),1),c("div",Ht,k(e.description),1),c("div",Jt,"ID: "+k(e.scene_key||e.id),1)])])]),_:1}),u(O,{label:"状态",width:"200",align:"center"},{default:p(({row:e})=>[c("div",Gt,[c("div",{class:C(["status-option",{active:"active"===e.status}]),onClick:l=>He(e,"active")},[...l[59]||(l[59]=[c("span",{class:"status-dot green"},null,-1),c("span",{class:"status-text"},"上线",-1)])],10,Zt),c("div",{class:C(["status-option",{active:"coming_soon"===e.status}]),onClick:l=>He(e,"coming_soon")},[...l[60]||(l[60]=[c("span",{class:"status-dot yellow"},null,-1),c("span",{class:"status-text"},"即将",-1)])],10,Qt),c("div",{class:C(["status-option",{active:"inactive"===e.status}]),onClick:l=>He(e,"inactive")},[...l[61]||(l[61]=[c("span",{class:"status-dot gray"},null,-1),c("span",{class:"status-text"},"下线",-1)])],10,en)])]),_:1}),u(O,{label:"审核安全",width:"90",align:"center"},{default:p(({row:e})=>[u(fe,{modelValue:e.is_review_safe,"onUpdate:modelValue":l=>e.is_review_safe=l,"active-value":1,"inactive-value":0,onChange:l=>qe(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),u(O,{label:"高亮",width:"80",align:"center"},{default:p(({row:e})=>[u(fe,{modelValue:e.is_highlighted,"onUpdate:modelValue":l=>e.is_highlighted=l,"active-value":1,"inactive-value":0,onChange:l=>qe(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),u(O,{label:"醒币",width:"80",align:"center"},{default:p(({row:e})=>[c("span",ln,k(e.points_cost||e.price),1)]),_:1}),u(O,{label:"操作",width:"120",fixed:"right"},{default:p(({row:e})=>[c("div",an,[u(t,{type:"primary",link:"",size:"small",onClick:l=>async function(e){var l;U.value=!0,q.value=e,Object.assign(Ae,e),Ae.is_review_safe=1===e.is_review_safe,Z.value="basic";try{const t=await X.get(`/config/admin/scene/${e.id}/steps`);H.value=(t.data||[]).map(e=>{let l={};try{l=e.config?JSON.parse(e.config):{}}catch(t){l={}}const a=(e.options||[]).map(e=>{let l={};try{l=e.metadata?JSON.parse(e.metadata):{}}catch(t){l={}}return{...e,width:l.width||null,height:l.height||null}});if(1===e.gender_based||!0===e.gender_based||l.gender_based){let e=!1,l=!1;const t=a.filter(e=>"male"===e.gender),n=a.filter(e=>"female"===e.gender);t.forEach(l=>{1===l.is_default&&(e?l.is_default=0:e=!0)}),n.forEach(e=>{1===e.is_default&&(l?e.is_default=0:l=!0)}),!e&&t.length>0&&(t[0].is_default=1),!l&&n.length>0&&(n[0].is_default=1)}else{let e=!1;a.forEach(l=>{1===l.is_default&&(e?l.is_default=0:e=!0)}),!e&&a.length>0&&(a[0].is_default=1)}return{...e,config:l,is_required:1===e.is_required,is_visible:1===e.is_visible,gender_based:1===e.gender_based||!0===e.gender_based||l.gender_based||!1,icon:e.icon||l.icon||"",free_count:void 0!==e.free_count?e.free_count:1,cost_per_roll:void 0!==e.cost_per_roll?e.cost_per_roll:10,options:a}});for(const n of H.value)if(n.step_key)try{const a=await X.get(`/admin/grade-schemes/mapping/${e.id}/${n.step_key}`);0===a.code&&(null==(l=a.data)?void 0:l.scheme_id)&&(n.config.gradeSchemeId=a.data.scheme_id)}catch(a){}J.value=H.value.length>0?0:-1}catch(t){console.error("加载步骤失败:",t),H.value=[],J.value=-1}try{const l=(await X.get(`/config/admin/prompts/${e.id}`)).data||[];l.length>0?(Object.assign(Te,l[0]),Te.is_active=1===l[0].is_active,Oe.value={name:l[0].name||"",template:l[0].template_content||l[0].template||"",negative_prompt:l[0].negative_prompt||"",segments:l[0].segments||null,model_config:l[0].model_config||null}):(Object.assign(Te,{id:null,name:`${e.name}模板`,template:"",negative_prompt:"",segments:null,model_config:null,is_active:!0}),Oe.value={name:`${e.name}模板`,template:"",negative_prompt:"",segments:null,model_config:null})}catch(t){console.error("加载Prompt失败:",t),Object.assign(Te,{id:null,name:`${e.name}模板`,template:"",negative_prompt:"",segments:null,model_config:null,is_active:!0}),Oe.value={name:`${e.name}模板`,template:"",negative_prompt:"",segments:null,model_config:null}}D.value=!0}(e)},{default:p(()=>[...l[62]||(l[62]=[_("编辑",-1)])]),_:1},8,["onClick"]),u(t,{type:"danger",link:"",size:"small",onClick:l=>async function(e){try{await E.confirm(`确定删除场景"${e.name}"吗？`,"删除确认",{type:"warning"}),await X.delete(`/config/admin/scene/${e.id}`),S.success("删除成功"),Re()}catch{}}(e)},{default:p(()=>[...l[63]||(l[63]=[_("删除",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])])),[[ea,y.value]]),d((r(),g(ql,{modelValue:D.value,"onUpdate:modelValue":l[27]||(l[27]=e=>D.value=e),title:U.value?"编辑场景":"新增场景",width:"90%",style:{"max-width":"1200px"},top:"5vh"},{footer:p(()=>[u(t,{onClick:l[26]||(l[26]=e=>D.value=!1)},{default:p(()=>[...l[113]||(l[113]=[_("取消",-1)])]),_:1}),u(t,{type:"primary",onClick:We,loading:I.value},{default:p(()=>[...l[114]||(l[114]=[_("保存",-1)])]),_:1},8,["loading"])]),default:p(()=>[u(Wl,{modelValue:Z.value,"onUpdate:modelValue":l[25]||(l[25]=e=>Z.value=e),type:"card"},{default:p(()=>[u(Rl,{label:"基本信息",name:"basic"},{default:p(()=>[u(Bl,{model:Ae,rules:$e,ref_key:"formRef",ref:W,"label-width":"100px"},{default:p(()=>[u(Ol,{label:"场景ID",prop:"id"},{default:p(()=>[u(Dl,{modelValue:Ae.id,"onUpdate:modelValue":l[1]||(l[1]=e=>Ae.id=e),disabled:U.value,placeholder:"如: idphoto, portrait"},null,8,["modelValue","disabled"])]),_:1}),u(Ol,{label:"场景名称",prop:"name"},{default:p(()=>[c("div",tn,[u(Dl,{modelValue:Ae.name,"onUpdate:modelValue":l[2]||(l[2]=e=>Ae.name=e),placeholder:"中文名称",style:{flex:"1"}},null,8,["modelValue"]),u(Dl,{modelValue:Ae.name_en,"onUpdate:modelValue":l[3]||(l[3]=e=>Ae.name_en=e),placeholder:"English name",style:{flex:"1"}},null,8,["modelValue"]),u(Al,{content:"调用腾讯翻译API",placement:"top"},{default:p(()=>[u(t,{type:"primary",link:"",onClick:pl,icon:h(T),loading:ul.name,class:"translate-btn"},{default:p(()=>[...l[64]||(l[64]=[_("翻译",-1)])]),_:1},8,["icon","loading"])]),_:1})])]),_:1}),u(Ol,{label:"场景描述",prop:"description"},{default:p(()=>[c("div",nn,[u(Dl,{modelValue:Ae.description,"onUpdate:modelValue":l[4]||(l[4]=e=>Ae.description=e),type:"textarea",rows:2,placeholder:"简短描述（中文）",style:{flex:"1"}},null,8,["modelValue"]),u(Dl,{modelValue:Ae.description_en,"onUpdate:modelValue":l[5]||(l[5]=e=>Ae.description_en=e),type:"textarea",rows:2,placeholder:"English description",style:{flex:"1"}},null,8,["modelValue"]),u(Al,{content:"调用腾讯翻译API",placement:"top"},{default:p(()=>[u(t,{type:"primary",link:"",onClick:ml,icon:h(T),loading:ul.desc,class:"translate-btn"},{default:p(()=>[...l[65]||(l[65]=[_("翻译",-1)])]),_:1},8,["icon","loading"])]),_:1})])]),_:1}),u(Ol,{label:"场景图标"},{default:p(()=>[c("div",on,[c("div",{class:"scene-icon-selector",onClick:rl,title:"点击从素材库选择图标"},[Ae.icon?(r(),g(ue,{key:0,class:"icon-preview-inline",src:Ae.icon,fit:"cover"},null,8,["src"])):(r(),s("div",sn,[u(a,null,{default:p(()=>[u(h(b))]),_:1}),l[66]||(l[66]=c("span",null,"选择图标",-1))]))]),c("div",rn,[Ae.icon?(r(),g(t,{key:0,size:"small",link:"",type:"danger",onClick:l[6]||(l[6]=A(e=>Ae.icon="",["stop"]))},{default:p(()=>[...l[67]||(l[67]=[_("清除",-1)])]),_:1})):x("",!0),u($l,{class:"icon-upload-btn",action:"/api/upload/icon",headers:Ue.value,data:{sceneId:Ae.id},"show-file-list":!1,"on-success":Ke,"on-error":Ye,"before-upload":Xe,accept:"image/*"},{default:p(()=>[u(t,{size:"small",link:""},{default:p(()=>[...l[68]||(l[68]=[_("本地上传",-1)])]),_:1})]),_:1},8,["headers","data"])]),l[69]||(l[69]=c("div",{class:"icon-upload-tips"},[c("p",null,"点击图标从COS选择"),c("p",null,"建议: 200×200px PNG")],-1))])]),_:1}),u(jl,{gutter:20},{default:p(()=>[u(Fl,{span:12},{default:p(()=>[u(Ol,{label:"状态"},{default:p(()=>[u(Nl,{modelValue:Ae.status,"onUpdate:modelValue":l[7]||(l[7]=e=>Ae.status=e),style:{width:"100%"}},{default:p(()=>[u(Pl,{label:"上线中",value:"active"}),u(Pl,{label:"即将上线",value:"coming_soon"}),u(Pl,{label:"未上线",value:"inactive"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),u(Fl,{span:12},{default:p(()=>[u(Ol,{label:"消耗醒币"},{default:p(()=>[u(Ml,{modelValue:Ae.points_cost,"onUpdate:modelValue":l[8]||(l[8]=e=>Ae.points_cost=e),min:1,max:1e3,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),u(Ol,{label:"审核安全"},{default:p(()=>[u(fe,{modelValue:Ae.is_review_safe,"onUpdate:modelValue":l[9]||(l[9]=e=>Ae.is_review_safe=e)},null,8,["modelValue"]),l[70]||(l[70]=c("span",{class:"form-tip"},"审核模式下是否显示此场景",-1))]),_:1})]),_:1},8,["model"])]),_:1}),u(Rl,{label:"步骤配置",name:"steps",disabled:!U.value},{default:p(()=>{var e;return[c("div",cn,[c("div",dn,[l[74]||(l[74]=c("div",{class:"sidebar-title"},"步骤列表",-1)),u(h(Y),{modelValue:H.value,"onUpdate:modelValue":l[10]||(l[10]=e=>H.value=e),"item-key":"id",handle:".drag-handle",onEnd:ll,class:"steps-list-compact"},{item:p(({element:e,index:a})=>[c("div",{class:C(["step-item-compact",{active:J.value===a}]),onClick:e=>function(e){J.value=e;const l=H.value[e];l&&!l.config&&(l.config={})}(a)},[l[72]||(l[72]=c("span",{class:"drag-handle"},"☰",-1)),c("span",pn,k(a+1),1),c("div",mn,[c("span",vn,k(e.title),1),u(Ll,{size:"small",type:"info"},{default:p(()=>[_(k(e.step_key||"未设置"),1)]),_:2},1024)]),u(t,{size:"small",link:"",type:"danger",onClick:A(e=>function(e){H.value.splice(e,1),J.value>=H.value.length&&(J.value=H.value.length-1)}(a),["stop"])},{default:p(()=>[...l[71]||(l[71]=[_("×",-1)])]),_:1},8,["onClick"])],10,un)]),_:1},8,["modelValue"]),u(t,{class:"add-step-btn",size:"small",onClick:Je},{default:p(()=>[...l[73]||(l[73]=[_("+ 添加步骤",-1)])]),_:1})]),Ne.value?(r(),s("div",gn,[l[77]||(l[77]=c("div",{class:"config-section-title"},"基本配置",-1)),u(Bl,{model:Ne.value,"label-width":"80px",size:"small","label-position":"top"},{default:p(()=>[u(Ol,{label:"步骤图标"},{default:p(()=>[c("div",fn,[c("div",{class:"step-icon-preview",onClick:il},[Ne.value.icon?(r(),s("img",{key:0,src:Ne.value.icon,class:"step-icon-img"},null,8,hn)):(r(),s("div",yn,[u(a,null,{default:p(()=>[u(h(b))]),_:1})]))]),Ne.value.icon?(r(),g(t,{key:0,size:"small",link:"",type:"danger",onClick:l[11]||(l[11]=e=>Ne.value.icon="")},{default:p(()=>[...l[75]||(l[75]=[_("清除",-1)])]),_:1})):x("",!0)])]),_:1}),u(Ol,{label:"步骤标识"},{default:p(()=>[u(Dl,{modelValue:Ne.value.step_key,"onUpdate:modelValue":l[12]||(l[12]=e=>Ne.value.step_key=e),placeholder:"如: gender, background"},null,8,["modelValue"])]),_:1}),u(Ol,{label:"步骤标题"},{default:p(()=>[c("div",_n,[u(Dl,{modelValue:Ne.value.title,"onUpdate:modelValue":l[13]||(l[13]=e=>Ne.value.title=e),placeholder:"中文"},null,8,["modelValue"]),u(Dl,{modelValue:Ne.value.title_en,"onUpdate:modelValue":l[14]||(l[14]=e=>Ne.value.title_en=e),placeholder:"English"},null,8,["modelValue"]),u(Al,{content:"翻译",placement:"top"},{default:p(()=>[u(t,{type:"primary",link:"",size:"small",onClick:vl,icon:h(T),loading:ul.step},null,8,["icon","loading"])]),_:1})])]),_:1}),u(Ol,{label:"组件类型"},{default:p(()=>[u(Nl,{modelValue:Ne.value.component_type,"onUpdate:modelValue":l[15]||(l[15]=e=>Ne.value.component_type=e),style:{width:"100%"}},{default:p(()=>[u(Pl,{label:"图片上传",value:"image_upload"}),u(Pl,{label:"性别选择",value:"gender_select"}),u(Pl,{label:"单选框",value:"radio"}),u(Pl,{label:"标签选择",value:"tags"}),u(Pl,{label:"规格选择",value:"spec_select"}),u(Pl,{label:"颜色选择",value:"color_picker"}),u(Pl,{label:"图片标签",value:"image_tags"}),u(Pl,{label:"滑块",value:"slider"}),u(Pl,{label:"摇骰子",value:"random_dice"})]),_:1},8,["modelValue"])]),_:1}),"random_dice"===Ne.value.component_type?(r(),s("div",bn,[u(Ol,{label:"免费次数"},{default:p(()=>[u(Ml,{modelValue:Ne.value.free_count,"onUpdate:modelValue":l[16]||(l[16]=e=>Ne.value.free_count=e),min:0,max:99,size:"small",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),u(Ol,{label:"每次消耗"},{default:p(()=>[u(Ml,{modelValue:Ne.value.cost_per_roll,"onUpdate:modelValue":l[17]||(l[17]=e=>Ne.value.cost_per_roll=e),min:0,max:999,size:"small",style:{width:"100%"}},{suffix:p(()=>[...l[76]||(l[76]=[_("醒币",-1)])]),_:1},8,["modelValue"])]),_:1})])):x("",!0),c("div",wn,[u(Ol,{label:"必填"},{default:p(()=>[u(fe,{modelValue:Ne.value.is_required,"onUpdate:modelValue":l[18]||(l[18]=e=>Ne.value.is_required=e)},null,8,["modelValue"])]),_:1}),u(Ol,{label:"显示"},{default:p(()=>[u(fe,{modelValue:Ne.value.is_visible,"onUpdate:modelValue":l[19]||(l[19]=e=>Ne.value.is_visible=e)},null,8,["modelValue"])]),_:1}),"image_tags"===Ne.value.component_type?(r(),g(Ol,{key:0,label:"性别分类"},{default:p(()=>[u(fe,{modelValue:Ne.value.gender_based,"onUpdate:modelValue":l[20]||(l[20]=e=>Ne.value.gender_based=e)},null,8,["modelValue"])]),_:1})):x("",!0)])]),_:1},8,["model"])])):(r(),s("div",kn,[u(Kl,{description:"请选择步骤","image-size":60})])),Ne.value?(r(),s("div",Vn,["image_upload"===Ne.value.component_type?(r(),s("div",xn,[u(a,{size:40,color:"#909399"},{default:p(()=>[u(h(w))]),_:1}),l[78]||(l[78]=c("p",null,"图片上传组件",-1)),l[79]||(l[79]=c("span",null,"此组件用于用户上传照片，无需配置选项",-1))])):"gender_select"===Ne.value.component_type?(r(),s("div",Cn,[u(a,{size:40,color:"#909399"},{default:p(()=>[u(h($))]),_:1}),l[80]||(l[80]=c("p",null,"性别选择组件",-1)),l[81]||(l[81]=c("span",null,"此组件提供男/女选项，无需额外配置",-1))])):"random_dice"===Ne.value.component_type?(r(),s("div",Sn,[c("div",En,[u(Yl,{modelValue:Ne.value.config.showImage,"onUpdate:modelValue":l[21]||(l[21]=e=>Ne.value.config.showImage=e),size:"small"},{default:p(()=>[...l[82]||(l[82]=[_("显示图片",-1)])]),_:1},8,["modelValue"]),l[83]||(l[83]=c("span",{class:"config-tip"},"（勾选后每个选项需要配置图片）",-1))]),c("div",In,[l[85]||(l[85]=c("div",{class:"section-title"}," 品级方案管理 ",-1)),Ae.id&&Ne.value.step_key?(r(),s("div",zn,[c("div",Dn,[u(Nl,{modelValue:Ne.value.config.gradeSchemeId,"onUpdate:modelValue":l[22]||(l[22]=e=>Ne.value.config.gradeSchemeId=e),placeholder:"选择品级方案",style:{width:"180px"},size:"small",onChange:Ie},{default:p(()=>[(r(!0),s(m,null,v(ke.value,e=>(r(),g(Pl,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),u(t,{size:"small",onClick:Ce},{default:p(()=>[...l[84]||(l[84]=[_("编辑",-1)])]),_:1})]),xe.value?(r(),s("div",Un,[(r(!0),s(m,null,v(xe.value.grades,e=>(r(),s("span",{key:e.id,class:"grade-preview-item",style:V({background:e.color,color:"#fff"})},k(e.name),5))),128))])):x("",!0)])):(r(),g(Kl,{key:1,description:"请先保存场景","image-size":60}))]),c("div",Tn,[l[86]||(l[86]=c("div",{class:"section-title"},"词条池管理",-1)),Ae.id&&Ne.value.step_key?(r(),g(ba,{"scene-id":Ae.id,"step-key":Ne.value.step_key,"show-image":(null==(e=Ne.value.config)?void 0:e.showImage)||!1,key:Ne.value.step_key},null,8,["scene-id","step-key","show-image"])):(r(),g(Kl,{key:1,description:"请先保存场景","image-size":60}))])])):(r(),s(m,{key:3},[c("div",On,[l[89]||(l[89]=_(" 选项配置 ",-1)),c("div",An,[u(Al,{content:"批量翻译所有选项为英文",placement:"top"},{default:p(()=>[u(t,{size:"small",type:"success",link:"",onClick:gl,icon:h(T)},{default:p(()=>[...l[87]||(l[87]=[_("批量翻译",-1)])]),_:1},8,["icon"])]),_:1}),u(t,{size:"small",type:"primary",link:"",onClick:Ge},{default:p(()=>[...l[88]||(l[88]=[_("+ 添加选项",-1)])]),_:1})])]),"image_tags"===Ne.value.component_type&&Ne.value.gender_based?(r(),s("div",$n,[u(z,{modelValue:Fe.value,"onUpdate:modelValue":l[23]||(l[23]=e=>Fe.value=e),size:"small"},{default:p(()=>[u(n,{label:""},{default:p(()=>[...l[90]||(l[90]=[_("全部",-1)])]),_:1}),u(n,{label:"male"},{default:p(()=>[...l[91]||(l[91]=[_("男",-1)])]),_:1}),u(n,{label:"female"},{default:p(()=>[...l[92]||(l[92]=[_("女",-1)])]),_:1})]),_:1},8,["modelValue"]),c("span",Pn,k(Me.value.length)+" 项",1)])):x("",!0),"spec_select"===Ne.value.component_type?(r(),s("div",Nn,[u(a,null,{default:p(()=>[u(h(P))]),_:1}),l[93]||(l[93]=c("span",null,"尺寸用于后端动态裁剪",-1))])):x("",!0),c("div",Fn,["image_tags"===Ne.value.component_type?(r(!0),s(m,{key:0},v(Me.value,(e,n)=>(r(),s("div",{key:e.option_key||n,class:"image-tag-row"},[c("div",Mn,[c("div",{class:"option-thumb-selector",onClick:l=>async function(e){var l;al.value=e,re.value=-1,se.value=e.image||"",(null==(l=Ne.value)?void 0:l.gender_based)&&e.gender?ie.value=e.gender:ie.value="",Q.value=!0,0===le.value.length?await tl():nl()}(e),title:"点击从素材库选择图片"},[e.image?(r(),g(ue,{key:0,class:"option-thumb",src:e.image,fit:"cover"},null,8,["src"])):(r(),s("div",Bn,[u(a,null,{default:p(()=>[u(h(b))]),_:1})]))],8,jn),e.image?(r(),g(t,{key:0,size:"small",link:"",type:"danger",onClick:A(l=>e.image="",["stop"]),title:"清除图片"},{default:p(()=>[...l[94]||(l[94]=[_("清除",-1)])]),_:1},8,["onClick"])):x("",!0)]),c("div",Rn,[c("div",Ln,[c("div",Kn,[l[95]||(l[95]=c("label",null,"中文",-1)),u(Dl,{modelValue:e.label,"onUpdate:modelValue":l=>e.label=l,size:"small",style:{width:"90px"},placeholder:"名称"},null,8,["modelValue","onUpdate:modelValue"])]),c("div",Yn,[l[96]||(l[96]=c("label",null,"English",-1)),c("div",Xn,[u(Dl,{modelValue:e.label_en,"onUpdate:modelValue":l=>e.label_en=l,size:"small",style:{width:"100px"},placeholder:"Name"},null,8,["modelValue","onUpdate:modelValue"]),u(Al,{content:"翻译",placement:"top"},{default:p(()=>[u(t,{type:"primary",link:"",size:"small",onClick:l=>fl(e),class:"mini-translate-btn"},{default:p(()=>[u(a,{size:12},{default:p(()=>[u(h(T))]),_:1})]),_:1},8,["onClick"])]),_:2},1024)])]),Ne.value.gender_based?(r(),s("div",Wn,[l[97]||(l[97]=c("label",null,"性别",-1)),u(Nl,{modelValue:e.gender,"onUpdate:modelValue":l=>e.gender=l,size:"small",style:{width:"65px"},clearable:""},{default:p(()=>[u(Pl,{label:"男",value:"male"}),u(Pl,{label:"女",value:"female"})]),_:1},8,["modelValue","onUpdate:modelValue"])])):x("",!0),c("div",qn,[l[99]||(l[99]=c("label",null," ",-1)),u(Yl,{"model-value":1===e.is_default,onChange:l=>Qe(e),size:"small",disabled:el(e)},{default:p(()=>[...l[98]||(l[98]=[_("默认",-1)])]),_:1},8,["model-value","onChange","disabled"])]),c("div",Hn,[l[101]||(l[101]=c("label",null," ",-1)),u(t,{size:"small",link:"",type:"danger",onClick:l=>function(e){const l=Ne.value.options.indexOf(e);l>=0&&Ze(l)}(e)},{default:p(()=>[...l[100]||(l[100]=[_("删除",-1)])]),_:1},8,["onClick"])])]),c("div",Jn,[l[102]||(l[102]=c("label",null,"AI提示词",-1)),u(Dl,{modelValue:e.prompt_text,"onUpdate:modelValue":l=>e.prompt_text=l,size:"small",placeholder:"发送给AI的描述文字"},null,8,["modelValue","onUpdate:modelValue"])])])]))),128)):"tags"===Ne.value.component_type?(r(),s(m,{key:1},[l[104]||(l[104]=c("div",{class:"tags-table-header"},[c("div",{class:"tags-col tags-col-label-main"},"中文"),c("div",{class:"tags-col tags-col-label"},"English"),c("div",{class:"tags-col tags-col-prompt"},"AI提示词"),c("div",{class:"tags-col tags-col-default"},"默认"),c("div",{class:"tags-col tags-col-action"},"操作")],-1)),(r(!0),s(m,null,v(Ne.value.options,(e,n)=>(r(),s("div",{key:n,class:"tags-table-row"},[c("div",Gn,[u(Dl,{modelValue:e.label,"onUpdate:modelValue":l=>e.label=l,placeholder:"标签名",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),c("div",Zn,[c("div",Qn,[u(Dl,{modelValue:e.label_en,"onUpdate:modelValue":l=>e.label_en=l,placeholder:"Tag",size:"small"},null,8,["modelValue","onUpdate:modelValue"]),u(t,{type:"primary",link:"",size:"small",onClick:l=>fl(e),class:"mini-translate-btn"},{default:p(()=>[u(a,{size:12},{default:p(()=>[u(h(T))]),_:1})]),_:1},8,["onClick"])])]),c("div",eo,[u(Dl,{modelValue:e.prompt_text,"onUpdate:modelValue":l=>e.prompt_text=l,placeholder:"发送给AI的描述",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),c("div",lo,[u(Yl,{"model-value":1===e.is_default,onChange:l=>Qe(e),size:"small",disabled:1===e.is_default},null,8,["model-value","onChange","disabled"])]),c("div",ao,[u(t,{size:"small",link:"",type:"danger",onClick:e=>Ze(n)},{default:p(()=>[...l[103]||(l[103]=[_("删除",-1)])]),_:1},8,["onClick"])])]))),128))],64)):"spec_select"===Ne.value.component_type?(r(),s(m,{key:2},[l[106]||(l[106]=c("div",{class:"spec-table-header"},[c("div",{class:"spec-col spec-col-label-main"},"中文"),c("div",{class:"spec-col spec-col-label"},"English"),c("div",{class:"spec-col spec-col-size"},"宽度(mm)"),c("div",{class:"spec-col spec-col-size"},"高度(mm)"),c("div",{class:"spec-col spec-col-default"},"默认"),c("div",{class:"spec-col spec-col-action"},"操作")],-1)),(r(!0),s(m,null,v(Ne.value.options,(e,n)=>(r(),s("div",{key:n,class:"spec-table-row"},[c("div",to,[u(Dl,{modelValue:e.label,"onUpdate:modelValue":l=>e.label=l,placeholder:"一寸",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),c("div",no,[c("div",oo,[u(Dl,{modelValue:e.label_en,"onUpdate:modelValue":l=>e.label_en=l,placeholder:"1 inch",size:"small"},null,8,["modelValue","onUpdate:modelValue"]),u(t,{type:"primary",link:"",size:"small",onClick:l=>fl(e),class:"mini-translate-btn"},{default:p(()=>[u(a,{size:12},{default:p(()=>[u(h(T))]),_:1})]),_:1},8,["onClick"])])]),c("div",io,[u(Dl,{modelValue:e.width,"onUpdate:modelValue":l=>e.width=l,modelModifiers:{number:!0},type:"number",size:"small",placeholder:"25"},null,8,["modelValue","onUpdate:modelValue"])]),c("div",so,[u(Dl,{modelValue:e.height,"onUpdate:modelValue":l=>e.height=l,modelModifiers:{number:!0},type:"number",size:"small",placeholder:"35"},null,8,["modelValue","onUpdate:modelValue"])]),c("div",ro,[u(Yl,{"model-value":1===e.is_default,onChange:l=>Qe(e),size:"small",disabled:1===e.is_default},null,8,["model-value","onChange","disabled"])]),c("div",co,[u(t,{size:"small",link:"",type:"danger",onClick:e=>Ze(n)},{default:p(()=>[...l[105]||(l[105]=[_("删除",-1)])]),_:1},8,["onClick"])])]))),128))],64)):"random_dice"!==Ne.value.component_type?(r(),s(m,{key:3},[c("div",uo,[l[107]||(l[107]=c("div",{class:"common-col common-col-label-main"},"中文",-1)),l[108]||(l[108]=c("div",{class:"common-col common-col-label"},"English",-1)),"color_picker"===Ne.value.component_type?(r(),s("div",po,"颜色")):(r(),s("div",mo,"图片URL")),l[109]||(l[109]=c("div",{class:"common-col common-col-prompt"},"AI提示词",-1)),l[110]||(l[110]=c("div",{class:"common-col common-col-default"},"默认",-1)),l[111]||(l[111]=c("div",{class:"common-col common-col-action"},"操作",-1))]),(r(!0),s(m,null,v(Ne.value.options,(e,n)=>(r(),s("div",{key:n,class:"common-table-row"},[c("div",vo,[u(Dl,{modelValue:e.label,"onUpdate:modelValue":l=>e.label=l,placeholder:"选项名",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),c("div",go,[c("div",fo,[u(Dl,{modelValue:e.label_en,"onUpdate:modelValue":l=>e.label_en=l,placeholder:"Option",size:"small"},null,8,["modelValue","onUpdate:modelValue"]),u(t,{type:"primary",link:"",size:"small",onClick:l=>fl(e),class:"mini-translate-btn"},{default:p(()=>[u(a,{size:12},{default:p(()=>[u(h(T))]),_:1})]),_:1},8,["onClick"])])]),c("div",ho,["color_picker"===Ne.value.component_type?(r(),g(Xl,{key:0,modelValue:e.color,"onUpdate:modelValue":l=>e.color=l,size:"small"},null,8,["modelValue","onUpdate:modelValue"])):(r(),g(Dl,{key:1,modelValue:e.image,"onUpdate:modelValue":l=>e.image=l,placeholder:"URL",size:"small"},null,8,["modelValue","onUpdate:modelValue"]))]),c("div",yo,[u(Dl,{modelValue:e.prompt_text,"onUpdate:modelValue":l=>e.prompt_text=l,placeholder:"发送给AI的描述",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),c("div",_o,[u(Yl,{"model-value":1===e.is_default,onChange:l=>Qe(e),size:"small",disabled:1===e.is_default},null,8,["model-value","onChange","disabled"])]),c("div",bo,[u(t,{size:"small",link:"",type:"danger",onClick:e=>Ze(n)},{default:p(()=>[...l[112]||(l[112]=[_("删除",-1)])]),_:1},8,["onClick"])])]))),128))],64)):x("",!0)])],64))])):(r(),s("div",wo,[u(Kl,{description:"选择步骤后配置选项","image-size":60})]))])]}),_:1},8,["disabled"]),u(Rl,{label:"Prompt模板",name:"prompt",disabled:!U.value},{default:p(()=>[u(Ft,{modelValue:Oe.value,"onUpdate:modelValue":l[24]||(l[24]=e=>Oe.value=e),"scene-steps":H.value,"scene-id":Ae.id},null,8,["modelValue","scene-steps","scene-id"])]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"])),[[la]]),d((r(),g(ql,{modelValue:Q.value,"onUpdate:modelValue":l[32]||(l[32]=e=>Q.value=e),title:"从COS选择图片",width:"90%",style:{"max-width":"900px"},"append-to-body":""},{footer:p(()=>[u(t,{onClick:l[31]||(l[31]=e=>Q.value=!1)},{default:p(()=>[...l[119]||(l[119]=[_("取消",-1)])]),_:1}),u(t,{type:"primary",onClick:ol,disabled:!se.value},{default:p(()=>[...l[120]||(l[120]=[_("确定选择",-1)])]),_:1},8,["disabled"])]),default:p(()=>[c("div",ko,[c("div",Vo,[Ne.value&&Ne.value.gender_based?(r(),g(z,{key:0,modelValue:ie.value,"onUpdate:modelValue":l[28]||(l[28]=e=>ie.value=e),size:"small",onChange:nl},{default:p(()=>[u(n,{label:""},{default:p(()=>[...l[115]||(l[115]=[_("全部",-1)])]),_:1}),u(n,{label:"male"},{default:p(()=>[...l[116]||(l[116]=[_("男",-1)])]),_:1}),u(n,{label:"female"},{default:p(()=>[...l[117]||(l[117]=[_("女",-1)])]),_:1})]),_:1},8,["modelValue"])):x("",!0),u(Nl,{modelValue:oe.value,"onUpdate:modelValue":l[29]||(l[29]=e=>oe.value=e),placeholder:"选择文件夹",clearable:"",style:{width:"200px"},onChange:nl},{default:p(()=>[u(Pl,{label:"全部文件夹",value:""}),(r(!0),s(m,null,v(te.value,e=>(r(),g(Pl,{key:e,label:e||"根目录",value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),u(Dl,{modelValue:ne.value,"onUpdate:modelValue":l[30]||(l[30]=e=>ne.value=e),placeholder:"搜索文件名...",clearable:"",style:{width:"180px"},onInput:nl},null,8,["modelValue"]),u(t,{onClick:tl,loading:ee.value},{default:p(()=>[...l[118]||(l[118]=[_("刷新",-1)])]),_:1},8,["loading"])]),ae.value.length>0?(r(),s("div",xo,[c("span",Co,"共 "+k(ae.value.length)+" 张图片",1)])):x("",!0),d((r(),s("div",So,[(r(!0),s(m,null,v(ae.value,e=>(r(),s("div",{key:e.key,class:C(["cos-image-item",{selected:se.value===e.url}]),onClick:l=>function(e){se.value=e.url}(e)},[u(ue,{src:e.url,fit:"cover",lazy:""},null,8,["src"]),c("div",Io,[c("div",zo,k(e.fileName),1),c("div",Do,[e.folderPath&&"根目录"!==e.folderPath?(r(),g(Ll,{key:0,size:"small",type:"info"},{default:p(()=>[_(k(e.folderPath),1)]),_:2},1024)):x("",!0)])])],10,Eo))),128)),ee.value||0!==ae.value.length?x("",!0):(r(),g(Kl,{key:0,description:"暂无图片，请调整筛选条件"}))])),[[ea,ee.value]])])]),_:1},8,["modelValue"])),[[la]]),d((r(),g(ql,{modelValue:ce.value,"onUpdate:modelValue":l[35]||(l[35]=e=>ce.value=e),title:"选择步骤图标",width:"90%",style:{"max-width":"600px"},"append-to-body":""},{footer:p(()=>[u(t,{onClick:l[34]||(l[34]=e=>ce.value=!1)},{default:p(()=>[...l[121]||(l[121]=[_("取消",-1)])]),_:1}),u(t,{type:"primary",onClick:sl,disabled:!me.value},{default:p(()=>[...l[122]||(l[122]=[_("确定选择",-1)])]),_:1},8,["disabled"])]),default:p(()=>[c("div",Uo,[u(Dl,{modelValue:pe.value,"onUpdate:modelValue":l[33]||(l[33]=e=>pe.value=e),placeholder:"搜索图标...",clearable:"",style:{width:"200px","margin-bottom":"12px"}},null,8,["modelValue"]),d((r(),s("div",To,[(r(!0),s(m,null,v(ze.value,e=>(r(),s("div",{key:e.key,class:C(["step-icon-item",{selected:me.value===e.url}]),onClick:l=>function(e){me.value=e.url}(e)},[c("img",{src:e.url,alt:e.fileName},null,8,Ao),c("div",$o,k(e.fileName),1)],10,Oo))),128)),de.value||0!==ze.value.length?x("",!0):(r(),g(Kl,{key:0,description:"暂无图标"}))])),[[ea,de.value]])])]),_:1},8,["modelValue"])),[[la]]),d((r(),g(ql,{modelValue:ve.value,"onUpdate:modelValue":l[39]||(l[39]=e=>ve.value=e),title:"从COS选择场景图标",width:"90%",style:{"max-width":"900px"},"append-to-body":""},{footer:p(()=>[u(t,{onClick:l[38]||(l[38]=e=>ve.value=!1)},{default:p(()=>[...l[124]||(l[124]=[_("取消",-1)])]),_:1}),u(t,{type:"primary",onClick:dl,disabled:!be.value},{default:p(()=>[...l[125]||(l[125]=[_("确定选择",-1)])]),_:1},8,["disabled"])]),default:p(()=>[c("div",Po,[c("div",No,[u(Nl,{modelValue:_e.value,"onUpdate:modelValue":l[36]||(l[36]=e=>_e.value=e),placeholder:"选择文件夹",clearable:"",style:{width:"160px"},onChange:De},{default:p(()=>[u(Pl,{label:"全部文件夹",value:""}),(r(!0),s(m,null,v(he.value,e=>(r(),g(Pl,{key:e,label:e||"根目录",value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),u(Dl,{modelValue:ye.value,"onUpdate:modelValue":l[37]||(l[37]=e=>ye.value=e),placeholder:"搜索图片...",clearable:"",style:{width:"200px"},onInput:De},null,8,["modelValue"]),u(t,{onClick:cl,loading:ge.value,size:"small"},{default:p(()=>[...l[123]||(l[123]=[_("刷新",-1)])]),_:1},8,["loading"]),we.value.length>0?(r(),s("span",Fo,"共 "+k(we.value.length)+" 张图片",1)):x("",!0)]),d((r(),s("div",Mo,[(r(!0),s(m,null,v(we.value,e=>(r(),s("div",{key:e.key,class:C(["scene-icon-item",{selected:be.value===e.url}]),onClick:l=>function(e){be.value=e.url}(e)},[u(ue,{src:e.url,fit:"cover",lazy:""},null,8,["src"]),c("div",Bo,[c("div",Ro,k(e.fileName),1),c("div",Lo,[e.folderPath?(r(),g(Ll,{key:0,size:"small",type:"info"},{default:p(()=>[_(k(e.folderPath),1)]),_:2},1024)):x("",!0)])])],10,jo))),128)),ge.value||0!==we.value.length?x("",!0):(r(),g(Kl,{key:0,description:"暂无图片"}))])),[[ea,ge.value]])])]),_:1},8,["modelValue"])),[[la]]),c("div",{class:C(["ai-assistant-fab",{active:hl.value}]),onClick:Cl},[u(a,{size:24},{default:p(()=>[u(h(T))]),_:1}),l[126]||(l[126]=c("span",{class:"fab-label"},"AI助手",-1))],2),u(Gl,{modelValue:hl.value,"onUpdate:modelValue":l[46]||(l[46]=e=>hl.value=e),title:"AI 场景生成助手",direction:"rtl",size:"420px","close-on-click-modal":!1},{default:p(()=>[c("div",Ko,[c("div",Yo,[u(z,{modelValue:yl.value,"onUpdate:modelValue":l[40]||(l[40]=e=>yl.value=e),size:"small"},{default:p(()=>[u(n,{label:"create"},{default:p(()=>[...l[127]||(l[127]=[_("新建场景",-1)])]),_:1}),u(n,{label:"modify",disabled:!q.value},{default:p(()=>[...l[128]||(l[128]=[_("修改场景",-1)])]),_:1},8,["disabled"]),u(n,{label:"image"},{default:p(()=>[...l[129]||(l[129]=[_("生成图标",-1)])]),_:1})]),_:1},8,["modelValue"])]),"modify"===yl.value&&q.value?(r(),s("div",Xo,[u(a,null,{default:p(()=>[u(h(N))]),_:1}),c("span",null,"当前场景: "+k(q.value.name),1)])):x("",!0),"image"===yl.value?(r(),s("div",Wo,[c("div",qo,[u(Hl,{title:"AI图片生成已禁用",type:"info",closable:!1,"show-icon":""},{default:p(()=>[...l[130]||(l[130]=[c("p",null,"由于绿幕抠图效果不理想，AI图片生成功能已暂时禁用。",-1),c("p",{style:{"margin-top":"8px"}},"请使用以下方式管理图片：",-1),c("ol",{style:{margin:"8px 0 0 16px",padding:"0"}},[c("li",null,"在「素材管理」中上传图片素材"),c("li",null,"在「场景配置」的步骤选项中点击图片区域从素材库选择")],-1)])]),_:1})]),c("div",Ho,[u(t,{type:"primary",onClick:Il},{default:p(()=>[u(a,null,{default:p(()=>[u(h(N))]),_:1}),l[131]||(l[131]=_(" 前往素材管理 ",-1))]),_:1})]),q.value?(r(),s("div",Jo,[u(Jl,{shadow:"never"},{header:p(()=>[c("span",null,"当前场景: "+k(q.value.name),1)]),default:p(()=>[l[132]||(l[132]=c("p",{style:{"font-size":"13px",color:"#909399"}}," 请在编辑场景时，点击步骤选项的图片区域从COS素材库选择图片。 ",-1))]),_:1})])):x("",!0)])):x("",!0),d(c("div",{class:"ai-chat-history",ref_key:"chatHistoryRef",ref:kl},[0===wl.value.length?(r(),s("div",Go,[l[134]||(l[134]=c("div",{class:"welcome-icon"},"🤖",-1)),l[135]||(l[135]=c("h3",null,"AI 场景生成助手",-1)),"create"===yl.value?(r(),s("p",Zo,"描述您想要创建的场景，我将自动生成完整配置")):(r(),s("p",Qo,"描述您想要修改的内容，我将帮您调整当前场景")),c("div",ei,[l[133]||(l[133]=c("div",{class:"suggestion-title"},"试试这样说:",-1)),"create"===yl.value?(r(),s("div",{key:0,class:"suggestion-item",onClick:l[41]||(l[41]=e=>Sl("帮我创建一个宠物写真场景，包含宠物类型选择、背景风格、滤镜效果等步骤"))},' "帮我创建一个宠物写真场景" ')):x("",!0),"create"===yl.value?(r(),s("div",{key:1,class:"suggestion-item",onClick:l[42]||(l[42]=e=>Sl("创建一个职业形象照场景，需要性别选择、行业选择、着装风格、背景颜色等配置"))},' "创建一个职业形象照场景" ')):x("",!0),"modify"===yl.value?(r(),s("div",{key:2,class:"suggestion-item",onClick:l[43]||(l[43]=e=>Sl("添加一个新的背景颜色选项：渐变紫色"))},' "添加一个新的背景颜色选项" ')):x("",!0),"modify"===yl.value?(r(),s("div",{key:3,class:"suggestion-item",onClick:l[44]||(l[44]=e=>Sl("优化当前场景的Prompt模板，使生成效果更专业"))},' "优化Prompt模板" ')):x("",!0)])])):x("",!0),(r(!0),s(m,null,v(wl.value,(e,n)=>{var o,i,d,f,y,b,w;return r(),s("div",{key:n,class:C(["ai-message",e.role])},[c("div",li,["user"===e.role?(r(),s("span",ai,"👤")):(r(),s("span",ti,"🤖"))]),c("div",ni,[c("div",{class:"message-text",innerHTML:(w=e.content,w?w.replace(/\n/g,"<br>"):"")},null,8,oi),"assistant"===e.role&&e.generatedConfig?(r(),s("div",ii,[c("div",si,[u(a,null,{default:p(()=>[u(h(F))]),_:1}),l[136]||(l[136]=c("span",null,"已生成场景配置",-1))]),c("div",ri,[c("div",null,"场景: "+k((null==(o=e.generatedConfig.scene)?void 0:o.name)||"未命名"),1),c("div",null,"步骤数: "+k((null==(i=e.generatedConfig.steps)?void 0:i.length)||0),1),(null==(d=e.generatedConfig.scene)?void 0:d.icon)?(r(),s("div",ci,[c("img",{src:e.generatedConfig.scene.icon,alt:"场景图标",style:{width:"40px",height:"40px","border-radius":"4px"}},null,8,di)])):x("",!0),e.imageTasksPending?(r(),s("div",ui,[c("div",pi,[u(a,null,{default:p(()=>[u(h(M))]),_:1}),c("span",null,"需要生成 "+k((null==(f=e.imageTasks)?void 0:f.length)||0)+" 张图片",1)]),c("div",mi,[(r(!0),s(m,null,v(e.imageTasks,(e,l)=>(r(),s("div",{key:l,class:"task-item"},[u(a,null,{default:p(()=>[u(h(j))]),_:1}),c("span",null,k(e.label),1)]))),128))]),c("div",vi,[u(t,{type:"primary",size:"small",onClick:e=>zl(n)},{default:p(()=>{var l;return[_(" 确认生成（消耗 "+k((null==(l=e.imageTasks)?void 0:l.length)||0)+" 次调用） ",1)]}),_:2},1032,["onClick"]),u(t,{size:"small",onClick:e=>function(e){var l,a;const t=wl.value[e];t&&(t.imageTasksPending=!1,t.imageTasks=[],t.content="create"===yl.value?`已为您生成「${(null==(l=t.generatedConfig.scene)?void 0:l.name)||"新场景"}」的完整配置，包含 ${(null==(a=t.generatedConfig.steps)?void 0:a.length)||0} 个步骤。已跳过图片生成，点击下方按钮可预览详情或直接应用。`:"已根据您的要求修改了场景配置。已跳过图片生成，点击下方按钮查看修改结果。",S.info("已跳过图片生成"),El())}(n)},{default:p(()=>[...l[137]||(l[137]=[_(" 跳过图片生成 ",-1)])]),_:1},8,["onClick"])])])):x("",!0),e.generatingImages?(r(),s("div",gi,[c("div",fi,[u(a,{class:"is-loading"},{default:p(()=>[u(h(B))]),_:1}),c("span",null,"正在生成图标和示意图 ("+k((null==(y=e.imageProgress)?void 0:y.current)||0)+"/"+k((null==(b=e.imageProgress)?void 0:b.total)||0)+")",1)]),c("div",hi,[(r(!0),s(m,null,v(e.imageTasks,(e,l)=>(r(),s("div",{key:l,class:C(["progress-task-item",e.status])},["completed"===e.status?(r(),g(a,{key:0},{default:p(()=>[u(h(R))]),_:1})):"processing"===e.status?(r(),g(a,{key:1,class:"is-loading"},{default:p(()=>[u(h(B))]),_:1})):(r(),g(a,{key:2},{default:p(()=>[u(h(L))]),_:1})),c("span",null,k(e.label),1)],2))),128))])])):x("",!0)]),c("div",yi,[u(t,{type:"primary",size:"small",onClick:l=>Tl(e.generatedConfig),disabled:e.generatingImages||e.imageTasksPending},{default:p(()=>[...l[138]||(l[138]=[_(" 应用配置 ",-1)])]),_:1},8,["onClick","disabled"]),u(t,{size:"small",onClick:l=>{return a=e.generatedConfig,xl.value=a,void(Vl.value=!0);var a}},{default:p(()=>[...l[139]||(l[139]=[_(" 预览详情 ",-1)])]),_:1},8,["onClick"])])])):x("",!0)])],2)}),128)),bl.value?(r(),s("div",_i,[...l[140]||(l[140]=[c("div",{class:"message-avatar"},"🤖",-1),c("div",{class:"message-content"},[c("div",{class:"message-loading"},[c("span"),c("span"),c("span")])],-1)])])):x("",!0)],512),[[K,"image"!==yl.value]]),c("div",bi,[u(Dl,{modelValue:_l.value,"onUpdate:modelValue":l[45]||(l[45]=e=>_l.value=e),type:"textarea",rows:3,placeholder:"create"===yl.value?"描述您想创建的场景...":"描述您想修改的内容...",onKeydown:f(A(Ul,["ctrl"]),["enter"]),disabled:bl.value},null,8,["modelValue","placeholder","onKeydown","disabled"]),c("div",wi,[l[142]||(l[142]=c("span",{class:"input-hint"},"Ctrl + Enter 发送",-1)),u(t,{type:"primary",onClick:Ul,loading:bl.value,disabled:!_l.value.trim()},{default:p(()=>[...l[141]||(l[141]=[_(" 发送 ",-1)])]),_:1},8,["loading","disabled"])])])])]),_:1},8,["modelValue"]),u(ql,{modelValue:Vl.value,"onUpdate:modelValue":l[49]||(l[49]=e=>Vl.value=e),title:"AI 生成配置预览",width:"80%",style:{"max-width":"900px"},"append-to-body":""},{footer:p(()=>[u(t,{onClick:l[47]||(l[47]=e=>Vl.value=!1)},{default:p(()=>[...l[144]||(l[144]=[_("关闭",-1)])]),_:1}),u(t,{type:"primary",onClick:l[48]||(l[48]=e=>{Tl(xl.value),Vl.value=!1})},{default:p(()=>[...l[145]||(l[145]=[_(" 应用此配置 ",-1)])]),_:1})]),default:p(()=>[xl.value?(r(),s("div",ki,[u(Wl,null,{default:p(()=>{var e;return[u(Rl,{label:"场景信息"},{default:p(()=>[u(Ql,{column:2,border:""},{default:p(()=>[u(Zl,{label:"场景ID"},{default:p(()=>{var e;return[_(k(null==(e=xl.value.scene)?void 0:e.scene_key),1)]}),_:1}),u(Zl,{label:"场景名称"},{default:p(()=>{var e;return[_(k(null==(e=xl.value.scene)?void 0:e.name),1)]}),_:1}),u(Zl,{label:"英文名称"},{default:p(()=>{var e;return[_(k(null==(e=xl.value.scene)?void 0:e.name_en),1)]}),_:1}),u(Zl,{label:"消耗醒币"},{default:p(()=>{var e;return[_(k(null==(e=xl.value.scene)?void 0:e.points_cost),1)]}),_:1}),u(Zl,{label:"场景图标"},{default:p(()=>{var e;return[(null==(e=xl.value.scene)?void 0:e.icon)?(r(),s("img",{key:0,src:xl.value.scene.icon,alt:"场景图标",style:{width:"60px",height:"60px","border-radius":"8px","object-fit":"cover"}},null,8,Vi)):(r(),s("span",xi,"暂无图标"))]}),_:1}),u(Zl,{label:"图标描述"},{default:p(()=>{var e;return[_(k((null==(e=xl.value.scene)?void 0:e.icon_description)||"无"),1)]}),_:1}),u(Zl,{label:"中文描述",span:2},{default:p(()=>{var e;return[_(k(null==(e=xl.value.scene)?void 0:e.description),1)]}),_:1}),u(Zl,{label:"英文描述",span:2},{default:p(()=>{var e;return[_(k(null==(e=xl.value.scene)?void 0:e.description_en),1)]}),_:1})]),_:1})]),_:1}),u(Rl,{label:`步骤配置 (${(null==(e=xl.value.steps)?void 0:e.length)||0})`},{default:p(()=>[(r(!0),s(m,null,v(xl.value.steps,(e,l)=>{var t;return r(),s("div",{key:l,class:"preview-step-card"},[c("div",Ci,[c("span",Si,k(l+1),1),c("span",Ei,k(e.title)+" ("+k(e.step_key)+")",1),u(Ll,{size:"small"},{default:p(()=>{return[_(k((l=e.component_type,je[l]||l)),1)];var l}),_:2},1024)]),(null==(t=e.options)?void 0:t.length)?(r(),s("div",Ii,[c("div",zi,[(r(!0),s(m,null,v(e.options,e=>(r(),s("div",{key:e.option_key,class:"option-item"},[e.image?(r(),s("img",{key:0,src:e.image,alt:e.label,class:"option-preview-image"},null,8,Di)):(r(),s("div",Ui,[u(a,null,{default:p(()=>[u(h(M))]),_:1})])),c("div",Ti,k(e.label),1)]))),128))])])):x("",!0)])}),128))]),_:1},8,["label"]),u(Rl,{label:"Prompt模板"},{default:p(()=>{var e,a,t;return[c("div",Oi,[l[143]||(l[143]=c("div",{class:"prompt-label"},"正向提示词:",-1)),c("pre",null,k(null==(e=xl.value.prompt_template)?void 0:e.template),1),(null==(a=xl.value.prompt_template)?void 0:a.negative_prompt)?(r(),s("div",Ai,"负面提示词:")):x("",!0),(null==(t=xl.value.prompt_template)?void 0:t.negative_prompt)?(r(),s("pre",$i,k(xl.value.prompt_template.negative_prompt),1)):x("",!0)])]}),_:1})]}),_:1})])):x("",!0)]),_:1},8,["modelValue"]),u(ql,{modelValue:Ve.value,"onUpdate:modelValue":l[51]||(l[51]=e=>Ve.value=e),title:"品级方案管理",width:"900px","destroy-on-close":""},{footer:p(()=>[u(t,{onClick:l[50]||(l[50]=e=>Ve.value=!1)},{default:p(()=>[...l[146]||(l[146]=[_("关闭",-1)])]),_:1})]),default:p(()=>{var e;return[Ve.value&&Ae.id&&(null==(e=Ne.value)?void 0:e.step_key)?(r(),g(St,{key:0,"scene-id":String(Ae.id),"step-key":Ne.value.step_key,onChange:Se},null,8,["scene-id","step-key"])):x("",!0)]}),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-b83de2a5"]]);export{Pi as default};
