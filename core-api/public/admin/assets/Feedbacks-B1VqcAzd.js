import{F as e,r as a,i as l,c as s,o as t,e as i,G as n,w as d,f as r,H as u,I as o,d as c,t as v,J as p,O as m,P as w,h as f,Q as g,E as k}from"./index-CHOzxtOa.js";import{u as y,t as _}from"./timezone-bSrhj2J5.js";import{_ as h,c as b}from"./_plugin-vue_export-helper-Sp67ay3B.js";const x={class:"feedbacks-container"},C={class:"card-header"},V={class:"user-cell"},z={class:"nickname"},I={class:"user-id"},D={key:0,class:"feedback-images"},H={key:0,class:"more-images"},M={key:1,class:"no-images"},U={key:1,class:"no-reward"},Y={key:0},j={class:"detail-item"},F={key:0,class:"detail-item"},$={key:0},A={key:1,class:"reply-form"},B={key:0,class:"reward-dialog"},E={class:"user-info-card"},G={class:"user-avatar"},J={class:"user-details"},O={class:"user-name"},P={class:"user-id-text"},Q={class:"feedback-preview"},S={class:"preview-content"},q={class:"amount-section"},K={class:"amount-options"},L=["onClick"],N={class:"amount-value"},R={class:"custom-input-wrap"},T={class:"reward-footer"},W=h({__name:"Feedbacks",setup(h){e.extend(y),e.extend(_);const W=a([]),X=a(!1),Z=a(!1),ee=a(null),ae=a(""),le=a(!1),se=a(!1),te=a(null),ie=a(10),ne=a(10),de=a(!1),re=a(!1),ue=async()=>{X.value=!0;try{const e=await b.get("/feedback/admin/list");200!==e.code&&0!==e.code||(W.value=e.data)}catch(e){console.error("加载反馈列表失败:",e)}finally{X.value=!1}},oe=async()=>{if(!ae.value.trim())return k.warning("请输入回复内容");le.value=!0;try{const e=await b.post("/feedback/admin/reply",{feedbackId:ee.value.feedback_id,replyContent:ae.value});200!==e.code&&0!==e.code||(k.success("回复成功"),Z.value=!1,ue())}catch(e){console.error("回复失败:",e)}finally{le.value=!1}};l(()=>{ue()});const ce=e=>{e&&(ie.value=e,re.value=!0)},ve=async()=>{if(!ie.value||ie.value<=0)return k.warning("请选择打赏金额");if(ie.value>500)return k.warning("打赏金额不能超过500醒币");de.value=!0;try{const e=await b.post("/feedback/admin/reward",{feedbackId:te.value.feedback_id,amount:ie.value});200===e.code||0===e.code?(k.success(`打赏成功！${te.value.nickname||"用户"}获得 ${ie.value} 醒币`),se.value=!1,ue()):k.error(e.message||"打赏失败")}catch(e){console.error("打赏失败:",e),k.error("打赏失败")}finally{de.value=!1}};return(a,l)=>{var k;const y=r("el-button"),_=r("el-table-column"),h=r("el-image"),b=r("el-tag"),pe=r("el-table"),me=r("el-card"),we=r("el-input"),fe=r("el-dialog"),ge=r("el-input-number"),ke=o("loading"),ye=o("dialog-drag");return t(),s("div",x,[i(me,null,{header:d(()=>[c("div",C,[l[8]||(l[8]=c("span",null,"意见反馈管理",-1)),i(y,{type:"primary",onClick:ue},{default:d(()=>[...l[7]||(l[7]=[f("刷新",-1)])]),_:1})])]),default:d(()=>[n((t(),u(pe,{data:W.value,style:{width:"100%"}},{default:d(()=>[i(_,{prop:"feedback_id",label:"反馈ID",width:"180","show-overflow-tooltip":""}),i(_,{label:"用户",width:"180"},{default:d(({row:e})=>[c("div",V,[c("span",z,v(e.nickname||"未知用户"),1),c("span",I,v(e.user_id),1)])]),_:1}),i(_,{prop:"content",label:"反馈内容","min-width":"200","show-overflow-tooltip":""}),i(_,{label:"图片",width:"160"},{default:d(({row:e})=>[e.images&&e.images.length>0?(t(),s("div",D,[(t(!0),s(m,null,w(e.images.slice(0,3),(a,l)=>(t(),u(h,{key:l,class:"feedback-img",src:a,"preview-src-list":e.images,"initial-index":l,"preview-teleported":"",fit:"cover"},null,8,["src","preview-src-list","initial-index"]))),128)),e.images.length>3?(t(),s("span",H,"+"+v(e.images.length-3),1)):p("",!0)])):(t(),s("span",M,"无"))]),_:1}),i(_,{prop:"contact",label:"联系方式",width:"120","show-overflow-tooltip":""}),i(_,{label:"打赏",width:"100"},{default:d(({row:e})=>[e.reward_amount>0?(t(),u(b,{key:0,type:"warning",effect:"dark"},{default:d(()=>[f(" +"+v(e.reward_amount),1)]),_:2},1024)):(t(),s("span",U,"-"))]),_:1}),i(_,{prop:"status",label:"状态",width:"90"},{default:d(({row:e})=>[i(b,{type:"pending"===e.status?"warning":"success",size:"small"},{default:d(()=>[f(v("pending"===e.status?"待处理":"已回复"),1)]),_:2},1032,["type"])]),_:1}),i(_,{prop:"created_at",label:"提交时间",width:"170"},{default:d(({row:a})=>{return[f(v((l=a.created_at,l?e.utc(l).tz("Asia/Shanghai").format("YYYY-MM-DD HH:mm:ss"):"-")),1)];var l}),_:1}),i(_,{label:"操作",width:"140",fixed:"right"},{default:d(({row:e})=>[i(y,{type:"primary",link:"",size:"small",onClick:a=>(e=>{ee.value=e,ae.value=e.reply_content||"",Z.value=!0})(e)},{default:d(()=>[f(v("pending"===e.status?"回复":"查看"),1)]),_:2},1032,["onClick"]),i(y,{type:"warning",link:"",size:"small",onClick:a=>(e=>{te.value=e,ie.value=10,ne.value=10,re.value=!1,se.value=!0})(e),disabled:e.reward_amount>0},{default:d(()=>[f(v(e.reward_amount>0?"已打赏":"打赏"),1)]),_:2},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[ke,X.value]])]),_:1}),n((t(),u(fe,{modelValue:Z.value,"onUpdate:modelValue":l[2]||(l[2]=e=>Z.value=e),title:"pending"===(null==(k=ee.value)?void 0:k.status)?"回复反馈":"反馈详情",width:"500px"},{footer:d(()=>{var e;return[i(y,{onClick:l[1]||(l[1]=e=>Z.value=!1)},{default:d(()=>[...l[11]||(l[11]=[f("取消",-1)])]),_:1}),"pending"===(null==(e=ee.value)?void 0:e.status)?(t(),u(y,{key:0,type:"primary",loading:le.value,onClick:oe},{default:d(()=>[...l[12]||(l[12]=[f(" 提交回复 ",-1)])]),_:1},8,["loading"])):p("",!0)]}),default:d(()=>[ee.value?(t(),s("div",Y,[c("div",j,[l[9]||(l[9]=c("strong",null,"反馈内容：",-1)),c("p",null,v(ee.value.content),1)]),ee.value.reply_content?(t(),s("div",F,[l[10]||(l[10]=c("strong",null,"管理员回复：",-1)),c("p",null,v(ee.value.reply_content),1),ee.value.replied_at?(t(),s("small",$,"回复时间："+v(ee.value.replied_at),1)):p("",!0)])):p("",!0),"pending"===ee.value.status?(t(),s("div",A,[i(we,{modelValue:ae.value,"onUpdate:modelValue":l[0]||(l[0]=e=>ae.value=e),type:"textarea",rows:4,placeholder:"请输入回复内容..."},null,8,["modelValue"])])):p("",!0)])):p("",!0)]),_:1},8,["modelValue","title"])),[[ye]]),n((t(),u(fe,{modelValue:se.value,"onUpdate:modelValue":l[6]||(l[6]=e=>se.value=e),title:"",width:"420px",class:"reward-dialog-wrapper","show-close":!1},{footer:d(()=>[c("div",T,[i(y,{onClick:l[5]||(l[5]=e=>se.value=!1),size:"large"},{default:d(()=>[...l[20]||(l[20]=[f("取消",-1)])]),_:1}),i(y,{type:"warning",size:"large",loading:de.value,onClick:ve,class:"confirm-btn"},{default:d(()=>[f(" 确认打赏 "+v(ie.value)+" 醒币 ",1)]),_:1},8,["loading"])])]),default:d(()=>[te.value?(t(),s("div",B,[l[19]||(l[19]=c("div",{class:"reward-header"},[c("div",{class:"reward-icon-wrap"},[c("svg",{class:"reward-svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[c("polyline",{points:"20 12 20 22 4 22 4 12"}),c("rect",{x:"2",y:"7",width:"20",height:"5"}),c("line",{x1:"12",y1:"22",x2:"12",y2:"7"}),c("path",{d:"M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"}),c("path",{d:"M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"})])]),c("h3",{class:"reward-title"},"打赏醒币"),c("p",{class:"reward-subtitle"},"感谢用户的宝贵反馈")],-1)),c("div",E,[c("div",G,[c("span",null,v((te.value.nickname||"用户")[0]),1)]),c("div",J,[c("div",O,v(te.value.nickname||"未知用户"),1),c("div",P,"ID: "+v(te.value.user_id),1)])]),c("div",Q,[l[13]||(l[13]=c("div",{class:"preview-label"},"反馈内容",-1)),c("div",S,v(te.value.content),1)]),c("div",q,[l[18]||(l[18]=c("div",{class:"amount-label"},"选择打赏金额",-1)),c("div",K,[(t(),s(m,null,w([5,10,20,50,100,200],e=>c("div",{key:e,class:g(["amount-option",{active:ie.value===e&&!re.value}]),onClick:a=>(e=>{ie.value=e,re.value=!1})(e)},[c("span",N,v(e),1),l[14]||(l[14]=c("span",{class:"amount-unit"},"醒币",-1))],10,L)),64))]),c("div",R,[l[15]||(l[15]=c("span",{class:"custom-label"},"自定义金额：",-1)),i(ge,{modelValue:ne.value,"onUpdate:modelValue":l[3]||(l[3]=e=>ne.value=e),min:1,max:500,size:"small",controls:!0,onChange:ce,onFocus:l[4]||(l[4]=e=>re.value=!0)},null,8,["modelValue"]),l[16]||(l[16]=c("span",{class:"custom-unit"},"醒币",-1)),l[17]||(l[17]=c("span",{class:"custom-hint"},"(上限500)",-1))])])])):p("",!0)]),_:1},8,["modelValue"])),[[ye]])])}}},[["__scopeId","data-v-3d9fd96c"]]);export{W as default};
