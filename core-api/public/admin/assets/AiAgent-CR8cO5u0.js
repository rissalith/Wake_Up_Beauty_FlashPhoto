import{r as e,x as a,bu as l,c as t,o as s,d as i,e as n,w as r,f as o,H as u,J as d,h as c,j as v,a1 as p,t as m,O as g,P as f,E as _,l as y}from"./index-zvIQdR65.js";import{_ as w,c as h}from"./_plugin-vue_export-helper-D822DtMY.js";const k={class:"ai-agent-page"},x={class:"main-content"},b={class:"input-section"},I={class:"card-header"},z={key:0,class:"progress-section"},A={class:"progress-info"},V={class:"step-text"},D={class:"example-list"},j=["onClick"],C={class:"example-title"},T={class:"example-desc"},E={class:"result-section"},J={class:"card-header"},O={class:"header-actions"},P={class:"result-info"},U={class:"steps-preview"},W={class:"step-item"},F={class:"step-title"},H={key:0,class:"step-options"},N={class:"prompt-preview"},S={key:0,class:"images-preview"},$={class:"image-grid"},q={key:0,class:"image-item"},B={key:1,class:"image-item"},G={class:"execution-info"},K=w({__name:"AiAgent",setup(w){const K=e({description:"",generateImages:!1}),L=e(!1),M=e(null),Q=e(null);let R=null;const X=[{title:"春节拜年",description:"春节拜年场景，用户可以选择不同的祝福语和喜庆背景，生成带有新年氛围的照片"},{title:"职业证件照",description:"职业证件照场景，用户可以选择不同的背景颜色、服装风格，生成专业的证件照"},{title:"情人节",description:"情人节主题场景，用户可以选择浪漫的背景和装饰，生成甜蜜的情侣照片"},{title:"毕业照",description:"毕业照场景，用户可以选择学士服颜色和校园背景，生成纪念性的毕业照片"}],Y=a(()=>{if(!M.value)return 0;const e=M.value.current_step;return"knowledge_retrieval"===e?0:"planning"===e?1:"config_generation"===e?2:(null==e?void 0:e.startsWith("review"))||(null==e?void 0:e.startsWith("optimization"))?3:"done"===e?4:0}),Z=a(()=>M.value?"completed"===M.value.status?"success":"failed"===M.value.status?"exception":"":""),ee=a(()=>{if(!M.value)return"";return{init:"初始化...",knowledge_retrieval:"正在检索知识库...",planning:"正在规划场景...",config_generation:"正在生成配置...",review_iteration_1:"正在审核配置...",review_iteration_2:"正在优化配置...",review_iteration_3:"正在最终审核...",optimization_1:"正在优化配置...",optimization_2:"正在再次优化...",image_generation:"正在生成图片...",done:"生成完成!"}[M.value.current_step]||M.value.current_step}),ae=async()=>{if(K.value.description.trim()){L.value=!0,M.value=null,Q.value=null;try{const e=await h.post("/admin/ai-agent/generate",{description:K.value.description,options:{async:!0,generateImages:K.value.generateImages}});if(200!==e.code)throw new Error(e.message||"创建任务失败");{const a=e.data.task_id;_.success("任务已创建，正在生成中..."),le(a)}}catch(e){_.error(e.message||"生成失败"),L.value=!1}}else _.warning("请输入场景描述")},le=e=>{R&&clearInterval(R);const a=async()=>{try{const a=await h.get(`/admin/ai-agent/status/${e}`);200===a.code&&(M.value=a.data,"completed"===a.data.status?(clearInterval(R),L.value=!1,Q.value={task_id:a.data.id,config:a.data.config_result,images:a.data.images_result,review:{score:a.data.review_score,passed:a.data.review_score>=70},iterations:a.data.iterations,duration:new Date(a.data.completed_at)-new Date(a.data.created_at)},_.success("生成完成!")):"failed"===a.data.status&&(clearInterval(R),L.value=!1,_.error(a.data.error_message||"生成失败")))}catch(a){console.error("轮询状态失败:",a)}};a(),R=setInterval(a,2e3)},te=async()=>{var e;if(null==(e=Q.value)?void 0:e.config)try{await y.confirm("确定要将此配置应用到场景管理吗？这将创建一个新的场景。","应用配置",{type:"info"}),_.info("功能开发中，请手动复制配置到场景管理");const e=JSON.stringify(Q.value.config,null,2);await navigator.clipboard.writeText(e),_.success("配置已复制到剪贴板")}catch(a){"cancel"!==a&&_.error(a.message||"操作失败")}else _.warning("没有可应用的配置")};return l(()=>{R&&clearInterval(R)}),(e,a)=>{const l=o("el-tag"),_=o("el-input"),y=o("el-form-item"),w=o("el-checkbox"),h=o("el-icon"),R=o("el-button"),le=o("el-form"),se=o("el-divider"),ie=o("el-step"),ne=o("el-steps"),re=o("el-progress"),oe=o("el-card"),ue=o("el-timeline-item"),de=o("el-timeline"),ce=o("el-image"),ve=o("el-descriptions-item"),pe=o("el-descriptions"),me=o("el-empty");return s(),t("div",k,[a[13]||(a[13]=i("div",{class:"page-header"},[i("div",{class:"header-left"},[i("h2",null,"AI 智能生成"),i("span",{class:"subtitle"},"使用 AI Agent 自动生成场景配置")])],-1)),i("div",x,[i("div",b,[n(oe,{class:"input-card"},{header:r(()=>[i("div",I,[a[3]||(a[3]=i("span",null,"场景描述",-1)),n(l,{type:"info",size:"small"},{default:r(()=>[...a[2]||(a[2]=[c("AI 将根据描述自动生成配置",-1)])]),_:1})])]),default:r(()=>[n(le,{model:K.value,"label-position":"top"},{default:r(()=>[n(y,{label:"描述你想要的场景"},{default:r(()=>[n(_,{modelValue:K.value.description,"onUpdate:modelValue":a[0]||(a[0]=e=>K.value.description=e),type:"textarea",rows:6,placeholder:"例如：春节拜年场景，用户可以选择不同的祝福语和喜庆背景，生成带有新年氛围的照片",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),n(y,{label:"生成选项"},{default:r(()=>[n(w,{modelValue:K.value.generateImages,"onUpdate:modelValue":a[1]||(a[1]=e=>K.value.generateImages=e)},{default:r(()=>[...a[4]||(a[4]=[c("自动生成封面图和参考图",-1)])]),_:1},8,["modelValue"])]),_:1}),n(y,null,{default:r(()=>[n(R,{type:"primary",size:"large",loading:L.value,disabled:!K.value.description.trim(),onClick:ae,style:{width:"100%"}},{default:r(()=>[L.value?d("",!0):(s(),u(h,{key:0},{default:r(()=>[n(v(p))]),_:1})),c(" "+m(L.value?"生成中...":"开始生成"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["model"]),M.value?(s(),t("div",z,[n(se,null,{default:r(()=>[...a[5]||(a[5]=[c("生成进度",-1)])]),_:1}),n(ne,{active:Y.value,"finish-status":"success",simple:""},{default:r(()=>[n(ie,{title:"知识检索"}),n(ie,{title:"规划"}),n(ie,{title:"配置生成"}),n(ie,{title:"审核"}),n(ie,{title:"完成"})]),_:1},8,["active"]),i("div",A,[n(re,{percentage:M.value.progress,status:Z.value},null,8,["percentage","status"]),i("span",V,m(ee.value),1)])])):d("",!0)]),_:1}),n(oe,{class:"examples-card"},{header:r(()=>[...a[6]||(a[6]=[i("span",null,"示例描述",-1)])]),default:r(()=>[i("div",D,[(s(),t(g,null,f(X,e=>i("div",{key:e.title,class:"example-item",onClick:a=>(e=>{K.value.description=e.description})(e)},[i("div",C,m(e.title),1),i("div",T,m(e.description),1)],8,j)),64))])]),_:1})]),i("div",E,[Q.value?(s(),u(oe,{key:0,class:"result-card"},{header:r(()=>{var e;return[i("div",J,[a[8]||(a[8]=i("span",null,"生成结果",-1)),i("div",O,[n(l,{type:(null==(e=Q.value.review)?void 0:e.passed)?"success":"warning",size:"small"},{default:r(()=>{var e;return[c(" 审核得分: "+m((null==(e=Q.value.review)?void 0:e.score)||0),1)]}),_:1},8,["type"]),n(R,{type:"primary",size:"small",onClick:te},{default:r(()=>[...a[7]||(a[7]=[c(" 应用配置 ",-1)])]),_:1})])])]}),default:r(()=>{var e,o,v,p,y,w,h,k;return[i("div",P,[i("h3",null,m((null==(o=null==(e=Q.value.config)?void 0:e.scene)?void 0:o.name)||"未命名场景"),1),i("p",null,m(null==(p=null==(v=Q.value.config)?void 0:v.scene)?void 0:p.description),1),n(l,{size:"small"},{default:r(()=>{var e,a;return[c(m((null==(a=null==(e=Q.value.config)?void 0:e.scene)?void 0:a.points_cost)||50)+" 醒币",1)]}),_:1})]),i("div",U,[i("h4",null,"步骤配置 ("+m((null==(w=null==(y=Q.value.config)?void 0:y.steps)?void 0:w.length)||0)+" 步)",1),n(de,null,{default:r(()=>{var e;return[(s(!0),t(g,null,f(null==(e=Q.value.config)?void 0:e.steps,(e,a)=>(s(),u(ue,{key:a,type:0===a?"primary":""},{default:r(()=>{var a;return[i("div",W,[i("div",F,[c(m(e.title)+" ",1),n(l,{size:"small",type:"info"},{default:r(()=>[c(m(e.component_type),1)]),_:2},1024)]),(null==(a=e.options)?void 0:a.length)?(s(),t("div",H,[(s(!0),t(g,null,f(e.options.slice(0,5),e=>(s(),u(l,{key:e.value,size:"small",type:"info",effect:"plain"},{default:r(()=>[c(m(e.label),1)]),_:2},1024))),128)),e.options.length>5?(s(),u(l,{key:0,size:"small",type:"info"},{default:r(()=>[c(" +"+m(e.options.length-5),1)]),_:2},1024)):d("",!0)])):d("",!0)])]}),_:2},1032,["type"]))),128))]}),_:1})]),i("div",N,[a[9]||(a[9]=i("h4",null,"Prompt 模板",-1)),n(_,{type:"textarea",rows:4,"model-value":null==(k=null==(h=Q.value.config)?void 0:h.prompt_template)?void 0:k.template,readonly:""},null,8,["model-value"])]),Q.value.images?(s(),t("div",S,[a[12]||(a[12]=i("h4",null,"生成的图片",-1)),i("div",$,[Q.value.images.cover_image?(s(),t("div",q,[n(ce,{src:"data:"+Q.value.images.cover_image.mimeType+";base64,"+Q.value.images.cover_image.imageData,fit:"cover"},null,8,["src"]),a[10]||(a[10]=i("span",null,"封面图",-1))])):d("",!0),Q.value.images.reference_image?(s(),t("div",B,[n(ce,{src:"data:"+Q.value.images.reference_image.mimeType+";base64,"+Q.value.images.reference_image.imageData,fit:"cover"},null,8,["src"]),a[11]||(a[11]=i("span",null,"参考图",-1))])):d("",!0)])])):d("",!0),i("div",G,[n(pe,{column:3,size:"small",border:""},{default:r(()=>[n(ve,{label:"任务ID"},{default:r(()=>[c(m(Q.value.task_id),1)]),_:1}),n(ve,{label:"迭代次数"},{default:r(()=>[c(m(Q.value.iterations),1)]),_:1}),n(ve,{label:"耗时"},{default:r(()=>[c(m((Q.value.duration/1e3).toFixed(1))+"s",1)]),_:1})]),_:1})])]}),_:1})):(s(),u(me,{key:1,description:"输入场景描述，点击生成按钮开始"}))])])])}}},[["__scopeId","data-v-aa97ce37"]]);export{K as default};
