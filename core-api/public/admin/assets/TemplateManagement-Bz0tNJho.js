import{r as e,x as a,a as l,i as t,c as i,o as n,d as o,e as s,w as r,f as d,I as u,G as c,h as p,t as v,J as m,H as f,j as _,ab as g,O as w,P as y,g as b,W as h,ae as V,l as k,E as x}from"./index-CsAM56ZN.js";import{_ as C,c as U}from"./_plugin-vue_export-helper-Coss9NIm.js";const z={class:"template-management"},T={class:"tab-content"},B={class:"filter-bar"},j={class:"count-text"},$={class:"template-list"},I={class:"template-info"},S={class:"image-placeholder"},O={class:"template-detail"},A={class:"template-name"},J={class:"template-desc"},N={class:"template-meta"},P={key:0,class:"review-score"},L={key:0,class:"review-details"},q={class:"review-details-content"},D={key:1,class:"no-details"},E={class:"action-btns"},G={key:0,class:"pagination-wrap"},H={class:"tab-content"},K={class:"filter-bar"},M={class:"count-text"},R={class:"template-list"},W={class:"template-info"},F={class:"image-placeholder"},Q={class:"template-detail"},X={class:"template-name"},Y={class:"template-desc"},Z={class:"template-meta"},ee={class:"points-value"},ae={class:"stats-info"},le={class:"action-btns"},te={key:0,class:"pagination-wrap"},ie={class:"quick-reasons"},ne=C({__name:"TemplateManagement",setup(C){const ne=e("review"),oe=e([]),se=e(0),re=e(1),de=e(20),ue=e(!1),ce=e(""),pe=a(()=>se.value),ve=e([]),me=e(0),fe=e(1),_e=e(20),ge=e(!1),we=e(""),ye=e(""),be=e(""),he=e([]),Ve=e(!1),ke=l({templateId:"",reason:""}),xe=e(!1),Ce=["图片包含不当内容","文字描述不符合规范","模板配置不完整","与现有模板重复","质量不符合要求"],Ue=e(!1),ze=l({id:"",name:"",description:"",cover_image:"",category_id:null,points_cost:50,is_featured:0}),Te=e(!1),Be=async()=>{ue.value=!0;try{const e={page:re.value,pageSize:de.value,status:ce.value||"reviewing,pending"},a=await U.get("/admin/template-review/list",{params:e});200===a.code&&(oe.value=a.data.list||[],se.value=a.data.total||0)}catch(e){console.error("加载审核列表失败:",e)}finally{ue.value=!1}},je=async()=>{ge.value=!0;try{const e={page:fe.value,pageSize:_e.value,status:we.value,category_id:ye.value,keyword:be.value},a=await U.get("/admin/template-review/all",{params:e});200===a.code&&(ve.value=a.data.list||[],me.value=a.data.total||0)}catch(e){console.error("加载模板列表失败:",e)}finally{ge.value=!1}},$e=e=>{"review"===e?Be():je()},Ie=async()=>{if(ke.reason){xe.value=!0;try{200===(await U.post(`/api/admin/template-review/${ke.templateId}/reject`,{reason:ke.reason})).code&&(x.success("已拒绝"),Ve.value=!1,Be())}catch(e){console.error("拒绝失败:",e)}finally{xe.value=!1}}else x.warning("请输入拒绝原因")},Se=async()=>{Te.value=!0;try{200===(await U.put(`/api/admin/template-review/${ze.id}`,ze)).code&&(x.success("保存成功"),Ue.value=!1,je())}catch(e){console.error("保存失败:",e)}finally{Te.value=!1}},Oe=e=>{try{const a="string"==typeof e?JSON.parse(e):e;return JSON.stringify(a,null,2)}catch{return e}},Ae=e=>({reviewing:"审核中",pending:"待人工复核"}[e]||e),Je=e=>({active:"已上架",offline:"已下架",rejected:"已拒绝",draft:"草稿"}[e]||e);return t(()=>{Be(),(async()=>{try{const e=await U.get("/admin/template-review/categories");200===e.code&&(he.value=e.data||[])}catch(e){console.error("加载分类失败:",e)}})()}),(e,a)=>{const l=d("el-icon"),t=d("el-badge"),C=d("el-radio-button"),Ne=d("el-radio-group"),Pe=d("el-image"),Le=d("el-table-column"),qe=d("el-tag"),De=d("el-button"),Ee=d("el-popover"),Ge=d("el-table"),He=d("el-pagination"),Ke=d("el-tab-pane"),Me=d("el-option"),Re=d("el-select"),We=d("el-input"),Fe=d("el-switch"),Qe=d("el-tabs"),Xe=d("el-form-item"),Ye=d("el-form"),Ze=d("el-dialog"),ea=d("el-input-number"),aa=u("loading");return n(),i("div",z,[a[40]||(a[40]=o("div",{class:"page-header"},[o("h2",null,"模板管理"),o("span",{class:"subtitle"},"管理创作者提交的模板，AI 自动审核")],-1)),s(Qe,{modelValue:ne.value,"onUpdate:modelValue":a[6]||(a[6]=e=>ne.value=e),onTabChange:$e},{default:r(()=>[s(Ke,{name:"review"},{label:r(()=>[o("span",null,[s(l,null,{default:r(()=>[s(_(g))]),_:1}),a[18]||(a[18]=p(" 审核区域 ",-1)),pe.value>0?(n(),f(t,{key:0,value:pe.value,class:"tab-badge"},null,8,["value"])):m("",!0)])]),default:r(()=>[o("div",T,[o("div",B,[s(Ne,{modelValue:ce.value,"onUpdate:modelValue":a[0]||(a[0]=e=>ce.value=e),onChange:Be},{default:r(()=>[s(C,{label:""},{default:r(()=>[...a[19]||(a[19]=[p("全部待处理",-1)])]),_:1}),s(C,{label:"reviewing"},{default:r(()=>[...a[20]||(a[20]=[p("审核中",-1)])]),_:1}),s(C,{label:"pending"},{default:r(()=>[...a[21]||(a[21]=[p("待人工复核",-1)])]),_:1})]),_:1},8,["modelValue"]),o("span",j,"共 "+v(se.value)+" 个待审核",1)]),c((n(),i("div",$,[s(Ge,{data:oe.value,"row-key":"id","empty-text":"暂无待审核模板"},{default:r(()=>[s(Le,{label:"模板信息","min-width":"300"},{default:r(({row:e})=>{return[o("div",I,[s(Pe,{class:"template-cover",src:e.cover_image,fit:"cover","preview-src-list":[e.cover_image,e.reference_image].filter(Boolean),"preview-teleported":""},{error:r(()=>{var a;return[o("div",S,v((null==(a=e.name)?void 0:a.charAt(0))||"?"),1)]}),_:2},1032,["src","preview-src-list"]),o("div",O,[o("div",A,v(e.name),1),o("div",J,v(e.description||"暂无描述"),1),o("div",N,[o("span",null,"创作者: "+v(e.creator_name),1),o("span",null,"提交时间: "+v((a=e.updated_at,a?new Date(a).toLocaleString("zh-CN"):"-")),1)])])])];var a}),_:1}),s(Le,{label:"审核状态",width:"140",align:"center"},{default:r(({row:e})=>{return[s(qe,{type:(a=e.status,{reviewing:"warning",pending:"info"}[a]||"info")},{default:r(()=>[p(v(Ae(e.status)),1)]),_:2},1032,["type"]),e.review_score?(n(),i("div",P," 得分: "+v(e.review_score),1)):m("",!0)];var a}),_:1}),s(Le,{label:"审核详情",width:"200"},{default:r(({row:e})=>[e.review_details?(n(),i("div",L,[s(Ee,{placement:"left",width:400,trigger:"hover"},{reference:r(()=>[s(De,{link:"",type:"primary",size:"small"},{default:r(()=>[...a[22]||(a[22]=[p("查看详情",-1)])]),_:1})]),default:r(()=>[o("div",q,[o("pre",null,v(Oe(e.review_details)),1)])]),_:2},1024)])):(n(),i("span",D,"等待审核"))]),_:1}),s(Le,{label:"操作",width:"200",fixed:"right"},{default:r(({row:e})=>[o("div",E,[s(De,{type:"success",link:"",size:"small",onClick:a=>(async e=>{try{await k.confirm("确定要通过该模板的审核吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}),200===(await U.post(`/api/admin/template-review/${e.id}/approve`)).code&&(x.success("审核通过"),Be())}catch(a){"cancel"!==a&&console.error("审核失败:",a)}})(e)},{default:r(()=>[...a[23]||(a[23]=[p(" 通过 ",-1)])]),_:1},8,["onClick"]),s(De,{type:"danger",link:"",size:"small",onClick:a=>(e=>{ke.templateId=e.id,ke.reason="",Ve.value=!0})(e)},{default:r(()=>[...a[24]||(a[24]=[p(" 拒绝 ",-1)])]),_:1},8,["onClick"]),s(De,{type:"primary",link:"",size:"small",onClick:e=>{x.info("预览功能开发中")}},{default:r(()=>[...a[25]||(a[25]=[p(" 预览 ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"]),se.value>de.value?(n(),i("div",G,[s(He,{"current-page":re.value,"onUpdate:currentPage":a[1]||(a[1]=e=>re.value=e),"page-size":de.value,total:se.value,layout:"prev, pager, next",onCurrentChange:Be},null,8,["current-page","page-size","total"])])):m("",!0)])),[[aa,ue.value]])])]),_:1}),s(Ke,{name:"list"},{label:r(()=>[o("span",null,[s(l,null,{default:r(()=>[s(_(V))]),_:1}),a[26]||(a[26]=p(" 模板清单 ",-1))])]),default:r(()=>[o("div",H,[o("div",K,[s(Ne,{modelValue:we.value,"onUpdate:modelValue":a[2]||(a[2]=e=>we.value=e),onChange:je},{default:r(()=>[s(C,{label:""},{default:r(()=>[...a[27]||(a[27]=[p("全部",-1)])]),_:1}),s(C,{label:"active"},{default:r(()=>[...a[28]||(a[28]=[p("已上架",-1)])]),_:1}),s(C,{label:"offline"},{default:r(()=>[...a[29]||(a[29]=[p("已下架",-1)])]),_:1}),s(C,{label:"rejected"},{default:r(()=>[...a[30]||(a[30]=[p("已拒绝",-1)])]),_:1})]),_:1},8,["modelValue"]),s(Re,{modelValue:ye.value,"onUpdate:modelValue":a[3]||(a[3]=e=>ye.value=e),placeholder:"选择分类",clearable:"",style:{width:"150px","margin-left":"16px"},onChange:je},{default:r(()=>[(n(!0),i(w,null,y(he.value,e=>(n(),f(Me,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),s(We,{modelValue:be.value,"onUpdate:modelValue":a[4]||(a[4]=e=>be.value=e),placeholder:"搜索模板名称",clearable:"",style:{width:"200px","margin-left":"16px"},onClear:je,onKeyup:b(je,["enter"])},{prefix:r(()=>[s(l,null,{default:r(()=>[s(_(h))]),_:1})]),_:1},8,["modelValue"]),o("span",M,"共 "+v(me.value)+" 个模板",1)]),c((n(),i("div",R,[s(Ge,{data:ve.value,"row-key":"id","empty-text":"暂无模板"},{default:r(()=>[s(Le,{label:"模板信息","min-width":"280"},{default:r(({row:e})=>[o("div",W,[s(Pe,{class:"template-cover",src:e.cover_image,fit:"cover","preview-src-list":[e.cover_image],"preview-teleported":""},{error:r(()=>{var a;return[o("div",F,v((null==(a=e.name)?void 0:a.charAt(0))||"?"),1)]}),_:2},1032,["src","preview-src-list"]),o("div",Q,[o("div",X,[p(v(e.name)+" ",1),e.is_official?(n(),f(qe,{key:0,type:"warning",size:"small"},{default:r(()=>[...a[31]||(a[31]=[p("官方",-1)])]),_:1})):m("",!0)]),o("div",Y,v(e.description||"暂无描述"),1),o("div",Z,[o("span",null,"创作者: "+v(e.creator_name||"官方"),1)])])])]),_:1}),s(Le,{label:"分类",width:"100",align:"center"},{default:r(({row:e})=>[s(qe,{size:"small"},{default:r(()=>[p(v(e.category_name||"未分类"),1)]),_:2},1024)]),_:1}),s(Le,{label:"状态",width:"100",align:"center"},{default:r(({row:e})=>{return[s(qe,{type:(a=e.status,{active:"success",offline:"info",rejected:"danger",draft:"warning"}[a]||"info")},{default:r(()=>[p(v(Je(e.status)),1)]),_:2},1032,["type"])];var a}),_:1}),s(Le,{label:"精选",width:"80",align:"center"},{default:r(({row:e})=>[s(Fe,{modelValue:e.is_featured,"onUpdate:modelValue":a=>e.is_featured=a,"active-value":1,"inactive-value":0,onChange:a=>(async e=>{try{await U.put(`/api/admin/template-review/${e.id}`,{is_featured:e.is_featured}),x.success("更新成功")}catch(a){console.error("更新失败:",a),je()}})(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),s(Le,{label:"醒币",width:"80",align:"center"},{default:r(({row:e})=>[o("span",ee,v(e.points_cost),1)]),_:1}),s(Le,{label:"数据",width:"120",align:"center"},{default:r(({row:e})=>[o("div",ae,[o("span",null,"使用: "+v(e.use_count||0),1),o("span",null,"收藏: "+v(e.favorite_count||0),1)])]),_:1}),s(Le,{label:"操作",width:"180",fixed:"right"},{default:r(({row:e})=>[o("div",le,[s(De,{type:"primary",link:"",size:"small",onClick:a=>(e=>{Object.assign(ze,{id:e.id,name:e.name,description:e.description||"",cover_image:e.cover_image,category_id:e.category_id,points_cost:e.points_cost,is_featured:e.is_featured}),Ue.value=!0})(e)},{default:r(()=>[...a[32]||(a[32]=[p(" 编辑 ",-1)])]),_:1},8,["onClick"]),"active"===e.status?(n(),f(De,{key:0,type:"warning",link:"",size:"small",onClick:a=>(async e=>{try{await k.confirm("确定要下架该模板吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),200===(await U.post(`/api/admin/template-review/${e.id}/offline`)).code&&(x.success("已下架"),je())}catch(a){"cancel"!==a&&console.error("下架失败:",a)}})(e)},{default:r(()=>[...a[33]||(a[33]=[p(" 下架 ",-1)])]),_:1},8,["onClick"])):"offline"===e.status?(n(),f(De,{key:1,type:"success",link:"",size:"small",onClick:a=>(async e=>{try{await k.confirm("确定要重新上架该模板吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}),200===(await U.post(`/api/admin/template-review/${e.id}/online`)).code&&(x.success("已上架"),je())}catch(a){"cancel"!==a&&console.error("上架失败:",a)}})(e)},{default:r(()=>[...a[34]||(a[34]=[p(" 上架 ",-1)])]),_:1},8,["onClick"])):m("",!0),s(De,{type:"danger",link:"",size:"small",onClick:a=>(async e=>{try{await k.confirm("确定要删除该模板吗？此操作不可恢复。","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),200===(await U.delete(`/api/admin/template-review/${e.id}`)).code&&(x.success("删除成功"),je())}catch(a){"cancel"!==a&&console.error("删除失败:",a)}})(e)},{default:r(()=>[...a[35]||(a[35]=[p(" 删除 ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"]),me.value>_e.value?(n(),i("div",te,[s(He,{"current-page":fe.value,"onUpdate:currentPage":a[5]||(a[5]=e=>fe.value=e),"page-size":_e.value,total:me.value,layout:"prev, pager, next",onCurrentChange:je},null,8,["current-page","page-size","total"])])):m("",!0)])),[[aa,ge.value]])])]),_:1})]),_:1},8,["modelValue"]),s(Ze,{modelValue:Ve.value,"onUpdate:modelValue":a[9]||(a[9]=e=>Ve.value=e),title:"拒绝模板",width:"500px"},{footer:r(()=>[s(De,{onClick:a[8]||(a[8]=e=>Ve.value=!1)},{default:r(()=>[...a[36]||(a[36]=[p("取消",-1)])]),_:1}),s(De,{type:"danger",onClick:Ie,loading:xe.value},{default:r(()=>[...a[37]||(a[37]=[p("确认拒绝",-1)])]),_:1},8,["loading"])]),default:r(()=>[s(Ye,{model:ke,"label-width":"80px"},{default:r(()=>[s(Xe,{label:"拒绝原因"},{default:r(()=>[s(We,{modelValue:ke.reason,"onUpdate:modelValue":a[7]||(a[7]=e=>ke.reason=e),type:"textarea",rows:4,placeholder:"请输入拒绝原因，将通知创作者"},null,8,["modelValue"])]),_:1}),s(Xe,{label:"快捷选择"},{default:r(()=>[o("div",ie,[(n(),i(w,null,y(Ce,e=>s(qe,{key:e,onClick:a=>ke.reason=e,style:{cursor:"pointer",margin:"4px"}},{default:r(()=>[p(v(e),1)]),_:2},1032,["onClick"])),64))])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),s(Ze,{modelValue:Ue.value,"onUpdate:modelValue":a[17]||(a[17]=e=>Ue.value=e),title:"编辑模板",width:"700px",top:"5vh"},{footer:r(()=>[s(De,{onClick:a[16]||(a[16]=e=>Ue.value=!1)},{default:r(()=>[...a[38]||(a[38]=[p("取消",-1)])]),_:1}),s(De,{type:"primary",onClick:Se,loading:Te.value},{default:r(()=>[...a[39]||(a[39]=[p("保存",-1)])]),_:1},8,["loading"])]),default:r(()=>[s(Ye,{model:ze,"label-width":"100px"},{default:r(()=>[s(Xe,{label:"模板名称"},{default:r(()=>[s(We,{modelValue:ze.name,"onUpdate:modelValue":a[10]||(a[10]=e=>ze.name=e),placeholder:"中文名称"},null,8,["modelValue"])]),_:1}),s(Xe,{label:"模板描述"},{default:r(()=>[s(We,{modelValue:ze.description,"onUpdate:modelValue":a[11]||(a[11]=e=>ze.description=e),type:"textarea",rows:2},null,8,["modelValue"])]),_:1}),s(Xe,{label:"封面图"},{default:r(()=>[s(We,{modelValue:ze.cover_image,"onUpdate:modelValue":a[12]||(a[12]=e=>ze.cover_image=e),placeholder:"封面图URL"},null,8,["modelValue"])]),_:1}),s(Xe,{label:"分类"},{default:r(()=>[s(Re,{modelValue:ze.category_id,"onUpdate:modelValue":a[13]||(a[13]=e=>ze.category_id=e),placeholder:"选择分类",clearable:""},{default:r(()=>[(n(!0),i(w,null,y(he.value,e=>(n(),f(Me,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(Xe,{label:"消耗醒币"},{default:r(()=>[s(ea,{modelValue:ze.points_cost,"onUpdate:modelValue":a[14]||(a[14]=e=>ze.points_cost=e),min:0,max:9999},null,8,["modelValue"])]),_:1}),s(Xe,{label:"精选"},{default:r(()=>[s(Fe,{modelValue:ze.is_featured,"onUpdate:modelValue":a[15]||(a[15]=e=>ze.is_featured=e),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-7822efd2"]]);export{ne as default};
