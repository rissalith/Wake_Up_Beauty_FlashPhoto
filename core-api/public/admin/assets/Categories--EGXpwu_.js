import{r as e,i as a,c as l,o as t,d as s,G as n,e as o,w as i,f as d,I as u,C as r,E as c,h as m,j as v,X as p,Z as _,J as f,t as g,a4 as y,l as h}from"./index-DQJe672r.js";import{_ as b,e as w}from"./_plugin-vue_export-helper-DhoNb-KX.js";import{S as V}from"./sortable.esm-Dhe0be67.js";const k={class:"category-management"},C={class:"page-header"},x={class:"header-right"},j={class:"category-list"},U={class:"category-info"},I={class:"category-detail"},D={class:"category-name"},R={key:0,class:"category-name-en"},q={class:"template-count"},z={class:"action-btns"},E={class:"drag-tip"},S=b({__name:"Categories",setup(b){const S=e(!1),G=e([]),J=e(!1),L=e(!1),X=e(!1),Z=e(null),$=e(null),A=e({name:"",name_en:""}),B={name:[{required:!0,message:"请输入分类名称",trigger:"blur"}]},F=async()=>{S.value=!0;try{const e=await w.getList();200===e.code&&(G.value=e.data||[],r(()=>{const e=document.querySelector(".category-list .el-table__body-wrapper tbody");e&&V.create(e,{handle:".drag-handle",animation:150,ghostClass:"sortable-ghost",onEnd:async({oldIndex:e,newIndex:a})=>{if(e===a)return;const l=G.value.splice(e,1)[0];G.value.splice(a,0,l);const t=G.value.map((e,a)=>({id:e.id,sort_order:a}));try{await w.reorder(t),c.success("排序已更新")}catch(s){console.error("更新排序失败:",s),F()}}})}))}catch(e){console.error("加载分类失败:",e)}finally{S.value=!1}},H=()=>{L.value=!1,$.value=null,A.value={name:"",name_en:""},J.value=!0},K=async()=>{Z.value&&await Z.value.validate(async e=>{if(e){X.value=!0;try{L.value?(await w.update($.value,A.value),c.success("更新成功")):(await w.create({...A.value,sort_order:G.value.length}),c.success("创建成功")),J.value=!1,F()}catch(a){console.error("保存失败:",a)}finally{X.value=!1}}})};return a(()=>{F()}),(e,a)=>{const r=d("el-icon"),b=d("el-button"),V=d("el-table-column"),M=d("el-switch"),N=d("el-table"),O=d("el-input"),P=d("el-form-item"),Q=d("el-form"),T=d("el-dialog"),W=u("loading");return t(),l("div",k,[s("div",C,[a[5]||(a[5]=s("div",{class:"header-left"},[s("h2",null,"分类管理"),s("span",{class:"subtitle"},"管理模板市场的分类标签，拖拽调整顺序")],-1)),s("div",x,[o(b,{type:"primary",onClick:H},{default:i(()=>[o(r,null,{default:i(()=>[o(v(p))]),_:1}),a[4]||(a[4]=m(" 新增分类 ",-1))]),_:1})])]),n((t(),l("div",j,[o(N,{data:G.value,"row-key":"id","empty-text":"暂无分类数据",onRowDrop:e.handleDrop},{default:i(()=>[o(V,{label:"",width:"50",align:"center"},{default:i(()=>[o(r,{class:"drag-handle"},{default:i(()=>[o(v(_))]),_:1})]),_:1}),o(V,{label:"分类名称","min-width":"200"},{default:i(({row:e})=>[s("div",U,[s("div",I,[s("div",D,g(e.name),1),e.name_en?(t(),l("div",R,g(e.name_en),1)):f("",!0)])])]),_:1}),o(V,{label:"模板数量",width:"120",align:"center"},{default:i(({row:e})=>[s("span",q,g(e.template_count||0),1)]),_:1}),o(V,{label:"显示状态",width:"120",align:"center"},{default:i(({row:e})=>[o(M,{modelValue:e.is_visible,"onUpdate:modelValue":a=>e.is_visible=a,"active-value":1,"inactive-value":0,onChange:a=>(async e=>{try{await w.update(e.id,{is_visible:e.is_visible}),c.success(e.is_visible?"已显示":"已隐藏")}catch(a){console.error("更新状态失败:",a),e.is_visible=e.is_visible?0:1}})(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),o(V,{label:"操作",width:"150",fixed:"right"},{default:i(({row:e})=>[s("div",z,[o(b,{type:"primary",link:"",size:"small",onClick:a=>(e=>{L.value=!0,$.value=e.id,A.value={name:e.name,name_en:e.name_en||""},J.value=!0})(e)},{default:i(()=>[...a[6]||(a[6]=[m("编辑",-1)])]),_:1},8,["onClick"]),o(b,{type:"danger",link:"",size:"small",onClick:a=>(async e=>{if(e.template_count>0)c.warning("该分类下有模板，无法删除");else try{await h.confirm(`确定要删除分类「${e.name}」吗？`,"删除确认",{type:"warning"}),await w.delete(e.id),c.success("删除成功"),F()}catch(a){"cancel"!==a&&console.error("删除失败:",a)}})(e),disabled:e.template_count>0},{default:i(()=>[...a[7]||(a[7]=[m("删除",-1)])]),_:1},8,["onClick","disabled"])])]),_:1})]),_:1},8,["data","onRowDrop"]),s("div",E,[o(r,null,{default:i(()=>[o(v(y))]),_:1}),a[8]||(a[8]=s("span",null,"拖拽行可调整分类顺序",-1))])])),[[W,S.value]]),o(T,{modelValue:J.value,"onUpdate:modelValue":a[3]||(a[3]=e=>J.value=e),title:L.value?"编辑分类":"新增分类",width:"500px"},{footer:i(()=>[o(b,{onClick:a[2]||(a[2]=e=>J.value=!1)},{default:i(()=>[...a[9]||(a[9]=[m("取消",-1)])]),_:1}),o(b,{type:"primary",onClick:K,loading:X.value},{default:i(()=>[...a[10]||(a[10]=[m("确定",-1)])]),_:1},8,["loading"])]),default:i(()=>[o(Q,{model:A.value,rules:B,ref_key:"formRef",ref:Z,"label-width":"100px"},{default:i(()=>[o(P,{label:"分类名称",prop:"name"},{default:i(()=>[o(O,{modelValue:A.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>A.value.name=e),placeholder:"请输入中文名称"},null,8,["modelValue"])]),_:1}),o(P,{label:"英文名称"},{default:i(()=>[o(O,{modelValue:A.value.name_en,"onUpdate:modelValue":a[1]||(a[1]=e=>A.value.name_en=e),placeholder:"请输入英文名称（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-7c270740"]]);export{S as default};
