import{F as e,r as a,x as l,i as t,c as s,o as n,e as i,G as u,w as o,f as d,H as r,I as c,J as v,d as p,t as m,h as g,g as y,j as _,K as f,L as h,M as b,N as w,O as k,P as x,Q as z,E as V,l as C}from"./index-L24IvDQP.js";import{u as T,t as U}from"./timezone-C_JJJcQT.js";import{_ as $,u as S}from"./_plugin-vue_export-helper-EDQBBoSw.js";const B={class:"users-page"},I={class:"card-header"},D={class:"header-right"},P={key:0,class:"batch-actions"},j={class:"selected-count"},A={class:"user-cell"},W={key:1,class:"user-avatar"},E={class:"user-info"},F={class:"nickname"},O={class:"user-id"},R={key:0,class:"union-id"},Y={key:1,class:"union-id"},H={class:"points-value"},M={class:"recharge-value"},N={key:0,style:{"white-space":"nowrap"}},q={key:1,class:"text-muted"},J={style:{"white-space":"nowrap"}},K={class:"pagination-wrap"},L={key:0,class:"user-detail"},G={class:"detail-header"},Q={key:1,class:"detail-avatar"},X={class:"detail-info"},Z={class:"detail-id"},ee={class:"detail-points"},ae={class:"points-num"},le={class:"stats-cards"},te={class:"stat-card recharge"},se={class:"stat-icon"},ne={class:"stat-content"},ie={class:"stat-value"},ue={class:"stat-sub"},oe={class:"stat-card consume"},de={class:"stat-icon"},re={class:"stat-content"},ce={class:"stat-value"},ve={class:"stat-sub"},pe={class:"stat-card share"},me={class:"stat-icon"},ge={class:"stat-content"},ye={class:"stat-value"},_e={class:"stat-sub"},fe={class:"stat-card invite"},he={class:"stat-icon"},be={class:"stat-content"},we={class:"stat-value"},ke={class:"stat-sub"},xe={class:"id-text"},ze={class:"id-text"},Ve={key:2,class:"agreement-time"},Ce={key:2,class:"agreement-time"},Te={key:0},Ue={key:1,class:"text-muted"},$e={class:"activities-container"},Se={class:"activity-item"},Be={class:"activity-desc"},Ie={key:2,class:"activities-pagination"},De={class:"behaviors-container"},Pe={class:"behaviors-filter"},je={key:0,class:"behaviors-total"},Ae={key:0,class:"behaviors-stats"},We={class:"stat-label"},Ee={class:"stat-count"},Fe={class:"behavior-item"},Oe={class:"behavior-name"},Re={key:0,class:"behavior-page"},Ye={key:1,class:"behavior-extra"},He={key:3,class:"behaviors-pagination"},Me={class:"amount-text"},Ne={class:"points-value"},qe={class:"photo-grid"},Je={class:"photo-info"},Ke={class:"points-value"},Le={key:0,style:{color:"#f56c6c","margin-left":"8px"}},Ge=$({__name:"Users",setup($){e.extend(T),e.extend(U);const Ge=a(!1),Qe=a([]),Xe=a(1),Ze=a(20),ea=a(0),aa=a(""),la=a(!1),ta=a(null),sa=a({}),na=a(!1),ia=a("info"),ua=a(!1),oa=a([]),da=a(1),ra=a(20),ca=a(0),va=a(!1),pa=a([]),ma=a(1),ga=a(20),ya=a(0),_a=a(""),fa=a({}),ha=a(!1),ba=a(!1),wa=a([]),ka=a(null),xa=a(!1),za=a(!1),Va=a([]),Ca=a(null),Ta=a(null),Ua=a([]),$a=a(!1),Sa=a(!1),Ba=a({type:"add",amount:null,reason:""}),Ia=l(()=>{var e;if(!ta.value||!Ba.value.amount)return(null==(e=ta.value)?void 0:e.points)||0;const a=ta.value.points||0,l=Ba.value.amount||0;return"add"===Ba.value.type?a+l:a-l}),Da=a=>a?e.utc(a).tz("Asia/Shanghai").format("YYYY-MM-DD HH:mm:ss"):"-",Pa=e=>e?Number(e).toFixed(2):"0.00",ja=e=>!(!e||"string"!=typeof e)&&(!e.startsWith("wxfile://")&&(!e.startsWith("http://tmp")&&!e.startsWith("https://tmp")&&(e.startsWith("http://")||e.startsWith("https://")))),Aa=e=>{e.avatar_url=null},Wa=async()=>{Ge.value=!0;try{const e=await S.getList({page:Xe.value,pageSize:Ze.value,keyword:aa.value});200!==e.code&&0!==e.code&&0!==e.code||(Qe.value=e.data.list,ea.value=e.data.total)}finally{Ge.value=!1}},Ea=async()=>{if(ta.value){ua.value=!0;try{const e=await S.getActivities(ta.value.user_id||ta.value.id,{page:da.value,pageSize:ra.value});200!==e.code&&0!==e.code||(oa.value=e.data.list,ca.value=e.data.total)}catch(e){console.error("获取用户操作记录失败:",e)}finally{ua.value=!1}}},Fa=async()=>{if(ta.value){va.value=!0;try{const e={page:ma.value,pageSize:ga.value};_a.value&&(e.behavior_type=_a.value);const a=await S.getBehaviors(ta.value.user_id||ta.value.id,e);200!==a.code&&0!==a.code||(pa.value=a.data.list,ya.value=a.data.total);const l=await S.getBehaviorStats(ta.value.user_id||ta.value.id);200!==l.code&&0!==l.code||(fa.value=l.data)}catch(e){console.error("获取用户行为轨迹失败:",e)}finally{va.value=!1}}},Oa=e=>({page_view:"页面访问",click:"点击",event:"事件",error:"错误"}[e]||e),Ra=e=>({page_view:"",click:"success",event:"warning",error:"danger"}[e]||"info"),Ya=e=>{const a={points:{new_user:{label:"新用户注册",color:"success",tagType:"success"},recharge:{label:"充值",color:"success",tagType:"success"},consume:{label:"消费",color:"warning",tagType:"warning"},admin_adjust:{label:"管理员调整",color:"primary",tagType:""},share_photo:{label:"分享奖励",color:"primary",tagType:"primary"},invite_friend:{label:"邀请奖励",color:"primary",tagType:"primary"},daily_login:{label:"每日登录",color:"info",tagType:"info"}},photo:{generating:{label:"生成中",color:"warning",tagType:"warning"},done:{label:"照片生成",color:"success",tagType:"success"},failed:{label:"生成失败",color:"danger",tagType:"danger"}},order:{pending:{label:"创建订单",color:"info",tagType:"info"},paid:{label:"支付成功",color:"success",tagType:"success"},cancelled:{label:"订单取消",color:"info",tagType:"info"},refunded:{label:"订单退款",color:"warning",tagType:"warning"}},invite:{completed:{label:"邀请成功",color:"success",tagType:"success"},pending:{label:"邀请中",color:"info",tagType:"info"}}},l=e.activity_type,t=e.sub_type;return a[l]&&a[l][t]?a[l][t]:{label:l,color:"info",tagType:"info"}},Ha=e=>{const a=e.activity_type,l=e.sub_type;switch(a){case"points":const a=e.amount||0,t=a>0?"+":"",s=e.description||"";return`${t}${a} 醒币${s?" - "+s:""}`;case"photo":const n=e.scene||e.spec||"照片",i=e.scene&&e.spec||"",u=e.bg_color||"";return"done"===l?`生成照片成功 - ${n}${i?" · "+i:""}${u?" · "+u:""}`:"failed"===l?`照片生成失败 - ${n}`:`正在生成照片 - ${n}`;case"order":const o=(e.amount||0)/100,d=(e.points_amount||0)+(e.bonus_points||0);return"paid"===l?`支付 ¥${o.toFixed(2)}，获得 ${d} 醒币`:`订单金额 ¥${o.toFixed(2)}`;case"invite":const r=e.invitee_nickname||"用户",c=e.reward_points||0;return"completed"===l?`成功邀请 ${r}，获得 ${c} 醒币`:`邀请 ${r}`;default:return e.description||"-"}},Ma=e=>{Ua.value=e},Na=()=>{var e;null==(e=Ta.value)||e.clearSelection(),Ua.value=[]},qa=async()=>{var e;if(0!==Ua.value.length)try{await C.confirm(`确定要批量注销选中的 ${Ua.value.length} 个用户吗？注销后这些用户的所有数据（醒币、订单、照片等）将被永久删除，下次登录将作为新用户。`,"批量注销用户",{confirmButtonText:"确定注销",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"});const a=Ua.value.map(e=>e.user_id||e.id),l=await S.batchDeleteUsers(a);200!==l.code&&0!==l.code||(V.success(`成功注销 ${(null==(e=l.data)?void 0:e.deletedCount)||a.length} 个用户`),Na(),Wa())}catch(a){"cancel"!==a&&V.error("批量注销失败: "+(a.message||"未知错误"))}else V.warning("请先选择要注销的用户")},Ja=()=>{Ba.value={type:"add",amount:null,reason:""},$a.value=!0},Ka=async()=>{var e,a,l;if(Ba.value.amount&&Ba.value.reason)if(Ia.value<0)V.error("扣减后余额不能为负数");else try{await C.confirm(`确定要${"add"===Ba.value.type?"增加":"扣减"} ${Ba.value.amount} 醒币吗？`,"确认修正",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),Sa.value=!0;const a="add"===Ba.value.type?Ba.value.amount:-Ba.value.amount,l=await S.adjustPoints(ta.value.user_id||ta.value.id,{amount:a,type:Ba.value.type,reason:Ba.value.reason});if(200===l.code||0===l.code){V.success(l.message||"醒币修正成功"),console.log("API响应:",JSON.stringify(l)),console.log("res.data:",l.data),console.log("newBalance:",null==(e=l.data)?void 0:e.newBalance),console.log("adjustPreview:",Ia.value);const a=l.data&&void 0!==l.data.newBalance?l.data.newBalance:Ia.value;console.log("最终newPoints:",a),$a.value=!1,ta.value.points=a,console.log("更新后currentUser.points:",ta.value.points),Wa()}else V.error(l.message||"醒币修正失败")}catch(t){"cancel"!==t&&(console.error("醒币修正失败:",t),V.error((null==(l=null==(a=t.response)?void 0:a.data)?void 0:l.message)||"醒币修正失败"))}finally{Sa.value=!1}else V.warning("请填写修正数量和原因")};return t(()=>{Wa()}),(e,a)=>{var l,t,T,U;const $=d("Search"),La=d("el-icon"),Ga=d("el-button"),Qa=d("el-input"),Xa=d("el-table-column"),Za=d("el-avatar"),el=d("el-table"),al=d("el-pagination"),ll=d("el-card"),tl=d("el-descriptions-item"),sl=d("el-tag"),nl=d("el-descriptions"),il=d("el-tab-pane"),ul=d("el-timeline-item"),ol=d("el-timeline"),dl=d("el-empty"),rl=d("el-option"),cl=d("el-select"),vl=d("el-tabs"),pl=d("el-dialog"),ml=d("el-image"),gl=d("el-form-item"),yl=d("el-radio"),_l=d("el-radio-group"),fl=d("el-input-number"),hl=d("el-form"),bl=c("loading"),wl=c("dialog-drag");return n(),s("div",B,[i(ll,null,{header:o(()=>[p("div",I,[a[17]||(a[17]=p("span",null,"用户管理",-1)),p("div",D,[i(Qa,{modelValue:aa.value,"onUpdate:modelValue":a[0]||(a[0]=e=>aa.value=e),placeholder:"搜索用户ID/UnionID/昵称",style:{width:"250px"},clearable:"",onKeyup:y(Wa,["enter"])},{append:o(()=>[i(Ga,{onClick:Wa},{default:o(()=>[i(La,null,{default:o(()=>[i($)]),_:1})]),_:1})]),_:1},8,["modelValue"]),i(Ga,{type:"primary",onClick:Wa},{default:o(()=>[...a[16]||(a[16]=[g("刷新",-1)])]),_:1})])])]),default:o(()=>[Ua.value.length>0?(n(),s("div",P,[p("span",j,"已选择 "+m(Ua.value.length)+" 个用户",1),i(Ga,{type:"danger",size:"small",onClick:qa},{default:o(()=>[...a[18]||(a[18]=[g(" 批量注销 ",-1)])]),_:1}),i(Ga,{size:"small",onClick:Na},{default:o(()=>[...a[19]||(a[19]=[g(" 取消选择 ",-1)])]),_:1})])):v("",!0),u((n(),r(el,{ref_key:"tableRef",ref:Ta,data:Qe.value,stripe:"",style:{width:"100%"},onSelectionChange:Ma},{default:o(()=>[i(Xa,{type:"selection",width:"55"}),i(Xa,{label:"用户","min-width":"320"},{default:o(({row:e})=>[p("div",A,[ja(e.avatar_url)?(n(),r(Za,{key:0,src:e.avatar_url,size:36,onError:()=>Aa(e)},{default:o(()=>[p("span",null,m((e.nickname||"用户")[0]),1)]),_:2},1032,["src","onError"])):(n(),s("div",W,[p("span",null,m((e.nickname||"用户")[0]),1)])),p("div",E,[p("div",F,m(e.nickname||"未设置昵称"),1),p("div",O,"ID: "+m(e.user_id||e.id),1),e.unionid?(n(),s("div",R,"UnionID: "+m(e.unionid),1)):(n(),s("div",Y,"UnionID: -"))])])]),_:1}),i(Xa,{label:"醒币",width:"90",align:"center"},{default:o(({row:e})=>[p("span",H,m(e.points||0),1)]),_:1}),i(Xa,{label:"累计充值",width:"100",align:"center"},{default:o(({row:e})=>[p("span",M,"¥"+m(Pa(e.total_recharge)),1)]),_:1}),i(Xa,{label:"生成次数",width:"90",align:"center"},{default:o(({row:e})=>[p("span",null,m(e.photo_count||0),1)]),_:1}),i(Xa,{label:"最近登录",width:"170"},{default:o(({row:e})=>[e.last_login_time?(n(),s("span",N,m(Da(e.last_login_time)),1)):(n(),s("span",q,"-"))]),_:1}),i(Xa,{label:"注册时间",width:"170"},{default:o(({row:e})=>[p("span",J,m(Da(e.created_at)),1)]),_:1}),i(Xa,{label:"操作",width:"240",fixed:"right"},{default:o(({row:e})=>[i(Ga,{type:"primary",link:"",size:"small",onClick:a=>(async e=>{ta.value=e,sa.value={},oa.value=[],da.value=1,ca.value=0,pa.value=[],ma.value=1,ya.value=0,_a.value="",fa.value={},ia.value="info",la.value=!0,na.value=!0;try{const a=await S.getStats(e.user_id||e.id);200!==a.code&&0!==a.code||(sa.value=a.data)}catch(a){console.error("获取用户统计失败:",a)}finally{na.value=!1}Ea(),Fa()})(e)},{default:o(()=>[...a[20]||(a[20]=[g("详情",-1)])]),_:1},8,["onClick"]),i(Ga,{type:"primary",link:"",size:"small",onClick:a=>(async e=>{ka.value=e,ha.value=!0,ba.value=!0,wa.value=[];try{const a=await S.getOrders(e.user_id||e.id,{pageSize:50});200!==a.code&&0!==a.code||(wa.value=a.data.list)}finally{ba.value=!1}})(e)},{default:o(()=>[...a[21]||(a[21]=[g("订单",-1)])]),_:1},8,["onClick"]),i(Ga,{type:"primary",link:"",size:"small",onClick:a=>(async e=>{Ca.value=e,xa.value=!0,za.value=!0,Va.value=[];try{const a=await S.getPhotos(e.user_id||e.id,{pageSize:50});200!==a.code&&0!==a.code||(Va.value=a.data.list)}finally{za.value=!1}})(e)},{default:o(()=>[...a[22]||(a[22]=[g("照片",-1)])]),_:1},8,["onClick"]),i(Ga,{type:"danger",link:"",size:"small",onClick:a=>(async e=>{try{await C.confirm(`确定要注销用户 "${e.nickname||e.user_id}" 吗？注销后该用户的所有数据（醒币、订单、照片等）将被永久删除，下次登录将作为新用户。`,"注销用户",{confirmButtonText:"确定注销",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"});const a=await S.deleteUser(e.user_id||e.id);200!==a.code&&0!==a.code||(V.success("用户注销成功"),Wa())}catch(a){"cancel"!==a&&V.error("注销失败: "+(a.message||"未知错误"))}})(e)},{default:o(()=>[...a[23]||(a[23]=[g("注销",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[bl,Ge.value]]),p("div",K,[i(al,{"current-page":Xe.value,"onUpdate:currentPage":a[1]||(a[1]=e=>Xe.value=e),"page-size":Ze.value,"onUpdate:pageSize":a[2]||(a[2]=e=>Ze.value=e),total:ea.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",onChange:Wa},null,8,["current-page","page-size","total"])])]),_:1}),u((n(),r(pl,{modelValue:la.value,"onUpdate:modelValue":a[8]||(a[8]=e=>la.value=e),title:"用户详情",width:"900px"},{default:o(()=>{var e,l,t,d,c,y,z,V,C;return[ta.value?u((n(),s("div",L,[p("div",G,[ja(ta.value.avatar_url)?(n(),r(Za,{key:0,src:ta.value.avatar_url,size:60,onError:a[3]||(a[3]=()=>Aa(ta.value))},{default:o(()=>[p("span",null,m((ta.value.nickname||"用户")[0]),1)]),_:1},8,["src"])):(n(),s("div",Q,[p("span",null,m((ta.value.nickname||"用户")[0]),1)])),p("div",X,[p("h3",null,m(ta.value.nickname||"未设置昵称"),1),p("p",Z,m(ta.value.user_id||ta.value.id),1)]),p("div",ee,[a[25]||(a[25]=p("div",{class:"points-label"},"醒币余额",-1)),p("div",ae,m(ta.value.points||0),1),i(Ga,{type:"primary",size:"small",onClick:Ja,style:{"margin-top":"8px"}},{default:o(()=>[...a[24]||(a[24]=[g(" 修正醒币 ",-1)])]),_:1})])]),p("div",le,[p("div",te,[p("div",se,[i(La,null,{default:o(()=>[i(_(f))]),_:1})]),p("div",ne,[a[26]||(a[26]=p("div",{class:"stat-title"},"累计充值",-1)),p("div",ie,"¥"+m(Pa(null==(e=sa.value.totalRecharge)?void 0:e.amount)),1),p("div",ue,"获得 "+m((null==(l=sa.value.totalRecharge)?void 0:l.points)||0)+" 醒币 · "+m((null==(t=sa.value.totalRecharge)?void 0:t.count)||0)+" 次",1)])]),p("div",oe,[p("div",de,[i(La,null,{default:o(()=>[i(_(h))]),_:1})]),p("div",re,[a[27]||(a[27]=p("div",{class:"stat-title"},"累计消费",-1)),p("div",ce,m((null==(d=sa.value.totalConsume)?void 0:d.points)||0)+" 醒币",1),p("div",ve,m((null==(c=sa.value.totalConsume)?void 0:c.count)||0)+" 次",1)])]),p("div",pe,[p("div",me,[i(La,null,{default:o(()=>[i(_(b))]),_:1})]),p("div",ge,[a[28]||(a[28]=p("div",{class:"stat-title"},"分享奖励",-1)),p("div",ye,m((null==(y=sa.value.totalShare)?void 0:y.points)||0)+" 醒币",1),p("div",_e,m((null==(z=sa.value.totalShare)?void 0:z.count)||0)+" 次分享",1)])]),p("div",fe,[p("div",he,[i(La,null,{default:o(()=>[i(_(w))]),_:1})]),p("div",be,[a[29]||(a[29]=p("div",{class:"stat-title"},"邀请奖励",-1)),p("div",we,m((null==(V=sa.value.totalInvite)?void 0:V.points)||0)+" 醒币",1),p("div",ke,m((null==(C=sa.value.totalInvite)?void 0:C.count)||0)+" 人",1)])])]),i(vl,{modelValue:ia.value,"onUpdate:modelValue":a[7]||(a[7]=e=>ia.value=e),class:"detail-tabs"},{default:o(()=>[i(il,{label:"基本信息",name:"info"},{default:o(()=>[i(nl,{column:2,border:"",class:"detail-desc"},{default:o(()=>[i(tl,{label:"OpenID","label-class-name":"desc-label","class-name":"desc-content",span:2},{default:o(()=>[p("span",xe,m(ta.value.openid||"-"),1)]),_:1}),i(tl,{label:"UnionID","label-class-name":"desc-label","class-name":"desc-content",span:2},{default:o(()=>[p("span",ze,m(ta.value.unionid||"-"),1)]),_:1}),i(tl,{label:"隐私协议","label-class-name":"desc-label"},{default:o(()=>{var e,l,t,i;return[(null==(l=null==(e=sa.value.agreements)?void 0:e.privacy)?void 0:l.signed)?(n(),r(sl,{key:0,type:"success",size:"small"},{default:o(()=>[...a[30]||(a[30]=[g(" 已签署 ",-1)])]),_:1})):(n(),r(sl,{key:1,type:"info",size:"small"},{default:o(()=>[...a[31]||(a[31]=[g("未签署",-1)])]),_:1})),(null==(i=null==(t=sa.value.agreements)?void 0:t.privacy)?void 0:i.signedAt)?(n(),s("span",Ve,m(Da(sa.value.agreements.privacy.signedAt)),1)):v("",!0)]}),_:1}),i(tl,{label:"用户协议","label-class-name":"desc-label"},{default:o(()=>{var e,l,t,i;return[(null==(l=null==(e=sa.value.agreements)?void 0:e.terms)?void 0:l.signed)?(n(),r(sl,{key:0,type:"success",size:"small"},{default:o(()=>[...a[32]||(a[32]=[g(" 已签署 ",-1)])]),_:1})):(n(),r(sl,{key:1,type:"info",size:"small"},{default:o(()=>[...a[33]||(a[33]=[g("未签署",-1)])]),_:1})),(null==(i=null==(t=sa.value.agreements)?void 0:t.terms)?void 0:i.signedAt)?(n(),s("span",Ce,m(Da(sa.value.agreements.terms.signedAt)),1)):v("",!0)]}),_:1}),i(tl,{label:"最近登录","label-class-name":"desc-label"},{default:o(()=>[ta.value.last_login_time?(n(),s("span",Te,m(Da(ta.value.last_login_time)),1)):(n(),s("span",Ue,"-"))]),_:1}),i(tl,{label:"注册时间","label-class-name":"desc-label"},{default:o(()=>[g(m(Da(ta.value.created_at)),1)]),_:1})]),_:1})]),_:1}),i(il,{label:"操作记录",name:"activities"},{default:o(()=>[u((n(),s("div",$e,[oa.value.length>0?(n(),r(ol,{key:0},{default:o(()=>[(n(!0),s(k,null,x(oa.value,e=>(n(),r(ul,{key:e.id,timestamp:Da(e.created_at),type:Ya(e).color,placement:"top"},{default:o(()=>[p("div",Se,[i(sl,{type:Ya(e).tagType,size:"small",class:"activity-tag"},{default:o(()=>[g(m(Ya(e).label),1)]),_:2},1032,["type"]),p("span",Be,m(Ha(e)),1)])]),_:2},1032,["timestamp","type"]))),128))]),_:1})):(n(),r(dl,{key:1,description:"暂无操作记录"})),ca.value>ra.value?(n(),s("div",Ie,[i(al,{"current-page":da.value,"onUpdate:currentPage":a[4]||(a[4]=e=>da.value=e),"page-size":ra.value,total:ca.value,layout:"prev, pager, next",onChange:Ea},null,8,["current-page","page-size","total"])])):v("",!0)])),[[bl,ua.value]])]),_:1}),i(il,{label:"行为轨迹",name:"behaviors"},{default:o(()=>{var e;return[u((n(),s("div",De,[p("div",Pe,[i(cl,{modelValue:_a.value,"onUpdate:modelValue":a[5]||(a[5]=e=>_a.value=e),placeholder:"行为类型",clearable:"",size:"small",style:{width:"120px"},onChange:Fa},{default:o(()=>[i(rl,{label:"全部",value:""}),i(rl,{label:"页面访问",value:"page_view"}),i(rl,{label:"点击事件",value:"click"}),i(rl,{label:"功能事件",value:"event"}),i(rl,{label:"错误",value:"error"})]),_:1},8,["modelValue"]),fa.value.totalBehaviors?(n(),s("span",je," 共 "+m(fa.value.totalBehaviors)+" 条记录 ",1)):v("",!0)]),(null==(e=fa.value.typeStats)?void 0:e.length)>0?(n(),s("div",Ae,[(n(!0),s(k,null,x(fa.value.typeStats,e=>(n(),s("div",{class:"behavior-stat-item",key:e.behavior_type},[p("span",We,m(Oa(e.behavior_type)),1),p("span",Ee,m(e.count),1)]))),128))])):v("",!0),pa.value.length>0?(n(),r(ol,{key:1},{default:o(()=>[(n(!0),s(k,null,x(pa.value,e=>{return n(),r(ul,{key:e.id,timestamp:Da(e.created_at),type:(a=e.behavior_type,{page_view:"primary",click:"success",event:"warning",error:"danger"}[a]||"info"),placement:"top"},{default:o(()=>[p("div",Fe,[i(sl,{type:Ra(e.behavior_type),size:"small",class:"behavior-tag"},{default:o(()=>[g(m(Oa(e.behavior_type)),1)]),_:2},1032,["type"]),p("span",Oe,m(e.behavior_name),1),e.page_path?(n(),s("span",Re,m(e.page_path),1)):v("",!0),e.element_text?(n(),s("span",Ye,m(e.element_text),1)):v("",!0)])]),_:2},1032,["timestamp","type"]);var a}),128))]),_:1})):(n(),r(dl,{key:2,description:"暂无行为记录"})),ya.value>ga.value?(n(),s("div",He,[i(al,{"current-page":ma.value,"onUpdate:currentPage":a[6]||(a[6]=e=>ma.value=e),"page-size":ga.value,total:ya.value,layout:"prev, pager, next",onChange:Fa},null,8,["current-page","page-size","total"])])):v("",!0)])),[[bl,va.value]])]}),_:1})]),_:1},8,["modelValue"])])),[[bl,na.value]]):v("",!0)]}),_:1},8,["modelValue"])),[[wl]]),u((n(),r(pl,{modelValue:ha.value,"onUpdate:modelValue":a[9]||(a[9]=e=>ha.value=e),title:"用户订单 - "+((null==(l=ka.value)?void 0:l.nickname)||(null==(t=ka.value)?void 0:t.user_id)||""),width:"900px"},{default:o(()=>[u((n(),r(el,{data:wa.value},{default:o(()=>[i(Xa,{prop:"order_id",label:"订单号","min-width":"220"}),i(Xa,{prop:"amount",label:"金额",width:"100"},{default:o(({row:e})=>[p("span",Me,"¥"+m(Pa(e.amount)),1)]),_:1}),i(Xa,{label:"获得醒币",width:"100"},{default:o(({row:e})=>[p("span",Ne,m((e.points_amount||0)+(e.bonus_points||0)),1)]),_:1}),i(Xa,{prop:"status",label:"状态",width:"90"},{default:o(({row:e})=>[i(sl,{type:"paid"===e.status?"success":"warning",size:"small"},{default:o(()=>{return[g(m((a=e.status,{paid:"已支付",pending:"待支付",cancelled:"已取消",refunded:"已退款",failed:"支付失败"}[a]||a)),1)];var a}),_:2},1032,["type"])]),_:1}),i(Xa,{prop:"created_at",label:"创建时间",width:"170"},{default:o(({row:e})=>[g(m(Da(e.created_at)),1)]),_:1})]),_:1},8,["data"])),[[bl,ba.value]]),ba.value||0!==wa.value.length?v("",!0):(n(),r(dl,{key:0,description:"暂无订单"}))]),_:1},8,["modelValue","title"])),[[wl]]),u((n(),r(pl,{modelValue:xa.value,"onUpdate:modelValue":a[10]||(a[10]=e=>xa.value=e),title:"用户照片 - "+((null==(T=Ca.value)?void 0:T.nickname)||(null==(U=Ca.value)?void 0:U.user_id)||""),width:"900px"},{default:o(()=>[u((n(),s("div",qe,[(n(!0),s(k,null,x(Va.value,e=>(n(),s("div",{class:"photo-item",key:e.id},[i(ml,{src:e.result_image,"preview-src-list":[e.result_image],fit:"cover",class:"photo-img"},null,8,["src","preview-src-list"]),p("div",Je,[p("span",null,m(e.spec||"-"),1),p("span",null,m(e.bg_color||"-"),1)])]))),128))])),[[bl,za.value]]),za.value||0!==Va.value.length?v("",!0):(n(),r(dl,{key:0,description:"暂无照片"}))]),_:1},8,["modelValue","title"])),[[wl]]),u((n(),r(pl,{modelValue:$a.value,"onUpdate:modelValue":a[15]||(a[15]=e=>$a.value=e),title:"醒币修正",width:"500px"},{footer:o(()=>[i(Ga,{onClick:a[14]||(a[14]=e=>$a.value=!1)},{default:o(()=>[...a[37]||(a[37]=[g("取消",-1)])]),_:1}),i(Ga,{type:"primary",onClick:Ka,loading:Sa.value,disabled:!Ba.value.amount||!Ba.value.reason||Ia.value<0},{default:o(()=>[...a[38]||(a[38]=[g(" 确认修正 ",-1)])]),_:1},8,["loading","disabled"])]),default:o(()=>[ta.value?(n(),r(hl,{key:0,model:Ba.value,"label-width":"100px"},{default:o(()=>[i(gl,{label:"当前用户"},{default:o(()=>[p("span",null,m(ta.value.nickname||ta.value.user_id),1)]),_:1}),i(gl,{label:"当前余额"},{default:o(()=>[p("span",Ke,m(ta.value.points||0)+" 醒币",1)]),_:1}),i(gl,{label:"修正类型"},{default:o(()=>[i(_l,{modelValue:Ba.value.type,"onUpdate:modelValue":a[11]||(a[11]=e=>Ba.value.type=e)},{default:o(()=>[i(yl,{value:"add"},{default:o(()=>[...a[34]||(a[34]=[g("增加",-1)])]),_:1}),i(yl,{value:"deduct"},{default:o(()=>[...a[35]||(a[35]=[g("扣减",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),i(gl,{label:"修正数量",required:""},{default:o(()=>[i(fl,{modelValue:Ba.value.amount,"onUpdate:modelValue":a[12]||(a[12]=e=>Ba.value.amount=e),min:1,max:99999,placeholder:"请输入修正数量"},null,8,["modelValue"]),a[36]||(a[36]=p("span",{style:{"margin-left":"8px",color:"#909399"}},"醒币",-1))]),_:1}),i(gl,{label:"修正后余额"},{default:o(()=>[p("span",{class:z(["points-preview",Ia.value<0?"negative":""])},m(Ia.value)+" 醒币 ",3),Ia.value<0?(n(),s("span",Le," (余额不足) ")):v("",!0)]),_:1}),i(gl,{label:"修正原因",required:""},{default:o(()=>[i(Qa,{modelValue:Ba.value.reason,"onUpdate:modelValue":a[13]||(a[13]=e=>Ba.value.reason=e),type:"textarea",rows:3,placeholder:"请输入修正原因，如：客服补偿、系统异常修正等",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])):v("",!0)]),_:1},8,["modelValue"])),[[wl]])])}}},[["__scopeId","data-v-2f4bee76"]]);export{Ge as default};
