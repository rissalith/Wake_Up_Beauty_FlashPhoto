import{r as e,i as a,c as l,o as t,d as o,G as n,e as s,w as i,f as r,I as d,h as u,j as c,X as m,H as v,t as _,J as p,E as f,l as h}from"./index-zvIQdR65.js";import{_ as y,e as g}from"./_plugin-vue_export-helper-D822DtMY.js";const b={class:"category-management"},w={class:"page-header"},V={class:"header-right"},k={class:"category-list"},C={class:"category-info"},U={class:"icon-placeholder"},x={key:1,class:"icon-placeholder"},j={class:"category-detail"},z={class:"category-name"},L={key:0,class:"category-name-en"},R={class:"template-count"},A={class:"action-btns"},I=y({__name:"Categories",setup(y){const I=e(!1),q=e([]),E=e(!1),G=e(!1),H=e(!1),J=e(null),X=e(null),$=e({name:"",name_en:"",icon:"",sort_order:0}),B={name:[{required:!0,message:"请输入分类名称",trigger:"blur"}]},D=async()=>{I.value=!0;try{const e=await g.getList();200===e.code&&(q.value=e.data||[])}catch(e){console.error("加载分类失败:",e)}finally{I.value=!1}},F=()=>{G.value=!1,X.value=null,$.value={name:"",name_en:"",icon:"",sort_order:q.value.length},E.value=!0},K=async()=>{J.value&&await J.value.validate(async e=>{if(e){H.value=!0;try{G.value?(await g.update(X.value,$.value),f.success("更新成功")):(await g.create($.value),f.success("创建成功")),E.value=!1,D()}catch(a){console.error("保存失败:",a)}finally{H.value=!1}}})};return a(()=>{D()}),(e,a)=>{const y=r("el-icon"),M=r("el-button"),N=r("el-input-number"),O=r("el-table-column"),P=r("el-image"),Q=r("el-switch"),S=r("el-table"),T=r("el-input"),W=r("el-form-item"),Y=r("el-form"),Z=r("el-dialog"),ee=d("loading");return t(),l("div",b,[o("div",w,[a[7]||(a[7]=o("div",{class:"header-left"},[o("h2",null,"分类管理"),o("span",{class:"subtitle"},"管理模板市场的分类标签")],-1)),o("div",V,[s(M,{type:"primary",onClick:F},{default:i(()=>[s(y,null,{default:i(()=>[s(c(m))]),_:1}),a[6]||(a[6]=u(" 新增分类 ",-1))]),_:1})])]),n((t(),l("div",k,[s(S,{data:q.value,"row-key":"id","empty-text":"暂无分类数据"},{default:i(()=>[s(O,{label:"排序",width:"100",align:"center"},{default:i(({row:e})=>[s(N,{modelValue:e.sort_order,"onUpdate:modelValue":a=>e.sort_order=a,min:0,max:999,size:"small","controls-position":"right",onChange:a=>(async e=>{try{await g.update(e.id,{sort_order:e.sort_order}),f.success("排序已更新"),D()}catch(a){console.error("更新排序失败:",a)}})(e),style:{width:"80px"}},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),s(O,{label:"分类名称","min-width":"200"},{default:i(({row:e})=>{var a;return[o("div",C,[e.icon?(t(),v(P,{key:0,class:"category-icon",src:e.icon,fit:"cover"},{error:i(()=>{var a;return[o("div",U,_((null==(a=e.name)?void 0:a.charAt(0))||"?"),1)]}),_:2},1032,["src"])):(t(),l("div",x,_((null==(a=e.name)?void 0:a.charAt(0))||"?"),1)),o("div",j,[o("div",z,_(e.name),1),e.name_en?(t(),l("div",L,_(e.name_en),1)):p("",!0)])])]}),_:1}),s(O,{label:"模板数量",width:"120",align:"center"},{default:i(({row:e})=>[o("span",R,_(e.template_count||0),1)]),_:1}),s(O,{label:"显示状态",width:"120",align:"center"},{default:i(({row:e})=>[s(Q,{modelValue:e.is_visible,"onUpdate:modelValue":a=>e.is_visible=a,"active-value":1,"inactive-value":0,onChange:a=>(async e=>{try{await g.update(e.id,{is_visible:e.is_visible}),f.success(e.is_visible?"已显示":"已隐藏")}catch(a){console.error("更新状态失败:",a),e.is_visible=e.is_visible?0:1}})(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),s(O,{label:"操作",width:"150",fixed:"right"},{default:i(({row:e})=>[o("div",A,[s(M,{type:"primary",link:"",size:"small",onClick:a=>(e=>{G.value=!0,X.value=e.id,$.value={name:e.name,name_en:e.name_en||"",icon:e.icon||"",sort_order:e.sort_order||0},E.value=!0})(e)},{default:i(()=>[...a[8]||(a[8]=[u("编辑",-1)])]),_:1},8,["onClick"]),s(M,{type:"danger",link:"",size:"small",onClick:a=>(async e=>{if(e.template_count>0)f.warning("该分类下有模板，无法删除");else try{await h.confirm(`确定要删除分类「${e.name}」吗？`,"删除确认",{type:"warning"}),await g.delete(e.id),f.success("删除成功"),D()}catch(a){"cancel"!==a&&console.error("删除失败:",a)}})(e),disabled:e.template_count>0},{default:i(()=>[...a[9]||(a[9]=[u("删除",-1)])]),_:1},8,["onClick","disabled"])])]),_:1})]),_:1},8,["data"])])),[[ee,I.value]]),s(Z,{modelValue:E.value,"onUpdate:modelValue":a[5]||(a[5]=e=>E.value=e),title:G.value?"编辑分类":"新增分类",width:"500px"},{footer:i(()=>[s(M,{onClick:a[4]||(a[4]=e=>E.value=!1)},{default:i(()=>[...a[11]||(a[11]=[u("取消",-1)])]),_:1}),s(M,{type:"primary",onClick:K,loading:H.value},{default:i(()=>[...a[12]||(a[12]=[u("确定",-1)])]),_:1},8,["loading"])]),default:i(()=>[s(Y,{model:$.value,rules:B,ref_key:"formRef",ref:J,"label-width":"100px"},{default:i(()=>[s(W,{label:"分类名称",prop:"name"},{default:i(()=>[s(T,{modelValue:$.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>$.value.name=e),placeholder:"请输入中文名称"},null,8,["modelValue"])]),_:1}),s(W,{label:"英文名称"},{default:i(()=>[s(T,{modelValue:$.value.name_en,"onUpdate:modelValue":a[1]||(a[1]=e=>$.value.name_en=e),placeholder:"请输入英文名称（可选）"},null,8,["modelValue"])]),_:1}),s(W,{label:"图标URL"},{default:i(()=>[s(T,{modelValue:$.value.icon,"onUpdate:modelValue":a[2]||(a[2]=e=>$.value.icon=e),placeholder:"请输入图标URL（可选）"},null,8,["modelValue"])]),_:1}),s(W,{label:"排序权重"},{default:i(()=>[s(N,{modelValue:$.value.sort_order,"onUpdate:modelValue":a[3]||(a[3]=e=>$.value.sort_order=e),min:0,max:999},null,8,["modelValue"]),a[10]||(a[10]=o("span",{class:"form-tip"},"数值越小越靠前",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-80630bab"]]);export{I as default};
