import{r as a,i as s,bs as e,c as l,o as c,d as i,e as r,H as t,w as n,f as u,h as d,t as v,Q as o,J as m,O as p,P as f,j as g,aa as y,ck as b,cl as _,cm as k,cn as h,co as w,cp as x,cq as C,cr as P,a2 as z,cs as M,ct as R,S as j,ab as B,cu as D,cv as E,l as I,E as N}from"./index-L24IvDQP.js";import{_ as S,c as T}from"./_plugin-vue_export-helper-EDQBBoSw.js";const $={class:"monitor-dashboard"},q={class:"status-indicator"},F={class:"status-text"},O={key:0},U={key:1},W={key:2},A={key:3},H={class:"status-time"},J={class:"quick-links"},L={class:"service-header"},Q={class:"service-icon"},V={class:"service-name"},G={class:"service-port"},K={class:"service-metrics"},X={class:"metric"},Y={class:"metric-value"},Z={class:"metric"},aa={class:"metric-value"},sa={class:"metric"},ea={class:"metric-value"},la={class:"metric"},ca={class:"metric-value"},ia={class:"service-actions"},ra={class:"service-header"},ta={class:"service-icon nginx"},na={class:"service-metrics"},ua={class:"metric"},da={class:"metric-value"},va={class:"metric"},oa={class:"metric-value"},ma={class:"service-header"},pa={class:"service-icon portainer"},fa={class:"service-actions"},ga={class:"page-card"},ya={class:"card-body"},ba={class:"resource-item"},_a={class:"resource-label"},ka={class:"resource-detail"},ha={class:"resource-item"},wa={class:"resource-label"},xa={class:"resource-detail"},Ca={class:"resource-item"},Pa={class:"resource-label"},za={class:"resource-value"},Ma={class:"resource-item"},Ra={class:"resource-label"},ja={class:"resource-value"},Ba={class:"page-card"},Da={class:"card-header"},Ea={class:"card-body"},Ia={class:"db-info"},Na={class:"db-item"},Sa={class:"db-value"},Ta={class:"db-item"},$a={class:"db-value"},qa={class:"db-item"},Fa={class:"db-value"},Oa={class:"db-item"},Ua={class:"db-value"},Wa={class:"db-path"},Aa={class:"page-card logs-card"},Ha={class:"card-header"},Ja={class:"card-body"},La={class:"logs-container"},Qa={key:0,class:"no-logs"},Va=S({__name:"Monitor",setup(S){const Va=a(!1),Ga=a(!1),Ka=a("unknown"),Xa=a("-"),Ya=a([]),Za=a({}),as=a({}),ss=a({}),es=a([]),ls=a(null),cs=a("https://pop-pub.com:9443");let is=null;const rs=async()=>{Va.value=!0;try{const a=await T.get("/monitor/status");0===a.code&&(Ka.value=a.overallStatus,Ya.value=a.services||[],Za.value=a.nginx||{},as.value=a.system||{},ss.value=a.database||{},Xa.value=(new Date).toLocaleTimeString())}catch(a){console.error("加载监控状态失败:",a),Ka.value="critical"}finally{Va.value=!1}},ts=async()=>{Ga.value=!0;try{const a=await T.get("/monitor/logs",{params:{lines:30}});0===a.code&&(es.value=a.logs||[])}catch(a){console.error("加载日志失败:",a)}finally{Ga.value=!1}},ns=a=>a>=90?"#f56c6c":a>=70?"#e6a23c":"#67c23a",us=a=>a.includes("error")||a.includes("Error")||a.includes("ERROR")?"error":a.includes("warn")||a.includes("Warning")||a.includes("WARN")?"warn":"info",ds=()=>{window.open(cs.value,"_blank")};return s(()=>{rs(),ts(),is=setInterval(rs,1e4)}),e(()=>{is&&clearInterval(is)}),(a,s)=>{const e=u("el-icon"),S=u("el-button"),cs=u("el-col"),is=u("el-row"),vs=u("el-progress"),os=u("el-tag");return c(),l("div",$,[i("div",{class:o(["overall-status",Ka.value])},[i("div",q,["healthy"===Ka.value?(c(),t(e,{key:0,class:"status-icon"},{default:n(()=>[r(g(y))]),_:1})):"warning"===Ka.value?(c(),t(e,{key:1,class:"status-icon"},{default:n(()=>[r(g(b))]),_:1})):(c(),t(e,{key:2,class:"status-icon"},{default:n(()=>[r(g(_))]),_:1}))]),i("div",F,["healthy"===Ka.value?(c(),l("span",O,"所有服务运行正常")):"warning"===Ka.value?(c(),l("span",U,"部分服务存在告警")):"critical"===Ka.value?(c(),l("span",W,"有服务离线")):(c(),l("span",A,"正在检测..."))]),i("div",H,[d(" 最后更新: "+v(Xa.value)+" ",1),r(S,{link:"",type:"primary",onClick:rs,loading:Va.value},{default:n(()=>[r(e,null,{default:n(()=>[r(g(k))]),_:1})]),_:1},8,["loading"])]),i("div",J,[r(S,{type:"primary",onClick:ds},{default:n(()=>[r(e,null,{default:n(()=>[r(g(h))]),_:1}),s[0]||(s[0]=d(" Portainer 容器管理 ",-1))]),_:1})])],2),r(is,{gutter:20,class:"services-row"},{default:n(()=>[(c(!0),l(p,null,f(Ya.value,a=>(c(),t(cs,{xs:24,sm:12,md:8,key:a.name},{default:n(()=>{var l;return[i("div",{class:o(["service-card",a.status])},[i("div",L,[i("div",Q,["miniprogram-api"===a.name?(c(),t(e,{key:0},{default:n(()=>[r(g(w))]),_:1})):"flashphoto-api"===a.name?(c(),t(e,{key:1},{default:n(()=>[r(g(x))]),_:1})):(c(),t(e,{key:2},{default:n(()=>[r(g(C))]),_:1}))]),i("div",{class:o(["service-status-badge",a.status])},v("online"===a.status?"在线":"offline"===a.status?"离线":"超时"),3)]),i("div",V,v(a.displayName),1),i("div",G,"端口 :"+v(a.port),1),i("div",K,[i("div",X,[s[1]||(s[1]=i("span",{class:"metric-label"},"运行时间",-1)),i("span",Y,v(a.uptimeFormatted||"-"),1)]),i("div",Z,[s[2]||(s[2]=i("span",{class:"metric-label"},"内存使用",-1)),i("span",aa,v((null==(l=a.memory)?void 0:l.heapUsed)||0)+" MB",1)]),i("div",sa,[s[3]||(s[3]=i("span",{class:"metric-label"},"响应时间",-1)),i("span",ea,v(a.responseTime||"-"),1)]),i("div",la,[s[4]||(s[4]=i("span",{class:"metric-label"},"重启次数",-1)),i("span",ca,v(a.restarts??"-"),1)])]),i("div",ia,[r(S,{size:"small",type:"warning",onClick:s=>(async a=>{try{await I.confirm(`确定要重启服务 ${a} 吗？这可能会导致短暂的服务中断。`,"重启确认",{type:"warning"}),ls.value=a;const s=await T.post(`/monitor/restart/${a}`);0===s.code?(N.success(`服务 ${a} 重启成功`),setTimeout(rs,3e3)):N.error(s.error||"重启失败")}catch(s){"cancel"!==s&&N.error("重启服务失败")}finally{ls.value=null}})(a.name),loading:ls.value===a.name},{default:n(()=>[r(e,null,{default:n(()=>[r(g(k))]),_:1}),s[5]||(s[5]=d(" 重启 ",-1))]),_:1},8,["onClick","loading"])])],2)]}),_:2},1024))),128)),r(cs,{xs:24,sm:12,md:8},{default:n(()=>[i("div",{class:o(["service-card nginx-card","running"===Za.value.status?"online":"offline"])},[i("div",ra,[i("div",ta,[r(e,null,{default:n(()=>[r(g(P))]),_:1})]),i("div",{class:o(["service-status-badge","running"===Za.value.status?"online":"offline"])},v("running"===Za.value.status?"运行中":"异常"),3)]),s[8]||(s[8]=i("div",{class:"service-name"},"Nginx 反向代理",-1)),s[9]||(s[9]=i("div",{class:"service-port"},"端口 :80/443",-1)),i("div",na,[i("div",ua,[s[6]||(s[6]=i("span",{class:"metric-label"},"版本",-1)),i("span",da,v(Za.value.version||"-"),1)]),i("div",va,[s[7]||(s[7]=i("span",{class:"metric-label"},"配置状态",-1)),i("span",oa,v(Za.value.configValid?"✓ 有效":"✗ 无效"),1)])])],2)]),_:1}),r(cs,{xs:24,sm:12,md:8},{default:n(()=>[i("div",{class:"service-card portainer-card online",onClick:ds},[i("div",ma,[i("div",pa,[r(e,null,{default:n(()=>[r(g(h))]),_:1})]),s[10]||(s[10]=i("div",{class:"service-status-badge external"}," 外部链接 ",-1))]),s[12]||(s[12]=i("div",{class:"service-name"},"Portainer 容器管理",-1)),s[13]||(s[13]=i("div",{class:"service-port"},"Docker 可视化管理面板",-1)),s[14]||(s[14]=i("div",{class:"service-metrics"},[i("div",{class:"metric full-width"},[i("span",{class:"metric-label"},"功能说明"),i("span",{class:"metric-value"},"实时监控 Docker 容器状态、日志、资源使用")])],-1)),i("div",fa,[r(S,{type:"primary",onClick:z(ds,["stop"])},{default:n(()=>[r(e,null,{default:n(()=>[r(g(M))]),_:1}),s[11]||(s[11]=d(" 打开 Portainer ",-1))]),_:1})])])]),_:1})]),_:1}),r(is,{gutter:20,class:"system-row"},{default:n(()=>[r(cs,{xs:24,md:12},{default:n(()=>{var a,l,c,t,u,o,m,p;return[i("div",ga,[s[19]||(s[19]=i("div",{class:"card-header"},[i("span",{class:"card-title"},"系统资源")],-1)),i("div",ya,[i("div",ba,[i("div",_a,[r(e,null,{default:n(()=>[r(g(R))]),_:1}),s[15]||(s[15]=d(" CPU 使用率 ",-1))]),r(vs,{percentage:(null==(a=as.value.cpu)?void 0:a.usage)||0,color:ns(null==(l=as.value.cpu)?void 0:l.usage)},null,8,["percentage","color"]),i("span",ka,v((null==(c=as.value.cpu)?void 0:c.cores)||0)+" 核心 / "+v((null==(t=as.value.cpu)?void 0:t.model)||"-"),1)]),i("div",ha,[i("div",wa,[r(e,null,{default:n(()=>[r(g(j))]),_:1}),s[16]||(s[16]=d(" 内存使用 ",-1))]),r(vs,{percentage:(null==(u=as.value.memory)?void 0:u.usagePercent)||0,color:ns(null==(o=as.value.memory)?void 0:o.usagePercent)},null,8,["percentage","color"]),i("span",xa,v((null==(m=as.value.memory)?void 0:m.used)||0)+" MB / "+v((null==(p=as.value.memory)?void 0:p.total)||0)+" MB",1)]),i("div",Ca,[i("div",Pa,[r(e,null,{default:n(()=>[r(g(B))]),_:1}),s[17]||(s[17]=d(" 系统运行时间 ",-1))]),i("span",za,v(as.value.uptimeFormatted||"-"),1)]),i("div",Ma,[i("div",Ra,[r(e,null,{default:n(()=>[r(g(D))]),_:1}),s[18]||(s[18]=d(" 服务器信息 ",-1))]),i("span",ja,v(as.value.hostname)+" / "+v(as.value.platform)+" "+v(as.value.arch),1)])])])]}),_:1}),r(cs,{xs:24,md:12},{default:n(()=>{var a,l,c;return[i("div",Ba,[i("div",Da,[s[20]||(s[20]=i("span",{class:"card-title"},"数据库状态",-1)),r(os,{type:"connected"===ss.value.status?"success":"danger",size:"small"},{default:n(()=>[d(v("connected"===ss.value.status?"已连接":"断开"),1)]),_:1},8,["type"])]),i("div",Ea,[i("div",Ia,[i("div",Na,[s[21]||(s[21]=i("span",{class:"db-label"},"数据库大小",-1)),i("span",Sa,v(ss.value.size||"-"),1)]),i("div",Ta,[s[22]||(s[22]=i("span",{class:"db-label"},"用户数量",-1)),i("span",$a,v((null==(a=ss.value.stats)?void 0:a.users)||0),1)]),i("div",qa,[s[23]||(s[23]=i("span",{class:"db-label"},"照片数量",-1)),i("span",Fa,v((null==(l=ss.value.stats)?void 0:l.photos)||0),1)]),i("div",Oa,[s[24]||(s[24]=i("span",{class:"db-label"},"订单数量",-1)),i("span",Ua,v((null==(c=ss.value.stats)?void 0:c.orders)||0),1)])]),i("div",Wa,[r(e,null,{default:n(()=>[r(g(E))]),_:1}),i("span",null,v(ss.value.path||"-"),1)])])])]}),_:1})]),_:1}),i("div",Aa,[i("div",Ha,[s[26]||(s[26]=i("span",{class:"card-title"},"最近日志",-1)),r(S,{size:"small",onClick:ts,loading:Ga.value},{default:n(()=>[r(e,null,{default:n(()=>[r(g(k))]),_:1}),s[25]||(s[25]=d(" 刷新 ",-1))]),_:1},8,["loading"])]),i("div",Ja,[i("div",La,[(c(!0),l(p,null,f(es.value,(a,s)=>(c(),l("div",{key:s,class:o(["log-line",us(a)])},v(a),3))),128)),0===es.value.length?(c(),l("div",Qa,"暂无日志")):m("",!0)])])])])}}},[["__scopeId","data-v-69cdde91"]]);export{Va as default};
